import{E as ce,aC as pe,r as x,c as ee,o as e,bB as be,R as ie,C as ae,p as _,v as T,I as ge,b2 as te,F as ye,x as f,w as C,z as A,bC as M,bD as fe,bu as je,bE as Ne,bv as ve,bF as we,bG as ke,bH as Ce,bI as Ae,bJ as Ee,bK as De,ak as Pe}from"./index-jd7Ax_Ed.js";import{u as Se}from"./chartOfAccountsApi-DmTn-F78.js";import{u as Me}from"./banksApi-DQwHDPrA.js";import{u as H}from"./useMutation-n-l4Ns3H.js";import{P as le}from"./plus-C2o0386P.js";import{C as _e}from"./check-circle-8oGxTki5.js";import{E as Le}from"./eye-DMmE8Niy.js";import{P as Be}from"./printer-BkLl9NNZ.js";import{T as Fe}from"./trash-2-DCbqoVbR.js";/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Te=ce("ArrowLeftRight",[["path",{d:"M8 3 4 7l4 4",key:"9rb6wj"}],["path",{d:"M4 7h16",key:"6tx8e3"}],["path",{d:"m16 21 4-4-4-4",key:"siv7j2"}],["path",{d:"M20 17H4",key:"h6l3hr"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $e=ce("Pencil",[["path",{d:"M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z",key:"5qss01"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]]),ne={name:"",description:"",amount:"",dayOfMonth:1,reminderDaysBefore:3,defaultPaymentType:"cash",expenseAccount:"",bank:"",notes:"",startFromDate:""},Re=n=>{if(!n)return null;const h=new Date;h.setHours(0,0,0,0);const b=new Date(n);b.setHours(0,0,0,0);const j=b.getTime()-h.getTime();return Math.round(j/(1e3*60*60*24))},ze=n=>n!=null&&n.supplier?n.supplier.displayName||n.supplier.companyName||n.supplier.businessName||n.supplier.name:n!=null&&n.customer?n.customer.displayName||n.customer.businessName||n.customer.name||[n.customer.firstName,n.customer.lastName].filter(Boolean).join(" "):"General Expense",Oe=({expenseAccounts:n=[],onPaymentRecorded:h})=>{const b=pe(),[j,E]=x.useState(!1),[l,o]=x.useState(ne),[N,y]=x.useState(7),{data:$,isLoading:v,isFetching:p}=ee(["recurringExpensesUpcoming",N],()=>M.getUpcoming({days:N}),{keepPreviousData:!0,refetchInterval:6e4}),{data:R,isLoading:W}=ee(["recurringExpensesList"],()=>M.getRecurringExpenses({status:"active"}),{keepPreviousData:!0}),{data:u,isLoading:J}=ee(["banks",{isActive:!0}],()=>fe.getBanks({isActive:!0}),{staleTime:5*6e4}),L=s=>{var c,m;return s?Array.isArray(s)?s:Array.isArray(s==null?void 0:s.data)?s.data:Array.isArray(s==null?void 0:s.expenses)?s.expenses:Array.isArray((c=s==null?void 0:s.data)==null?void 0:c.recurringExpenses)?s.data.recurringExpenses:Array.isArray((m=s==null?void 0:s.data)==null?void 0:m.items)?s.data.items:[]:[]},g=x.useMemo(()=>L($),[$]),z=x.useMemo(()=>L(R),[R]),O=x.useMemo(()=>{var s;return((s=u==null?void 0:u.data)==null?void 0:s.banks)||(u==null?void 0:u.banks)||[]},[u]),B=x.useMemo(()=>Array.isArray(n)?n:[],[n]),w=()=>{o(ne)},D=()=>{b.invalidateQueries("recurringExpensesUpcoming"),b.invalidateQueries("recurringExpensesList"),b.invalidateQueries("cashPayments"),b.invalidateQueries("bankPayments")},P=H(s=>M.createRecurringExpense(s),{onSuccess:()=>{A("Recurring expense created"),D(),E(!1),w()},onError:s=>{f(C(s))}}),Q=H(({id:s,payload:c})=>M.recordPayment(s,c),{onSuccess:s=>{A("Payment recorded successfully"),D(),typeof h=="function"&&h(s==null?void 0:s.data)},onError:s=>{f(C(s))}}),U=H(s=>M.deactivateRecurringExpense(s),{onSuccess:()=>{A("Recurring expense deactivated"),D()},onError:s=>{f(C(s))}}),q=H(({id:s,payload:c})=>M.snoozeRecurringExpense(s,c),{onSuccess:()=>{A("Reminder updated"),D()},onError:s=>{f(C(s))}}),K=s=>{const c=B.find(m=>m._id===s);o(m=>({...m,expenseAccount:s,name:c?c.accountName:""}))},Y=s=>{var m,G;if(s.preventDefault(),!l.expenseAccount){f("Please select an expense account");return}const c={name:l.name.trim(),description:((m=l.description)==null?void 0:m.trim())||void 0,amount:parseFloat(l.amount),dayOfMonth:Number(l.dayOfMonth),reminderDaysBefore:Number(l.reminderDaysBefore),defaultPaymentType:l.defaultPaymentType,expenseAccount:l.expenseAccount||void 0,bank:l.defaultPaymentType==="bank"&&l.bank||void 0,notes:((G=l.notes)==null?void 0:G.trim())||void 0,startFromDate:l.startFromDate||void 0};P.mutate(c)},Z=s=>{Q.mutate({id:s._id,payload:{paymentType:s.defaultPaymentType,notes:`Recurring payment for ${s.name}`}})},I=(s,c=3)=>{q.mutate({id:s._id,payload:{snoozeDays:c}})},X=s=>{U.mutate(s)},k=P.isLoading||Q.isLoading||U.isLoading||q.isLoading;return e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"card-header flex flex-col md:flex-row md:items-center md:justify-between space-y-4 md:space-y-0",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-lg font-semibold text-gray-900 flex items-center space-x-2",children:[e.jsx(be,{className:"h-5 w-5 text-primary-600"}),e.jsx("span",{children:"Recurring Expense Reminders"})]}),e.jsx("p",{className:"text-sm text-gray-600",children:"Track monthly obligations and record payments in a single click."})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("label",{className:"text-sm text-gray-600",children:"Show next"}),e.jsxs("select",{value:N,onChange:s=>y(Number(s.target.value)),className:"input w-24",children:[e.jsx("option",{value:3,children:"3 days"}),e.jsx("option",{value:7,children:"7 days"}),e.jsx("option",{value:14,children:"14 days"}),e.jsx("option",{value:30,children:"30 days"})]}),e.jsxs("button",{type:"button",onClick:()=>b.invalidateQueries("recurringExpensesUpcoming"),className:"btn btn-light flex items-center space-x-1",disabled:p,children:[e.jsx(ie,{className:`h-4 w-4 ${p?"animate-spin":""}`}),e.jsx("span",{children:"Refresh"})]}),e.jsx("button",{type:"button",className:"btn btn-primary",onClick:()=>E(s=>!s),children:j?"Close":"Add Recurring Expense"})]})]}),e.jsxs("div",{className:"card-content space-y-6",children:[j&&e.jsxs("div",{className:"border border-dashed border-primary-200 rounded-lg p-4 bg-primary-50/40",children:[e.jsxs("h3",{className:"text-sm font-semibold text-primary-700 flex items-center space-x-2 mb-3",children:[e.jsx(le,{className:"h-4 w-4"}),e.jsx("span",{children:"Create Recurring Expense"})]}),e.jsxs("form",{onSubmit:Y,className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"form-label",children:"Expense Account*"}),e.jsxs("select",{className:"input",value:l.expenseAccount,onChange:s=>K(s.target.value),required:!0,children:[e.jsx("option",{value:"",children:"Select expense account"}),B.map(s=>e.jsxs("option",{value:s._id,children:[s.accountName," (",s.accountCode,")"]},s._id))]}),l.name&&e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Selected: ",l.name]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"form-label",children:"Amount*"}),e.jsx("input",{type:"number",min:"0",step:"0.01",className:"input",value:l.amount,onChange:s=>o(c=>({...c,amount:s.target.value})),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"form-label",children:"Due Day of Month*"}),e.jsx("input",{type:"number",min:"1",max:"31",className:"input",value:l.dayOfMonth,onChange:s=>o(c=>({...c,dayOfMonth:Number(s.target.value)})),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"form-label",children:"Reminder (days before)"}),e.jsx("input",{type:"number",min:"0",max:"31",className:"input",value:l.reminderDaysBefore,onChange:s=>o(c=>({...c,reminderDaysBefore:Number(s.target.value)}))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"form-label",children:"Default Payment Type*"}),e.jsxs("select",{className:"input",value:l.defaultPaymentType,onChange:s=>o(c=>({...c,defaultPaymentType:s.target.value,bank:s.target.value==="bank"?c.bank:""})),children:[e.jsx("option",{value:"cash",children:"Cash"}),e.jsx("option",{value:"bank",children:"Bank"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"form-label",children:"Start From"}),e.jsx("input",{type:"date",className:"input",value:l.startFromDate,onChange:s=>o(c=>({...c,startFromDate:s.target.value}))})]}),l.defaultPaymentType==="bank"&&e.jsxs("div",{children:[e.jsx("label",{className:"form-label",children:"Bank Account*"}),e.jsxs("select",{className:"input",value:l.bank,onChange:s=>o(c=>({...c,bank:s.target.value})),required:!0,disabled:J,children:[e.jsx("option",{value:"",children:"Select bank account"}),O.map(s=>e.jsxs("option",{value:s._id,children:[s.bankName," • ",s.accountNumber,s.accountName?` (${s.accountName})`:""]},s._id))]})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"form-label",children:"Notes"}),e.jsx("textarea",{className:"input",rows:2,value:l.notes,onChange:s=>o(c=>({...c,notes:s.target.value}))})]}),e.jsxs("div",{className:"md:col-span-2 flex justify-end space-x-3",children:[e.jsx("button",{type:"button",className:"btn btn-light",onClick:()=>{E(!1),w()},disabled:P.isLoading,children:"Cancel"}),e.jsx("button",{type:"submit",className:"btn btn-primary",disabled:k||!l.amount||!l.expenseAccount,children:P.isLoading?"Saving...":"Save Recurring Expense"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"border rounded-lg p-4 bg-gray-50",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("h3",{className:"text-sm font-semibold text-gray-700 flex items-center space-x-2",children:[e.jsx(ae,{className:"h-4 w-4 text-primary-500"}),e.jsx("span",{children:"Upcoming"})]}),(v||p)&&e.jsx("span",{className:"text-xs text-gray-500",children:"Loading..."})]}),g.length===0?e.jsxs("div",{className:"text-center text-sm text-gray-500 bg-white border border-dashed border-gray-200 rounded-lg py-6",children:[e.jsx(_e,{className:"h-5 w-5 mx-auto text-success-500 mb-2"}),e.jsxs("p",{children:["No reminders due in the next ",N," days."]})]}):e.jsx("div",{className:"space-y-3",children:g.map(s=>{const c=Re(s.nextDueDate),m=typeof c=="number"&&c<0;return e.jsx("div",{className:`rounded-lg border bg-white p-4 shadow-sm ${m?"border-danger-200 bg-danger-50/40":"border-gray-200"}`,children:e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-3",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("h4",{className:"font-semibold text-gray-900",children:s.name}),e.jsx("span",{className:"text-xs px-2 py-1 rounded-full bg-primary-100 text-primary-700",children:s.defaultPaymentType==="bank"?"Bank":"Cash"})]}),e.jsxs("p",{className:"text-sm text-gray-600",children:[_(s.amount)," • Due ",T(s.nextDueDate)]}),e.jsx("p",{className:"text-xs text-gray-500",children:ze(s)})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:`flex items-center space-x-1 text-sm font-semibold ${m?"text-danger-600":"text-primary-600"}`,children:m?e.jsxs(e.Fragment,{children:[e.jsx(ge,{className:"h-4 w-4"}),e.jsxs("span",{children:[Math.abs(c)," day(s) overdue"]})]}):e.jsxs(e.Fragment,{children:[e.jsx(te,{className:"h-4 w-4"}),e.jsxs("span",{children:[c," day(s) left"]})]})}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs("button",{type:"button",className:"btn btn-secondary flex items-center space-x-1",onClick:()=>I(s,3),disabled:k,children:[e.jsx(ae,{className:"h-4 w-4"}),e.jsx("span",{children:"Snooze 3d"})]}),e.jsxs("button",{type:"button",className:"btn btn-primary flex items-center space-x-1",onClick:()=>Z(s),disabled:k,children:[e.jsx(ye,{className:"h-4 w-4"}),e.jsx("span",{children:"Record Payment"})]})]})]})]})},s._id)})})]}),e.jsxs("div",{className:"border rounded-lg p-4 bg-white",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("h3",{className:"text-sm font-semibold text-gray-700 flex items-center space-x-2",children:[e.jsx(te,{className:"h-4 w-4 text-gray-500"}),e.jsx("span",{children:"Active Recurring Expenses"})]}),W&&e.jsx("span",{className:"text-xs text-gray-500",children:"Loading..."})]}),z.length===0?e.jsx("div",{className:"text-center text-sm text-gray-500 border border-dashed border-gray-200 rounded-lg py-6",children:e.jsx("p",{children:"No recurring expenses configured yet."})}):e.jsx("div",{className:"max-h-72 overflow-y-auto divide-y",children:z.map(s=>e.jsxs("div",{className:"py-3 flex items-start justify-between space-x-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-gray-800",children:s.name}),e.jsxs("p",{className:"text-xs text-gray-500",children:["Due every month on day ",s.dayOfMonth," •"," ",s.reminderDaysBefore," day(s) reminder"]}),e.jsxs("p",{className:"text-xs text-gray-500",children:["Next: ",T(s.nextDueDate)," • ",_(s.amount)]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("button",{type:"button",className:"btn btn-light text-xs",onClick:()=>I(s,30),disabled:k,children:"Skip Month"}),e.jsx("button",{type:"button",className:"btn btn-danger text-xs",onClick:()=>X(s._id),disabled:k,children:"Deactivate"})]})]},s._id))})]})]})]})]})},de=new Date().toISOString().split("T")[0],re={date:de,expenseAccount:"",amount:"",notes:"",bank:"",particular:""},Ke=()=>{const[n,h]=x.useState(re),[b,j]=x.useState("cash"),[E,l]=x.useState([]),[o,N]=x.useState(null),{data:y,isLoading:$}=Se({accountType:"expense",isActive:"true"}),v=x.useMemo(()=>{var t;return((t=y==null?void 0:y.data)==null?void 0:t.accounts)||(y==null?void 0:y.accounts)||(y==null?void 0:y.data)||[]},[y]),{data:p,isLoading:R}=Me({isActive:!0}),W=x.useMemo(()=>{var t;return((t=p==null?void 0:p.data)==null?void 0:t.banks)||(p==null?void 0:p.banks)||(p==null?void 0:p.data)||[]},[p]),{data:u,isFetching:J}=je({limit:20}),L=x.useMemo(()=>{var a,r,i;return(((a=u==null?void 0:u.data)==null?void 0:a.cashPayments)||(u==null?void 0:u.cashPayments)||((i=(r=u==null?void 0:u.data)==null?void 0:r.data)==null?void 0:i.cashPayments)||[]).filter(d=>!(d!=null&&d.supplier)&&!(d!=null&&d.customer))},[u]),{data:g,isFetching:z}=Ne({limit:20}),O=x.useMemo(()=>{var a,r,i;return(((a=g==null?void 0:g.data)==null?void 0:a.bankPayments)||(g==null?void 0:g.bankPayments)||((i=(r=g==null?void 0:g.data)==null?void 0:r.data)==null?void 0:i.bankPayments)||[]).filter(d=>!(d!=null&&d.supplier)&&!(d!=null&&d.customer))},[g]),B=x.useMemo(()=>[...(L||[]).map(a=>({...a,source:"cash"})),...(O||[]).map(a=>({...a,source:"bank"})),...E].filter((a,r,i)=>(a==null?void 0:a._id)&&r===i.findIndex(d=>d._id===a._id)).sort((a,r)=>new Date(r.date||r.createdAt)-new Date(a.date||a.createdAt)).slice(0,25),[L,O,E]),w=t=>{if(t==null)return"";if(typeof t=="string")return t;if(typeof t=="number")return`${t}`;if(typeof t=="boolean")return t?"Yes":"No";if(Array.isArray(t)){const a=t.find(r=>r!=null);return w(a)}if(typeof t=="object"){const a=["label","name","accountName","bankName","displayName","companyName","businessName","type","title","code","id","_id"];for(const r of a)if(r in t){const i=w(t[r]);if(i)return i}}return""},D=t=>{if(!t)return"cash";const{source:a,bank:r}=t,i=w(a);if(i)return i;if(r){const d=w(r);return d||"bank"}return"cash"},[P,{isLoading:Q}]=ve(),[U,{isLoading:q}]=we(),[K]=ke(),[Y,{isLoading:Z}]=Ce(),[I,{isLoading:X}]=Ae(),[k]=Ee(),s=async t=>{try{let a;(o==null?void 0:o.source)==="cash"?a=await U({id:o._id,...t}).unwrap():a=await P(t).unwrap();const r=(a==null?void 0:a.data)||a;if(r){const i={...r,source:"cash"};l(d=>{const F=d.filter(S=>S._id!==i._id);return[i,...F].slice(0,10)})}A(o?"Cash expense updated successfully":"Cash expense recorded successfully"),V()}catch(a){f(C(a))}},c=async t=>{try{let a;(o==null?void 0:o.source)==="bank"?a=await I({id:o._id,...t}).unwrap():a=await Y(t).unwrap();const r=(a==null?void 0:a.data)||a;if(r){const i={...r,source:"bank"};l(d=>{const F=d.filter(S=>S._id!==i._id);return[i,...F].slice(0,10)})}A(o?"Bank expense updated successfully":"Bank expense recorded successfully"),V()}catch(a){f(C(a))}},m=x.useMemo(()=>v.find(t=>t._id===n.expenseAccount),[v,n.expenseAccount]),G=t=>{h(a=>({...a,expenseAccount:t,particular:a.particular||(()=>{const r=v.find(i=>i._id===t);return r?r.accountName:""})()}))},V=()=>{h(re),j("cash"),N(null)},oe=t=>{var r,i;if(t.preventDefault(),!n.expenseAccount){f("Please choose an expense account");return}if(!n.amount||Number(n.amount)<=0){f("Amount must be greater than zero");return}const a={date:n.date,amount:parseFloat(n.amount),particular:((r=n.particular)==null?void 0:r.trim())||(m==null?void 0:m.accountName)||"Expense",expenseAccount:n.expenseAccount,notes:((i=n.notes)==null?void 0:i.trim())||void 0};if(b==="bank"){if(!n.bank){f("Please select a bank account for this expense");return}c({...a,bank:n.bank})}else s(a)},me=t=>{var a,r,i;N(t),j(t.source==="bank"?"bank":"cash"),h({date:t.date?t.date.split("T")[0]:de,expenseAccount:((a=t.expenseAccount)==null?void 0:a._id)||t.expenseAccount||"",amount:((r=t.amount)==null?void 0:r.toString())||"",notes:t.notes||"",bank:((i=t.bank)==null?void 0:i._id)||t.bank||"",particular:t.particular||""})},ue=async t=>{if(window.confirm("Are you sure you want to delete this expense entry?"))try{t.source==="bank"?await k(t._id).unwrap():await K(t._id).unwrap(),l(r=>r.filter(i=>i._id!==t._id)),A("Expense deleted successfully"),(o==null?void 0:o._id)===t._id&&V()}catch(r){f(C(r))}},se=(t,{print:a=!1}={})=>{var S;const r=(S=t.expenseAccount)!=null&&S.accountName?`${t.expenseAccount.accountName} (${t.expenseAccount.accountCode||""})`:"Expense Account",i=t.source==="bank"?"Bank":"Cash",d=window.open("","_blank","width=800,height=600");if(!d)return;const F=`
      <html>
        <head>
          <title>Expense Voucher</title>
          <style>
            body { font-family: Arial, sans-serif; margin: 24px; color: #1f2937; }
            h1 { font-size: 20px; margin-bottom: 16px; }
            table { width: 100%; border-collapse: collapse; margin-bottom: 24px; }
            td { padding: 8px 12px; border: 1px solid #e5e7eb; vertical-align: top; font-size: 14px; }
            .label { font-weight: 600; background: #f3f4f6; width: 35%; }
            .footer { text-align: center; font-size: 12px; color: #6b7280; }
          </style>
        </head>
        <body>
          <h1>Expense Voucher</h1>
          <table>
            <tr>
              <td class="label">Voucher ID</td>
              <td>${t.voucherCode||t._id}</td>
            </tr>
            <tr>
              <td class="label">Date</td>
              <td>${T(t.date||t.createdAt)}</td>
            </tr>
            <tr>
              <td class="label">Payment Method</td>
              <td>${i}</td>
            </tr>
            <tr>
              <td class="label">Expense Account</td>
              <td>${r}</td>
            </tr>
            <tr>
              <td class="label">Amount</td>
              <td>${_(t.amount||0)}</td>
            </tr>
            <tr>
              <td class="label">Description</td>
              <td>${t.particular||"-"}</td>
            </tr>
            <tr>
              <td class="label">Notes</td>
              <td>${t.notes||"-"}</td>
            </tr>
          </table>
          <div class="footer">Generated on ${T(new Date().toISOString())}</div>
        </body>
      </html>
    `;d.document.open(),d.document.write(F),d.document.close(),d.focus(),a&&(d.print(),d.close())},xe=t=>{se(t,{print:!1})},he=t=>{se(t,{print:!0})};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold text-gray-900 flex items-center space-x-2",children:[e.jsx(De,{className:"h-6 w-6 text-primary-600"}),e.jsx("span",{children:"Record Expense"})]}),e.jsxs("div",{className:"mt-1 lg:mt-0 grid grid-cols-1 lg:grid-cols-[minmax(0,1fr)_minmax(420px,0.45fr)] gap-3 lg:gap-6 lg:items-start lg:mt-1",children:[e.jsx("p",{className:"text-gray-600 lg:mt-1",children:"Log operating expenses directly from cash or bank while posting to the right expense account."}),e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4 bg-gray-50 w-full",children:[e.jsx("p",{className:"text-sm font-semibold text-gray-700 mb-3",children:"Payment Method"}),e.jsx("div",{className:"flex items-center gap-3 mt-1",children:[{value:"cash",label:"Cash",helper:"Use cash on hand"},{value:"bank",label:"Bank",helper:"Use a bank account"}].map(t=>{const a=b===t.value;return e.jsxs("button",{type:"button",onClick:()=>{j(t.value),t.value==="cash"&&h(r=>({...r,bank:""}))},className:`flex-1 px-4 py-3 rounded-xl border-2 text-left transition-all duration-200 ${a?"border-primary-500 bg-primary-50 text-primary-700 shadow-sm":"border-gray-200 text-gray-600 hover:border-primary-300 hover:bg-primary-50/40"}`,children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:`h-4 w-4 rounded-full border ${a?"border-primary-500 bg-primary-500":"border-gray-300 bg-white"}`}),e.jsx("span",{className:"text-sm font-semibold",children:t.label})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:t.helper})]},t.value)})})]})]})]}),e.jsx("div",{className:"card relative",children:e.jsx("div",{className:"card-content pt-4",children:e.jsxs("form",{onSubmit:oe,className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"form-label flex items-center justify-between",children:[e.jsx("span",{children:"Expense Account"}),e.jsxs("button",{type:"button",onClick:V,className:"text-sm text-primary-600 hover:text-primary-700 flex items-center space-x-1",children:[e.jsx(ie,{className:"h-4 w-4"}),e.jsx("span",{children:"Reset"})]})]}),e.jsxs("select",{className:"input",value:n.expenseAccount,onChange:t=>G(t.target.value),required:!0,disabled:$,children:[e.jsx("option",{value:"",children:"Select expense account"}),v.map(t=>e.jsxs("option",{value:t._id,children:[t.accountName," (",t.accountCode,")"]},t._id))]}),m&&e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Selected account will be debited when this expense is posted."})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"form-label",children:"Amount"}),e.jsxs("div",{className:"relative",children:[e.jsx(Pe,{className:"absolute left-3 top-3 h-4 w-4 text-gray-400"}),e.jsx("input",{type:"number",min:"0",step:"0.01",className:"input pl-9",value:n.amount,onChange:t=>h(a=>({...a,amount:t.target.value})),required:!0})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"form-label",children:"Date"}),e.jsxs("div",{className:"relative",children:[e.jsx(te,{className:"absolute left-3 top-3 h-4 w-4 text-gray-400"}),e.jsx("input",{type:"date",className:"input pl-9",value:n.date,onChange:t=>h(a=>({...a,date:t.target.value}))})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"form-label",children:"Description (optional)"}),e.jsx("input",{type:"text",className:"input",placeholder:m?m.accountName:"e.g., Rent for November",value:n.particular,onChange:t=>h(a=>({...a,particular:t.target.value}))})]}),b==="bank"&&e.jsxs("div",{children:[e.jsx("label",{className:"form-label",children:"Bank Account"}),e.jsxs("select",{className:"input",value:n.bank,onChange:t=>h(a=>({...a,bank:t.target.value})),required:!0,disabled:R,children:[e.jsx("option",{value:"",children:"Select bank account"}),W.map(t=>e.jsxs("option",{value:t._id,children:[t.bankName," • ",t.accountNumber,t.accountName?` (${t.accountName})`:""]},t._id))]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"form-label",children:"Notes"}),e.jsx("textarea",{className:"input",rows:6,placeholder:"Optional internal notes...",value:n.notes,onChange:t=>h(a=>({...a,notes:t.target.value}))})]}),e.jsxs("div",{className:"border rounded-lg bg-primary-50/40 p-4",children:[e.jsx("h3",{className:"text-sm font-semibold text-primary-700 mb-2",children:"Posting Preview"}),e.jsxs("div",{className:"space-y-2 text-sm text-gray-700",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:"Debit"}),e.jsx("span",{children:m?`${m.accountName} (${m.accountCode})`:"Select expense account"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:"Credit"}),e.jsx("span",{children:b==="cash"?"Cash on Hand":"Bank Account"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:"Amount"}),e.jsx("span",{children:n.amount?_(parseFloat(n.amount)||0):_(0)})]})]})]}),e.jsx("div",{className:"flex justify-end",children:e.jsxs("button",{type:"submit",className:"btn btn-primary flex items-center space-x-2",disabled:Q||q||Z||X,children:[e.jsx(le,{className:"h-4 w-4"}),e.jsx("span",{children:o?"Update Expense":"Save Expense"})]})})]})]})})}),e.jsxs("div",{className:"grid grid-cols-1 xl:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"card-header flex items-center justify-between",children:[e.jsxs("h2",{className:"text-lg font-semibold text-gray-900 flex items-center space-x-2",children:[e.jsx(Te,{className:"h-5 w-5 text-primary-600"}),e.jsx("span",{children:"Recent Expense Entries"})]}),(J||z)&&e.jsx("span",{className:"text-xs text-gray-500",children:"Refreshing..."})]}),e.jsx("div",{className:"card-content",children:B.length===0?e.jsx("p",{className:"text-sm text-gray-500",children:"Expenses recorded here will appear in this list for quick reference."}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-2 text-left text-xs font-semibold text-gray-500 uppercase tracking-wider",children:"Date"}),e.jsx("th",{className:"px-4 py-2 text-left text-xs font-semibold text-gray-500 uppercase tracking-wider",children:"Voucher"}),e.jsx("th",{className:"px-4 py-2 text-left text-xs font-semibold text-gray-500 uppercase tracking-wider",children:"Expense Account"}),e.jsx("th",{className:"px-4 py-2 text-left text-xs font-semibold text-gray-500 uppercase tracking-wider",children:"Description"}),e.jsx("th",{className:"px-4 py-2 text-right text-xs font-semibold text-gray-500 uppercase tracking-wider",children:"Amount"}),e.jsx("th",{className:"px-4 py-2 text-center text-xs font-semibold text-gray-500 uppercase tracking-wider",children:"Method"}),e.jsx("th",{className:"px-4 py-2 text-center text-xs font-semibold text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:B.map(t=>{var a;return e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-3 text-sm text-gray-700 whitespace-nowrap",children:T(t.date||t.createdAt)}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-700 whitespace-nowrap",children:t.voucherCode||t._id}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-700",children:(a=t.expenseAccount)!=null&&a.accountName?`${t.expenseAccount.accountName} (${t.expenseAccount.accountCode})`:"—"}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-600",children:t.particular||"—"}),e.jsx("td",{className:"px-4 py-3 text-sm font-semibold text-gray-900 text-right whitespace-nowrap",children:_(t.amount||0)}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-600 text-center capitalize whitespace-nowrap",children:D(t)}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-600 text-center whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center justify-center gap-1.5",children:[e.jsxs("button",{type:"button",onClick:()=>xe(t),className:"p-2 rounded-md text-blue-600 hover:bg-blue-50 transition-colors",title:"View Expense",children:[e.jsx(Le,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"View"})]}),e.jsxs("button",{type:"button",onClick:()=>he(t),className:"p-2 rounded-md text-green-600 hover:bg-green-50 transition-colors",title:"Print Expense",children:[e.jsx(Be,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Print"})]}),e.jsxs("button",{type:"button",onClick:()=>me(t),className:"p-2 rounded-md text-blue-600 hover:bg-blue-50 transition-colors",title:"Edit Expense",children:[e.jsx($e,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Edit"})]}),e.jsxs("button",{type:"button",onClick:()=>ue(t),className:"p-2 rounded-md text-red-600 hover:bg-red-50 transition-colors",title:"Delete Expense",children:[e.jsx(Fe,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Delete"})]})]})})]},t._id)})})]})})})]}),e.jsx(Oe,{expenseAccounts:v,onPaymentRecorded:t=>{t!=null&&t.payment&&l(a=>[{...t.payment,source:t.payment.bank?"bank":"cash"},...a].slice(0,25))}})]})]})};export{Ke as default};
