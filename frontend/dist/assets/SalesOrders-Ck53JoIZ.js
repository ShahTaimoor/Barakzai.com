import{u as sa,r as u,a as aa,b as ra,c as na,d as la,R as Ht,e as ca,f as ia,g as oa,h as da,i as ma,j as ua,k as xa,l as pa,m as ha,n as ga,o as fa,p as e,S as Xt,U as ba,q as ya,L as G,s as Na,t as ja,A as va,v as wa,X as Sa,w as je,x as et,y as Z,z as b,B as T,C as tt}from"./index-Cw3xRKpc.js";import{u as Pa,a as Ca}from"./productsApi-DhOlFJ93.js";import{u as Yt}from"./useFuzzySearch-ZiMs9RBo.js";import{S as ka}from"./SearchableDropdown-CdqaVq-Q.js";import{P as Ta}from"./PrintModal-DmgjaKQ0.js";import{u as Ma}from"./useCompanyInfo-B4fVT8rp.js";import{N as La}from"./NotesPanel-CiNYxO-7.js";import{D as Zt}from"./download-B8XL5QGf.js";import{P as es}from"./plus-DxsvPhf3.js";import{E as Da}from"./eye-off-DT0V_He4.js";import{E as ts}from"./eye-DISpb38e.js";import{C as Oa}from"./calculator-9IOFXN46.js";import{H as Ia}from"./history-B8jJndAB.js";import{C as st}from"./check-circle-C7396OEq.js";import{I as Aa}from"./info-9RksQo07.js";import{A as Ea}from"./alert-circle-HQsWpy-L.js";import{T as at}from"./trash-2-D2rrIU_x.js";import{S as $a}from"./save-Bj2eTcKa.js";import{F as Ba}from"./filter-bwJnrGXq.js";import{M as Fa}from"./message-square-BY9VhxYt.js";import{P as ss}from"./printer-Bdyt47kH.js";import{P as Ra}from"./pen-square-XPG_rn4Q.js";import{X as rt}from"./x-circle-MQqDWFsw.js";import"./chevron-down-BKU-tyXN.js";import"./check-DKrAXHMA.js";import"./settingsApi-ygxRjDN0.js";import"./lock-WdI7bfPW.js";const E=h=>h==null?"":typeof h=="string"||typeof h=="number"?h:typeof h=="object"?h.name||h.title||h.fullName||h.companyName||h.displayName||h.businessName||JSON.stringify(h):String(h),Nr=()=>{var At,Et,$t,Bt,Ft,Rt,qt,Ut;const{updateTabTitle:h,getActiveTab:S}=sa(),{companyInfo:ve}=Ma(),as=ve.companyName||"Company Name",nt=ve.address||ve.billingAddress||"",lt=ve.contactNumber||"",[M,rs]=u.useState({fromDate:new Date(Date.now()-30*24*60*60*1e3).toISOString().split("T")[0],toDate:new Date().toISOString().split("T")[0],orderNumber:"",customer:"",status:"",orderType:""}),[ns,ls]=u.useState({page:1,limit:999999}),[cs,qa]=u.useState({key:"createdAt",direction:"desc"}),[is,ct]=u.useState(!1),[we,it]=u.useState(null),[Se,ce]=u.useState(!1),[os,$e]=u.useState(!1),[ds,ot]=u.useState(!1),[ms,dt]=u.useState(null),[c,z]=u.useState(null),[Ua,_a]=u.useState(null),[o,ie]=u.useState(null),[F,R]=u.useState(""),[Pe,ee]=u.useState(-1),[te,pe]=u.useState(!0),[d,g]=u.useState({orderType:"wholesale",customer:"",items:[],notes:"",isTaxExempt:!0,orderNumber:""}),[K,Be]=u.useState(!0),V=u.useCallback(t=>{const s=new Date,a=s.getFullYear(),n=String(s.getMonth()+1).padStart(2,"0"),r=String(s.getDate()).padStart(2,"0"),l=String(s.getTime()).slice(-4);return`SO-${(t?(t.businessName||t.name||t.displayName||"").split(" ").map(x=>x.charAt(0).toUpperCase()).join("").substring(0,3):"")||"GEN"}-${a}${n}${r}-${l}`},[]),[se,us]=u.useState("wholesale"),[y,he]=u.useState(null),[mt,Ce]=u.useState(""),[O,J]=u.useState(1),[L,$]=u.useState(""),[ut,ke]=u.useState(0),[xt,ge]=u.useState(!1),[Qa,Fe]=u.useState(-1),[xs,pt]=u.useState(0),[ps,Re]=u.useState(!1),[Te,oe]=u.useState({}),[Me,fe]=u.useState(!1),[ae,de]=u.useState({}),[ht,qe]=u.useState(!1),[hs,Ue]=u.useState(!1),[gs,_e]=u.useState({}),[fs,Qe]=u.useState(!1),[re,bs]=u.useState(!1),[_,be]=u.useState(null),[k,We]=u.useState({}),[ys,Le]=u.useState(!1),[D,De]=u.useState("pdf"),[Ge,gt]=u.useState(!1),{hasPermission:Ns,user:ze}=aa(),Oe=Ns("view_cost_prices"),[ft,js]=u.useState(!1),bt=u.useMemo(()=>{if(!Array.isArray(d.items)||d.items.length===0)return 0;const t=a=>{var n,r;return a?(n=a.product)!=null&&n._id?a.product._id:typeof a.product=="string"?a.product:(r=a.productData)!=null&&r._id?a.productData._id:null:null},s=a=>a?a.productData?a.productData:a.product&&typeof a.product=="object"?a.product:null:null;return d.items.reduce((a,n)=>{var v,B,A;const r=Number(n.quantity)||0,l=Number(n.unitPrice)||0,m=t(n),i=s(n),N=[m&&k[m]!==void 0?Number(k[m]):null,Number((v=i==null?void 0:i.pricing)==null?void 0:v.cost),Number((B=i==null?void 0:i.pricing)==null?void 0:B.purchasePrice),Number((A=i==null?void 0:i.pricing)==null?void 0:A.wholesaleCost),Number(i==null?void 0:i.costPrice),Number(i==null?void 0:i.purchasePrice)].find(j=>j!=null&&Number.isFinite(j))||0,f=(l-N)*r;return a+(Number.isFinite(f)?f:0)},0)},[d.items,k]),[Ke,Q]=u.useState(""),[Ie,H]=u.useState(null),[Ae,I]=u.useState(-1),Ve=u.useRef(null);u.useEffect(()=>{if(K){const t=V(o);g(s=>s.orderNumber===t?s:{...s,orderNumber:t})}},[K,o,V]),u.useEffect(()=>{if(Se){document.body.style.overflow="hidden";const t=setTimeout(()=>{const s=document.querySelector(".modal-product-search");s&&s.focus()},100);return()=>{clearTimeout(t),document.body.style.overflow="unset"}}else document.body.style.overflow="unset",Q(""),H(null),I(-1)},[Se]),u.useEffect(()=>()=>{document.body.style.overflow="unset"},[]);const{data:me,isLoading:vs,error:yt,refetch:ne}=ra({...M,...ns,sortConfig:cs},{refetchOnMountOrArgChange:!0}),[ws]=Pa(),[Ss]=na(),{data:P,isLoading:Wa}=la({limit:1e3},{staleTime:0,refetchOnMountOrArgChange:!0}),ye=Ht.useMemo(()=>{var t;return((t=P==null?void 0:P.data)==null?void 0:t.customers)||(P==null?void 0:P.customers)||(P==null?void 0:P.data)||P||[]},[P]),{data:C,isLoading:Ps,refetch:ue}=Ca({limit:100,status:"active"},{keepPreviousData:!0,staleTime:0,refetchOnMountOrArgChange:!0}),Nt=Ht.useMemo(()=>{var t,s,a;return C?Array.isArray(C)?C:(t=C==null?void 0:C.data)!=null&&t.products?C.data.products:C!=null&&C.products?C.products:(a=(s=C==null?void 0:C.data)==null?void 0:s.data)!=null&&a.products?C.data.data.products:[]:[]},[C]),Cs=Yt(Nt,mt,["name","description","brand"],{threshold:.4,minScore:.3,limit:50}),q=Yt(Nt,Ke,["name","description","brand"],{threshold:.4,minScore:.3,limit:50}),[ks,{isLoading:jt}]=ca(),[Ts,{isLoading:vt}]=ia(),[Ms,{isLoading:wt}]=oa(),[Ls,{isLoading:St}]=da(),[Ds,{isLoading:Pt}]=ma(),[Ga,{isLoading:za}]=ua(),[Os]=xa(),[Is]=pa(),[As]=ha(),[Es]=ga(),[$s]=fa(),le=()=>{if(ie(null),R(""),pe(!0),ee(-1),he(null),Ce(""),Fe(-1),J(1),$(""),ke(0),ge(!1),pt(t=>t+1),g({orderType:"wholesale",customer:"",items:[],notes:"",isTaxExempt:!0,orderNumber:""}),Be(!0),oe({}),fe(!1),de({}),be(null),We({}),qe(!1),Ue(!1),_e({}),Qe(!1),h&&S){const t=S();t&&h(t.id,"SO")}},Ct=t=>{const s=ye==null?void 0:ye.find(a=>a._id===t);if(ie(s),g(a=>({...a,customer:t,orderNumber:K?V(s):a.orderNumber})),R(""),pe(!1),ee(-1),oe({}),fe(!1),de({}),h&&S&&s){const a=S();a&&h(a.id,`SO - ${s.businessName||s.name||"Unknown"}`)}},Bs=t=>{if(R(t),ee(-1),t===""&&(ie(null),pe(!0),g(s=>({...s,customer:"",orderNumber:K?V(null):s.orderNumber})),h&&S)){const s=S();s&&h(s.id,"SO")}},Fs=t=>{if(!te||!F||!P)return;const s=(ye||[]).filter(n=>(n.businessName||n.name||"").toLowerCase().includes(F.toLowerCase())||(n.email||"").toLowerCase().includes(F.toLowerCase())||(n.phone||"").includes(F)),a=s.length-1;switch(t.key){case"ArrowDown":t.preventDefault(),ee(n=>n<a?n+1:0);break;case"ArrowUp":t.preventDefault(),ee(n=>n>0?n-1:a);break;case"Enter":t.preventDefault(),Pe>=0&&Pe<s.length&&Ct(s[Pe]._id);break;case"Escape":R(""),ee(-1);break}},Je=(t,s)=>{var a,n,r,l,m;return t?s==="wholesale"?((a=t.pricing)==null?void 0:a.wholesale)||((n=t.pricing)==null?void 0:n.retail)||0:s==="retail"?((r=t.pricing)==null?void 0:r.retail)||0:((l=t.pricing)==null?void 0:l.wholesale)||((m=t.pricing)==null?void 0:m.retail)||0:0},Rs=async t=>{if(he(t),J(1),ge(!0),Ce(t.name),t._id)try{const a=await ws(t._id).unwrap();a&&a.lastPurchasePrice!==null?be(a.lastPurchasePrice):be(null)}catch{be(null)}else be(null);const s=Je(t,se);ke(s),$(s.toString())};u.useEffect(()=>{if(y){const t=Je(y,se);ke(t);const s=Je(y,se==="wholesale"?"retail":"wholesale");(!L||L===s.toString()||L===ut.toString())&&$(t.toString())}},[se,y]);const qs=t=>{Ce(t),Fe(-1),y&&t!==y.name&&(he(null),$(""),ge(!1)),t===""&&(he(null),$(""),ge(!1))},kt=t=>{t.key==="Enter"&&y&&(t.preventDefault(),Tt())},Us=t=>{var a,n,r,l,m,i,w,x,N;((a=t.inventory)==null?void 0:a.currentStock)<=(((n=t.inventory)==null?void 0:n.reorderPoint)||0),(r=t.inventory)==null||r.currentStock;let s=((l=t.pricing)==null?void 0:l.wholesale)||((m=t.pricing)==null?void 0:m.retail)||0;return se==="wholesale"?s=((i=t.pricing)==null?void 0:i.wholesale)||((w=t.pricing)==null?void 0:w.retail)||0:se==="retail"&&(s=((x=t.pricing)==null?void 0:x.retail)||0),e.jsxs("div",{className:"flex items-center justify-between w-full",children:[e.jsx("div",{className:"font-medium",children:t.name}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("div",{className:"text-sm text-gray-600",children:["Stock: ",((N=t.inventory)==null?void 0:N.currentStock)||0]}),e.jsxs("div",{className:"text-sm text-gray-600",children:["Price: $",Math.round(s)]})]})]})},Tt=async()=>{var t,s,a,n,r;if(y){if(!L||parseFloat(L)<=0){b("Please enter a valid rate");return}if(((t=y.inventory)==null?void 0:t.currentStock)===0){b(`${y.name} is out of stock and cannot be added to the order.`);return}if(O>((s=y.inventory)==null?void 0:s.currentStock)){b(`Cannot add ${O} units. Only ${(a=y.inventory)==null?void 0:a.currentStock} units available in stock.`);return}qe(!0);try{const l=parseFloat(L)||ut;if(_!==null&&l<_){const f=_-l,v=(f/_*100).toFixed(1);if(!window.confirm(`⚠️ WARNING: Sale price ($${l}) is below cost price ($${Math.round(_)}).

Loss per unit: $${Math.round(f)} (${v}%)
Total loss: $${Math.round(f*O)}

Do you want to proceed?`))return}const m=l*O,i=0,w=d.isTaxExempt?0:m*(((n=y.taxSettings)==null?void 0:n.taxRate)||0)/100,x=m-i+w;_!==null&&We(f=>({...f,[y._id]:_}));const N={product:y._id,productData:y,quantity:O,unitPrice:l,discountPercent:0,taxRate:((r=y.taxSettings)==null?void 0:r.taxRate)||0,subtotal:m,discountAmount:i,taxAmount:w,total:x};g(f=>({...f,items:[...f.items,N]})),he(null),J(1),$(""),ke(0),ge(!1),Ce(""),Fe(-1),pt(f=>f+1),setTimeout(()=>{Ve.current&&Ve.current.focus()},100);const p=(o==null?void 0:o.businessType)==="wholesale"?"wholesale":(o==null?void 0:o.businessType)==="distributor"?"distributor":"wholesale";T(`${y.name} added to order at ${p} price: ${Math.round(l)}`)}catch(l){Z(l,"Product Price Check")}finally{qe(!1)}}},Mt=t=>{var n;const s=d.items[t],a=((n=s==null?void 0:s.product)==null?void 0:n.toString())||t.toString();_e(r=>({...r,[a]:!0}));try{if(g(r=>({...r,items:r.items.filter((l,m)=>m!==t)})),Me&&s){const r=s.product.toString(),l={...Te};delete l[r],oe(l);const m={...ae};delete m[r],de(m)}if(s){const r=s.product.toString(),l={...k};delete l[r],We(l)}}finally{_e(r=>{const l={...r};return delete l[a],l})}},_s=()=>{Qe(!0);try{g(t=>{if(!t.items||t.items.length<2)return t;const s=n=>{const r=n.productData||n.product;return r?typeof r=="string"?r:r.name||r.title||r.displayName||r.businessName||r.fullName||"":""},a=[...t.items].sort((n,r)=>{const l=s(n).toString().toLowerCase(),m=s(r).toString().toLowerCase();return l<m?-1:l>m?1:0});return{...t,items:a}}),T("Cart items sorted alphabetically")}finally{Qe(!1)}},Qs=async()=>{if(!o){b("Please select a customer first");return}if(d.items.length===0){b("Please add products to cart first");return}Re(!0);try{const{data:t}=await Ss(o._id),{prices:s,orderNumber:a,orderDate:n}=t.data;if(!s||Object.keys(s).length===0){b("No previous order found for this customer"),Re(!1);return}const r={},l={};d.items.forEach(p=>{const f=p.product.toString();r[f]=p.unitPrice}),oe(r);let m=0,i=0,w=0;const x=d.items.map(p=>{const f=p.product.toString();if(s[f]){const v=s[f].unitPrice,B=p.unitPrice;if(v!==B){m++,l[f]="updated";const A=v*p.quantity,j=d.isTaxExempt?0:A*(p.taxRate||0)/100,U=A-(p.discountAmount||0)+j;return{...p,unitPrice:v,subtotal:A,taxAmount:j,total:U}}else return i++,l[f]="unchanged",p}else return w++,l[f]="not-found",p});g(p=>({...p,items:x})),de(l),fe(!0);const N=n?new Date(n).toLocaleDateString():"previous order";if(m>0){let p=`Applied prices from ${a||"previous order"} (${N}). Updated ${m} product(s).`;i>0&&(p+=` ${i} product(s) had same price.`),w>0&&(p+=` ${w} product(s) not found in previous order.`),T(p)}else i>0?T(`All products already have the same prices as in ${a||"previous order"} (${N}).`):b("No matching products found in previous order")}catch(t){Z(t,"Apply Last Prices")}finally{Re(!1)}},Ws=()=>{if(Object.keys(Te).length===0){b("No original prices to restore");return}Ue(!0);try{let t=0;const s=d.items.map(a=>{const n=a.product.toString();if(Te[n]!==void 0){t++;const r=Te[n],l=r*a.quantity,m=d.isTaxExempt?0:l*(a.taxRate||0)/100,i=l-(a.discountAmount||0)+m;return{...a,unitPrice:r,subtotal:l,taxAmount:m,total:i}}return a});g(a=>({...a,items:s})),fe(!1),oe({}),de({}),t>0&&T(`Restored original prices for ${t} product(s).`)}finally{Ue(!1)}},Lt=()=>{const t=d.items.reduce((r,l)=>r+l.unitPrice*l.quantity,0),s=d.items.reduce((r,l)=>r+(l.discountAmount||0),0),a=d.isTaxExempt?0:t*.08,n=t-s+a;return{subtotal:t,totalDiscount:s,totalTax:a,total:n}},Ee=(t,s)=>{rs(a=>({...a,[t]:s})),ls(a=>({...a,page:1}))},Gs=()=>{if(d.items.length===0){b("Please add at least one item to the order");return}const{subtotal:t,totalTax:s,total:a}=Lt(),{payment:n,...r}=d,l=d.items.map(i=>({product:i.product,quantity:i.quantity,unitPrice:i.unitPrice,totalPrice:i.total,invoicedQuantity:0,remainingQuantity:i.quantity})),m={...r,items:l,subtotal:t,tax:s,total:a};ks(m).unwrap().then(()=>{if(le(),T("Sales order created successfully"),h&&S){const i=S();i&&h(i.id,"SO")}ne()}).catch(i=>{b(Z(i))})},zs=()=>{const t={...d,items:d.items.map(s=>({product:s.product,quantity:s.quantity,unitPrice:s.unitPrice,totalPrice:s.total,invoicedQuantity:s.invoicedQuantity||0,remainingQuantity:s.remainingQuantity||s.quantity}))};Ts({id:c._id,...t}).unwrap().then(()=>{if(ce(!1),z(null),Q(""),H(null),I(-1),le(),T("Sales order updated successfully"),h&&S){const s=S();s&&h(s.id,"SO")}ne()}).catch(s=>{var n;const a=((n=s==null?void 0:s.data)==null?void 0:n.message)||(s==null?void 0:s.message)||"Failed to update sales order";b(a)})},Ks=t=>{window.confirm("Are you sure you want to delete this sales order?")&&Ms(t).unwrap().then(()=>{T("Sales order deleted successfully"),ne()}).catch(s=>{b(Z(s))})},Vs=t=>{window.confirm("Are you sure you want to confirm this pending sales order? This will change its status to confirmed and make it ready for invoicing.")&&Ls(t).unwrap().then(()=>{T("Sales order confirmed successfully"),ne(),ue&&typeof ue=="function"&&ue()}).catch(s=>{b(Z(s))})},Js=t=>{window.confirm("Are you sure you want to cancel this sales order? This action cannot be undone.")&&Ds(t).unwrap().then(()=>{T("Sales order cancelled successfully"),ne(),ue&&typeof ue=="function"&&ue()}).catch(s=>{b(Z(s))})},Hs=async()=>{var t;gt(!0);try{const s={fromDate:M.fromDate,toDate:M.toDate,status:M.status,customer:M.customer,orderNumber:M.orderNumber,orderType:M.orderType};let a;if(D==="excel"?a=await Os(s).unwrap():D==="csv"?a=await Is(s).unwrap():D==="json"?a=await Es(s).unwrap():D==="pdf"&&(a=await As(s).unwrap()),a!=null&&a.filename){const n=a.filename;try{D==="pdf"&&await new Promise(l=>setTimeout(l,500));let r;try{r=await $s(n).unwrap()}catch{b("Download failed");return}if(!r){b("Download failed: No response received");return}if(!r){b("Download failed: No data received from server");return}if(D==="pdf"){const l=r;if(!l||!(l instanceof Blob)){if(typeof l=="string")b(`Server error: ${l.substring(0,100)}`);else if(l&&typeof l=="object"){let x=l.message||l.error;if(!x)try{const N=JSON.stringify(l);N==="{}"||N==="null"||N===""?x=l.statusText||l.status||"Unknown server error":x=N.substring(0,150)}catch{x="Invalid response format"}b(`Server error: ${x||"Unknown error"}`)}else b("Invalid PDF file received - expected Blob. Response type: "+typeof l);return}const m=l.type||"";if(m.includes("application/json")||m.includes("text/html")){const x=new FileReader;x.onload=()=>{const N=x.result;try{const p=JSON.parse(N);b(p.message||"File not found or generation failed")}catch{b("Server returned error instead of PDF. Please try again.")}},x.readAsText(l);return}if(l.size===0){b("PDF file is empty");return}if(l.type&&!l.type.includes("pdf")&&!l.type.includes("application/octet-stream")){const x=new FileReader;x.onload=()=>{const N=x.result;if(N.includes("<!DOCTYPE")||N.includes('{"error"')||N.includes('{"message"'))b("Server returned an error instead of PDF file");else{const p=URL.createObjectURL(l);if(window.open(p,"_blank"))T("PDF opened in new tab");else{const v=document.createElement("a");v.href=p,v.download=n,document.body.appendChild(v),v.click(),document.body.removeChild(v),T("PDF downloaded (popup was blocked)")}setTimeout(()=>URL.revokeObjectURL(p),1e4)}},x.readAsText(l.slice(0,100));return}const i=URL.createObjectURL(l);if(window.open(i,"_blank"))T("PDF opened in new tab");else{const x=document.createElement("a");x.href=i,x.download=n,document.body.appendChild(x),x.click(),document.body.removeChild(x),T("PDF downloaded (popup was blocked)")}setTimeout(()=>URL.revokeObjectURL(i),1e4)}else{const l=r instanceof Blob?r:new Blob([r],{type:D==="excel"?"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet":D==="csv"?"text/csv":"application/json"}),m=URL.createObjectURL(l),i=document.createElement("a");i.href=m,i.download=n,document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(m),T(`${D.toUpperCase()} file downloaded successfully`)}}catch(r){if(r.response)if(r.response.data instanceof Blob){const l=new FileReader;l.onload=()=>{const m=l.result;try{const i=JSON.parse(m);b(i.message||"Download failed")}catch{b("Download failed: "+m.substring(0,100))}},l.readAsText(r.response.data)}else b(((t=r.response.data)==null?void 0:t.message)||`Download failed: ${r.response.status}`);else b("Download failed: "+(r.message||"Unknown error"));return}}Le(!1)}catch(s){Z(s,"Export")}finally{gt(!1)}},Xs=t=>{var a,n;z(t),ce(!0);const s=(t.items||[]).map(r=>({...r,productData:r.product||null}));if(g({orderType:t.orderType,customer:((a=t.customer)==null?void 0:a._id)||"",items:s,notes:t.notes||"",terms:t.terms||"",isTaxExempt:((n=t.pricing)==null?void 0:n.isTaxExempt)||!1,orderNumber:t.soNumber||t.orderNumber||t.invoiceNumber||""}),Be(!(t.soNumber||t.orderNumber||t.invoiceNumber)),t.customer){if(ie(t.customer),R(t.customer.businessName||t.customer.name||""),h&&S){const r=S();r&&h(r.id,`SO - ${t.customer.businessName||t.customer.name||"Unknown"}`)}}else if(ie(null),R(""),pe(!0),h&&S){const r=S();r&&h(r.id,"SO")}ce(!0)},Ys=t=>{z(t),$e(!0)},Zs=u.useCallback(t=>{var p,f,v,B,A;if(!t)return null;const s=t.customer||o||(t.customerInfo?{displayName:t.customerInfo.name,email:t.customerInfo.email,phone:t.customerInfo.phone,address:t.customerInfo.address,pendingBalance:t.customerInfo.pendingBalance}:null),a=t.customerInfo||(s?{name:s.displayName||s.businessName||s.name||"Customer",email:s.email||"",phone:s.phone||"",address:s.address||s.location||s.companyAddress||""}:null),r=(t.items||d.items||[]).map(j=>{const U=j.productData||j.product||j.productInfo||j.productDetails||{};return{...j,product:{name:U.name||j.productName||U.title||"Product"},quantity:Number(j.quantity)||0,unitPrice:Number(j.unitPrice!==void 0?j.unitPrice:j.rate!==void 0?j.rate:0)||0}}),l=r.reduce((j,U)=>j+(U.unitPrice||0)*(U.quantity||0),0),m=t.subtotal??((p=t.pricing)==null?void 0:p.subtotal)??l,i=t.discount??((f=t.pricing)==null?void 0:f.discountAmount)??0,w=t.total??((v=t.pricing)==null?void 0:v.total)??m-i,x=((B=t.payment)==null?void 0:B.amountPaid)||0,N=((A=t.payment)==null?void 0:A.remainingBalance)??w-x;return{...t,orderNumber:t.soNumber||t.orderNumber||t.invoiceNumber||d.orderNumber||V(s),customer:s,customerInfo:a,items:r,pricing:{subtotal:m,discountAmount:i,total:w},payment:{amountPaid:x,remainingBalance:N},createdAt:t.createdAt||new Date().toISOString()}},[d.items,d.orderNumber,V,o]),He=t=>{const s=Zs(t);s&&(dt(s),ot(!0))},ea=t=>{switch(t){case"closed":case"fully_invoiced":return e.jsx(st,{className:"h-4 w-4 text-green-500"});case"confirmed":case"partially_invoiced":return e.jsx(tt,{className:"h-4 w-4 text-yellow-500"});case"cancelled":return e.jsx(rt,{className:"h-4 w-4 text-red-500"});case"draft":return e.jsx(tt,{className:"h-4 w-4 text-blue-500"});default:return e.jsx(tt,{className:"h-4 w-4 text-gray-500"})}},Dt=(me==null?void 0:me.salesOrders)||[],ta=(me==null?void 0:me.pagination)||{},{subtotal:Ot,totalDiscount:Xe,totalTax:It,total:Ye}=Lt();return e.jsxs("div",{className:"space-y-4 lg:space-y-6",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Sales Orders"}),e.jsx("p",{className:"text-gray-600",children:"Process sales order transactions"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("button",{onClick:()=>Le(!0),className:"btn btn-secondary btn-md",title:"Export sales orders data",children:[e.jsx(Zt,{className:"h-4 w-4 mr-2"}),"Export"]}),e.jsxs("button",{onClick:le,className:"btn btn-primary btn-md",children:[e.jsx(es,{className:"h-4 w-4 mr-2"}),"New Sales Order"]})]})]}),e.jsxs("div",{className:"flex items-start space-x-4",children:[e.jsxs("div",{className:"w-[500px] flex-shrink-0",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Select Customer"}),o&&e.jsx("button",{onClick:()=>{if(ie(null),R(""),g(t=>({...t,customer:""})),ee(-1),oe({}),fe(!1),de({}),h&&S){const t=S();t&&h(t.id,"SO")}},className:"text-xs text-blue-600 hover:text-blue-800 underline",title:"Change customer",children:"Change Customer"})]}),e.jsx("div",{className:"flex items-center space-x-2",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("label",{className:"text-xs font-normal text-gray-400",children:"Price Type:"}),e.jsxs("select",{value:se,onChange:t=>us(t.target.value),className:"border border-gray-200 rounded-md px-2 py-1 text-xs text-gray-600 focus:outline-none focus:ring-1 focus:ring-primary-400 focus:border-primary-400",children:[e.jsx("option",{value:"wholesale",children:"Wholesale"}),e.jsx("option",{value:"retail",children:"Retail"}),e.jsx("option",{value:"custom",children:"Custom"})]})]})})]}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:te?F:o&&(o.displayName||o.businessName||o.name)||"",onChange:t=>{te&&Bs(t.target.value)},onKeyDown:Fs,className:`input w-full pr-10 ${te?"":"bg-gray-50 cursor-default"}`,placeholder:te?"Search customers by name, email, or business...":"",readOnly:!te}),e.jsx(Xt,{className:"absolute right-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"})]}),te&&F&&e.jsx("div",{className:"mt-2 max-h-40 overflow-y-auto border border-gray-200 rounded-md bg-white shadow-lg",children:(ye||[]).filter(t=>{const s=F.toLowerCase(),a=(t.displayName||t.businessName||t.name||"").toLowerCase(),n=(t.email||"").toLowerCase(),r=(t.phone||"").toLowerCase();return a.includes(s)||n.includes(s)||r.includes(F)}).map((t,s)=>e.jsxs("div",{onClick:()=>{Ct(t._id),R(""),pe(!1)},className:`px-3 py-2 cursor-pointer border-b border-gray-100 last:border-b-0 ${s===Pe?"bg-blue-100 text-blue-900":"hover:bg-gray-100"}`,children:[e.jsx("div",{className:"font-medium text-gray-900",children:t.displayName||t.businessName||t.name||"Unknown"}),e.jsxs("div",{className:"text-sm text-gray-600",children:[t.email&&e.jsx("div",{children:t.email}),(()=>{const a=t.pendingBalance||0,n=t.advanceBalance||0,r=a-n;return r<0?`Payables: $${Math.abs(r).toFixed(2)}`:`Receivables: $${r.toFixed(2)}`})()]})]},t._id))})]}),e.jsx("div",{className:"flex-1",children:o?e.jsx("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-3",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(ba,{className:"h-5 w-5 text-gray-400"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium",children:o.displayName||o.businessName||o.name||"Unknown"}),e.jsxs("p",{className:"text-sm text-gray-600 capitalize",children:[o.businessType||"Business"," • ",o.phone||"No phone"]}),o.email&&e.jsx("p",{className:"text-sm text-gray-600",children:o.email}),e.jsxs("div",{className:"flex items-center space-x-4 mt-2",children:[(()=>{const t=o.pendingBalance||0,s=o.advanceBalance||0,a=t-s,n=a<0,r=a>0;return t>0||s>0?e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("span",{className:"text-xs text-gray-500",children:n?"Payables:":"Receivables:"}),e.jsxs("span",{className:`text-sm font-medium ${n?"text-red-600":r?"text-green-600":"text-gray-600"}`,children:["$",Math.abs(a).toFixed(2)]})]}):null})(),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("span",{className:"text-xs text-gray-500",children:"Credit Limit:"}),e.jsxs("span",{className:`text-sm font-medium ${o.creditLimit>0?(o.currentBalance||0)+(o.pendingBalance||0)>=o.creditLimit*.9?"text-red-600":(o.currentBalance||0)+(o.pendingBalance||0)>=o.creditLimit*.7?"text-yellow-600":"text-blue-600":"text-gray-600"}`,children:["$",(o.creditLimit||0).toFixed(2)]}),o.creditLimit>0&&(o.currentBalance||0)+(o.pendingBalance||0)>=o.creditLimit*.9&&e.jsx("span",{className:"text-xs text-red-600 font-bold ml-1",children:"⚠️"})]}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("span",{className:"text-xs text-gray-500",children:"Available Credit:"}),e.jsxs("span",{className:`text-sm font-medium ${o.creditLimit>0?o.creditLimit-((o.currentBalance||0)+(o.pendingBalance||0))<=o.creditLimit*.1?"text-red-600":o.creditLimit-((o.currentBalance||0)+(o.pendingBalance||0))<=o.creditLimit*.3?"text-yellow-600":"text-green-600":"text-gray-600"}`,children:["$",(o.creditLimit-((o.currentBalance||0)+(o.pendingBalance||0))).toFixed(2)]})]})]})]})]})}):e.jsx("div",{className:"hidden lg:block"})})]}),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center lg:justify-between gap-3",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Product Selection & Cart"}),e.jsxs("div",{className:"flex flex-wrap items-center justify-start lg:justify-end gap-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("button",{onClick:()=>bs(!re),className:"btn btn-secondary btn-sm flex items-center space-x-2",title:re?"Hide purchase cost prices":"Show purchase cost prices",children:re?e.jsxs(e.Fragment,{children:[e.jsx(Da,{className:"h-4 w-4"}),e.jsx("span",{children:"Hide Cost"})]}):e.jsxs(e.Fragment,{children:[e.jsx(ts,{className:"h-4 w-4"}),e.jsx("span",{children:"Show Cost"})]})}),(ze==null?void 0:ze.role)==="admin"&&d.items.length>0&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:()=>js(t=>!t),className:"btn btn-secondary btn-sm flex items-center space-x-2",title:"Toggle estimated profit (BP)",children:[e.jsx(Oa,{className:"h-4 w-4"}),e.jsx("span",{children:ft?"Hide BP":"Show BP"})]}),ft&&e.jsx("span",{className:`text-sm font-semibold ${bt>=0?"text-green-600":"text-red-600"}`,children:ya(bt||0)})]})]}),o&&d.items.length>0&&e.jsx(e.Fragment,{children:Me?e.jsxs(G,{onClick:Ws,isLoading:hs,className:"btn btn-secondary btn-sm flex items-center space-x-2",title:"Restore original/current prices",children:[e.jsx(Na,{className:"h-4 w-4 mr-2"}),"Restore Current Prices"]}):e.jsxs(G,{onClick:Qs,isLoading:ps,className:"btn btn-secondary btn-sm flex items-center space-x-2",title:"Apply prices from last order for this customer",children:[e.jsx(Ia,{className:"h-4 w-4 mr-2"}),"Apply Last Prices"]})})]})]})}),e.jsxs("div",{className:"card-content",children:[e.jsx("div",{className:"mb-6",children:(()=>{var a,n;const t=Oe&&re?"md:col-span-6":"md:col-span-7",s=xt?Math.round(O*parseFloat(L||0)):0;return e.jsxs("div",{className:"grid grid-cols-12 gap-4 items-end",children:[e.jsxs("div",{className:`col-span-12 ${t}`,children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Product Search"}),e.jsx(ka,{ref:Ve,placeholder:"Search or select product...",items:Cs||[],onSelect:Rs,onSearch:qs,displayKey:Us,selectedItem:y,loading:Ps,emptyMessage:"No products found",value:mt},xs)]}),e.jsxs("div",{className:"col-span-6 md:col-span-1",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Stock"}),e.jsx("span",{className:"text-sm font-semibold text-gray-700 bg-gray-100 px-2 py-1 rounded border border-gray-200 block text-center h-10 flex items-center justify-center",children:y?((a=y.inventory)==null?void 0:a.currentStock)||0:"0"})]}),e.jsxs("div",{className:"col-span-6 md:col-span-1",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Quantity"}),e.jsx("input",{type:"number",min:"1",max:(n=y==null?void 0:y.inventory)==null?void 0:n.currentStock,value:O,onChange:r=>J(parseInt(r.target.value)||1),onKeyDown:kt,onFocus:r=>r.target.select(),className:"input text-center",placeholder:"1 (Enter to add & focus search)",autoFocus:xt})]}),re&&Oe&&e.jsxs("div",{className:"col-span-6 md:col-span-1",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Cost"}),e.jsx("span",{className:"text-sm font-semibold text-red-700 bg-red-50 px-2 py-1 rounded border border-red-200 block text-center h-10 flex items-center justify-center",title:"Last Purchase Price",children:_!==null?`$${Math.round(_)}`:y?"N/A":"$0"})]}),e.jsxs("div",{className:"col-span-6 md:col-span-1",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Rate"}),e.jsx("input",{type:"number",step:"1",value:L,onChange:r=>$(r.target.value),onKeyDown:kt,onFocus:r=>r.target.select(),className:"input text-center",placeholder:"0 (Enter to add & focus search)",required:!0})]}),e.jsxs("div",{className:"col-span-6 md:col-span-1",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Amount"}),e.jsx("span",{className:"text-sm font-semibold text-gray-700 bg-gray-100 px-2 py-1 rounded border border-gray-200 block text-center h-10 flex items-center justify-center",children:s})]}),e.jsx("div",{className:"col-span-6 md:col-span-1 flex items-end",children:e.jsxs(G,{type:"button",onClick:Tt,isLoading:ht,className:"btn btn-primary w-full flex items-center justify-center px-3 py-2",disabled:!y||ht,title:"Add to cart (or press Enter in Quantity/Rate fields - focus returns to search)",children:[e.jsx(es,{className:"h-4 w-4 mr-2"}),"Add"]})})]})})()}),d.items.length===0?e.jsxs("div",{className:"p-8 text-center text-gray-500 border-t border-gray-200",children:[e.jsx(ja,{className:"mx-auto h-12 w-12 text-gray-400"}),e.jsx("p",{className:"mt-2",children:"No items in cart"})]}):e.jsxs("div",{className:"space-y-4 border-t border-gray-200 pt-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h4",{className:"text-md font-medium text-gray-700",children:"Cart Items"}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs(G,{type:"button",onClick:_s,isLoading:fs,className:"btn btn-secondary btn-sm flex items-center space-x-2",title:"Sort products alphabetically",children:[e.jsx(va,{className:"h-4 w-4"}),e.jsx("span",{children:"Sort A-Z"})]}),Me&&Object.keys(ae).length>0&&e.jsxs("div",{className:"flex items-center space-x-3 text-xs",children:[e.jsx("span",{className:"text-gray-600 font-medium",children:"Price Status:"}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(st,{className:"h-3 w-3 text-green-600"}),e.jsx("span",{className:"text-gray-600",children:"Updated"})]}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(Aa,{className:"h-3 w-3 text-blue-600"}),e.jsx("span",{className:"text-gray-600",children:"Same Price"})]}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(Ea,{className:"h-3 w-3 text-yellow-600"}),e.jsx("span",{className:"text-gray-600",children:"Not in Last Order"})]})]})]})]}),d.items.map((t,s)=>{var l,m,i,w,x,N,p,f,v,B,A,j,U,_t,Qt,Wt,Gt,zt,Kt,Vt;const a=t.productData||t.product,n=t.unitPrice*t.quantity,r=((l=a==null?void 0:a.inventory)==null?void 0:l.currentStock)<=(((m=a==null?void 0:a.inventory)==null?void 0:m.reorderPoint)||0);return e.jsx("div",{className:`py-1 ${s%2===0?"bg-white":"bg-gray-50"}`,children:e.jsxs("div",{className:"grid grid-cols-12 gap-4 items-center",children:[e.jsx("div",{className:"col-span-1",children:e.jsx("span",{className:"text-sm font-medium text-gray-700 bg-gray-50 px-0.5 py-1 rounded border border-gray-200 block text-center h-8 flex items-center justify-center",children:s+1})}),e.jsx("div",{className:`${re&&Oe?"col-span-5":"col-span-6"} flex items-center h-8`,children:e.jsxs("span",{className:"font-medium text-sm truncate",children:[E(a==null?void 0:a.name)||"Unknown Product",r&&e.jsx("span",{className:"text-yellow-600 text-xs ml-2",children:"⚠️ Low Stock"}),k[(i=t.product)==null?void 0:i.toString()]!==void 0&&t.unitPrice<k[(w=t.product)==null?void 0:w.toString()]&&e.jsx("span",{className:"text-xs ml-2 px-1.5 py-0.5 rounded bg-red-100 text-red-700 font-bold",title:`Sale price below cost! Loss: $${Math.round(k[(x=t.product)==null?void 0:x.toString()]-t.unitPrice)} per unit`,children:"⚠️ Below Cost"}),Me&&ae[(N=t.product)==null?void 0:N.toString()]&&e.jsx("span",{className:`text-xs ml-2 px-1.5 py-0.5 rounded ${ae[(p=t.product)==null?void 0:p.toString()]==="updated"?"bg-green-100 text-green-700":ae[(f=t.product)==null?void 0:f.toString()]==="unchanged"?"bg-blue-100 text-blue-700":"bg-yellow-100 text-yellow-700"}`,children:ae[(v=t.product)==null?void 0:v.toString()]==="updated"?"Updated":ae[(B=t.product)==null?void 0:B.toString()]==="unchanged"?"Same Price":"Not in Last Order"})]})}),e.jsx("div",{className:"col-span-1",children:e.jsx("span",{className:"text-sm font-semibold text-gray-700 bg-gray-100 px-2 py-1 rounded border border-gray-200 block text-center h-8 flex items-center justify-center",children:((A=a==null?void 0:a.inventory)==null?void 0:A.currentStock)||0})}),e.jsx("div",{className:"col-span-1",children:e.jsx("input",{type:"number",value:t.quantity,onChange:Ze=>{const W=parseInt(Ze.target.value)||1;if(W<=0){Mt(s);return}g(X=>({...X,items:X.items.map((xe,Y)=>Y===s?{...xe,quantity:W,total:W*xe.unitPrice}:xe)}))},className:"input text-center h-8",min:"1"})}),re&&Oe&&e.jsx("div",{className:"col-span-1",children:e.jsx("span",{className:"text-sm font-semibold text-red-700 bg-red-50 px-2 py-1 rounded border border-red-200 block text-center h-8 flex items-center justify-center",title:"Last Purchase Price",children:k[(j=t.product)==null?void 0:j.toString()]!==void 0?`$${Math.round(k[(U=t.product)==null?void 0:U.toString()])}`:"N/A"})}),e.jsx("div",{className:"col-span-1",children:e.jsx("input",{type:"number",step:"0.01",value:t.unitPrice,onChange:Ze=>{var xe;const W=parseFloat(Ze.target.value)||0,X=k[(xe=t.product)==null?void 0:xe.toString()];if(X!==void 0&&W<X){const Y=X-W,Ne=(Y/X*100).toFixed(1);if(!window.confirm(`⚠️ WARNING: Sale price ($${W}) is below cost price ($${Math.round(X)}).

Loss per unit: $${Math.round(Y)} (${Ne}%)
Total loss: $${Math.round(Y*t.quantity)}

Do you want to proceed?`))return}g(Y=>({...Y,items:Y.items.map((Ne,Jt)=>Jt===s?{...Ne,unitPrice:W,total:Ne.quantity*W}:Ne)}))},className:`input text-center h-8 ${k[(_t=t.product)==null?void 0:_t.toString()]!==void 0&&t.unitPrice<k[(Qt=t.product)==null?void 0:Qt.toString()]?"border-red-500 bg-red-50":""}`,title:k[(Wt=t.product)==null?void 0:Wt.toString()]!==void 0&&t.unitPrice<k[(Gt=t.product)==null?void 0:Gt.toString()]?`⚠️ WARNING: Sale price ($${Math.round(t.unitPrice)}) is below cost price ($${Math.round(k[(zt=t.product)==null?void 0:zt.toString()])})`:"",min:"0"})}),e.jsx("div",{className:"col-span-1",children:e.jsx("span",{className:"text-sm font-semibold text-gray-700 bg-gray-100 px-2 py-1 rounded border border-gray-200 block text-center h-8 flex items-center justify-center",children:Math.round(n)})}),e.jsx("div",{className:"col-span-1",children:e.jsx(G,{onClick:()=>Mt(s),isLoading:gs[((Vt=(Kt=d.items[s])==null?void 0:Kt.product)==null?void 0:Vt.toString())||s],className:"btn btn-danger btn-sm h-8 w-full",children:e.jsx(at,{className:"h-4 w-4"})})})]})},s)})]})]})]}),d.items.length>0&&!Se&&e.jsxs("div",{className:"bg-gradient-to-br from-blue-50 to-indigo-50 border-2 border-blue-200 rounded-lg max-w-5xl ml-auto mt-4",children:[e.jsxs("div",{className:"px-6 py-4 border-b border-blue-200",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 text-right mb-4",children:"Sales Order Details"}),e.jsxs("div",{className:"flex flex-nowrap gap-3 items-end justify-end",children:[e.jsxs("div",{className:"flex flex-col w-44",children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Order Type"}),e.jsxs("select",{value:d.orderType,onChange:t=>g(s=>({...s,orderType:t.target.value})),className:"input h-8 text-sm",children:[e.jsx("option",{value:"retail",children:"Retail"}),e.jsx("option",{value:"wholesale",children:"Wholesale"}),e.jsx("option",{value:"return",children:"Return"}),e.jsx("option",{value:"exchange",children:"Exchange"})]})]}),e.jsxs("div",{className:"flex flex-col w-40",children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Tax Status"}),e.jsxs("div",{className:"flex items-center space-x-1 px-2 py-1 border border-gray-200 rounded h-8",children:[e.jsx("input",{type:"checkbox",id:"taxExempt",checked:d.isTaxExempt,onChange:t=>g(s=>({...s,isTaxExempt:t.target.checked})),className:"h-3 w-3 text-primary-600 focus:ring-primary-500 border-gray-300 rounded"}),e.jsx("div",{className:"flex-1",children:e.jsx("label",{htmlFor:"taxExempt",className:"text-xs font-medium text-gray-700 cursor-pointer",children:"Tax Exempt"})}),d.isTaxExempt&&e.jsx("div",{className:"text-green-600 text-xs font-medium",children:"✓"})]})]}),e.jsxs("div",{className:"flex flex-col w-72",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-1",children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 m-0",children:"Invoice Number"}),e.jsxs("label",{htmlFor:"soAutoGenerateInvoice",className:"flex items-center space-x-1 text-[11px] text-gray-600 cursor-pointer select-none",children:[e.jsx("input",{type:"checkbox",id:"soAutoGenerateInvoice",checked:K,onChange:t=>{const s=t.target.checked;if(Be(s),s){const a=V(o);g(n=>({...n,orderNumber:a}))}},className:"h-3 w-3 text-primary-600 focus:ring-primary-500 border-gray-300 rounded"}),e.jsx("span",{children:"Auto-generate"})]})]}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:d.orderNumber,onChange:t=>g(s=>({...s,orderNumber:t.target.value})),className:"w-full input pr-16 h-8 text-sm",placeholder:K?"Auto-generated":"Enter invoice number",disabled:K}),K&&e.jsx("button",{type:"button",onClick:()=>{const t=V(o);g(s=>({...s,orderNumber:t}))},className:"absolute right-2 top-1/2 transform -translate-y-1/2 text-[11px] text-primary-600 hover:text-primary-800 font-medium",children:"Regenerate"})]})]}),e.jsxs("div",{className:"flex flex-col w-[28rem]",children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Notes"}),e.jsx("input",{type:"text",value:d.notes,onChange:t=>g(s=>({...s,notes:t.target.value})),className:"input h-8 text-sm",placeholder:"Additional notes..."})]})]})]}),e.jsx("div",{className:"bg-gradient-to-r from-blue-500 to-indigo-600 px-6 py-4",children:e.jsx("h3",{className:"text-lg font-semibold text-white",children:"Order Summary"})}),e.jsx("div",{className:"px-6 py-4",children:e.jsxs("div",{className:"space-y-3 mb-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-800 font-semibold",children:"Subtotal:"}),e.jsx("span",{className:"text-xl font-bold text-gray-900",children:Math.round(Ot)})]}),Xe>0&&e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-800 font-semibold",children:"Discount:"}),e.jsxs("span",{className:"text-xl font-bold text-red-600",children:["-",Math.round(Xe)]})]}),!d.isTaxExempt&&e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-800 font-semibold",children:"Tax (8%):"}),e.jsx("span",{className:"text-xl font-bold text-gray-900",children:Math.round(It)})]}),o&&(()=>{const t=o.pendingBalance||0,s=o.advanceBalance||0,a=t-s;return t>0||s>0?e.jsxs("div",{className:"flex justify-between items-center mt-2",children:[e.jsx("span",{className:"text-gray-800 font-semibold",children:a<0?"Previous Advance:":"Previous Balance:"}),e.jsxs("span",{className:`text-xl font-bold ${a<0?"text-green-600":"text-red-600"}`,children:[a<0?"-":"+",Math.abs(Math.round(a))]})]}):null})(),e.jsxs("div",{className:"flex justify-between items-center text-xl font-bold border-t-2 border-blue-400 pt-3 mt-2",children:[e.jsx("span",{className:"text-blue-900",children:"Total:"}),e.jsx("span",{className:"text-blue-900 text-3xl",children:Math.round(Ye)})]}),o&&(()=>{const t=o.pendingBalance||0,s=o.advanceBalance||0,a=t-s;if(!(t>0||s>0))return null;const r=Ye+a,l=r<0;return e.jsxs("div",{className:"flex justify-between items-center text-lg font-bold border-t-2 border-red-400 pt-3 mt-2",children:[e.jsx("span",{className:l?"text-green-700":"text-red-700",children:l?"Total Advance:":"Total Payables:"}),e.jsx("span",{className:`text-2xl ${l?"text-green-700":"text-red-700"}`,children:Math.abs(Math.round(r))})]})})()]})}),e.jsxs("div",{className:"flex space-x-3 mt-6 px-6 pb-6",children:[e.jsxs("button",{onClick:le,className:"btn btn-secondary flex-1",children:[e.jsx(at,{className:"h-4 w-4 mr-2"}),"Clear Cart"]}),e.jsxs("button",{onClick:()=>{const t={soNumber:d.orderNumber||`SO-${Date.now()}`,orderNumber:d.orderNumber||`SO-${Date.now()}`,customer:o,items:d.items.map(s=>({product:s.productData,quantity:s.quantity,unitPrice:s.unitPrice,totalPrice:s.total})),subtotal:Ot,discount:Xe,tax:It,total:Ye,orderType:d.orderType||"wholesale",status:"draft",paymentMethod:d.paymentMethod,isTaxExempt:d.isTaxExempt,notes:d.notes,createdAt:new Date().toISOString()};He(t)},className:"btn btn-secondary flex-1",children:[e.jsx(wa,{className:"h-4 w-4 mr-2"}),"Print Preview"]}),e.jsxs("button",{onClick:Gs,disabled:jt||d.items.length===0,className:"btn btn-primary btn-lg flex-2",children:[e.jsx($a,{className:"h-4 w-4 mr-2"}),jt?"Creating...":"Create Sales Order"]})]})]}),Se&&c&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",onClick:t=>{t.target===t.currentTarget&&(ce(!1),z(null),Q(""),H(null),I(-1),le())},children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-4xl w-full mx-4 max-h-[90vh] overflow-y-auto",onClick:t=>t.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Edit Sales Order Details"}),e.jsx("button",{onClick:()=>{ce(!1),z(null),Q(""),H(null),I(-1),le()},className:"text-gray-400 hover:text-gray-600",children:e.jsx(Sa,{className:"h-6 w-6"})})]}),e.jsxs("div",{className:"p-6",children:[e.jsx("div",{className:"mb-4",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Customer Selection"}),e.jsx("input",{type:"text",placeholder:"Search customers...",value:F,onChange:t=>R(t.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"}),F&&((At=P==null?void 0:P.customers)==null?void 0:At.length)>0&&e.jsx("div",{className:"mt-2 max-h-40 overflow-y-auto border border-gray-200 rounded-md bg-white shadow-lg",children:P.customers.slice(0,5).map(t=>e.jsxs("div",{onClick:()=>{g(s=>({...s,customer:t._id})),R(t.businessName||t.name)},className:"px-3 py-2 hover:bg-gray-100 cursor-pointer border-b border-gray-100 last:border-b-0",children:[e.jsx("div",{className:"font-medium",children:t.businessName||t.name}),e.jsx("div",{className:"text-sm text-gray-600",children:t.email})]},t._id))})]})}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Order Type"}),e.jsxs("select",{value:d.orderType,onChange:t=>g(s=>({...s,orderType:t.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"retail",children:"Retail"}),e.jsx("option",{value:"wholesale",children:"Wholesale"}),e.jsx("option",{value:"return",children:"Return"}),e.jsx("option",{value:"exchange",children:"Exchange"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Tax Status"}),e.jsxs("div",{className:"flex items-center space-x-2 px-3 py-2 border border-gray-300 rounded-md",children:[e.jsx("input",{type:"checkbox",id:"taxExempt",checked:d.isTaxExempt,onChange:t=>g(s=>({...s,isTaxExempt:t.target.checked})),className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),e.jsx("label",{htmlFor:"taxExempt",className:"text-sm font-medium text-gray-700 cursor-pointer",children:"Tax Exempt"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Notes"}),e.jsx("textarea",{value:d.notes,onChange:t=>g(s=>({...s,notes:t.target.value})),placeholder:"Add any notes or comments...",rows:"3",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Terms & Conditions"}),e.jsx("textarea",{value:d.terms,onChange:t=>g(s=>({...s,terms:t.target.value})),placeholder:"Add terms and conditions...",rows:"3",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]})]}),e.jsxs("div",{className:"px-6 py-4 border-t border-blue-200",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-900 mb-3",children:"Product Selection & Cart Items"}),e.jsx("div",{className:"mb-4",children:e.jsxs("div",{className:"grid grid-cols-12 gap-4 items-end",children:[e.jsxs("div",{className:"col-span-6",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Product Search"}),e.jsx("input",{type:"text",placeholder:"Search or type product name...",value:Ke,onChange:t=>{t.stopPropagation(),Q(t.target.value),I(-1)},onFocus:t=>t.stopPropagation(),onKeyDown:t=>{var a;if(t.stopPropagation(),!(q!=null&&q.length))return;const s=Math.min(q.length-1,4);switch(t.key){case"ArrowDown":t.preventDefault(),I(n=>n<s?n+1:0);break;case"ArrowUp":t.preventDefault(),I(n=>n>0?n-1:s);break;case"Enter":if(t.preventDefault(),Ae>=0&&q[Ae]){const n=q[Ae];H(n),$(((a=n.pricing)==null?void 0:a.retail)||0),J(1),Q(n.name),I(-1),setTimeout(()=>{const r=document.querySelector(".modal-quantity-input");r&&r.focus()},100)}break;case"Escape":t.preventDefault(),I(-1);break}},className:"modal-product-search w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",autoFocus:!0}),Ke&&(q==null?void 0:q.length)>0&&e.jsx("div",{className:"mt-2 max-h-40 overflow-y-auto border border-gray-200 rounded-md bg-white shadow-lg",children:q.slice(0,5).map((t,s)=>{var a,n;return e.jsxs("div",{onClick:()=>{var r;H(t),$(((r=t.pricing)==null?void 0:r.retail)||0),J(1),Q(t.name),I(-1),setTimeout(()=>{const l=document.querySelector(".modal-quantity-input");l&&l.focus()},100)},className:`px-3 py-2 cursor-pointer border-b border-gray-100 last:border-b-0 ${Ae===s?"bg-blue-100 border-blue-200":"hover:bg-gray-100"}`,children:[e.jsx("div",{className:"font-medium",children:t.name}),e.jsxs("div",{className:"text-sm text-gray-600",children:["Stock: ",((a=t.inventory)==null?void 0:a.currentStock)||0," | Price: ",((n=t.pricing)==null?void 0:n.retail)||0]})]},t._id)})})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Quantity"}),e.jsx("input",{type:"number",min:"1",value:O,onChange:t=>J(parseInt(t.target.value)||1),className:"modal-quantity-input w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"1"})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Sale Price Per Unit"}),e.jsx("input",{type:"number",step:"0.01",min:"0",value:L,onChange:t=>$(parseFloat(t.target.value)||0),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"0.00"})]}),e.jsx("div",{className:"col-span-2",children:e.jsx("button",{type:"button",onClick:()=>{if(Ie&&O>0&&L>=0){const t={product:Ie._id,quantity:O,unitPrice:L,subtotal:O*L,productData:Ie};g(s=>({...s,items:[...s.items,t]})),H(null),Q(""),J(1),$(""),I(-1)}},disabled:!Ie||O<=0||L<0,className:"w-full px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:bg-gray-300 disabled:cursor-not-allowed",children:"Add Product"})})]})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h5",{className:"text-sm font-medium text-gray-700 mb-2",children:"Current Items:"}),d.items.length===0?e.jsx("p",{className:"text-sm text-gray-500 italic",children:"No items in this order"}):d.items.map((t,s)=>{var a,n;return e.jsxs("div",{className:"flex items-center p-3 bg-white border border-gray-200 rounded-lg",children:[e.jsx("div",{className:"font-medium text-gray-900 min-w-[200px] mr-4",children:((a=t.productData)==null?void 0:a.name)||"Unknown Product"}),e.jsxs("div",{className:"flex items-center space-x-3 ml-auto",children:[e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("label",{className:"text-xs text-gray-600",children:"Qty:"}),e.jsx("input",{type:"number",min:"1",value:t.quantity,onChange:r=>{const l=[...d.items],m=Math.max(1,parseInt(r.target.value)||1);l[s].quantity=m,l[s].subtotal=m*l[s].unitPrice,g(i=>({...i,items:l}))},className:"w-16 px-2 py-1 text-sm border border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-blue-500"})]}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("label",{className:"text-xs text-gray-600",children:"× Sale Price:"}),e.jsx("input",{type:"number",step:"0.01",min:"0",value:t.unitPrice,onChange:r=>{const l=[...d.items],m=parseFloat(r.target.value)||0;l[s].unitPrice=m,l[s].subtotal=l[s].quantity*m,g(i=>({...i,items:l}))},className:"w-20 px-2 py-1 text-sm border border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-blue-500"})]}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("label",{className:"text-xs text-gray-600",children:"="}),e.jsx("span",{className:"text-sm font-medium text-gray-900 min-w-[60px]",children:((n=t.subtotal)==null?void 0:n.toFixed(2))||(t.quantity*t.unitPrice).toFixed(2)})]}),e.jsx("button",{type:"button",onClick:()=>{const r=d.items.filter((l,m)=>m!==s);g(l=>({...l,items:r}))},className:"px-2 py-1 text-sm bg-red-200 text-red-700 rounded hover:bg-red-300 ml-2",title:"Remove item",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]})]},s)})]})]}),e.jsxs("div",{className:"flex items-center justify-end space-x-3 p-6 border-t border-gray-200",children:[e.jsx("button",{onClick:()=>{ce(!1),z(null),Q(""),H(null),I(-1),le()},className:"px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 border border-gray-300 rounded-md hover:bg-gray-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500",children:"Cancel"}),e.jsx(G,{onClick:zs,isLoading:vt,disabled:vt||d.items.length===0,className:"px-4 py-2 text-sm font-medium text-white bg-blue-600 border border-transparent rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:bg-gray-300 disabled:cursor-not-allowed",children:"Update Sales Order"})]})]})}),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Ba,{className:"h-5 w-5 text-gray-400"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Filters"})]})}),e.jsx("div",{className:"card-content",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-6 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"From Date"}),e.jsx("input",{type:"date",value:M.fromDate,onChange:t=>Ee("fromDate",t.target.value),className:"input h-[42px]"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"To Date"}),e.jsx("input",{type:"date",value:M.toDate,onChange:t=>Ee("toDate",t.target.value),className:"input h-[42px]"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Order Number"}),e.jsx("input",{type:"text",placeholder:"Contains...",value:M.orderNumber,onChange:t=>Ee("orderNumber",t.target.value),className:"input h-[42px]"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Status"}),e.jsxs("select",{value:M.status,onChange:t=>Ee("status",t.target.value),className:"input h-[42px]",children:[e.jsx("option",{value:"",children:"All Statuses"}),e.jsx("option",{value:"draft",children:"Pending"}),e.jsx("option",{value:"confirmed",children:"Confirmed"}),e.jsx("option",{value:"partially_invoiced",children:"Partially Invoiced"}),e.jsx("option",{value:"fully_invoiced",children:"Fully Invoiced"}),e.jsx("option",{value:"cancelled",children:"Cancelled"}),e.jsx("option",{value:"closed",children:"Closed"})]})]}),e.jsx("div",{className:"flex items-end",children:e.jsxs("button",{onClick:()=>ne(),className:"btn btn-primary w-full flex items-center justify-center space-x-2 h-[42px]",children:[e.jsx(Xt,{className:"h-4 w-4"}),e.jsx("span",{children:"Search"})]})})]})})]}),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h3",{className:"text-lg font-medium text-gray-900",children:["Sales Orders From: ",je(M.fromDate)," To: ",je(M.toDate)]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("span",{className:"text-sm text-gray-500",children:[ta.totalItems||0," records"]}),e.jsx("button",{onClick:()=>ne(),className:"p-2 text-gray-400 hover:text-gray-600",title:"Refresh",children:e.jsx(et,{className:"h-4 w-4"})})]})]})}),e.jsx("div",{className:"card-content p-0",children:vs?e.jsxs("div",{className:"p-8 text-center",children:[e.jsx(et,{className:"h-8 w-8 animate-spin mx-auto text-gray-400"}),e.jsx("p",{className:"mt-2 text-gray-500",children:"Loading sales orders..."})]}):yt?e.jsx("div",{className:"p-8 text-center text-red-600",children:e.jsxs("p",{children:["Error loading sales orders: ",Z(yt).message]})}):Dt.length===0?e.jsx("div",{className:"p-8 text-center text-gray-500",children:e.jsx("p",{children:"No sales orders found for the selected criteria."})}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Date"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Order #"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Customer"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Type"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Total"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:Dt.map((t,s)=>{var a,n,r;return e.jsxs("tr",{className:s%2===0?"bg-white":"bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:je(t.createdAt)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:t.soNumber}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:((a=t.customer)==null?void 0:a.displayName)||((n=t.customer)==null?void 0:n.businessName)||((r=t.customer)==null?void 0:r.name)||"Walk-in"}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 capitalize",children:t.orderType}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:e.jsxs("div",{className:"flex items-center space-x-1",children:[ea(t.status),e.jsx("span",{className:"capitalize",children:t.status==="draft"?"Pending":t.status.replace("_"," ")})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:Math.round(t.total||0)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{onClick:()=>{it({type:"SalesOrder",id:t._id,name:t.soNumber}),ct(!0)},className:"text-green-600 hover:text-green-900",title:"Notes",children:e.jsx(Fa,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>Ys(t),className:"text-blue-600 hover:text-blue-900",title:"View",children:e.jsx(ts,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>He(t),className:"text-gray-600 hover:text-gray-900",title:"Print",children:e.jsx(ss,{className:"h-4 w-4"})}),t.status==="draft"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>Xs(t),className:"text-indigo-600 hover:text-indigo-900",title:"Edit",children:e.jsx(Ra,{className:"h-4 w-4"})}),e.jsx(G,{onClick:()=>Vs(t._id),isLoading:St,className:"text-green-600 hover:text-green-900",title:"Confirm Order",disabled:St,children:e.jsx(st,{className:"h-4 w-4"})}),e.jsx(G,{onClick:()=>Js(t._id),isLoading:Pt,className:"text-red-600 hover:text-red-900",title:"Cancel Order",disabled:Pt,children:e.jsx(rt,{className:"h-4 w-4"})})]}),t.status==="draft"&&e.jsx(G,{onClick:()=>Ks(t._id),isLoading:wt,className:"text-red-600 hover:text-red-900",title:"Delete",disabled:wt,children:e.jsx(at,{className:"h-4 w-4"})})]})})]},t._id)})})]})})})]}),os&&c&&e.jsx("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50",children:e.jsx("div",{className:"relative top-10 mx-auto p-5 border w-4/5 max-w-4xl shadow-lg rounded-md bg-white",children:e.jsxs("div",{className:"mt-3",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h3",{className:"text-2xl font-bold text-gray-900",children:"Sales Order"}),e.jsx("button",{onClick:()=>{$e(!1),z(null)},className:"text-gray-400 hover:text-gray-600 transition-colors",children:e.jsx("svg",{className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsxs("div",{className:"mb-6 text-center",children:[e.jsx("h4",{className:"text-lg font-semibold text-gray-900 mb-2",children:as}),nt&&e.jsx("p",{className:"text-sm text-gray-600",children:nt}),lt&&e.jsxs("p",{className:"text-sm text-gray-600",children:["Phone: ",lt]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-6 mb-6",children:[e.jsxs("div",{children:[e.jsx("h5",{className:"font-semibold text-gray-900 mb-2",children:"Sales Order Details"}),e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"SO Number:"})," ",c.soNumber]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Date:"})," ",je(c.createdAt)]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Order Type:"})," ",c.orderType||"Standard"]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Status:"}),e.jsx("span",{className:`ml-2 px-2 py-1 rounded-full text-xs font-medium ${c.status==="draft"?"bg-gray-100 text-gray-800":c.status==="confirmed"?"bg-blue-100 text-blue-800":c.status==="partially_invoiced"?"bg-yellow-100 text-yellow-800":c.status==="fully_invoiced"?"bg-green-100 text-green-800":c.status==="cancelled"?"bg-red-100 text-red-800":"bg-gray-100 text-gray-800"}`,children:c.status==="draft"?"Pending":c.status.replace("_"," ")})]}),c.expectedDelivery&&e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Expected Delivery:"})," ",je(c.expectedDelivery)]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("h5",{className:"font-semibold text-gray-900 mb-2",children:"Customer Details"}),e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Customer:"})," ",E(((Et=c.customer)==null?void 0:Et.displayName)||(($t=c.customer)==null?void 0:$t.businessName)||((Bt=c.customer)==null?void 0:Bt.name))||"Walk-in"]}),((Ft=c.customer)==null?void 0:Ft.email)&&e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Email:"})," ",E(c.customer.email)]}),((Rt=c.customer)==null?void 0:Rt.phone)&&e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Phone:"})," ",E(c.customer.phone)]}),((qt=c.customer)==null?void 0:qt.address)&&e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Address:"})," ",E(c.customer.address)]}),((Ut=c.customer)==null?void 0:Ut.contactPerson)&&e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Contact:"})," ",E(c.customer.contactPerson)]}),e.jsx("div",{className:"mt-3 pt-2 border-t border-gray-200",children:e.jsxs("p",{className:`font-semibold ${(()=>{var n,r;const t=((n=c.customer)==null?void 0:n.pendingBalance)||0,s=((r=c.customer)==null?void 0:r.advanceBalance)||0;return t-s<0?"text-red-600":"text-green-600"})()}`,children:[e.jsx("span",{className:"font-medium",children:(()=>{var n,r;const t=((n=c.customer)==null?void 0:n.pendingBalance)||0,s=((r=c.customer)==null?void 0:r.advanceBalance)||0;return t-s<0?"Current Payables:":"Current Receivables:"})()})," ",Math.round((()=>{var a,n;const t=((a=c.customer)==null?void 0:a.pendingBalance)||0,s=((n=c.customer)==null?void 0:n.advanceBalance)||0;return Math.abs(t-s)})())]})})]})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("h5",{className:"font-semibold text-gray-900 mb-3",children:"Items Ordered"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full border border-gray-200 rounded-lg",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider border-b border-gray-200",children:"#"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider border-b border-gray-200",children:"Product"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider border-b border-gray-200",children:"Quantity"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider border-b border-gray-200",children:"Unit Price"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider border-b border-gray-200",children:"Total Price"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:c.items&&c.items.map((t,s)=>{var a;return e.jsxs("tr",{className:s%2===0?"bg-white":"bg-gray-50",children:[e.jsx("td",{className:"px-4 py-3 text-sm text-gray-900 border-b border-gray-200",children:s+1}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-900 border-b border-gray-200",children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:E(t.product)||"Unknown Product"}),((a=t.product)==null?void 0:a.description)&&e.jsx("div",{className:"text-gray-500 text-xs",children:E(t.product.description)})]})}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-900 text-right border-b border-gray-200",children:t.quantity}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-900 text-right border-b border-gray-200",children:Math.round(t.unitPrice||t.price||0)}),e.jsx("td",{className:"px-4 py-3 text-sm font-medium text-gray-900 text-right border-b border-gray-200",children:Math.round(t.totalPrice||t.quantity*(t.unitPrice||t.price||0))})]},s)})})]})})]}),e.jsx("div",{className:"flex justify-end mb-6",children:e.jsx("div",{className:"w-80",children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Subtotal:"}),e.jsx("span",{className:"font-medium",children:Math.round(c.subtotal||0)})]}),c.tax&&c.tax>0&&e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Tax:"}),e.jsx("span",{className:"font-medium",children:Math.round(c.tax)})]}),c.discount&&c.discount>0&&e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Discount:"}),e.jsxs("span",{className:"font-medium text-green-600",children:["-",Math.round(c.discount)]})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"SO Total:"}),e.jsx("span",{className:"font-medium",children:Math.round(c.total||0)})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:(()=>{var n,r;const t=((n=c.customer)==null?void 0:n.pendingBalance)||0,s=((r=c.customer)==null?void 0:r.advanceBalance)||0;return t-s<0?"Payables:":"Receivables:"})()}),e.jsx("span",{className:`font-medium ${(()=>{var n,r;const t=((n=c.customer)==null?void 0:n.pendingBalance)||0,s=((r=c.customer)==null?void 0:r.advanceBalance)||0;return t-s<0?"text-red-600":"text-green-600"})()}`,children:Math.round((()=>{var a,n;const t=((a=c.customer)==null?void 0:a.pendingBalance)||0,s=((n=c.customer)==null?void 0:n.advanceBalance)||0;return Math.abs(t-s)})())})]}),e.jsxs("div",{className:"flex justify-between text-lg font-bold border-t pt-2",children:[e.jsxs("span",{children:["Total ",(()=>{var n,r;const t=((n=c.customer)==null?void 0:n.pendingBalance)||0,s=((r=c.customer)==null?void 0:r.advanceBalance)||0;return t-s<0?"Payables":"Receivables"})(),":"]}),e.jsx("span",{className:"text-red-600",children:Math.round((c.total||0)+(()=>{var a,n;const t=((a=c.customer)==null?void 0:a.pendingBalance)||0,s=((n=c.customer)==null?void 0:n.advanceBalance)||0;return Math.abs(t-s)})())})]})]})})}),c.paymentMethod&&e.jsxs("div",{className:"mb-6",children:[e.jsx("h5",{className:"font-semibold text-gray-900 mb-2",children:"Payment Information"}),e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Payment Method:"})," ",E(c.paymentMethod)]}),c.paymentStatus&&e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Payment Status:"})," ",E(c.paymentStatus)]})]})]}),c.notes&&e.jsxs("div",{className:"mb-6",children:[e.jsx("h5",{className:"font-semibold text-gray-900 mb-2",children:"Notes"}),e.jsx("p",{className:"text-sm text-gray-600 bg-gray-50 p-3 rounded border",children:E(c.notes)})]}),c.terms&&e.jsxs("div",{className:"mb-6",children:[e.jsx("h5",{className:"font-semibold text-gray-900 mb-2",children:"Terms & Conditions"}),e.jsx("p",{className:"text-sm text-gray-600 bg-gray-50 p-3 rounded border",children:E(c.terms)})]}),e.jsxs("div",{className:"flex justify-between items-center pt-4 border-t",children:[e.jsxs("div",{className:"text-xs text-gray-500",children:["Generated on ",new Date().toLocaleDateString()," at ",new Date().toLocaleTimeString()]}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsxs("button",{onClick:()=>He(c),className:"btn btn-primary flex items-center",children:[e.jsx(ss,{className:"h-4 w-4 mr-2"}),"Print"]}),e.jsx("button",{onClick:()=>{$e(!1),z(null)},className:"btn btn-secondary",children:"Close"})]})]})]})})}),ys&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-md w-full",children:[e.jsxs("div",{className:"flex justify-between items-center p-6 border-b border-gray-200",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Export Sales Orders"}),e.jsx("button",{onClick:()=>Le(!1),className:"text-gray-400 hover:text-gray-600 transition-colors",children:e.jsx(rt,{className:"h-6 w-6"})})]}),e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"Export Format"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("label",{className:"flex items-center p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-gray-50",children:[e.jsx("input",{type:"radio",name:"format",value:"pdf",checked:D==="pdf",onChange:t=>De(t.target.value),className:"mr-3"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900",children:"PDF"}),e.jsx("div",{className:"text-sm text-gray-500",children:"Print-ready format"})]})]}),e.jsxs("label",{className:"flex items-center p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-gray-50",children:[e.jsx("input",{type:"radio",name:"format",value:"excel",checked:D==="excel",onChange:t=>De(t.target.value),className:"mr-3"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900",children:"Excel"}),e.jsx("div",{className:"text-sm text-gray-500",children:"Spreadsheet format"})]})]}),e.jsxs("label",{className:"flex items-center p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-gray-50",children:[e.jsx("input",{type:"radio",name:"format",value:"csv",checked:D==="csv",onChange:t=>De(t.target.value),className:"mr-3"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900",children:"CSV"}),e.jsx("div",{className:"text-sm text-gray-500",children:"Comma-separated values"})]})]}),e.jsxs("label",{className:"flex items-center p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-gray-50",children:[e.jsx("input",{type:"radio",name:"format",value:"json",checked:D==="json",onChange:t=>De(t.target.value),className:"mr-3"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900",children:"JSON"}),e.jsx("div",{className:"text-sm text-gray-500",children:"Data format"})]})]})]})]}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-4 border-t border-gray-200",children:[e.jsx("button",{type:"button",onClick:()=>Le(!1),className:"btn btn-secondary",disabled:Ge,children:"Cancel"}),e.jsx("button",{type:"button",onClick:Hs,className:"btn btn-primary",disabled:Ge,children:Ge?e.jsxs(e.Fragment,{children:[e.jsx(et,{className:"h-4 w-4 mr-2 animate-spin"}),"Exporting..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Zt,{className:"h-4 w-4 mr-2"}),"Export"]})})]})]})})]})}),e.jsx(Ta,{isOpen:ds,onClose:()=>{ot(!1),dt(null)},orderData:ms,documentTitle:"Sales Order",partyLabel:"Customer"}),is&&we&&e.jsx(La,{entityType:we.type,entityId:we.id,entityName:we.name,onClose:()=>{ct(!1),it(null)}})]})};export{Nr as default};
