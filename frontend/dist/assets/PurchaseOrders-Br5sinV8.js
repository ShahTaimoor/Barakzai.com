import{u as Lt,r as d,R as le,V as zt,W as Qt,Y as Rt,Z as Bt,_ as Kt,$ as Vt,a0 as Gt,p as e,S as we,a1 as Wt,P as Ht,A as Xt,v as Yt,w as $,x as ct,Q as y,C as Zt,a2 as Jt}from"./index-WAoT78o_.js";import{u as es}from"./suppliersApi-CVrNDSoD.js";import{a as ts}from"./productsApi-PDeXJ7KD.js";import{u as ot}from"./useFuzzySearch-3T44_vhU.js";import"./SearchableDropdown-CP_BnlHv.js";import{u as ss}from"./useCompanyInfo-pvMQvuFr.js";import{D as as}from"./download-CqTUNGzV.js";import{P as dt}from"./plus-CNtrfzq0.js";import{P as ns}from"./phone-ehtvFRIM.js";import{T as Ce}from"./trash-2-DLkCb2w3.js";import{S as rs}from"./save-lWD1Nme9.js";import{F as ls}from"./filter-BTES_dtq.js";import{E as is}from"./eye-DhWj5Adg.js";import{P as mt}from"./printer-CLmMJmx9.js";import{P as cs}from"./pen-square-BWW9zxzE.js";import{C as Se}from"./check-circle-Bs4hD_Mn.js";import{X as Pe}from"./x-circle-B_We_keY.js";import"./chevron-down-BWZz_AVk.js";import"./check-C3uKB0YI.js";import"./settingsApi-CbNzY-DL.js";const b=j=>j==null?"":typeof j=="string"||typeof j=="number"?j:typeof j=="object"?j.name||j.title||j.fullName||j.companyName||JSON.stringify(j):String(j),os=({status:j})=>{const p={draft:{color:"bg-gray-100 text-gray-800",icon:Jt,label:"Pending"},confirmed:{color:"bg-blue-100 text-blue-800",icon:Se,label:"Confirmed"},partially_received:{color:"bg-yellow-100 text-yellow-800",icon:Zt,label:"Partially Received"},fully_received:{color:"bg-green-100 text-green-800",icon:Se,label:"Fully Received"},cancelled:{color:"bg-red-100 text-red-800",icon:Pe,label:"Cancelled"},closed:{color:"bg-gray-100 text-gray-800",icon:Pe,label:"Closed"}},x=p[j]||p.draft,ke=x.icon;return e.jsxs("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${x.color}`,children:[e.jsx(ke,{className:"h-3 w-3 mr-1"}),x.label]})},zs=({tabId:j})=>{var Be,Ke,Ve,Ge,We,He,Xe,Ye,Ze,Je,et;const{updateTabTitle:p,getActiveTab:x,openTab:ke}=Lt(),{companyInfo:ie}=ss(),De=ie.companyName||"Company Name",ce=ie.address||ie.billingAddress||"",oe=ie.contactNumber||"",[h,xt]=d.useState({fromDate:new Date().toISOString().split("T")[0],toDate:new Date().toISOString().split("T")[0],poNumber:"",supplier:"",status:"",paymentStatus:""}),[Te,ut]=d.useState({page:1,limit:999999}),[ds,ms]=d.useState({key:"createdAt",direction:"desc"}),[X,de]=d.useState(!1),[pt,ge]=d.useState(!1),[l,U]=d.useState(null),[g,R]=d.useState(null),[E,v]=d.useState(""),[me,Y]=d.useState(-1),[F,be]=d.useState(!0),[Z,q]=d.useState(1),[J,_]=d.useState(0),[i,m]=d.useState({supplier:"",items:[],invoiceNumber:"",expectedDelivery:new Date().toISOString().split("T")[0],notes:"",terms:"",isTaxExempt:!0}),[S,ee]=d.useState(null),[M,te]=d.useState(""),[se,fe]=d.useState(1),[ye,B]=d.useState(""),[L,ae]=d.useState(-1),[ne,z]=d.useState(""),[xe,K]=d.useState(null),[ue,D]=d.useState(-1),re=d.useRef(null),[xs,us]=d.useState(null);d.useEffect(()=>{re.current&&re.current.focus()},[]),d.useEffect(()=>{if(X){document.body.style.overflow="hidden";const t=setTimeout(()=>{const s=document.querySelector(".modal-product-search input");s&&s.focus()},100);return()=>{clearTimeout(t),document.body.style.overflow="unset"}}else z(""),K(null),q(1),_(0),D(-1)},[X]);const ht=le.useMemo(()=>{const t={...Te};return h.fromDate&&(t.dateFrom=h.fromDate),h.toDate&&(t.dateTo=h.toDate),h.poNumber&&(t.search=h.poNumber),h.status&&(t.status=h.status),h.supplier&&(t.supplier=h.supplier),t},[h,Te]),{data:V,isLoading:gt,error:Oe,refetch:Q}=zt(ht,{refetchOnMountOrArgChange:!0}),{data:A,isLoading:ps}=es({search:"",limit:100},{skip:!1}),N=le.useMemo(()=>{var t;return((t=A==null?void 0:A.data)==null?void 0:t.suppliers)||(A==null?void 0:A.suppliers)||[]},[A]),{data:w,isLoading:hs}=ts({limit:999999,status:"active"},{keepPreviousData:!0,staleTime:3e4}),G=le.useMemo(()=>{var t,s,a;return(t=w==null?void 0:w.data)!=null&&t.products?w.data.products:w!=null&&w.products?w.products:(a=(s=w==null?void 0:w.data)==null?void 0:s.data)!=null&&a.products?w.data.data.products:[]},[w]),Ee=ot(G,M,["name","description","brand"],{threshold:.4,minScore:.3,limit:50}),P=le.useMemo(()=>!M||M.trim().length===0?G.slice(0,30):Ee,[M,G,Ee]),Me=ot(G,ne,["name","description","brand"],{threshold:.4,minScore:.3,limit:50}),I=le.useMemo(()=>!ne||ne.trim().length===0?G.slice(0,30):Me,[ne,G,Me]);d.useEffect(()=>{if(L>=0&&M&&P){const t=document.querySelector(".product-list-container"),s=t==null?void 0:t.querySelector(`[data-product-index="${L}"]`);s&&t&&s.scrollIntoView({behavior:"smooth",block:"nearest",inline:"nearest"})}},[L,M,P]);const[bt,{isLoading:Ie}]=Qt(),[ft,{isLoading:$e}]=Rt(),[yt,{isLoading:gs}]=Bt(),[jt,{isLoading:bs}]=Kt(),[Nt,{isLoading:fs}]=Vt(),[ys,{isLoading:js}]=Gt(),W=()=>{if(m({supplier:"",items:[],invoiceNumber:"",expectedDelivery:new Date().toISOString().split("T")[0],notes:"",terms:"",isTaxExempt:!0}),R(null),v(""),ee(null),te(""),fe(1),B(""),p&&x){const t=x();t&&p(t.id,"PO")}},Ae=t=>{const s=N==null?void 0:N.find(a=>a._id===t);if(R(s),m(a=>({...a,supplier:t})),v(""),Y(-1),be(!1),p&&x&&s){const a=x();a&&p(a.id,`PO - ${s.companyName||s.name||"Unknown"}`)}},vt=t=>{if(v(t),Y(-1),t===""&&(R(null),m(s=>({...s,supplier:""})),be(!0),p&&x)){const s=x();s&&p(s.id,"PO")}},wt=t=>{if(!F||!E||!A)return;const s=N.filter(n=>(n.companyName||n.name||"").toLowerCase().includes(E.toLowerCase())||(n.phone||"").includes(E)),a=s.length-1;switch(t.key){case"ArrowDown":t.preventDefault(),Y(n=>n<a?n+1:0);break;case"ArrowUp":t.preventDefault(),Y(n=>n>0?n-1:a);break;case"Enter":t.preventDefault(),me>=0&&me<s.length&&Ae(s[me]._id);break;case"Escape":v(""),Y(-1);break}},Ue=t=>{var s;ee(t),B(((s=t.pricing)==null?void 0:s.cost)||""),te(t.name),ae(-1)},Ct=t=>{te(t),ae(-1),S&&t!==S.name&&(ee(null),B("")),t===""&&(ee(null),B(""))},St=t=>{if(!M||!P)return;const s=P,a=s.length-1;switch(t.key){case"ArrowDown":t.preventDefault(),ae(n=>n<a?n+1:0);break;case"ArrowUp":t.preventDefault(),ae(n=>n>0?n-1:a);break;case"Enter":t.preventDefault(),L>=0&&L<s.length&&Ue(s[L]);break;case"Escape":te(""),ae(-1);break}},Fe=t=>{t.key==="Enter"&&S&&(t.preventDefault(),qe())},qe=()=>{var n;if(!S||se<=0){y.error("Please select a product and enter quantity");return}const t=parseFloat(ye)||((n=S.pricing)==null?void 0:n.cost)||0,s=t*se,a={product:S._id,productData:S,quantity:se,costPerUnit:t,totalCost:s};m(r=>({...r,items:[...r.items,a]})),ee(null),te(""),fe(1),B(""),setTimeout(()=>{re.current&&re.current.focus()},100)},_e=t=>{m(s=>({...s,items:s.items.filter((a,n)=>n!==t)}))},Pt=()=>{m(t=>{if(!t.items||t.items.length<2)return t;const s=n=>{const r=n.productData||n.product;return r?typeof r=="string"?r:r.name||r.title||r.displayName||r.businessName||r.fullName||"":""},a=[...t.items].sort((n,r)=>{const c=s(n).toString().toLowerCase(),u=s(r).toString().toLowerCase();return c<u?-1:c>u?1:0});return{...t,items:a}})},Le=()=>{const t=i.items.reduce((c,u)=>c+u.totalCost,0),s=i.isTaxExempt?0:t*.08,a=t+s,n=(g==null?void 0:g.pendingBalance)||0,r=a+n;return{subtotal:t,tax:s,total:a,supplierOutstanding:n,totalPayables:r}},H=(t,s)=>{xt(a=>({...a,[t]:s})),ut(a=>({...a,page:1}))},kt=()=>{if(i.items.length===0){y.error("Please add at least one item to the order");return}if(!i.supplier){y.error("Please select a supplier");return}const{subtotal:t,tax:s,total:a}=Le(),n={...i,subtotal:t,tax:s,total:a};bt(n).unwrap().then(()=>{if(W(),y.success("Purchase order created successfully"),p&&x){const r=x();r&&p(r.id,"PO")}Q()}).catch(r=>{var c;y.error(((c=r==null?void 0:r.data)==null?void 0:c.message)||"Failed to create purchase order")})},Dt=()=>{const t={...i,items:i.items.map(s=>({product:s.product,quantity:s.quantity,costPerUnit:s.costPerUnit,totalCost:s.totalCost,receivedQuantity:s.receivedQuantity||0,remainingQuantity:s.remainingQuantity||s.quantity}))};ft({id:l._id,...t}).unwrap().then(()=>{if(de(!1),U(null),W(),y.success("Purchase order updated successfully"),p&&x){const s=x();s&&p(s.id,"PO")}Q()}).catch(s=>{var n;const a=((n=s==null?void 0:s.data)==null?void 0:n.message)||(s==null?void 0:s.message)||"Failed to update purchase order";y.error(a)})},Tt=t=>{window.confirm("Are you sure you want to delete this purchase order?")&&yt(t).unwrap().then(()=>{y.success("Purchase order deleted successfully"),Q()}).catch(s=>{var a;y.error(((a=s==null?void 0:s.data)==null?void 0:a.message)||"Failed to delete purchase order")})},Ot=t=>{window.confirm("Are you sure you want to confirm this pending purchase order? This will change its status to confirmed and make it ready for receiving.")&&jt(t).unwrap().then(()=>{y.success("Purchase order confirmed successfully"),Q()}).catch(s=>{var a;y.error(((a=s==null?void 0:s.data)==null?void 0:a.message)||"Failed to confirm purchase order")})},Et=t=>{window.confirm("Are you sure you want to cancel this purchase order? This action cannot be undone.")&&Nt(t).unwrap().then(()=>{y.success("Purchase order cancelled successfully"),Q()}).catch(s=>{var a;y.error(((a=s==null?void 0:s.data)==null?void 0:a.message)||"Failed to cancel purchase order")})},Mt=t=>{var n;U(t);const s=(t.items||[]).map(r=>{var u,T,o;let c=r.costPerUnit||0;return c===0&&((T=(u=r.product)==null?void 0:u.pricing)!=null&&T.cost)&&(c=r.product.pricing.cost),{product:((o=r.product)==null?void 0:o._id)||r.product,quantity:r.quantity,costPerUnit:c,totalCost:r.totalCost||r.quantity*c,receivedQuantity:r.receivedQuantity||0,remainingQuantity:r.remainingQuantity||r.quantity,productData:r.product||null}}),a={supplier:((n=t.supplier)==null?void 0:n._id)||"",items:s,expectedDelivery:t.expectedDelivery?new Date(t.expectedDelivery).toISOString().split("T")[0]:new Date().toISOString().split("T")[0],notes:t.notes||"",terms:t.terms||"",isTaxExempt:t.isTaxExempt!==void 0?t.isTaxExempt:!0};if(m(a),t.supplier){if(R(t.supplier),v(t.supplier.companyName||t.supplier.name||""),p&&x){const r=x();r&&p(r.id,`PO - ${t.supplier.companyName||t.supplier.name||"Unknown"}`)}}else if(R(null),v(""),p&&x){const r=x();r&&p(r.id,"PO")}de(!0)},It=t=>{U(t),ge(!0)},je=t=>{var n,r,c,u,T,o,k,O,C;const s=`
      <html>
        <head>
          <title>Purchase Order - ${t.poNumber}</title>
          <style>
            @media print {
              @page { size: A4; margin: 0.5in; }
              body { font-family: Arial, sans-serif; font-size: 14px; line-height: 1.2; color: #000; margin: 0; padding: 0; }
              .container { max-width: 800px; margin: 0 auto; }
              .header { text-align: center; margin-bottom: 20px; }
              .header h1 { font-size: 24px; font-weight: bold; margin: 0 0 4px 0; color: #000; }
              .header p { margin: 2px 0; font-size: 14px; color: #6b7280; }
              .details-grid { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 20px; margin-bottom: 20px; }
              .details-section h5 { font-size: 16px; font-weight: 600; color: #000; margin: 0 0 8px 0; }
              .details-section p { margin: 2px 0; font-size: 14px; color: #374151; }
              .details-section .font-medium { font-weight: 500; }
              .status-badge { display: inline-block; padding: 4px 8px; border-radius: 9999px; font-size: 12px; font-weight: 500; background-color: #f3f4f6; color: #374151; }
              .outstanding-balance { margin-top: 8px; padding-top: 6px; border-top: 1px solid #e5e7eb; }
              .outstanding-balance p { font-weight: 600; color: #dc2626; }
              .items-section { margin-bottom: 20px; }
              .items-section h5 { font-size: 16px; font-weight: 600; color: #000; margin: 0 0 8px 0; }
              .items-table { width: 100%; border-collapse: collapse; border: 1px solid #e5e7eb; border-radius: 8px; overflow: hidden; }
              .items-table thead { background-color: #f9fafb; }
              .items-table th { padding: 8px; text-align: left; font-size: 14px; font-weight: 600; color: #000; border-bottom: 1px solid #e5e7eb; }
              .items-table td { padding: 8px; font-size: 14px; color: #374151; border-bottom: 1px solid #e5e7eb; }
              .items-table tr:last-child td { border-bottom: none; }
              .items-table tr:nth-child(even) { background-color: #f9fafb; }
              .product-info { display: flex; flex-direction: column; }
              .product-name { font-weight: 500; color: #000; }
              .product-description { font-size: 12px; color: #6b7280; margin-top: 2px; }
              .text-right { text-align: right; }
              .totals-section { display: flex; justify-content: flex-end; margin-bottom: 20px; }
              .totals-container { width: 320px; }
              .totals-section .space-y-2 > * + * { margin-top: 4px; }
              .totals-section .flex { display: flex; justify-content: space-between; }
              .totals-section .text-sm { font-size: 14px; }
              .totals-section .text-gray-600 { color: #6b7280; }
              .totals-section .font-medium { font-weight: 500; }
              .totals-section .text-lg { font-size: 18px; }
              .totals-section .font-bold { font-weight: 700; }
              .totals-section .border-t { border-top: 1px solid #e5e7eb; }
              .totals-section .pt-2 { padding-top: 8px; }
              .totals-section .text-red-600 { color: #dc2626; }
              .notes-section { margin-bottom: 20px; }
              .notes-section h5 { font-size: 16px; font-weight: 600; color: #000; margin: 0 0 8px 0; }
              .notes-content { font-size: 14px; color: #374151; background-color: #f9fafb; padding: 8px; border-radius: 8px; border: 1px solid #e5e7eb; }
              .footer { display: flex; justify-content: space-between; align-items: center; padding-top: 12px; border-top: 1px solid #e5e7eb; }
              .footer .text-xs { font-size: 12px; line-height: 1.1; }
              .footer .text-gray-500 { color: #6b7280; }
              .footer .flex { display: flex; }
              .footer .space-x-3 > * + * { margin-left: 12px; }
              .footer .btn { padding: 8px 16px; border-radius: 6px; font-size: 14px; font-weight: 500; cursor: pointer; }
              .footer .btn-primary { background-color: #3b82f6; color: white; }
              .footer .btn-secondary { background-color: #6b7280; color: white; }
              .footer .flex .items-center { align-items: center; }
              .footer .mr-2 { margin-right: 8px; }
            }
          </style>
        </head>
        <body>
          <div class="container">
            <!-- Header -->
            <div class="header">
              <h1>${De}</h1>
              ${ce?`<p>${ce}</p>`:""}
              ${oe?`<p>Phone: ${oe}</p>`:""}
            </div>
            
            <!-- Details Section -->
            <div class="details-grid">
              <div class="details-section">
                <h5>Purchase Order Details</h5>
                <p><span class="font-medium">PO Number:</span> ${t.poNumber}</p>
                <p><span class="font-medium">Date:</span> ${$(t.createdAt)}</p>
                <p><span class="font-medium">Status:</span> 
                  <span class="status-badge">${t.status==="draft"?"Pending":t.status.replace("_"," ")}</span>
                </p>
                ${t.expectedDelivery?`<p><span class="font-medium">Expected Delivery:</span> ${$(t.expectedDelivery)}</p>`:""}
              </div>
              <div class="details-section">
                <!-- Empty middle column for spacing -->
              </div>
              <div class="details-section" style="text-align: right;">
                <h5>Supplier Details</h5>
                <p><span class="font-medium">Company:</span> ${b(((n=t.supplier)==null?void 0:n.companyName)||((r=t.supplier)==null?void 0:r.name))||"Unknown"}</p>
                ${(c=t.supplier)!=null&&c.email?`<p><span class="font-medium">Email:</span> ${b(t.supplier.email)}</p>`:""}
                ${(u=t.supplier)!=null&&u.phone?`<p><span class="font-medium">Phone:</span> ${b(t.supplier.phone)}</p>`:""}
                ${(T=t.supplier)!=null&&T.contactPerson?`<p><span class="font-medium">Contact:</span> ${b(t.supplier.contactPerson)}</p>`:""}
                <div class="outstanding-balance">
                  <p>
                    <span class="font-medium">Outstanding Balance:</span> ${Math.round(((o=t.supplier)==null?void 0:o.pendingBalance)||0)}
                  </p>
                </div>
              </div>
            </div>
            
            <!-- Items Section -->
            <div class="items-section">
              <h5>Items Ordered</h5>
              <table class="items-table">
                <thead>
                  <tr>
                    <th>#</th>
                    <th>PRODUCT</th>
                    <th class="text-right">QUANTITY</th>
                    <th class="text-right">UNIT COST</th>
                    <th class="text-right">TOTAL COST</th>
                  </tr>
                </thead>
                <tbody>
                  ${((k=t.items)==null?void 0:k.map((f,ve)=>{var pe,he;return`
                    <tr>
                      <td>${ve+1}</td>
                      <td>
                        <div class="product-info">
                          <div class="product-name">${b((pe=f.product)==null?void 0:pe.name)||"Unknown Product"}</div>
                          ${(he=f.product)!=null&&he.description?`<div class="product-description">${f.product.description}</div>`:""}
                        </div>
                      </td>
                      <td class="text-right">${f.quantity}</td>
                      <td class="text-right">${Math.round(f.unitCost||f.cost||0)}</td>
                      <td class="text-right">${Math.round(f.totalCost||f.quantity*(f.unitCost||f.cost||0))}</td>
                    </tr>
                  `}).join(""))||""}
                </tbody>
              </table>
            </div>
            
            <!-- Totals Section -->
            <div class="totals-section">
              <div class="totals-container">
                <div class="space-y-2">
                  <div class="flex text-sm">
                    <span class="text-gray-600">Subtotal:</span>
                    <span class="font-medium">${Math.round(t.subtotal||0)}</span>
                  </div>
                  ${t.tax&&t.tax>0?`
                    <div class="flex text-sm">
                      <span class="text-gray-600">Tax:</span>
                      <span class="font-medium">${Math.round(t.tax)}</span>
                    </div>
                  `:""}
                  <div class="flex text-sm">
                    <span class="text-gray-600">PO Total:</span>
                    <span class="font-medium">${Math.round(t.total||0)}</span>
                  </div>
                  <div class="flex text-sm">
                    <span class="text-gray-600">Previous Outstanding:</span>
                    <span class="font-medium text-red-600">${Math.round(((O=t.supplier)==null?void 0:O.pendingBalance)||0)}</span>
                  </div>
                  <div class="flex text-lg font-bold border-t pt-2">
                    <span>Total Payables:</span>
                    <span class="text-red-600">${Math.round((t.total||0)+(((C=t.supplier)==null?void 0:C.pendingBalance)||0))}</span>
                  </div>
                </div>
              </div>
            </div>
            
            ${t.notes?`
              <div class="notes-section">
                <h5>Notes</h5>
                <div class="notes-content">${t.notes}</div>
              </div>
            `:""}
            
            ${t.terms?`
              <div class="notes-section">
                <h5>Terms</h5>
                <div class="notes-content">${t.terms}</div>
              </div>
            `:""}
            
            <!-- Footer -->
            <div class="footer">
              <div class="text-xs text-gray-500">
                Generated on ${new Date().toLocaleDateString()} at ${new Date().toLocaleTimeString()}
              </div>
            </div>
          </div>
        </body>
      </html>
    `,a=window.open("","_blank");a.document.write(s),a.document.close(),a.focus(),a.print(),a.close()},$t=()=>{try{const t=Ne||[];if(t.length===0){y.error("No purchase orders to export");return}const a=[["Order Number","Date","Supplier","Status","Subtotal","Tax","Total","Items Count","Notes"].join(",")];t.forEach(o=>{var tt,st,at,nt,rt,lt,it;const k=((tt=o.supplier)==null?void 0:tt.companyName)||((st=o.supplier)==null?void 0:st.name)||((at=o.supplierInfo)==null?void 0:at.companyName)||"N/A",O=o.status||"N/A",C=o.subtotal||((nt=o.pricing)==null?void 0:nt.subtotal)||0,f=o.tax||((rt=o.pricing)==null?void 0:rt.taxAmount)||0,ve=o.total||((lt=o.pricing)==null?void 0:lt.total)||0,pe=((it=o.items)==null?void 0:it.length)||0,he=(o.notes||"").replace(/"/g,'""'),qt=o.createdAt?$(o.createdAt):$(new Date),_t=[o.poNumber||o.orderNumber||"N/A",qt,`"${k}"`,O,C.toFixed(2),f.toFixed(2),ve.toFixed(2),pe,`"${he}"`];a.push(_t.join(","))});const n=a.join(`
`),r=new Blob([n],{type:"text/csv;charset=utf-8;"}),c=document.createElement("a"),u=URL.createObjectURL(r),T=new Date().toISOString().split("T")[0];c.setAttribute("href",u),c.setAttribute("download",`purchase_orders_${T}.csv`),c.style.visibility="hidden",document.body.appendChild(c),c.click(),document.body.removeChild(c),URL.revokeObjectURL(u),y.success(`Exported ${t.length} purchase order(s) to CSV`)}catch{y.error("Failed to export purchase orders")}},Ne=((Be=V==null?void 0:V.data)==null?void 0:Be.purchaseOrders)||[],At=((Ke=V==null?void 0:V.data)==null?void 0:Ke.pagination)||{},{subtotal:ze,tax:Qe,total:Re,supplierOutstanding:Ut,totalPayables:Ft}=Le();return e.jsxs("div",{className:"space-y-4 lg:space-y-6",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Purchase Orders"}),e.jsx("p",{className:"text-gray-600",children:"Process purchase order transactions"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("button",{onClick:$t,className:"btn btn-secondary btn-md",children:[e.jsx(as,{className:"h-4 w-4 mr-2"}),"Export"]}),e.jsxs("button",{onClick:W,className:"btn btn-primary btn-md",children:[e.jsx(dt,{className:"h-4 w-4 mr-2"}),"New Purchase Order"]})]})]}),e.jsxs("div",{className:"flex items-start space-x-4",children:[e.jsxs("div",{className:"w-[500px] flex-shrink-0",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Select Supplier"}),g&&e.jsx("button",{onClick:()=>{if(R(null),v(""),be(!0),m(t=>({...t,supplier:""})),p&&x){const t=x();t&&p(t.id,"PO")}},className:"text-xs text-blue-600 hover:text-blue-800 underline",children:"Change Supplier"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:F?E:g&&(g.companyName||g.name)||"",onChange:t=>{F&&vt(t.target.value)},onKeyDown:wt,className:`input w-full pr-10 ${F?"":"bg-gray-50 cursor-default"}`,placeholder:F?"Search suppliers by name, email, or business...":"",readOnly:!F}),e.jsx(we,{className:"absolute right-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"})]}),F&&E&&e.jsx("div",{className:"mt-2 max-h-40 overflow-y-auto border border-gray-200 rounded-md bg-white shadow-lg",children:N==null?void 0:N.filter(t=>(t.companyName||t.name||"").toLowerCase().includes(E.toLowerCase())||(t.phone||"").includes(E)).map((t,s)=>e.jsxs("div",{onClick:()=>{Ae(t._id),v(t.companyName||t.name||"")},className:`px-3 py-2 cursor-pointer border-b border-gray-100 last:border-b-0 ${s===me?"bg-blue-100 text-blue-900":"hover:bg-gray-100"}`,children:[e.jsx("div",{className:"font-medium text-gray-900",children:b(t.companyName||t.name)||"Unknown"}),e.jsxs("div",{className:"text-sm text-gray-600",children:["Outstanding Balance: $",(t.pendingBalance||0).toFixed(2)]})]},t._id))})]}),e.jsx("div",{className:"flex-1",children:g?e.jsx("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-3",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(Wt,{className:"h-5 w-5 text-gray-400"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium",children:g.companyName||g.name||"Unknown"}),e.jsxs("p",{className:"text-sm text-gray-600 capitalize",children:[g.businessType||"Business"," • ",g.reliability||"Standard"]}),e.jsxs("div",{className:"flex items-center space-x-4 mt-2",children:[e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("span",{className:"text-xs text-gray-500",children:"Outstanding Balance:"}),e.jsx("span",{className:`text-sm font-medium ${(g.outstandingBalance||0)>0?"text-red-600":"text-green-600"}`,children:Math.round(g.outstandingBalance||0)})]}),g.phone&&e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(ns,{className:"h-3 w-3 text-gray-400"}),e.jsx("span",{className:"text-xs text-gray-500",children:g.phone})]})]})]})]})}):e.jsx("div",{className:"hidden lg:block"})})]}),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Product Selection & Cart"})}),e.jsxs("div",{className:"card-content",children:[e.jsx("div",{className:"mb-6",children:e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-12 gap-4 items-end",children:[e.jsxs("div",{className:"col-span-7",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Product Search"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{ref:re,type:"text",value:M,onChange:t=>Ct(t.target.value),onKeyDown:St,className:"input w-full pr-10 h-12",placeholder:"Search or select product..."}),e.jsx(we,{className:"absolute right-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"})]}),P&&P.length>0&&e.jsx("div",{className:"product-list-container mt-2 max-h-40 overflow-y-auto border border-gray-200 rounded-md bg-white shadow-lg",children:P.length===0?e.jsx("div",{className:"px-3 py-2 text-sm text-gray-500 text-center",children:M?"No products found":"Start typing to search products"}):P.map((t,s)=>{var a,n;return e.jsx("div",{"data-product-index":s,onClick:()=>Ue(t),className:`px-3 py-2 cursor-pointer border-b border-gray-100 last:border-b-0 ${s===L?"bg-blue-100 text-blue-900":"hover:bg-gray-100"}`,children:e.jsxs("div",{className:"flex items-center justify-between w-full",children:[e.jsx("div",{className:"font-medium",children:b(t.name)}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("div",{className:"text-sm text-gray-600",children:["Stock: ",((a=t.inventory)==null?void 0:a.currentStock)||0]}),e.jsxs("div",{className:"text-sm text-gray-600",children:["Cost: $",Math.round(((n=t.pricing)==null?void 0:n.cost)||0)]})]})]})},t._id)})})]}),e.jsxs("div",{className:"col-span-1",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Stock"}),e.jsx("span",{className:"text-sm font-semibold text-gray-700 bg-gray-100 px-2 py-1.5 rounded border border-gray-200 block text-center h-12 flex items-center justify-center",children:S?((Ve=S.inventory)==null?void 0:Ve.currentStock)||0:"0"})]}),e.jsxs("div",{className:"col-span-1",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Quantity"}),e.jsx("input",{type:"number",min:"1",value:se,onChange:t=>fe(parseInt(t.target.value)||1),onKeyDown:Fe,className:"input text-center h-12",placeholder:"1 (Enter to add & focus search)"})]}),e.jsxs("div",{className:"col-span-1",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Cost"}),e.jsx("input",{type:"number",step:"1",value:ye,onChange:t=>B(t.target.value),onKeyDown:Fe,className:"input text-center h-12",placeholder:"0 (Enter to add & focus search)",required:!0})]}),e.jsxs("div",{className:"col-span-1",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Amount"}),e.jsx("span",{className:"text-sm font-semibold text-gray-700 bg-gray-100 px-2 py-1.5 rounded border border-gray-200 block text-center h-12 flex items-center justify-center",children:S?Math.round(se*parseFloat(ye||0)):0})]}),e.jsxs("div",{className:"col-span-1",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:" "}),e.jsxs("button",{type:"button",onClick:qe,className:"w-full btn btn-primary flex items-center justify-center px-3 h-12",disabled:!S,title:"Add to cart (or press Enter in Quantity/Cost fields - focus returns to search)",children:[e.jsx(dt,{className:"h-4 w-4 mr-2"}),"Add"]})]})]})})}),i.items.length===0?e.jsxs("div",{className:"p-8 text-center text-gray-500 border-t border-gray-200",children:[e.jsx(Ht,{className:"mx-auto h-12 w-12 text-gray-400"}),e.jsx("p",{className:"mt-2",children:"No items in cart"})]}):e.jsxs("div",{className:"space-y-4 border-t border-gray-200 pt-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h4",{className:"text-md font-medium text-gray-700",children:"Cart Items"}),e.jsxs("button",{type:"button",onClick:Pt,className:"btn btn-secondary btn-sm flex items-center space-x-2",title:"Sort products alphabetically",children:[e.jsx(Xt,{className:"h-4 w-4"}),e.jsx("span",{children:"Sort A-Z"})]})]}),i.items.map((t,s)=>{var c,u,T;const a=t.productData||t.product,n=t.costPerUnit*t.quantity,r=((c=a==null?void 0:a.inventory)==null?void 0:c.currentStock)<=(((u=a==null?void 0:a.inventory)==null?void 0:u.reorderPoint)||0);return e.jsx("div",{className:`py-1 ${s%2===0?"bg-white":"bg-gray-50"}`,children:e.jsxs("div",{className:"grid grid-cols-12 gap-4 items-center",children:[e.jsx("div",{className:"col-span-1",children:e.jsx("span",{className:"text-sm font-medium text-gray-700 bg-gray-50 px-0.5 py-1 rounded border border-gray-200 block text-center h-8 flex items-center justify-center",children:s+1})}),e.jsx("div",{className:"col-span-6 flex items-center h-8",children:e.jsxs("span",{className:"font-medium text-sm truncate",children:[b(a==null?void 0:a.name)||"Unknown Product",r&&e.jsx("span",{className:"text-yellow-600 text-xs ml-2",children:"⚠️ Low"})]})}),e.jsx("div",{className:"col-span-1",children:e.jsx("span",{className:"text-sm font-semibold text-gray-700 bg-gray-100 px-2 py-1 rounded border border-gray-200 block text-center h-8 flex items-center justify-center",children:((T=a==null?void 0:a.inventory)==null?void 0:T.currentStock)||0})}),e.jsx("div",{className:"col-span-1",children:e.jsx("input",{type:"number",value:t.quantity,onChange:o=>{const k=parseInt(o.target.value)||1;if(k<=0){_e(s);return}m(O=>({...O,items:O.items.map((C,f)=>f===s?{...C,quantity:k,totalCost:k*C.costPerUnit}:C)}))},className:"input text-center h-8",min:"1"})}),e.jsx("div",{className:"col-span-1",children:e.jsx("input",{type:"number",step:"0.01",value:t.costPerUnit,onChange:o=>{const k=parseFloat(o.target.value)||0;m(O=>({...O,items:O.items.map((C,f)=>f===s?{...C,costPerUnit:k,totalCost:C.quantity*k}:C)}))},className:"input text-center h-8",min:"0"})}),e.jsx("div",{className:"col-span-1",children:e.jsx("span",{className:"text-sm font-semibold text-gray-700 bg-gray-100 px-2 py-1 rounded border border-gray-200 block text-center h-8 flex items-center justify-center",children:Math.round(n)})}),e.jsx("div",{className:"col-span-1",children:e.jsx("button",{onClick:()=>_e(s),className:"btn btn-danger btn-sm h-8 w-full",children:e.jsx(Ce,{className:"h-4 w-4"})})})]})},s)})]})]})]}),i.items.length>0&&!X&&e.jsxs("div",{className:"bg-gradient-to-br from-blue-50 to-indigo-50 border-2 border-blue-200 rounded-lg max-w-5xl ml-auto mt-4",children:[e.jsx("div",{className:"px-6 py-4 border-b border-blue-200",children:e.jsx("h3",{className:"text-lg font-medium text-gray-900 text-right",children:"Purchase Order Details"})}),e.jsxs("div",{className:"px-6 py-4",children:[e.jsxs("div",{className:"flex flex-nowrap gap-3 items-end justify-end",children:[e.jsxs("div",{className:"flex flex-col w-44",children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Invoice Number"}),e.jsx("input",{type:"text",value:i.invoiceNumber||"Auto-generated",onChange:t=>m(s=>({...s,invoiceNumber:t.target.value})),className:"input h-8 text-sm",placeholder:"Auto-generated",disabled:!0})]}),e.jsxs("div",{className:"flex flex-col w-48",children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Expected Delivery"}),e.jsx("input",{type:"date",value:i.expectedDelivery,onChange:t=>m(s=>({...s,expectedDelivery:t.target.value})),className:"input h-8 text-sm"})]}),e.jsxs("div",{className:"flex flex-col w-40",children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Tax Status"}),e.jsxs("div",{className:"flex items-center space-x-1 px-2 py-1 border border-gray-200 rounded h-8",children:[e.jsx("input",{type:"checkbox",id:"taxExempt",checked:i.isTaxExempt,onChange:t=>m(s=>({...s,isTaxExempt:t.target.checked})),className:"h-3 w-3 text-primary-600 focus:ring-primary-500 border-gray-300 rounded"}),e.jsx("div",{className:"flex-1",children:e.jsx("label",{htmlFor:"taxExempt",className:"text-xs font-medium text-gray-700 cursor-pointer",children:"Tax Exempt"})}),i.isTaxExempt&&e.jsx("div",{className:"text-green-600 text-xs font-medium",children:"✓"})]})]}),e.jsxs("div",{className:"flex flex-col w-[28rem]",children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Notes"}),e.jsx("input",{type:"text",value:i.notes,onChange:t=>m(s=>({...s,notes:t.target.value})),className:"input h-8 text-sm",placeholder:"Additional notes..."})]})]}),e.jsx("div",{className:"bg-gradient-to-r from-blue-500 to-indigo-600 px-6 py-4 border-t border-blue-200 mt-6",children:e.jsx("h3",{className:"text-lg font-semibold text-white",children:"Order Summary"})}),e.jsx("div",{className:"px-6 py-4",children:e.jsxs("div",{className:"space-y-3 mb-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-800 font-semibold",children:"Subtotal:"}),e.jsx("span",{className:"text-xl font-bold text-gray-900",children:Math.round(ze)})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-800 font-semibold",children:i.isTaxExempt?"Tax (Exempt):":"Tax (8%):"}),e.jsx("span",{className:"text-xl font-bold text-gray-900",children:Math.round(Qe)})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-800 font-semibold",children:"PO Total:"}),e.jsx("span",{className:"text-xl font-bold text-gray-900",children:Math.round(Re)})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-800 font-semibold",children:"Previous Outstanding:"}),e.jsx("span",{className:"text-xl font-bold text-red-600",children:Math.round(Ut)})]}),e.jsxs("div",{className:"flex justify-between items-center text-xl font-bold border-t-2 border-blue-400 pt-3 mt-2",children:[e.jsx("span",{className:"text-blue-900",children:"Total Payables:"}),e.jsx("span",{className:"text-blue-900 text-3xl",children:Math.round(Ft)})]})]})}),e.jsxs("div",{className:"flex space-x-3 mt-6 px-6 pb-6",children:[i.items.length>0&&!X&&e.jsxs("button",{onClick:W,className:"btn btn-secondary flex-1",children:[e.jsx(Ce,{className:"h-4 w-4 mr-2"}),"Clear Cart"]}),i.items.length>0&&e.jsxs("button",{onClick:()=>{const t={poNumber:`PO-${Date.now()}`,supplier:g,items:i.items.map(s=>({product:P==null?void 0:P.find(n=>n._id===s.product),quantity:s.quantity,unitCost:s.costPerUnit,totalCost:s.quantity*s.costPerUnit})),subtotal:ze,tax:Qe,total:Re,expectedDelivery:i.expectedDelivery,notes:i.notes,terms:i.terms,createdAt:new Date().toISOString()};je(t)},className:"btn btn-secondary flex-1",children:[e.jsx(Yt,{className:"h-4 w-4 mr-2"}),"Print Preview"]}),e.jsxs("button",{onClick:kt,disabled:Ie||i.items.length===0,className:"btn btn-primary btn-lg flex-2",children:[e.jsx(rs,{className:"h-4 w-4 mr-2"}),Ie?"Creating...":"Create Purchase Order"]})]})]})]}),X&&l&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",onClick:t=>t.stopPropagation(),children:e.jsx("div",{className:"bg-white rounded-lg shadow-xl max-w-6xl w-full mx-4 max-h-[90vh] overflow-y-auto",onClick:t=>t.stopPropagation(),onKeyDown:t=>t.stopPropagation(),children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Edit Purchase Order"}),e.jsx("button",{onClick:()=>{de(!1),U(null),v(""),z(""),K(null),q(1),_(0),D(-1),W()},className:"bg-gray-600 text-white px-4 py-2 rounded-lg hover:bg-gray-700",children:"Close"})]}),e.jsxs("div",{className:"bg-gradient-to-br from-blue-50 to-indigo-50 border-2 border-blue-200 rounded-lg mb-6",children:[e.jsx("div",{className:"px-6 py-4 border-b border-blue-200",children:e.jsx("h3",{className:"text-lg font-medium text-gray-900 text-right",children:"Edit Purchase Order Details"})}),e.jsxs("div",{className:"px-6 py-4",children:[e.jsx("div",{className:"mb-4",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Supplier Selection"}),e.jsx("input",{type:"text",placeholder:"Search suppliers...",value:E,onChange:t=>v(t.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"}),E&&(N==null?void 0:N.length)>0&&e.jsx("div",{className:"mt-2 max-h-40 overflow-y-auto border border-gray-200 rounded-md bg-white shadow-lg",children:N.slice(0,5).map(t=>e.jsxs("div",{onClick:()=>{m(s=>({...s,supplier:t._id})),v(t.companyName||t.name)},className:"px-3 py-2 hover:bg-gray-100 cursor-pointer border-b border-gray-100 last:border-b-0",children:[e.jsx("div",{className:"font-medium",children:t.companyName||t.name}),e.jsx("div",{className:"text-sm text-gray-600",children:t.email})]},t._id))}),i.supplier&&e.jsxs("div",{className:"mt-2 p-2 bg-blue-50 rounded border",children:[e.jsxs("div",{className:"text-sm font-medium text-blue-900",children:["Selected: ",((Ge=l==null?void 0:l.supplierInfo)==null?void 0:Ge.companyName)||((We=l==null?void 0:l.supplierInfo)==null?void 0:We.name)||"Supplier"]}),e.jsx("button",{type:"button",onClick:()=>{m(t=>({...t,supplier:null})),v("")},className:"text-xs text-blue-600 hover:text-blue-800 mt-1",children:"Clear selection"})]})]})}),e.jsxs("div",{className:"flex flex-nowrap gap-3 items-end justify-end",children:[e.jsxs("div",{className:"flex flex-col w-44",children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Invoice Number"}),e.jsx("input",{type:"text",value:i.invoiceNumber||"Auto-generated",onChange:t=>m(s=>({...s,invoiceNumber:t.target.value})),className:"input h-8 text-sm",placeholder:"Auto-generated",disabled:!0})]}),e.jsxs("div",{className:"flex flex-col w-48",children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Expected Delivery"}),e.jsx("input",{type:"date",value:i.expectedDelivery,onChange:t=>m(s=>({...s,expectedDelivery:t.target.value})),className:"input h-8 text-sm"})]}),e.jsxs("div",{className:"flex flex-col w-40",children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Tax Status"}),e.jsxs("div",{className:"flex items-center space-x-1 px-2 py-1 border border-gray-200 rounded h-8",children:[e.jsx("input",{type:"checkbox",id:"taxExemptEdit",checked:i.isTaxExempt,onChange:t=>m(s=>({...s,isTaxExempt:t.target.checked})),className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),e.jsx("label",{htmlFor:"taxExemptEdit",className:"text-xs text-gray-700",children:"Tax Exempt"})]})]})]}),e.jsx("div",{className:"mt-4",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Notes"}),e.jsx("textarea",{value:i.notes,onChange:t=>m(s=>({...s,notes:t.target.value})),className:"input h-16 text-sm resize-none",placeholder:"Add any notes or comments..."})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Terms & Conditions"}),e.jsx("textarea",{value:i.terms,onChange:t=>m(s=>({...s,terms:t.target.value})),className:"input h-16 text-sm resize-none",placeholder:"Add terms and conditions..."})]})]})})]}),e.jsxs("div",{className:"px-6 py-4 border-t border-blue-200",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-900 mb-3",children:"Product Selection & Cart Items"}),e.jsx("div",{className:"mb-4",children:e.jsxs("div",{className:"grid grid-cols-12 gap-4 items-end",children:[e.jsxs("div",{className:"col-span-6",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Product Search"}),e.jsx("input",{type:"text",placeholder:"Search or type product name...",value:ne,onChange:t=>{t.stopPropagation(),z(t.target.value),D(-1)},onFocus:t=>t.stopPropagation(),onKeyDown:t=>{var a;if(t.stopPropagation(),!(I!=null&&I.length))return;const s=Math.min(I.length-1,4);switch(t.key){case"ArrowDown":t.preventDefault(),D(n=>n<s?n+1:0);break;case"ArrowUp":t.preventDefault(),D(n=>n>0?n-1:s);break;case"Enter":if(t.preventDefault(),ue>=0&&I[ue]){const n=I[ue];K(n),_(((a=n.pricing)==null?void 0:a.costPrice)||0),q(1),z(n.name),D(-1),setTimeout(()=>{const r=document.querySelector(".modal-quantity-input");r&&r.focus()},100)}break;case"Escape":t.preventDefault(),D(-1);break}},className:"modal-product-search w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",autoFocus:!0}),I&&I.length>0&&e.jsx("div",{className:"mt-2 max-h-40 overflow-y-auto border border-gray-200 rounded-md bg-white shadow-lg",children:I.slice(0,5).map((t,s)=>{var a,n;return e.jsxs("div",{onClick:()=>{var r;K(t),_(((r=t.pricing)==null?void 0:r.costPrice)||0),q(1),z(t.name),D(-1),setTimeout(()=>{const c=document.querySelector(".modal-quantity-input");c&&c.focus()},100)},className:`px-3 py-2 cursor-pointer border-b border-gray-100 last:border-b-0 ${ue===s?"bg-blue-100 border-blue-200":"hover:bg-gray-100"}`,children:[e.jsx("div",{className:"font-medium",children:t.name}),e.jsxs("div",{className:"text-sm text-gray-600",children:["Stock: ",((a=t.inventory)==null?void 0:a.currentStock)||0," | Cost: ",((n=t.pricing)==null?void 0:n.costPrice)||0]})]},t._id)})})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Quantity"}),e.jsx("input",{type:"number",min:"1",value:Z,onChange:t=>q(parseInt(t.target.value)||1),className:"modal-quantity-input w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"1"})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Cost Per Unit"}),e.jsx("input",{type:"number",step:"0.01",value:J,onChange:t=>_(parseFloat(t.target.value)||0),className:"modal-cost-input w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"0.00"})]}),e.jsx("div",{className:"col-span-2",children:e.jsx("button",{type:"button",onClick:()=>{if(xe&&Z>0&&J>=0){const t={product:xe._id,quantity:Z,costPerUnit:J,totalCost:Z*J,productData:xe};m(s=>({...s,items:[...s.items,t]})),K(null),z(""),q(1),_(0),D(-1)}},disabled:!xe||Z<=0||J<0,className:"w-full px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:bg-gray-300 disabled:cursor-not-allowed",children:"Add Product"})})]})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h5",{className:"text-sm font-medium text-gray-700 mb-2",children:"Current Items:"}),i.items.length===0?e.jsx("p",{className:"text-sm text-gray-500 italic",children:"No items in this order"}):i.items.map((t,s)=>{var a;return e.jsxs("div",{className:"flex items-center p-3 bg-white border border-gray-200 rounded-lg",children:[e.jsx("div",{className:"font-medium text-gray-900 min-w-[200px] mr-4",children:((a=t.productData)==null?void 0:a.name)||"Unknown Product"}),e.jsxs("div",{className:"flex items-center space-x-3 ml-auto",children:[e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("label",{className:"text-xs text-gray-600",children:"Qty:"}),e.jsx("input",{type:"number",min:"1",value:t.quantity,onChange:n=>{const r=[...i.items],c=Math.max(1,parseInt(n.target.value)||1);r[s].quantity=c,r[s].totalCost=c*r[s].costPerUnit,m(u=>({...u,items:r}))},className:"w-16 px-2 py-1 text-sm border border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-blue-500"})]}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("label",{className:"text-xs text-gray-600",children:"× Cost:"}),e.jsx("input",{type:"number",step:"0.01",min:"0",value:t.costPerUnit,onChange:n=>{const r=[...i.items],c=parseFloat(n.target.value)||0;r[s].costPerUnit=c,r[s].totalCost=r[s].quantity*c,m(u=>({...u,items:r}))},className:"w-20 px-2 py-1 text-sm border border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-blue-500"})]}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("label",{className:"text-xs text-gray-600",children:"="}),e.jsx("span",{className:"text-sm font-medium text-gray-900 min-w-[60px]",children:t.totalCost.toFixed(2)})]}),e.jsx("button",{type:"button",onClick:()=>{const n=i.items.filter((r,c)=>c!==s);m(r=>({...r,items:n}))},className:"px-2 py-1 text-sm bg-red-200 text-red-700 rounded hover:bg-red-300 ml-2",title:"Remove item",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]})]},s)})]})]}),e.jsxs("div",{className:"px-6 py-4 border-t border-blue-200",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-900 mb-3",children:"Order Items Summary"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"bg-white rounded-lg p-3 border border-gray-200",children:[e.jsx("div",{className:"text-xs text-gray-600 mb-1",children:"Total Items"}),e.jsx("div",{className:"text-lg font-semibold text-gray-900",children:i.items.length})]}),e.jsxs("div",{className:"bg-white rounded-lg p-3 border border-gray-200",children:[e.jsx("div",{className:"text-xs text-gray-600 mb-1",children:"Total Quantity"}),e.jsx("div",{className:"text-lg font-semibold text-gray-900",children:i.items.reduce((t,s)=>t+s.quantity,0)})]}),e.jsxs("div",{className:"bg-white rounded-lg p-3 border border-gray-200",children:[e.jsx("div",{className:"text-xs text-gray-600 mb-1",children:"Total Cost"}),e.jsx("div",{className:"text-lg font-semibold text-blue-600",children:Math.round(i.items.reduce((t,s)=>t+s.totalCost,0))})]})]})]}),e.jsx("div",{className:"px-6 py-4 border-t border-blue-200 bg-white rounded-b-lg",children:e.jsx("div",{className:"flex justify-end",children:e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-sm text-gray-600 mb-1",children:"Total Payables"}),e.jsx("div",{className:"text-2xl font-bold text-blue-900",children:Math.round(i.items.reduce((t,s)=>t+s.totalCost,0))})]})})}),e.jsxs("div",{className:"flex items-center justify-end space-x-3 p-6 border-t border-gray-200",children:[e.jsx("button",{onClick:()=>{de(!1),U(null),v(""),z(""),K(null),q(1),_(0),D(-1),W()},className:"px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 border border-gray-300 rounded-md hover:bg-gray-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500",children:"Cancel"}),e.jsx("button",{onClick:Dt,disabled:$e||i.items.length===0,className:"px-4 py-2 text-sm font-medium text-white bg-blue-600 border border-transparent rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:bg-gray-300 disabled:cursor-not-allowed",children:$e?"Updating...":"Update Purchase Order"})]})]})]})})}),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ls,{className:"h-5 w-5 text-gray-400"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Filters"})]})}),e.jsx("div",{className:"card-content",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-7 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"From Date"}),e.jsx("input",{type:"date",value:h.fromDate,onChange:t=>H("fromDate",t.target.value),className:"input h-[42px]"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"To Date"}),e.jsx("input",{type:"date",value:h.toDate,onChange:t=>H("toDate",t.target.value),className:"input h-[42px]"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"PO Number"}),e.jsx("input",{type:"text",placeholder:"Contains...",value:h.poNumber,onChange:t=>H("poNumber",t.target.value),className:"input h-[42px]"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Status"}),e.jsxs("select",{value:h.status,onChange:t=>H("status",t.target.value),className:"input h-[42px]",children:[e.jsx("option",{value:"",children:"All Statuses"}),e.jsx("option",{value:"draft",children:"Pending"}),e.jsx("option",{value:"confirmed",children:"Confirmed"}),e.jsx("option",{value:"partially_received",children:"Partially Received"}),e.jsx("option",{value:"fully_received",children:"Fully Received"}),e.jsx("option",{value:"cancelled",children:"Cancelled"}),e.jsx("option",{value:"closed",children:"Closed"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Supplier"}),e.jsxs("select",{value:h.supplier,onChange:t=>H("supplier",t.target.value),className:"input h-[42px]",children:[e.jsx("option",{value:"",children:"All Suppliers"}),N==null?void 0:N.map(t=>e.jsx("option",{value:t._id,children:t.companyName||t.name||"Unknown"},t._id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Payment Status"}),e.jsxs("select",{value:h.paymentStatus,onChange:t=>H("paymentStatus",t.target.value),className:"input h-[42px]",children:[e.jsx("option",{value:"",children:"All Payment Statuses"}),e.jsx("option",{value:"pending",children:"Pending"}),e.jsx("option",{value:"paid",children:"Paid"}),e.jsx("option",{value:"partial",children:"Partial"}),e.jsx("option",{value:"refunded",children:"Refunded"})]})]}),e.jsx("div",{className:"flex items-end",children:e.jsxs("button",{onClick:()=>Q(),className:"btn btn-primary w-full flex items-center justify-center space-x-2 h-[42px]",children:[e.jsx(we,{className:"h-4 w-4"}),e.jsx("span",{children:"Search"})]})})]})})]}),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h3",{className:"text-lg font-medium text-gray-900",children:["Purchase Orders From: ",$(h.fromDate)," To: ",$(h.toDate)]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("span",{className:"text-sm text-gray-500",children:[At.totalItems||0," records"]}),e.jsx("button",{onClick:()=>Q(),className:"p-2 text-gray-400 hover:text-gray-600",title:"Refresh",children:e.jsx(ct,{className:"h-4 w-4"})})]})]})}),e.jsx("div",{className:"card-content p-0",children:gt?e.jsxs("div",{className:"p-8 text-center",children:[e.jsx(ct,{className:"h-8 w-8 animate-spin mx-auto text-gray-400"}),e.jsx("p",{className:"mt-2 text-gray-500",children:"Loading purchase orders..."})]}):Oe?e.jsx("div",{className:"p-8 text-center text-red-600",children:e.jsxs("p",{children:["Error loading purchase orders: ",Oe.message]})}):Ne.length===0?e.jsx("div",{className:"p-8 text-center text-gray-500",children:e.jsx("p",{children:"No purchase orders found for the selected criteria."})}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Date"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"PO #"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Supplier"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Total"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:Ne.map((t,s)=>e.jsxs("tr",{className:s%2===0?"bg-white":"bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:$(t.createdAt)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:t.poNumber}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:b(t.supplier)||"Unknown"}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:e.jsx(os,{status:t.status})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:Math.round(t.total||0)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{onClick:()=>It(t),className:"text-blue-600 hover:text-blue-900",title:"View",children:e.jsx(is,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>je(t),className:"text-gray-600 hover:text-gray-900",title:"Print",children:e.jsx(mt,{className:"h-4 w-4"})}),(t.status==="draft"||t.status==="confirmed"||t.status==="partially_received"||t.status==="cancelled")&&e.jsx("button",{onClick:()=>Mt(t),className:"text-indigo-600 hover:text-indigo-900",title:"Edit",children:e.jsx(cs,{className:"h-4 w-4"})}),t.status==="draft"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>Ot(t._id),className:"text-green-600 hover:text-green-900",title:"Confirm Order",children:e.jsx(Se,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>Et(t._id),className:"text-red-600 hover:text-red-900",title:"Cancel Order",children:e.jsx(Pe,{className:"h-4 w-4"})})]}),(t.status==="draft"||t.status==="cancelled"||t.status==="confirmed"||t.status==="partially_received"||!t.supplier)&&e.jsx("button",{onClick:()=>Tt(t._id),className:"text-red-600 hover:text-red-900",title:"Delete",children:e.jsx(Ce,{className:"h-4 w-4"})})]})})]},t._id))})]})})})]}),pt&&l&&e.jsx("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50",children:e.jsx("div",{className:"relative top-10 mx-auto p-5 border w-4/5 max-w-4xl shadow-lg rounded-md bg-white",children:e.jsxs("div",{className:"mt-3",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h3",{className:"text-2xl font-bold text-gray-900",children:"Purchase Order"}),e.jsx("button",{onClick:()=>{ge(!1),U(null)},className:"text-gray-400 hover:text-gray-600 transition-colors",children:e.jsx("svg",{className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsxs("div",{className:"mb-6 text-center",children:[e.jsx("h4",{className:"text-lg font-semibold text-gray-900 mb-2",children:De}),ce&&e.jsx("p",{className:"text-sm text-gray-600",children:ce}),oe&&e.jsxs("p",{className:"text-sm text-gray-600",children:["Phone: ",oe]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-6 mb-6",children:[e.jsxs("div",{children:[e.jsx("h5",{className:"font-semibold text-gray-900 mb-2",children:"Purchase Order Details"}),e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"PO Number:"})," ",l.poNumber]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Date:"})," ",$(l.createdAt)]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Status:"}),e.jsx("span",{className:`ml-2 px-2 py-1 rounded-full text-xs font-medium ${l.status==="draft"?"bg-gray-100 text-gray-800":l.status==="confirmed"?"bg-blue-100 text-blue-800":l.status==="partially_received"?"bg-yellow-100 text-yellow-800":l.status==="fully_received"?"bg-green-100 text-green-800":l.status==="cancelled"?"bg-red-100 text-red-800":"bg-gray-100 text-gray-800"}`,children:l.status==="draft"?"Pending":l.status.replace("_"," ")})]}),l.expectedDelivery&&e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Expected Delivery:"})," ",$(l.expectedDelivery)]})]})]}),e.jsx("div",{}),e.jsxs("div",{className:"text-right",children:[e.jsx("h5",{className:"font-semibold text-gray-900 mb-2",children:"Supplier Details"}),e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Company:"})," ",b(l.supplier)||"Unknown"]}),((He=l.supplier)==null?void 0:He.email)&&e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Email:"})," ",b(l.supplier.email)]}),((Xe=l.supplier)==null?void 0:Xe.phone)&&e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Phone:"})," ",b(l.supplier.phone)]}),((Ye=l.supplier)==null?void 0:Ye.contactPerson)&&e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Contact:"})," ",b(l.supplier.contactPerson)]}),e.jsx("div",{className:"mt-3 pt-2 border-t border-gray-200",children:e.jsxs("p",{className:"font-semibold text-red-600",children:[e.jsx("span",{className:"font-medium",children:"Outstanding Balance:"})," ",Math.round(((Ze=l.supplier)==null?void 0:Ze.pendingBalance)||0)]})})]})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("h5",{className:"font-semibold text-gray-900 mb-3",children:"Items Ordered"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full border border-gray-200 rounded-lg",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider border-b border-gray-200",children:"#"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider border-b border-gray-200",children:"Product"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider border-b border-gray-200",children:"Quantity"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider border-b border-gray-200",children:"Unit Cost"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider border-b border-gray-200",children:"Total Cost"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:l.items&&l.items.map((t,s)=>{var a;return e.jsxs("tr",{className:s%2===0?"bg-white":"bg-gray-50",children:[e.jsx("td",{className:"px-4 py-3 text-sm text-gray-900 border-b border-gray-200",children:s+1}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-900 border-b border-gray-200",children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:b(t.product)||"Unknown Product"}),((a=t.product)==null?void 0:a.description)&&e.jsx("div",{className:"text-gray-500 text-xs",children:b(t.product.description)})]})}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-900 text-right border-b border-gray-200",children:t.quantity}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-900 text-right border-b border-gray-200",children:Math.round(t.costPerUnit||0)}),e.jsx("td",{className:"px-4 py-3 text-sm font-medium text-gray-900 text-right border-b border-gray-200",children:Math.round(t.totalCost||0)})]},s)})})]})})]}),e.jsx("div",{className:"flex justify-end mb-6",children:e.jsx("div",{className:"w-80",children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Subtotal:"}),e.jsx("span",{className:"font-medium",children:Math.round(l.subtotal||0)})]}),l.tax&&l.tax>0&&e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Tax:"}),e.jsx("span",{className:"font-medium",children:Math.round(l.tax)})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"PO Total:"}),e.jsx("span",{className:"font-medium",children:Math.round(l.total||0)})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Previous Outstanding:"}),e.jsx("span",{className:"font-medium text-red-600",children:Math.round(((Je=l.supplier)==null?void 0:Je.pendingBalance)||0)})]}),e.jsxs("div",{className:"flex justify-between text-lg font-bold border-t pt-2",children:[e.jsx("span",{children:"Total Payables:"}),e.jsx("span",{className:"text-red-600",children:Math.round((l.total||0)+(((et=l.supplier)==null?void 0:et.pendingBalance)||0))})]})]})})}),l.notes&&e.jsxs("div",{className:"mb-6",children:[e.jsx("h5",{className:"font-semibold text-gray-900 mb-2",children:"Notes"}),e.jsx("p",{className:"text-sm text-gray-600 bg-gray-50 p-3 rounded border",children:b(l.notes)})]}),l.terms&&e.jsxs("div",{className:"mb-6",children:[e.jsx("h5",{className:"font-semibold text-gray-900 mb-2",children:"Terms & Conditions"}),e.jsx("p",{className:"text-sm text-gray-600 bg-gray-50 p-3 rounded border",children:b(l.terms)})]}),e.jsxs("div",{className:"flex justify-between items-center pt-4 border-t",children:[e.jsxs("div",{className:"text-xs text-gray-500",children:["Generated on ",new Date().toLocaleDateString()," at ",new Date().toLocaleTimeString()]}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsxs("button",{onClick:()=>je(l),className:"btn btn-primary flex items-center",children:[e.jsx(mt,{className:"h-4 w-4 mr-2"}),"Print"]}),e.jsx("button",{onClick:()=>{ge(!1),U(null)},className:"btn btn-secondary",children:"Close"})]})]})]})})})]})};export{zs as PurchaseOrders};
