import{r as l,bj as X,bk as ee,bl as te,p as e,q as H,aH as ae,x as se,s as re,z as b,y as L,B as ne}from"./index-Cw3xRKpc.js";import{u as oe}from"./chartOfAccountsApi-D_feYQra.js";import{P as ce}from"./PrintModal-DmgjaKQ0.js";import{P as B}from"./printer-Bdyt47kH.js";import{L as f}from"./loader-2-C_P1feTT.js";import{S as le}from"./save-Bj2eTcKa.js";import"./useCompanyInfo-B4fVT8rp.js";import"./settingsApi-ygxRjDN0.js";const Ne=()=>{var P;const[n,m]=l.useState({cashAccount:"CASH IN HAND",voucherDate:new Date().toISOString().split("T")[0],voucherNo:"",paymentType:"CASH"}),[y,$]=l.useState([]),[x,N]=l.useState([]),[v,I]=l.useState(!1),[ie,j]=l.useState([]),[i,h]=l.useState([]),[O,{data:ue,isFetching:w}]=X(),[M,C]=l.useState(!1),[V,A]=l.useState(null),{data:d,isLoading:Z,error:de}=ee(void 0,{refetchOnMountOrArgChange:!0}),{data:u}=oe({accountType:"asset",accountCategory:"current_assets",isActive:"true"},{refetchOnMountOrArgChange:!0}),S=(u==null?void 0:u.data)||(u==null?void 0:u.accounts)||u||[],D=Array.isArray(S)?S.filter(t=>{var a,s;return((a=t==null?void 0:t.accountName)==null?void 0:a.toLowerCase().includes("cash"))||((s=t==null?void 0:t.accountName)==null?void 0:s.toLowerCase().includes("bank"))}):[];(P=D.find(t=>{var a;return(a=t.accountName)==null?void 0:a.toLowerCase().includes("cash in hand")}))!=null&&P.accountName,l.useEffect(()=>{if(d){const t=(d==null?void 0:d.data)||d||[];$(t)}},[d]),l.useEffect(()=>{if(!n.voucherNo){const t=new Date(n.voucherDate||new Date),a=t.getFullYear(),s=String(t.getMonth()+1).padStart(2,"0"),r=String(t.getDate()).padStart(2,"0"),o=Date.now(),c=String(o).slice(-4);m(g=>({...g,voucherNo:`CR-${a}${s}${r}-${c}`}))}},[n.voucherNo,n.voucherDate]);const _=async()=>{if(x.length===0){b("Please select at least one city");return}const t=x.join(",");O({cities:t,showZeroBalance:v}).unwrap().then(a=>{var o;const s=((o=a==null?void 0:a.data)==null?void 0:o.customers)||(a==null?void 0:a.customers)||(a==null?void 0:a.data)||a||[];j(s);const r=s.map(c=>({customerId:c._id,accountName:c.accountName||c.businessName||c.name,balance:c.balance||c.pendingBalance||0,particular:"",amount:""}));h(r)}).catch(a=>{L(a,"Load customers")})},q=t=>{N(a=>a.includes(t)?a.filter(s=>s!==t):[...a,t])},K=()=>{N([]),j([]),h([])},k=(t,a,s)=>{h(r=>{const o=[...r];return o[t]={...o[t],[a]:s},o})},R=i.reduce((t,a)=>{const s=parseFloat(a.amount)||0;return t+s},0),[Q,{isLoading:T}]=te(),z=()=>{const t=i.filter(r=>parseFloat(r.amount)>0);if(t.length===0){b("Please enter at least one amount");return}const a=t.map(r=>({customer:r.customerId,amount:parseFloat(r.amount),particular:r.particular||"Cash Receipt"})),s={voucherDate:n.voucherDate,cashAccount:n.cashAccount,paymentType:n.paymentType,receipts:a};Q(s).unwrap().then(r=>{var F;ne((r==null?void 0:r.message)||`Successfully created ${((F=r==null?void 0:r.data)==null?void 0:F.count)||t.length} cash receipt(s)`),h(p=>p.map(J=>({...J,particular:"",amount:""})));const o=new Date(n.voucherDate||new Date),c=o.getFullYear(),g=String(o.getMonth()+1).padStart(2,"0"),U=String(o.getDate()).padStart(2,"0"),Y=Date.now(),W=String(Y).slice(-4);m(p=>({...p,voucherNo:`CR-${c}${g}${U}-${W}`}))}).catch(r=>{b(L(r))})},G=()=>{h(t=>t.map(a=>({...a,particular:"",amount:""})))},E=()=>{const t=i.reduce((s,r)=>s+(parseFloat(r.amount)||0),0),a={invoiceNumber:n.voucherNo||"N/A",orderNumber:n.voucherNo||"N/A",createdAt:n.voucherDate,invoiceDate:n.voucherDate,customer:null,customerInfo:null,pricing:{subtotal:t,total:t,discountAmount:0,taxAmount:0},total:t,items:i.filter(s=>parseFloat(s.amount)>0).map((s,r)=>({_id:s.customerId,product:{name:s.accountName||"N/A"},quantity:1,unitPrice:parseFloat(s.amount)||0,total:parseFloat(s.amount)||0,particular:s.particular||""})),notes:`Payment Type: ${n.paymentType} | Cash Account: ${n.cashAccount}`,voucherNo:n.voucherNo,paymentType:n.paymentType,cashAccount:n.cashAccount};A(a),C(!0)};return e.jsxs("div",{className:"space-y-6 p-6 bg-gray-50 min-h-screen",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-800 mb-6",children:"Cash Receipt Voucher"}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Cash Account"}),e.jsxs("select",{value:n.cashAccount,onChange:t=>m(a=>({...a,cashAccount:t.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"CASH IN HAND",children:"CASH IN HAND"}),D.map(t=>e.jsx("option",{value:t.accountName,children:t.accountName},t._id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Payment Type"}),e.jsxs("select",{value:n.paymentType,onChange:t=>m(a=>({...a,paymentType:t.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"CASH",children:"CASH"}),e.jsx("option",{value:"CHECK",children:"CHECK"}),e.jsx("option",{value:"BANK_TRANSFER",children:"BANK TRANSFER"}),e.jsx("option",{value:"OTHER",children:"OTHER"})]})]}),e.jsxs("div",{className:"bg-blue-50 p-4 rounded-md",children:[e.jsx("div",{className:"text-sm text-gray-600",children:"Total:"}),e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:H(R)})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Voucher Date"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"date",value:n.voucherDate,onChange:t=>m(a=>({...a,voucherDate:t.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"}),e.jsx(ae,{className:"absolute right-3 top-2.5 h-5 w-5 text-gray-400 pointer-events-none"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Voucher No"}),e.jsx("input",{type:"text",value:n.voucherNo,readOnly:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-md bg-gray-50 focus:outline-none"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",id:"showZeroBalance",checked:v,onChange:t=>I(t.target.checked),className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),e.jsx("label",{htmlFor:"showZeroBalance",className:"text-sm text-gray-700",children:"Show Zero Balance"})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs("button",{onClick:E,className:"flex-1 px-4 py-2 bg-gray-500 text-white rounded-md hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-gray-500 flex items-center justify-center",children:[e.jsx(B,{className:"h-4 w-4 mr-2"}),"Print"]}),e.jsx("button",{onClick:K,className:"flex-1 px-4 py-2 bg-gray-500 text-white rounded-md hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-gray-500",children:"UnSelect All"}),e.jsxs("button",{onClick:_,disabled:w||x.length===0,className:"flex-1 px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center",children:[w?e.jsx(f,{className:"h-4 w-4 mr-2 animate-spin"}):e.jsx(se,{className:"h-4 w-4 mr-2"}),"Load"]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Select Cities"}),e.jsx("div",{className:"border border-gray-300 rounded-md h-64 overflow-y-auto bg-white",children:Z?e.jsxs("div",{className:"p-4 text-center text-gray-500",children:[e.jsx(f,{className:"h-5 w-5 animate-spin mx-auto mb-2"}),"Loading cities..."]}):y.length===0?e.jsx("div",{className:"p-4 text-center text-gray-500",children:"No cities available"}):e.jsx("div",{className:"p-2",children:y.map(t=>e.jsxs("div",{className:"flex items-center p-2 hover:bg-gray-50",children:[e.jsx("input",{type:"checkbox",id:`city-${t}`,checked:x.includes(t),onChange:()=>q(t),className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded mr-2"}),e.jsx("label",{htmlFor:`city-${t}`,className:"text-sm text-gray-700 cursor-pointer flex-1",children:t})]},t))})})]})]})]}),i.length>0&&e.jsxs("div",{className:"bg-white rounded-lg shadow",children:[e.jsx("div",{className:"p-4 border-b border-gray-200",children:e.jsx("h2",{className:"text-lg font-semibold text-gray-800",children:"Customer Receipts"})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Account Name"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Balance"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Particular"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Amount"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:i.map((t,a)=>e.jsxs("tr",{className:parseFloat(t.amount)>0?"bg-yellow-50":"",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:t.accountName}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:H(t.balance)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("input",{type:"text",value:t.particular,onChange:s=>k(a,"particular",s.target.value),placeholder:"Enter description",className:"w-full px-3 py-1 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("input",{type:"number",value:t.amount,onChange:s=>k(a,"amount",s.target.value),placeholder:"0.00",min:"0",step:"0.01",className:"w-full px-3 py-1 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm"})})]},t.customerId))})]})})]}),e.jsxs("div",{className:"flex justify-end space-x-4 bg-white rounded-lg shadow p-6",children:[e.jsxs("button",{onClick:z,disabled:T||R===0,className:"px-6 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed flex items-center",children:[T?e.jsx(f,{className:"h-4 w-4 mr-2 animate-spin"}):e.jsx(le,{className:"h-4 w-4 mr-2"}),"Save"]}),e.jsxs("button",{onClick:G,className:"px-6 py-2 bg-gray-500 text-white rounded-md hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-gray-500 flex items-center",children:[e.jsx(re,{className:"h-4 w-4 mr-2"}),"Reset"]}),e.jsxs("button",{onClick:E,disabled:i.filter(t=>parseFloat(t.amount)>0).length===0,className:"px-6 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-green-500 disabled:opacity-50 disabled:cursor-not-allowed flex items-center",children:[e.jsx(B,{className:"h-4 w-4 mr-2"}),"Print"]})]}),e.jsx(ce,{isOpen:M,onClose:()=>{C(!1),A(null)},orderData:V,documentTitle:"Cash Receipt Voucher",partyLabel:"Customer"})]})};export{Ne as default};
