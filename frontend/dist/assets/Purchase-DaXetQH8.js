import{r as l,u as Le,ac as Oe,ad as _e,O as ge,Q as d,o as e,a2 as De,ae as Qe,af as Be,P as Ke,A as ze,t as Ge,L as Je,ag as We}from"./index-jd7Ax_Ed.js";import{u as Ve}from"./productsApi-hw6ecLPR.js";import{u as Xe,a as Ye}from"./suppliersApi-CEk3wVdz.js";import{u as Ze}from"./useFuzzySearch-BrpeiQaU.js";import{S as ve}from"./SearchableDropdown-D6GNUAgH.js";import{P as He}from"./PrintModal-BkQ6aCj8.js";import{g as et}from"./ComponentRegistry-COpHSNtL.js";import{D as tt}from"./download-bwqK3ulf.js";import{P as je}from"./plus-C2o0386P.js";import{P as st}from"./phone-Dkvr6QGJ.js";import{T as Ne}from"./trash-2-DCbqoVbR.js";import{X as rt}from"./x-circle-CN1zMonK.js";import"./chevron-down-BFYGIyCo.js";import"./check-C5eRyuMu.js";import"./useCompanyInfo-kGS5xcZ6.js";import"./printer-BkLl9NNZ.js";const at=({item:b,index:o,onUpdateQuantity:h,onUpdateCost:m,onRemove:r})=>{var v,x,O,q,R;const g=b.costPerUnit*b.quantity,I=((x=(v=b.product)==null?void 0:v.inventory)==null?void 0:x.currentStock)||0,P=((q=(O=b.product)==null?void 0:O.inventory)==null?void 0:q.reorderPoint)||0,T=I<=P;return e.jsx("div",{className:`py-1 ${o%2===0?"bg-white":"bg-gray-50"}`,children:e.jsxs("div",{className:"grid grid-cols-12 gap-4 items-center",children:[e.jsx("div",{className:"col-span-1",children:e.jsx("span",{className:"text-sm font-medium text-gray-700 bg-gray-50 px-0.5 py-1 rounded border border-gray-200 block text-center h-8 flex items-center justify-center",children:o+1})}),e.jsx("div",{className:"col-span-6 flex items-center h-8",children:e.jsxs("span",{className:"font-medium text-sm truncate",children:[((R=b.product)==null?void 0:R.name)||"Unknown Product",T&&e.jsx("span",{className:"text-yellow-600 text-xs ml-2",children:"⚠️ Low Stock"})]})}),e.jsx("div",{className:"col-span-1",children:e.jsx("span",{className:"text-sm font-semibold text-gray-700 bg-gray-100 px-2 py-1 rounded border border-gray-200 block text-center h-8 flex items-center justify-center",children:I})}),e.jsx("div",{className:"col-span-1",children:e.jsx("input",{type:"number",value:b.quantity,onChange:N=>{var S;return h((S=b.product)==null?void 0:S._id,parseInt(N.target.value)||1)},className:"input text-center h-8",min:"1"})}),e.jsx("div",{className:"col-span-1",children:e.jsx("input",{type:"number",step:"0.01",value:b.costPerUnit,onChange:N=>{var S;return m((S=b.product)==null?void 0:S._id,parseFloat(N.target.value)||0)},className:"input text-center h-8",min:"0"})}),e.jsx("div",{className:"col-span-1",children:e.jsx("span",{className:"text-sm font-semibold text-gray-700 bg-gray-100 px-2 py-1 rounded border border-gray-200 block text-center h-8 flex items-center justify-center",children:g.toFixed(2)})}),e.jsx("div",{className:"col-span-1",children:e.jsx("button",{onClick:()=>{var N;return r((N=b.product)==null?void 0:N._id)},className:"btn btn-danger btn-sm h-8 w-full",children:e.jsx(Ne,{className:"h-4 w-4"})})})]})})},nt=({onAddProduct:b})=>{const[o,h]=l.useState(""),[m,r]=l.useState(null),[g,I]=l.useState(1),[P,T]=l.useState("0"),v=l.useRef(null),{data:x,isLoading:O,error:q}=Ve({limit:100,status:"active"},{keepPreviousData:!0,staleTime:3e4}),R=ge.useMemo(()=>{var u,K,M;return x?Array.isArray(x)?x:(u=x==null?void 0:x.data)!=null&&u.products?x.data.products:x!=null&&x.products?x.products:(M=(K=x==null?void 0:x.data)==null?void 0:K.data)!=null&&M.products?x.data.data.products:[]:[]},[x]),N=Ze(R,o,["name","description","brand","barcode","sku"],{threshold:.4,minScore:.3,limit:10}),S=u=>{r(u),T(u.pricing.cost.toString()),h(u.name)},U=()=>{if(m){if(!P||parseFloat(P)<=0){d.error("Please enter a valid cost per unit");return}b({product:m,quantity:g,costPerUnit:parseFloat(P)}),r(null),I(1),T("0"),h(""),setTimeout(()=>{v.current&&v.current.focus()},100)}},B=u=>e.jsxs("div",{className:"flex items-center justify-between w-full",children:[e.jsx("div",{className:"font-medium",children:u.name}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("div",{className:"text-sm text-gray-600",children:["Stock: ",u.inventory.currentStock]}),e.jsxs("div",{className:"text-sm text-gray-600",children:["Cost: $",Math.round(u.pricing.cost)]})]})]});return e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-12 gap-4 items-end",children:[e.jsxs("div",{className:"col-span-7",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Product Search"}),e.jsx(ve,{ref:v,placeholder:"Search or select product...",items:N||[],onSelect:S,onSearch:u=>{h(u),m&&u!==m.name&&(r(null),T("0"))},displayKey:B,selectedItem:m,loading:O,emptyMessage:o.length>0?"No products found":"Start typing to search products...",value:m?m.name:o,showSelected:!0})]}),e.jsxs("div",{className:"col-span-1",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Stock"}),e.jsx("span",{className:"text-sm font-semibold text-gray-700 bg-gray-100 px-2 py-1 rounded border border-gray-200 block text-center h-10 flex items-center justify-center",children:m?m.inventory.currentStock:"0"})]}),e.jsxs("div",{className:"col-span-1",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Quantity"}),e.jsx("input",{type:"number",min:"1",value:g,onChange:u=>I(parseInt(u.target.value)||1),onKeyDown:u=>{u.key==="Enter"&&m&&(u.preventDefault(),U())},className:"input text-center",placeholder:"1 (Enter to add & focus search)"})]}),e.jsxs("div",{className:"col-span-1",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Cost"}),e.jsx("input",{type:"number",step:"1",value:P,onChange:u=>T(u.target.value),onKeyDown:u=>{u.key==="Enter"&&m&&(u.preventDefault(),U())},className:"input text-center",placeholder:"0 (Enter to add & focus search)",required:!0})]}),e.jsxs("div",{className:"col-span-1",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Amount"}),e.jsx("input",{type:"text",value:m?Math.round(g*parseFloat(P||0)):"",className:"input text-center font-medium",disabled:!0,placeholder:""})]}),e.jsxs("div",{className:"col-span-1",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:" "}),e.jsxs("button",{type:"button",onClick:U,className:"w-full btn btn-primary flex items-center justify-center px-3 py-2",disabled:!m,title:"Add to cart (or press Enter in Quantity/Cost fields - focus returns to search)",children:[e.jsx(je,{className:"h-4 w-4 mr-2"}),"Add"]})]})]})})},kt=({tabId:b,editData:o})=>{var ye,be;const[h,m]=l.useState([]),[r,g]=l.useState(null),[I,P]=l.useState(""),[T,v]=l.useState(""),[x,O]=l.useState(!0),[q,R]=l.useState(new Date().toISOString().split("T")[0]),[N,S]=l.useState(""),[U,B]=l.useState(!0),[u,K]=l.useState(!1),M=l.useRef(null),[Z,H]=l.useState("cash"),[F,ee]=l.useState(0),[y,z]=l.useState({type:"amount",value:0}),[we,le]=l.useState(!1),[Pe,ie]=l.useState(null),[Se,G]=l.useState(!1),[C,J]=l.useState("pdf"),[te,de]=l.useState(!1),ue=(()=>{const t=new Date,s=new Date;s.setMonth(t.getMonth()-1);const a=n=>{const c=n.getFullYear(),i=String(n.getMonth()+1).padStart(2,"0"),p=String(n.getDate()).padStart(2,"0");return`${c}-${i}-${p}`};return{from:a(s),to:a(t)}})(),[_,W]=l.useState(ue.from),[V,X]=l.useState(ue.to),{updateTabTitle:me,getActiveTab:xe,openTab:Ce}=Le(),[pe,{data:se,isLoading:ke}]=Xe(),[ct]=Oe(),[lt]=_e();l.useEffect(()=>{const t=()=>{K(window.innerWidth<768)};return t(),window.addEventListener("resize",t),()=>window.removeEventListener("resize",t)},[]),l.useEffect(()=>{M.current&&M.current.focus()},[]),l.useEffect(()=>{if(o&&o.isEditMode&&o.invoiceId&&(o.supplier&&g(o.supplier),o.invoiceNumber&&(v(o.invoiceNumber),O(!1)),o.notes&&S(o.notes),o.items&&o.items.length>0)){const t=o.items.map(s=>({product:s.product,quantity:s.quantity,costPerUnit:s.unitCost||s.costPerUnit,totalCost:s.totalCost||s.quantity*(s.unitCost||s.costPerUnit)}));m(t)}},[o==null?void 0:o.invoiceId]);const{data:D}=Ye(r==null?void 0:r._id,{skip:!(r!=null&&r._id)||!(o!=null&&o.isEditMode)});l.useEffect(()=>{D!=null&&D.data&&g(D.data)},[D]),l.useEffect(()=>{I.length>0&&pe(I)},[I,pe]);const j=ge.useMemo(()=>se||{data:{suppliers:[]}},[se]);l.useEffect(()=>{var t;if(r&&((t=j==null?void 0:j.data)!=null&&t.suppliers)){const s=j.data.suppliers.find(a=>a._id===r._id);s&&(s.pendingBalance!==r.pendingBalance||s.advanceBalance!==r.advanceBalance||s.currentBalance!==r.currentBalance)&&g(s)}},[(ye=j==null?void 0:j.data)==null?void 0:ye.suppliers]),(t=>{l.useEffect(()=>{const s=a=>{if(!a.key)return;const n=a.key.toLowerCase(),i=a.ctrlKey||a.metaKey?`ctrl+${n}`:n;t[i]&&(a.preventDefault(),t[i]())};return document.addEventListener("keydown",s),()=>document.removeEventListener("keydown",s)},[t])})({"ctrl+f":()=>{const t=document.querySelector('input[placeholder*="Search products"]');t&&(t.focus(),t.select())},"ctrl+s":()=>{const t=document.querySelector('input[placeholder*="Search suppliers"]');t&&(t.focus(),t.select())},"ctrl+p":()=>{h.length>0?(ne(),d.success("Processing purchase...")):d.error("No items to purchase")},"ctrl+enter":()=>{h.length>0?ne():d.error("No items to purchase")},escape:()=>{h.length>0&&(m([]),d.success("Purchase items cleared"))},f1:()=>{d.success("Keyboard Shortcuts: Ctrl+F (Product Search), Ctrl+S (Supplier Search), Ctrl+P (Process Purchase), Esc (Clear Items)")}});const re=t=>{if(!t)return"";const s=new Date,a=s.getFullYear(),n=String(s.getMonth()+1).padStart(2,"0"),c=String(s.getDate()).padStart(2,"0"),i=String(s.getTime()).slice(-6),p=Math.floor(Math.random()*1e3).toString().padStart(3,"0");return`PO-${(t.companyName||t.name||"SUP").split(" ").map(f=>f.charAt(0).toUpperCase()).join("").substring(0,3)}-${a}${n}${c}-${i}-${p}`},Ee=t=>{g(t),x&&t&&v(re(t));const s=xe();s&&t&&me(s.id,`Purchase - ${t.displayName}`),h.length>0&&!(o!=null&&o.isEditMode)&&(m([]),d.success("Purchase items cleared due to supplier change. Please re-add products."))};useMutation(purchaseInvoicesAPI.createPurchaseInvoice,{onSuccess:t=>{var i;queryClient.invalidateQueries("inventory"),queryClient.invalidateQueries("products"),queryClient.invalidateQueries(["purchase-invoices"]),queryClient.invalidateQueries("suppliers"),queryClient.invalidateQueries("todaySummary"),queryClient.invalidateQueries("purchaseOrdersToday"),queryClient.invalidateQueries("purchaseInvoicesToday");const s=((i=t==null?void 0:t.invoice)==null?void 0:i.invoiceNumber)||"Unknown",n=((t==null?void 0:t.inventoryUpdates)||[]).filter(p=>p.success).length;d.success(`Purchase invoice created successfully! Invoice ${s} created and ${n} products added to inventory.`),m([]),g(null),ee(0),H("cash"),v(""),R(new Date().toISOString().split("T")[0]),S("");const c=xe();c&&me(c.id,"Purchase")},onError:t=>{var s,a;console.error("Purchase failed:",t),d.error(((a=(s=t.response)==null?void 0:s.data)==null?void 0:a.message)||"Failed to complete purchase")}}),useMutation(purchaseInvoicesAPI.updatePurchaseInvoice,{onSuccess:t=>{var c;queryClient.invalidateQueries("inventory"),queryClient.invalidateQueries("products"),queryClient.invalidateQueries(["purchase-invoices"]),queryClient.invalidateQueries("suppliers"),queryClient.invalidateQueries("todaySummary"),queryClient.invalidateQueries("purchaseOrdersToday"),queryClient.invalidateQueries("purchaseInvoicesToday");const s=((c=t==null?void 0:t.invoice)==null?void 0:c.invoiceNumber)||"Unknown",n=((t==null?void 0:t.inventoryUpdates)||[]).filter(i=>i.success).length;d.success(`Purchase invoice updated successfully! Invoice ${s} updated and ${n} products adjusted in inventory.`)},onError:t=>{var s,a;console.error("Purchase update failed:",t),d.error(((a=(s=t.response)==null?void 0:s.data)==null?void 0:a.message)||"Failed to update purchase")}});const Ie=()=>{if(U||!r)return 0;const t=h.reduce((a,n)=>a+n.costPerUnit*n.quantity,0);let s=0;switch(r.businessType){case"manufacturer":s=.06;break;case"distributor":s=.07;break;case"wholesaler":s=.08;break;case"dropshipper":s=.05;break;default:s=.08}return r.rating>=5&&r.reliability==="excellent"&&(s*=.5),t*s},Q=h.reduce((t,s)=>t+s.costPerUnit*s.quantity,0),Y=Ie(),ae=y.type==="percentage"?Q*y.value/100:y.value,A=Q+Y-ae,he=(r==null?void 0:r.pendingBalance)||0,Te=A+he,Ue=t=>{m(s=>{var n;const a=s.find(c=>{var i,p;return((i=c.product)==null?void 0:i._id)===((p=t.product)==null?void 0:p._id)});return a?window.confirm(`"${((n=t.product)==null?void 0:n.name)||"Unknown Product"}" is already in the cart (Qty: ${a.quantity}).

Do you want to add ${t.quantity} more units?`)?s.map(i=>{var p,L;return((p=i.product)==null?void 0:p._id)===((L=t.product)==null?void 0:L._id)?{...i,quantity:i.quantity+t.quantity,costPerUnit:t.costPerUnit}:i}):s:[...s,t]})},Fe=(t,s)=>{if(s<=0){fe(t);return}m(a=>a.map(n=>{var c;return((c=n.product)==null?void 0:c._id)===t?{...n,quantity:s}:n}))},$e=(t,s)=>{m(a=>a.map(n=>{var c;return((c=n.product)==null?void 0:c._id)===t?{...n,costPerUnit:s}:n}))},fe=t=>{m(s=>s.filter(a=>{var n;return((n=a.product)==null?void 0:n._id)!==t}))},Ae=()=>{m(t=>{if(!t||t.length<2)return t;const s=n=>{const c=n.product;return c?typeof c=="string"?c:c.name||c.title||c.displayName||c.businessName||c.fullName||"":""};return[...t].sort((n,c)=>{const i=s(n).toString().toLowerCase(),p=s(c).toString().toLowerCase();return i<p?-1:i>p?1:0})})},Me=()=>{G(!0)},qe=async()=>{var t,s,a,n,c;de(!0);try{const i={...(r==null?void 0:r._id)&&{supplier:r._id},..._&&{dateFrom:_},...V&&{dateTo:V}};let p;if(C==="excel"?p=await purchaseInvoicesAPI.exportExcel(i):C==="csv"?p=await purchaseInvoicesAPI.exportCSV(i):C==="json"?p=await purchaseInvoicesAPI.exportJSON(i):C==="pdf"&&(p=await purchaseInvoicesAPI.exportPDF(i)),(t=p==null?void 0:p.data)!=null&&t.filename){const L=p.data.filename;try{C==="pdf"&&await new Promise(f=>setTimeout(f,500));let k;try{k=await purchaseInvoicesAPI.downloadFile(L)}catch(f){if(f.response){const w=f.response.data;if(w instanceof Blob){const $=new FileReader;$.onload=()=>{const E=$.result;try{const ce=JSON.parse(E);d.error(ce.message||`Download failed: ${f.response.status}`)}catch{d.error(`Download failed: ${f.response.status}`)}},$.readAsText(w)}else typeof w=="object"&&w!==null?d.error(w.message||`Download failed: ${f.response.status}`):d.error(`Download failed: ${f.response.status}`)}else d.error("Download failed: "+(f.message||"Network error"));return}if(!k||k.status!==200||!k.data){d.error("Download failed: No data received from server");return}const oe=((s=k.headers)==null?void 0:s["content-type"])||((a=k.headers)==null?void 0:a["Content-Type"])||"";if(C==="pdf"){const f=k.data;if(!f||!(f instanceof Blob)){d.error("Invalid PDF file received");return}if(f.size===0){d.error("PDF file is empty");return}if(oe.includes("application/json")||oe.includes("text/html")){const E=new FileReader;E.onload=()=>{const ce=E.result;try{const Re=JSON.parse(ce);d.error(Re.message||"File not found or generation failed")}catch{d.error("Server returned error instead of PDF. Please try again.")}},E.readAsText(f);return}const w=URL.createObjectURL(f);if(window.open(w,"_blank"))d.success("PDF opened in new tab");else{const E=document.createElement("a");E.href=w,E.download=L,document.body.appendChild(E),E.click(),document.body.removeChild(E),d.success("PDF downloaded (popup was blocked)")}setTimeout(()=>URL.revokeObjectURL(w),1e4)}else{const f=k.data,w=URL.createObjectURL(f),$=document.createElement("a");$.href=w,$.download=L,document.body.appendChild($),$.click(),document.body.removeChild($),setTimeout(()=>URL.revokeObjectURL(w),100),d.success(`${C.toUpperCase()} file downloaded successfully`)}G(!1)}catch(k){console.error("Download error:",k),d.error("Failed to download file")}}else d.error("Export failed: No filename received")}catch(i){console.error("Export error:",i),d.error("Failed to export purchase data: "+(((c=(n=i.response)==null?void 0:n.data)==null?void 0:c.message)||i.message))}finally{de(!1)}},ne=()=>{if(h.length===0){d.error("No items to purchase");return}if(!r){d.error("Please select a supplier");return}let t=T;(!t||t.trim()==="")&&x&&(t=re(r),v(t)),(!t||t.trim()==="")&&(t=re(r),v(t));const s={supplier:r._id,supplierInfo:{name:r.name,email:r.email,phone:r.phone,companyName:r.companyName,address:r.address},items:h.map(a=>{var n;return{product:(n=a.product)==null?void 0:n._id,quantity:a.quantity,unitCost:a.costPerUnit,totalCost:a.quantity*a.costPerUnit}}),pricing:{subtotal:Q,discountAmount:0,taxAmount:Y,isTaxExempt:U,total:A},payment:{method:Z,amount:F,remainingBalance:Math.max(0,A-F),isPartialPayment:F>0&&F<A,status:F>=A?"paid":F>0?"partial":"pending"},invoiceNumber:t,expectedDelivery:q,notes:N,terms:""};o!=null&&o.isEditMode?handleUpdatePurchaseInvoice(o.invoiceId,s):handleCreatePurchaseInvoice(s)};return e.jsx(e.Fragment,{children:e.jsxs("div",{className:"space-y-4 lg:space-y-6",children:[e.jsxs("div",{className:`flex ${u?"flex-col space-y-4":"items-start justify-between"}`,children:[e.jsxs("div",{children:[e.jsx("h1",{className:`${u?"text-xl":"text-2xl"} font-bold text-gray-900`,children:"Purchase"}),e.jsx("p",{className:"text-gray-600",children:"Process purchase transactions"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("button",{onClick:Me,className:"btn btn-secondary btn-md",title:"Export Purchase Report",children:[e.jsx(tt,{className:"h-4 w-4 mr-2"}),"Export Purchase Report"]}),e.jsxs("button",{onClick:()=>{const t=et("/purchase");if(t){const s=`tab_${Date.now()}_${Math.random().toString(36).substr(2,9)}`;Ce({title:"Purchase",path:"/purchase",component:t.component,icon:t.icon,allowMultiple:!0,props:{tabId:s}})}},className:"btn btn-primary btn-md",children:[e.jsx(je,{className:"h-4 w-4 mr-2"}),"New Purchase"]})]})]}),e.jsxs("div",{className:`flex ${u?"flex-col space-y-4":"items-start space-x-4"}`,children:[e.jsxs("div",{className:`${u?"w-full":"w-[500px] flex-shrink-0"}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Select Supplier"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[r&&e.jsx("button",{onClick:()=>{g(null),P(""),setTimeout(()=>{M.current&&M.current.focus()},100)},className:"text-xs text-blue-600 hover:text-blue-800 underline",title:"Change supplier",children:"Change Supplier"}),e.jsx("button",{onClick:()=>refetchSuppliers(),className:"text-xs text-blue-600 hover:text-blue-800 underline",title:"Refresh supplier data",children:"Refresh"})]})]}),e.jsx(ve,{ref:M,placeholder:"Search suppliers by name, email, or business...",items:((be=j==null?void 0:j.data)==null?void 0:be.suppliers)||(j==null?void 0:j.suppliers)||[],onSelect:Ee,onSearch:P,displayKey:t=>e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:t.displayName}),e.jsxs("div",{className:"text-sm text-gray-600",children:["Outstanding Balance: $",(t.pendingBalance||0).toFixed(2)]})]}),selectedItem:r,loading:ke,emptyMessage:I.length>0?"No suppliers found":"Start typing to search suppliers..."})]}),e.jsx("div",{className:`${u?"w-full":"flex-1"}`,children:r?e.jsx("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-3",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(De,{className:"h-5 w-5 text-gray-400"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium",children:r.displayName||r.name||r.companyName||"Unknown Supplier"}),e.jsx("p",{className:"text-sm text-gray-600 capitalize",children:r.businessType&&r.reliability?`${r.businessType} • ${r.reliability}`:r.businessType||r.reliability||"Supplier Information"}),e.jsxs("div",{className:"flex items-center space-x-4 mt-2",children:[e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("span",{className:"text-xs text-gray-500",children:"Outstanding Balance:"}),e.jsxs("span",{className:`text-sm font-medium ${(r.pendingBalance||0)>0?"text-red-600":"text-green-600"}`,children:["$",Math.round(r.pendingBalance||0)]})]}),r.phone&&e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(st,{className:"h-3 w-3 text-gray-400"}),e.jsx("span",{className:"text-xs text-gray-500",children:r.phone})]}),r.email&&e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(Qe,{className:"h-3 w-3 text-gray-400"}),e.jsx("span",{className:"text-xs text-gray-500",children:r.email})]})]}),r.address&&e.jsxs("div",{className:"flex items-center space-x-1 mt-1",children:[e.jsx(Be,{className:"h-3 w-3 text-gray-400"}),e.jsx("span",{className:"text-xs text-gray-500",children:r.address})]})]})]})}):e.jsx("div",{className:"hidden lg:block"})})]}),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Product Selection & Cart"})}),e.jsxs("div",{className:"card-content",children:[e.jsx("div",{className:"mb-6",children:e.jsx(nt,{onAddProduct:Ue})}),h.length===0?e.jsxs("div",{className:"p-8 text-center text-gray-500 border-t border-gray-200",children:[e.jsx(Ke,{className:"mx-auto h-12 w-12 text-gray-400"}),e.jsx("p",{className:"mt-2",children:"No items in cart"})]}):e.jsxs("div",{className:"space-y-4 border-t border-gray-200 pt-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h4",{className:"text-md font-medium text-gray-700",children:"Cart Items"}),e.jsxs("button",{type:"button",onClick:Ae,className:"btn btn-secondary btn-sm flex items-center space-x-2",title:"Sort products alphabetically",children:[e.jsx(ze,{className:"h-4 w-4"}),e.jsx("span",{children:"Sort A-Z"})]})]}),h.map((t,s)=>{var a;return e.jsx(at,{item:t,index:s,onUpdateQuantity:Fe,onUpdateCost:$e,onRemove:fe},(a=t.product)==null?void 0:a._id)})]})]})]}),h.length>0&&e.jsxs("div",{className:"bg-gradient-to-br from-blue-50 to-indigo-50 border-2 border-blue-200 rounded-lg max-w-5xl ml-auto mt-4",children:[e.jsxs("div",{className:"px-6 py-4 border-b border-blue-200",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 text-right mb-4",children:"Purchase Details"}),e.jsxs("div",{className:"flex flex-nowrap gap-3 items-end justify-end",children:[e.jsxs("div",{className:"flex flex-col w-44",children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Invoice Number"}),e.jsx("input",{type:"text",value:T,onChange:t=>v(t.target.value),className:"input h-8 text-sm",placeholder:x?"Auto-generated":"Enter invoice number",disabled:x})]}),e.jsxs("div",{className:"flex flex-col w-48",children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Expected Delivery"}),e.jsx("input",{type:"date",value:q,onChange:t=>R(t.target.value),className:"input h-8 text-sm"})]}),e.jsxs("div",{className:"flex flex-col w-40",children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Tax Status"}),e.jsxs("div",{className:"flex items-center space-x-1 px-2 py-1 border border-gray-200 rounded h-8",children:[e.jsx("input",{type:"checkbox",id:"taxExempt",checked:U,onChange:t=>B(t.target.checked),className:"h-3 w-3 text-primary-600 focus:ring-primary-500 border-gray-300 rounded"}),e.jsx("div",{className:"flex-1",children:e.jsx("label",{htmlFor:"taxExempt",className:"text-xs font-medium text-gray-700 cursor-pointer",children:"Tax Exempt"})}),U&&e.jsx("div",{className:"text-green-600 text-xs font-medium",children:"✓"})]})]}),e.jsxs("div",{className:"flex flex-col w-[28rem]",children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Notes"}),e.jsx("input",{type:"text",value:N,onChange:t=>S(t.target.value),className:"input h-8 text-sm",placeholder:"Additional notes..."})]})]})]}),e.jsx("div",{className:"bg-gradient-to-r from-blue-500 to-indigo-600 px-6 py-4",children:e.jsx("h3",{className:"text-lg font-semibold text-white",children:"Order Summary"})}),e.jsxs("div",{className:"px-6 py-4",children:[e.jsxs("div",{className:"space-y-3 mb-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-800 font-semibold",children:"Subtotal:"}),e.jsx("span",{className:"text-xl font-bold text-gray-900",children:Q.toFixed(2)})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-800 font-semibold",children:U?"Tax (Exempt):":"Tax (8%):"}),e.jsx("span",{className:"text-xl font-bold text-gray-900",children:Y.toFixed(2)})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-800 font-semibold",children:"Purchase Total:"}),e.jsx("span",{className:"text-xl font-bold text-gray-900",children:A.toFixed(2)})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-800 font-semibold",children:"Previous Outstanding:"}),e.jsx("span",{className:"text-xl font-bold text-red-600",children:he.toFixed(2)})]}),e.jsxs("div",{className:"flex justify-between items-center text-xl font-bold border-t-2 border-blue-400 pt-3 mt-2",children:[e.jsx("span",{className:"text-blue-900",children:"Total Payables:"}),e.jsx("span",{className:"text-blue-900 text-3xl",children:Te.toFixed(2)})]})]}),e.jsxs("div",{className:"bg-white rounded-lg p-4 shadow-sm",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 items-start",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-800 mb-2",children:"Apply Discount"}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs("select",{value:y.type,onChange:t=>z({...y,type:t.target.value}),className:"px-3 py-2 border-2 border-blue-200 rounded-md bg-blue-50 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 font-medium h-[42px]",children:[e.jsx("option",{value:"amount",children:"Amount"}),e.jsx("option",{value:"percentage",children:"%"})]}),e.jsx("input",{type:"number",placeholder:y.type==="amount"?"Enter amount...":"Enter percentage...",value:y.value||"",onChange:t=>{const s=parseFloat(t.target.value)||0;z({...y,value:s})},className:"flex-1 px-3 py-2 border-2 border-blue-200 rounded-md bg-blue-50 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 font-medium text-gray-900 h-[42px]",min:"0",step:y.type==="percentage"?"0.1":"0.01"})]}),y.value>0&&e.jsx("div",{className:"text-sm text-green-700 font-semibold mt-2 bg-green-50 px-2 py-1 rounded",children:y.type==="percentage"?`${y.value}% = ${ae.toFixed(2)} off`:`${y.value} off`})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-800 mb-2",children:"Payment Method"}),e.jsxs("select",{value:Z,onChange:t=>H(t.target.value),className:"w-full px-3 py-2 border-2 border-blue-200 rounded-md bg-blue-50 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 font-medium text-gray-900 h-[42px]",children:[e.jsx("option",{value:"cash",children:"Cash"}),e.jsx("option",{value:"credit_card",children:"Credit Card"}),e.jsx("option",{value:"debit_card",children:"Debit Card"}),e.jsx("option",{value:"check",children:"Check"})]})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-800 mb-2",children:"Amount Paid"}),e.jsx("input",{type:"number",step:"0.01",value:F,onChange:t=>ee(parseFloat(t.target.value)||0),onFocus:t=>t.target.select(),className:"w-full px-3 py-2 border-2 border-blue-200 rounded-md bg-blue-50 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 font-medium text-gray-900 text-lg h-[42px]",placeholder:"0.00"})]})]}),y.value>0&&e.jsx("div",{className:"mt-2",children:e.jsx("button",{onClick:()=>z({type:"amount",value:0}),className:"px-3 py-1 bg-red-600 text-white rounded-md hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-red-500 text-sm",children:"Clear Discount"})})]})]}),e.jsxs("div",{className:"flex space-x-3 mt-6 px-6 pb-6",children:[h.length>0&&e.jsxs("button",{onClick:()=>{m([]),g(null),P(""),B(!0),z({type:"amount",value:0}),ee(0),H("cash"),d.success("Cart cleared")},className:"btn btn-secondary flex-1",children:[e.jsx(Ne,{className:"h-4 w-4 mr-2"}),"Clear Cart"]}),h.length>0&&e.jsxs("button",{onClick:()=>{const t={orderNumber:`PO-${Date.now()}`,orderType:"purchase",supplier:r==null?void 0:r._id,customer:r,customerInfo:r?{name:r.displayName,email:r.email,phone:r.phone,address:r.address||r.companyAddress||r.location,businessName:r.companyName}:null,items:h.map(s=>{var a;return{product:{name:((a=s.product)==null?void 0:a.name)||"Unknown Product"},quantity:s.quantity,unitPrice:s.costPerUnit}}),pricing:{subtotal:Q,discountAmount:ae,taxAmount:Y,isTaxExempt:U,total:A},payment:{method:Z,amountPaid:F,remainingBalance:A-F,isPartialPayment:F<A},createdAt:new Date,createdBy:{name:"Current User"},invoiceNumber:T,expectedDelivery:q,notes:N};ie(t),le(!0)},className:"btn btn-secondary flex-1",children:[e.jsx(Ge,{className:"h-4 w-4 mr-2"}),"Print Preview"]}),e.jsxs(Je,{onClick:ne,isLoading:!1,className:"btn btn-primary btn-lg flex-2",children:[e.jsx(We,{className:"h-4 w-4 mr-2"}),o!=null&&o.isEditMode?"Update Purchase Invoice":"Complete Purchase & Update Inventory"]})]})]}),e.jsx(He,{isOpen:we,onClose:()=>{le(!1),ie(null)},orderData:Pe,documentTitle:"Purchase Invoice",partyLabel:"Supplier"}),Se&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-lg w-full",children:[e.jsxs("div",{className:"flex justify-between items-center p-6 border-b border-gray-200",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Export Purchase Report"}),e.jsx("button",{onClick:()=>{G(!1),W(""),X("")},className:"text-gray-400 hover:text-gray-600 transition-colors",children:e.jsx(rt,{className:"h-6 w-6"})})]}),e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"Export Format"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("label",{className:"flex items-center p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-gray-50",children:[e.jsx("input",{type:"radio",name:"format",value:"pdf",checked:C==="pdf",onChange:t=>J(t.target.value),className:"mr-3"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900",children:"PDF"}),e.jsx("div",{className:"text-sm text-gray-500",children:"Print-ready format"})]})]}),e.jsxs("label",{className:"flex items-center p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-gray-50",children:[e.jsx("input",{type:"radio",name:"format",value:"excel",checked:C==="excel",onChange:t=>J(t.target.value),className:"mr-3"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900",children:"Excel"}),e.jsx("div",{className:"text-sm text-gray-500",children:"Spreadsheet format"})]})]}),e.jsxs("label",{className:"flex items-center p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-gray-50",children:[e.jsx("input",{type:"radio",name:"format",value:"csv",checked:C==="csv",onChange:t=>J(t.target.value),className:"mr-3"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900",children:"CSV"}),e.jsx("div",{className:"text-sm text-gray-500",children:"Comma-separated values"})]})]}),e.jsxs("label",{className:"flex items-center p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-gray-50",children:[e.jsx("input",{type:"radio",name:"format",value:"json",checked:C==="json",onChange:t=>J(t.target.value),className:"mr-3"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900",children:"JSON"}),e.jsx("div",{className:"text-sm text-gray-500",children:"Data format"})]})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"Date Range (Optional)"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-600 mb-1",children:"From Date"}),e.jsx("input",{type:"date",value:_,onChange:t=>W(t.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-primary-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-600 mb-1",children:"To Date"}),e.jsx("input",{type:"date",value:V,onChange:t=>X(t.target.value),min:_,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-primary-500"})]})]}),(_||V)&&e.jsx("button",{type:"button",onClick:()=>{W(""),X("")},className:"mt-2 text-sm text-primary-600 hover:text-primary-700",children:"Clear dates"})]}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-4 border-t border-gray-200",children:[e.jsx("button",{onClick:()=>{G(!1),W(""),X("")},className:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50",disabled:te,children:"Cancel"}),e.jsx("button",{onClick:qe,disabled:te,className:"px-4 py-2 text-sm font-medium text-white bg-primary-600 border border-transparent rounded-md hover:bg-primary-700 disabled:opacity-50 disabled:cursor-not-allowed",children:te?"Exporting...":"Export"})]})]})})]})})]})})};export{kt as Purchase};
