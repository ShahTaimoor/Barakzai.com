import{E as I,r as f,H as X,aC as Y,c as L,o as e,K as P,I as z,M as G,aA as ee,R as V,w as i,z as p,a_ as o,C as se}from"./index-jd7Ax_Ed.js";import{u as g}from"./useMutation-n-l4Ns3H.js";import{D as F}from"./ConfirmationDialog-EbANb_5f.js";import{D as E}from"./database-DSPlIOkn.js";import{C as A}from"./check-circle-8oGxTki5.js";import{Z as U}from"./zap-BaBHVeC2.js";import{S as K}from"./shield-DYPDNaY8.js";import{U as te}from"./upload-DdBv5t3-.js";import{T as ae}from"./trash-2-DCbqoVbR.js";import"./info-D4lm7fBv.js";/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const re=I("HardDrive",[["line",{x1:"22",x2:"2",y1:"12",y2:"12",key:"1y58io"}],["path",{d:"M5.45 5.11 2 12v6a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6l-3.45-6.89A2 2 0 0 0 16.76 4H7.24a2 2 0 0 0-1.79 1.11z",key:"oot6mr"}],["line",{x1:"6",x2:"6.01",y1:"16",y2:"16",key:"sgf278"}],["line",{x1:"10",x2:"10.01",y1:"16",y2:"16",key:"1l4acy"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _=I("Pause",[["rect",{width:"4",height:"16",x:"6",y:"4",key:"iffhe4"}],["rect",{width:"4",height:"16",x:"14",y:"4",key:"sjin7j"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const le=I("Play",[["polygon",{points:"5 3 19 12 5 21 5 3",key:"191637"}]]),ne=({backup:a,onRestore:k,onDelete:N,onRetry:x,onVerify:l})=>{var w,C,B,D,M,T,R;const[d,r]=f.useState(!1),[t,b]=f.useState(null),c=()=>{switch(a.status){case"completed":return e.jsx(A,{className:"h-5 w-5 text-green-500"});case"failed":return e.jsx(z,{className:"h-5 w-5 text-red-500"});case"in_progress":return e.jsx(V,{className:"h-5 w-5 text-blue-500 animate-spin"});case"pending":return e.jsx(se,{className:"h-5 w-5 text-yellow-500"});default:return e.jsx(E,{className:"h-5 w-5 text-gray-500"})}},n=()=>{switch(a.status){case"completed":return"bg-green-100 text-green-800";case"failed":return"bg-red-100 text-red-800";case"in_progress":return"bg-blue-100 text-blue-800";case"pending":return"bg-yellow-100 text-yellow-800";default:return"bg-gray-100 text-gray-800"}},$=u=>{if(!u)return"0 B";const m=1024,h=["B","KB","MB","GB","TB"],y=Math.floor(Math.log(u)/Math.log(m));return parseFloat((u/Math.pow(m,y)).toFixed(2))+" "+h[y]},S=u=>{if(!u)return"N/A";const m=Math.floor(u/1e3),h=Math.floor(m/60),y=Math.floor(h/60);return y>0?`${y}h ${h%60}m`:h>0?`${h}m ${m%60}s`:`${m}s`},v=(u,m={})=>{b({type:u,data:m}),r(!0)},Q=()=>{switch(t.type){case"restore":k(a._id,t.data);break;case"delete":N(a._id,t.data);break;case"retry":x(a._id);break;case"verify":l(a._id);break}r(!1),b(null)};return e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-6 hover:shadow-md transition-shadow",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[c(),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-gray-900",children:a.backupId}),e.jsxs("p",{className:"text-sm text-gray-500",children:[a.type," â€¢ ",a.schedule]})]})]}),e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${n()}`,children:a.status})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Size"}),e.jsx("p",{className:"font-medium",children:$((w=a.metadata)==null?void 0:w.compressedSize)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Duration"}),e.jsx("p",{className:"font-medium",children:S((C=a.metadata)==null?void 0:C.duration)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Collections"}),e.jsx("p",{className:"font-medium",children:((B=a.collections)==null?void 0:B.length)||0})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Records"}),e.jsx("p",{className:"font-medium",children:((M=(D=a.metadata)==null?void 0:D.totalRecords)==null?void 0:M.toLocaleString())||0})]})]}),e.jsxs("div",{className:"flex items-center space-x-2 mb-4",children:[((T=a.compression)==null?void 0:T.enabled)&&e.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-800",children:[e.jsx(U,{className:"h-3 w-3 mr-1"}),"Compressed"]}),((R=a.encryption)==null?void 0:R.enabled)&&e.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-purple-100 text-purple-800",children:[e.jsx(K,{className:"h-3 w-3 mr-1"}),"Encrypted"]})]}),e.jsxs("div",{className:"flex space-x-2",children:[a.status==="completed"&&e.jsxs("button",{onClick:()=>v("restore",{confirmRestore:!0}),className:"flex-1 btn btn-secondary btn-sm",children:[e.jsx(te,{className:"h-4 w-4 mr-1"}),"Restore"]}),a.status==="failed"&&e.jsxs("button",{onClick:()=>v("retry"),className:"flex-1 btn btn-primary btn-sm",children:[e.jsx(V,{className:"h-4 w-4 mr-1"}),"Retry"]}),e.jsx("button",{onClick:()=>v("verify"),className:"btn btn-secondary btn-sm",children:e.jsx(K,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>v("delete",{confirmDelete:!0}),className:"btn btn-danger btn-sm",children:e.jsx(ae,{className:"h-4 w-4"})})]}),e.jsx(F,{isOpen:d,onClose:()=>r(!1),onConfirm:Q,title:`Confirm ${t==null?void 0:t.type}`,message:(t==null?void 0:t.type)==="restore"?"Are you sure you want to restore this backup? This will overwrite current data.":(t==null?void 0:t.type)==="delete"?"Are you sure you want to delete this backup? This action cannot be undone.":(t==null?void 0:t.type)==="retry"?"Are you sure you want to retry this failed backup?":"Are you sure you want to verify this backup?",confirmText:(t==null?void 0:t.type)==="delete"?"Delete":(t==null?void 0:t.type)==="restore"?"Restore":"Confirm",confirmClass:(t==null?void 0:t.type)==="delete"?"btn-danger":"btn-primary"})]})},ce=({status:a,onStart:k,onStop:N,onTrigger:x})=>{const[l,d]=f.useState(!1),[r,t]=f.useState({schedule:"daily",type:"full"}),b=()=>{x(r),d(!1)};return e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Backup Scheduler"}),e.jsx("div",{className:"flex items-center space-x-2",children:a.running?e.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800",children:[e.jsx(A,{className:"h-3 w-3 mr-1"}),"Running"]}):e.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-red-100 text-red-800",children:[e.jsx(_,{className:"h-3 w-3 mr-1"}),"Stopped"]})})]}),e.jsx("div",{className:"space-y-2 mb-4",children:Object.entries(a.jobs||{}).map(([c,n])=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600 capitalize",children:c}),e.jsxs("div",{className:"flex items-center space-x-2",children:[n.running?e.jsx(A,{className:"h-4 w-4 text-green-500"}):e.jsx(_,{className:"h-4 w-4 text-gray-400"}),n.nextRun&&e.jsxs("span",{className:"text-xs text-gray-500",children:["Next: ",new Date(n.nextRun).toLocaleString()]})]})]},c))}),e.jsxs("div",{className:"flex space-x-2",children:[a.running?e.jsxs("button",{onClick:N,className:"btn btn-danger btn-sm",children:[e.jsx(_,{className:"h-4 w-4 mr-1"}),"Stop"]}):e.jsxs("button",{onClick:k,className:"btn btn-primary btn-sm",children:[e.jsx(le,{className:"h-4 w-4 mr-1"}),"Start"]}),e.jsxs("button",{onClick:()=>d(!0),className:"btn btn-secondary btn-sm",children:[e.jsx(U,{className:"h-4 w-4 mr-1"}),"Trigger"]})]}),e.jsx(F,{isOpen:l,onClose:()=>d(!1),onConfirm:b,title:"Trigger Backup",message:"Select the backup schedule and type to trigger manually:",confirmText:"Trigger",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Schedule"}),e.jsxs("select",{value:r.schedule,onChange:c=>t({...r,schedule:c.target.value}),className:"input",children:[e.jsx("option",{value:"hourly",children:"Hourly"}),e.jsx("option",{value:"daily",children:"Daily"}),e.jsx("option",{value:"weekly",children:"Weekly"}),e.jsx("option",{value:"monthly",children:"Monthly"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Type"}),e.jsxs("select",{value:r.type,onChange:c=>t({...r,type:c.target.value}),className:"input",children:[e.jsx("option",{value:"full",children:"Full"}),e.jsx("option",{value:"incremental",children:"Incremental"}),e.jsx("option",{value:"differential",children:"Differential"})]})]})]})})]})},je=()=>{var H,O;const[a,k]=f.useState({page:1,limit:10,status:"",type:"",schedule:""}),[N,x]=f.useState(!1),[l,d]=f.useState({type:"full",schedule:"manual",compression:!0,encryption:!1});X();const r=Y(),{data:t,isLoading:b,error:c}=L(["backups",a],()=>o.getBackups(a),{keepPreviousData:!0,onError:s=>{i(s,"Backups")}}),{data:n,isLoading:$}=L("backupStats",()=>o.getBackupStats(30),{onError:s=>{i(s,"Backup Stats")}}),{data:S,isLoading:v}=L("schedulerStatus",()=>o.getSchedulerStatus(),{refetchInterval:3e4,onError:s=>{i(s,"Scheduler Status")}}),Q=g(o.createBackup,{onSuccess:()=>{r.invalidateQueries("backups"),r.invalidateQueries("backupStats"),p("Backup created successfully"),x(!1)},onError:s=>{i(s,"Create Backup")}}),w=g(({backupId:s,data:j})=>o.restoreBackup(s,j),{onSuccess:()=>{r.invalidateQueries("backups"),p("Backup restored successfully")},onError:s=>{i(s,"Restore Backup")}}),C=g(({backupId:s,data:j})=>o.deleteBackup(s,j),{onSuccess:()=>{r.invalidateQueries("backups"),r.invalidateQueries("backupStats"),p("Backup deleted successfully")},onError:s=>{i(s,"Delete Backup")}}),B=g(o.retryBackup,{onSuccess:()=>{r.invalidateQueries("backups"),p("Backup retry initiated")},onError:s=>{i(s,"Retry Backup")}}),D=g(o.verifyBackup,{onSuccess:()=>{r.invalidateQueries("backups"),p("Backup verification completed")},onError:s=>{i(s,"Verify Backup")}}),M=g(o.startScheduler,{onSuccess:()=>{r.invalidateQueries("schedulerStatus"),p("Scheduler started successfully")},onError:s=>{i(s,"Start Scheduler")}}),T=g(o.stopScheduler,{onSuccess:()=>{r.invalidateQueries("schedulerStatus"),p("Scheduler stopped successfully")},onError:s=>{i(s,"Stop Scheduler")}}),R=g(o.triggerBackup,{onSuccess:()=>{r.invalidateQueries("backups"),p("Backup triggered successfully")},onError:s=>{i(s,"Trigger Backup")}}),u=()=>{Q.mutate(l)},m=(s,j)=>{w.mutate({backupId:s,data:j})},h=(s,j)=>{C.mutate({backupId:s,data:j})},y=s=>{B.mutate(s)},W=s=>{D.mutate(s)},Z=()=>{M.mutate()},q=()=>{T.mutate()},J=s=>{R.mutate(s)};return c?e.jsxs(P,{className:"text-center py-8",children:[e.jsx("div",{className:"text-red-500 mb-4",children:e.jsx(z,{className:"h-12 w-12 mx-auto"})}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Error loading backups"}),e.jsx("p",{className:"text-gray-500 mb-4",children:c.message}),e.jsx("button",{onClick:()=>r.invalidateQueries("backups"),className:"btn btn-primary",children:"Try Again"})]}):e.jsxs(P,{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Backup Management"}),e.jsx("p",{className:"text-gray-600",children:"Manage automated backups and restore data"})]}),e.jsxs("button",{onClick:()=>x(!0),className:"btn btn-primary",children:[e.jsx(E,{className:"h-5 w-5 mr-2"}),"Create Backup"]})]}),n&&e.jsxs(G,{cols:{default:1,md:2,lg:4},gap:4,children:[e.jsx("div",{className:"bg-white border border-gray-200 rounded-lg p-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:e.jsx(E,{className:"h-6 w-6 text-blue-600"})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-500",children:"Total Backups"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:n.totalBackups})]})]})}),e.jsx("div",{className:"bg-white border border-gray-200 rounded-lg p-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"p-2 bg-green-100 rounded-lg",children:e.jsx(A,{className:"h-6 w-6 text-green-600"})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-500",children:"Successful"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:n.successfulBackups})]})]})}),e.jsx("div",{className:"bg-white border border-gray-200 rounded-lg p-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"p-2 bg-red-100 rounded-lg",children:e.jsx(z,{className:"h-6 w-6 text-red-600"})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-500",children:"Failed"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:n.failedBackups})]})]})}),e.jsx("div",{className:"bg-white border border-gray-200 rounded-lg p-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"p-2 bg-purple-100 rounded-lg",children:e.jsx(re,{className:"h-6 w-6 text-purple-600"})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-500",children:"Total Size"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:n.totalSize?(n.totalSize/1024/1024).toFixed(1)+" MB":"0 MB"})]})]})})]}),S&&e.jsx(ce,{status:S,onStart:Z,onStop:q,onTrigger:J}),e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg",children:[e.jsx("div",{className:"px-6 py-4 border-b border-gray-200",children:e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Recent Backups"})}),e.jsx("div",{className:"p-6",children:b?e.jsx(ee,{count:3}):((H=t==null?void 0:t.backups)==null?void 0:H.length)===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(E,{className:"h-12 w-12 mx-auto text-gray-400 mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No backups found"}),e.jsx("p",{className:"text-gray-500 mb-4",children:"Create your first backup to get started"}),e.jsx("button",{onClick:()=>x(!0),className:"btn btn-primary",children:"Create Backup"})]}):e.jsx(G,{cols:{default:1,md:2,lg:3},gap:4,children:(O=t==null?void 0:t.backups)==null?void 0:O.map(s=>e.jsx(ne,{backup:s,onRestore:m,onDelete:h,onRetry:y,onVerify:W},s._id))})})]}),e.jsx(F,{isOpen:N,onClose:()=>x(!1),onConfirm:u,title:"Create New Backup",message:"Configure your backup settings:",confirmText:"Create Backup",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Backup Type"}),e.jsxs("select",{value:l.type,onChange:s=>d({...l,type:s.target.value}),className:"input",children:[e.jsx("option",{value:"full",children:"Full Backup"}),e.jsx("option",{value:"incremental",children:"Incremental"}),e.jsx("option",{value:"differential",children:"Differential"}),e.jsx("option",{value:"schema_only",children:"Schema Only"}),e.jsx("option",{value:"data_only",children:"Data Only"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Schedule"}),e.jsxs("select",{value:l.schedule,onChange:s=>d({...l,schedule:s.target.value}),className:"input",children:[e.jsx("option",{value:"manual",children:"Manual"}),e.jsx("option",{value:"hourly",children:"Hourly"}),e.jsx("option",{value:"daily",children:"Daily"}),e.jsx("option",{value:"weekly",children:"Weekly"}),e.jsx("option",{value:"monthly",children:"Monthly"})]})]}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:l.compression,onChange:s=>d({...l,compression:s.target.checked}),className:"form-checkbox"}),e.jsx("span",{className:"ml-2 text-sm text-gray-700",children:"Compression"})]}),e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:l.encryption,onChange:s=>d({...l,encryption:s.target.checked}),className:"form-checkbox"}),e.jsx("span",{className:"ml-2 text-sm text-gray-700",children:"Encryption"})]})]})]})})]})};export{je as Backups};
