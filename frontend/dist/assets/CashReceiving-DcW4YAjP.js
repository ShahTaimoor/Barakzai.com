import{r as l,bl as ee,bm as te,bn as ae,p as e,q as $,aJ as se,x as re,s as ne,z as y,y as H,B as ce}from"./index-CPGRFPoA.js";import{u as oe}from"./chartOfAccountsApi-DCmoQmNP.js";import{P as le}from"./PrintModal-BVN5BxWf.js";import{P as L}from"./printer-Cmw_Pmcr.js";import{L as N}from"./loader-2-6ihMt2bX.js";import{S as ie}from"./save-Cm4Ve9_y.js";import"./useCompanyInfo-KiNc03tu.js";import"./settingsApi-C2p-obM0.js";const ue=(h=new Date)=>{const r=h.getFullYear(),i=String(h.getMonth()+1).padStart(2,"0"),p=String(h.getDate()).padStart(2,"0");return`${r}-${i}-${p}`},je=()=>{var F;const h=ue(),[r,i]=l.useState({cashAccount:"CASH IN HAND",voucherDate:h,voucherNo:"",paymentType:"CASH"}),[p,I]=l.useState([]),[b,v]=l.useState([]),[j,M]=l.useState(!1),[de,w]=l.useState([]),[u,x]=l.useState([]),[O,{data:me,isFetching:C}]=ee(),[V,S]=l.useState(!1),[Z,A]=l.useState(null),{data:m,isLoading:_,error:he}=te(void 0,{refetchOnMountOrArgChange:!0}),{data:d}=oe({accountType:"asset",accountCategory:"current_assets",isActive:"true"},{refetchOnMountOrArgChange:!0}),D=(d==null?void 0:d.data)||(d==null?void 0:d.accounts)||d||[],R=Array.isArray(D)?D.filter(t=>{var a,s;return((a=t==null?void 0:t.accountName)==null?void 0:a.toLowerCase().includes("cash"))||((s=t==null?void 0:t.accountName)==null?void 0:s.toLowerCase().includes("bank"))}):[];(F=R.find(t=>{var a;return(a=t.accountName)==null?void 0:a.toLowerCase().includes("cash in hand")}))!=null&&F.accountName,l.useEffect(()=>{if(m){const t=(m==null?void 0:m.data)||m||[];I(t)}},[m]),l.useEffect(()=>{if(!r.voucherNo){const t=new Date(r.voucherDate||new Date),a=t.getFullYear(),s=String(t.getMonth()+1).padStart(2,"0"),n=String(t.getDate()).padStart(2,"0"),c=Date.now(),o=String(c).slice(-4);i(g=>({...g,voucherNo:`CR-${a}${s}${n}-${o}`}))}},[r.voucherNo,r.voucherDate]);const q=async()=>{if(b.length===0){y("Please select at least one city");return}const t=b.join(",");O({cities:t,showZeroBalance:j}).unwrap().then(a=>{var c;const s=((c=a==null?void 0:a.data)==null?void 0:c.customers)||(a==null?void 0:a.customers)||(a==null?void 0:a.data)||a||[];w(s);const n=s.map(o=>{const g=o.currentBalance!==void 0?o.currentBalance:(o.pendingBalance||0)-(o.advanceBalance||0);return{customerId:o._id,accountName:o.accountName||o.businessName||o.name,balance:g,particular:"",amount:""}});x(n)}).catch(a=>{H(a,"Load customers")})},K=t=>{v(a=>a.includes(t)?a.filter(s=>s!==t):[...a,t])},Q=()=>{v([]),w([]),x([])},k=(t,a,s)=>{x(n=>{const c=[...n];return c[t]={...c[t],[a]:s},c})},T=u.reduce((t,a)=>{const s=parseFloat(a.amount)||0;return t+s},0),[Y,{isLoading:B}]=ae(),z=()=>{const t=u.filter(n=>parseFloat(n.amount)>0);if(t.length===0){y("Please enter at least one amount");return}const a=t.map(n=>({customer:n.customerId,amount:parseFloat(n.amount),particular:n.particular||"Cash Receipt"})),s={voucherDate:r.voucherDate,cashAccount:r.cashAccount,paymentType:r.paymentType,receipts:a};Y(s).unwrap().then(n=>{var P;ce((n==null?void 0:n.message)||`Successfully created ${((P=n==null?void 0:n.data)==null?void 0:P.count)||t.length} cash receipt(s)`),x(f=>f.map(X=>({...X,particular:"",amount:""})));const c=new Date(r.voucherDate||new Date),o=c.getFullYear(),g=String(c.getMonth()+1).padStart(2,"0"),U=String(c.getDate()).padStart(2,"0"),J=Date.now(),W=String(J).slice(-4);i(f=>({...f,voucherNo:`CR-${o}${g}${U}-${W}`}))}).catch(n=>{y(H(n))})},G=()=>{x(t=>t.map(a=>({...a,particular:"",amount:""})))},E=()=>{const t=u.reduce((s,n)=>s+(parseFloat(n.amount)||0),0),a={invoiceNumber:r.voucherNo||"N/A",orderNumber:r.voucherNo||"N/A",createdAt:r.voucherDate,invoiceDate:r.voucherDate,customer:null,customerInfo:null,pricing:{subtotal:t,total:t,discountAmount:0,taxAmount:0},total:t,items:u.filter(s=>parseFloat(s.amount)>0).map((s,n)=>({_id:s.customerId,product:{name:s.accountName||"N/A"},quantity:1,unitPrice:parseFloat(s.amount)||0,total:parseFloat(s.amount)||0,particular:s.particular||""})),notes:`Payment Type: ${r.paymentType} | Cash Account: ${r.cashAccount}`,voucherNo:r.voucherNo,paymentType:r.paymentType,cashAccount:r.cashAccount};A(a),S(!0)};return e.jsxs("div",{className:"space-y-6 p-6 bg-gray-50 min-h-screen",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-800 mb-6",children:"Cash Receipt Voucher"}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Cash Account"}),e.jsxs("select",{value:r.cashAccount,onChange:t=>i(a=>({...a,cashAccount:t.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"CASH IN HAND",children:"CASH IN HAND"}),R.map(t=>e.jsx("option",{value:t.accountName,children:t.accountName},t._id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Payment Type"}),e.jsxs("select",{value:r.paymentType,onChange:t=>i(a=>({...a,paymentType:t.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"CASH",children:"CASH"}),e.jsx("option",{value:"CHECK",children:"CHECK"}),e.jsx("option",{value:"BANK_TRANSFER",children:"BANK TRANSFER"}),e.jsx("option",{value:"OTHER",children:"OTHER"})]})]}),e.jsxs("div",{className:"bg-blue-50 p-4 rounded-md",children:[e.jsx("div",{className:"text-sm text-gray-600",children:"Total:"}),e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:$(T)})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Voucher Date"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"date",value:r.voucherDate,onChange:t=>i(a=>({...a,voucherDate:t.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"}),e.jsx(se,{className:"absolute right-3 top-2.5 h-5 w-5 text-gray-400 pointer-events-none"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Voucher No"}),e.jsx("input",{type:"text",value:r.voucherNo,readOnly:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-md bg-gray-50 focus:outline-none"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",id:"showZeroBalance",checked:j,onChange:t=>M(t.target.checked),className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),e.jsx("label",{htmlFor:"showZeroBalance",className:"text-sm text-gray-700",children:"Show Zero Balance"})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs("button",{onClick:E,className:"flex-1 px-4 py-2 bg-gray-500 text-white rounded-md hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-gray-500 flex items-center justify-center",children:[e.jsx(L,{className:"h-4 w-4 mr-2"}),"Print"]}),e.jsx("button",{onClick:Q,className:"flex-1 px-4 py-2 bg-gray-500 text-white rounded-md hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-gray-500",children:"UnSelect All"}),e.jsxs("button",{onClick:q,disabled:C||b.length===0,className:"flex-1 px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center",children:[C?e.jsx(N,{className:"h-4 w-4 mr-2 animate-spin"}):e.jsx(re,{className:"h-4 w-4 mr-2"}),"Load"]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Select Cities"}),e.jsx("div",{className:"border border-gray-300 rounded-md h-64 overflow-y-auto bg-white",children:_?e.jsxs("div",{className:"p-4 text-center text-gray-500",children:[e.jsx(N,{className:"h-5 w-5 animate-spin mx-auto mb-2"}),"Loading cities..."]}):p.length===0?e.jsx("div",{className:"p-4 text-center text-gray-500",children:"No cities available"}):e.jsx("div",{className:"p-2",children:p.map(t=>e.jsxs("div",{className:"flex items-center p-2 hover:bg-gray-50",children:[e.jsx("input",{type:"checkbox",id:`city-${t}`,checked:b.includes(t),onChange:()=>K(t),className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded mr-2"}),e.jsx("label",{htmlFor:`city-${t}`,className:"text-sm text-gray-700 cursor-pointer flex-1",children:t})]},t))})})]})]})]}),u.length>0&&e.jsxs("div",{className:"bg-white rounded-lg shadow",children:[e.jsx("div",{className:"p-4 border-b border-gray-200",children:e.jsx("h2",{className:"text-lg font-semibold text-gray-800",children:"Customer Receipts"})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Account Name"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Balance"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Particular"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Amount"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:u.map((t,a)=>e.jsxs("tr",{className:parseFloat(t.amount)>0?"bg-yellow-50":"",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:t.accountName}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:$(t.balance)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("input",{type:"text",value:t.particular,onChange:s=>k(a,"particular",s.target.value),placeholder:"Enter description",className:"w-full px-3 py-1 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("input",{type:"number",value:t.amount,onChange:s=>k(a,"amount",s.target.value),placeholder:"0.00",min:"0",step:"0.01",className:"w-full px-3 py-1 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm"})})]},t.customerId))})]})})]}),e.jsxs("div",{className:"flex justify-end space-x-4 bg-white rounded-lg shadow p-6",children:[e.jsxs("button",{onClick:z,disabled:B||T===0,className:"px-6 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed flex items-center",children:[B?e.jsx(N,{className:"h-4 w-4 mr-2 animate-spin"}):e.jsx(ie,{className:"h-4 w-4 mr-2"}),"Save"]}),e.jsxs("button",{onClick:G,className:"px-6 py-2 bg-gray-500 text-white rounded-md hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-gray-500 flex items-center",children:[e.jsx(ne,{className:"h-4 w-4 mr-2"}),"Reset"]}),e.jsxs("button",{onClick:E,disabled:u.filter(t=>parseFloat(t.amount)>0).length===0,className:"px-6 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-green-500 disabled:opacity-50 disabled:cursor-not-allowed flex items-center",children:[e.jsx(L,{className:"h-4 w-4 mr-2"}),"Print"]})]}),e.jsx(le,{isOpen:V,onClose:()=>{S(!1),A(null)},orderData:Z,documentTitle:"Cash Receipt Voucher",partyLabel:"Customer"})]})};export{je as default};
