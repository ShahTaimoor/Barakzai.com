import{E as P,a as ie,aC as de,r as o,c as g,c5 as c,c6 as oe,o as e,R as $,N as S,c7 as y,c8 as R,C as me,U,av as xe,b2 as ue,v as he,w as i,z as f}from"./index-jd7Ax_Ed.js";import{u as j}from"./useMutation-n-l4Ns3H.js";import{C as ge}from"./check-circle-8oGxTki5.js";import{F as ye}from"./filter-CQLYjJyW.js";/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const b=P("Coffee",[["path",{d:"M17 8h1a4 4 0 1 1 0 8h-1",key:"jx4kbh"}],["path",{d:"M3 8h14v9a4 4 0 0 1-4 4H7a4 4 0 0 1-4-4Z",key:"1bxrl0"}],["line",{x1:"6",x2:"6",y1:"2",y2:"4",key:"1cr9l3"}],["line",{x1:"10",x2:"10",y1:"2",y2:"4",key:"170wym"}],["line",{x1:"14",x2:"14",y1:"2",y2:"4",key:"1c5f70"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const z=P("LogIn",[["path",{d:"M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4",key:"u53s6r"}],["polyline",{points:"10 17 15 12 10 7",key:"1ail0h"}],["line",{x1:"15",x2:"3",y1:"12",y2:"12",key:"v6grx8"}]]),Ne=()=>{const{hasPermission:x}=ie(),d=de(),[n,D]=o.useState("my"),[V,H]=o.useState(!1),[t,u]=o.useState({startDate:new Date(new Date().setDate(new Date().getDate()-7)).toISOString().split("T")[0],endDate:new Date().toISOString().split("T")[0],userId:"",status:""}),[M,L]=o.useState(""),[O,E]=o.useState("");o.useEffect(()=>{x("view_team_attendance")&&H(!0)},[x]);const{data:p,isLoading:q,refetch:W}=g("attendance-status",()=>c.getStatus().then(s=>s.data),{refetchInterval:3e4,onError:s=>i(s,"Failed to fetch attendance status")}),r=p==null?void 0:p.data,{data:N,isLoading:Y,refetch:Z}=g(["my-attendance",t],()=>c.getMyAttendance({startDate:t.startDate,endDate:t.endDate,limit:50}).then(s=>s.data),{enabled:n==="my",onError:s=>i(s,"Failed to fetch attendance")}),{data:v,isLoading:G,refetch:J}=g(["team-attendance",t],()=>c.getTeamAttendance({startDate:t.startDate,endDate:t.endDate,userId:t.userId||void 0,status:t.status||void 0,limit:50}).then(s=>s.data),{enabled:n==="team"&&x("view_team_attendance"),onError:s=>i(s,"Failed to fetch team attendance")}),{data:k}=g("users-list",()=>oe.getUsers({limit:100}).then(s=>{var a;return((a=s.data)==null?void 0:a.users)||[]}),{enabled:n==="team"&&x("view_team_attendance"),staleTime:5*60*1e3}),w=j(s=>c.clockIn(s),{onSuccess:s=>{f("Clocked in successfully"),L(""),d.invalidateQueries("attendance-status"),d.invalidateQueries("my-attendance")},onError:s=>{i(s,"Failed to clock in")}}),C=j(s=>c.clockOut(s),{onSuccess:s=>{f("Clocked out successfully"),E(""),d.invalidateQueries("attendance-status"),d.invalidateQueries("my-attendance")},onError:s=>{i(s,"Failed to clock out")}}),m=j(s=>c.startBreak(s),{onSuccess:()=>{f("Break started"),d.invalidateQueries("attendance-status")},onError:s=>{i(s,"Failed to start break")}}),A=j(()=>c.endBreak(),{onSuccess:()=>{f("Break ended"),d.invalidateQueries("attendance-status")},onError:s=>{i(s,"Failed to end break")}}),K=()=>{w.mutate({notesIn:M.trim()||void 0})},X=()=>{C.mutate({notesOut:O.trim()||void 0})},B=(s="break")=>{m.mutate(s)},ee=()=>{A.mutate()},F=s=>{if(!s)return"0m";const a=Math.floor(s/60),l=s%60;return a>0?`${a}h ${l}m`:`${l}m`},se=s=>{var _;if(!s)return 0;const a=new Date,l=new Date(s),ae=a-l,ne=((_=r==null?void 0:r.breaks)==null?void 0:_.reduce((Q,I)=>{if(I.endedAt)return Q+(I.durationMinutes||0);{const le=new Date(I.startedAt),ce=a-le;return Q+Math.round(ce/6e4)}},0))||0,re=ae-ne*6e4;return Math.max(0,Math.round(re/6e4))},h=()=>{var s;return(s=r==null?void 0:r.breaks)==null?void 0:s.find(a=>!a.endedAt)},T=n==="my"?(N==null?void 0:N.data)||[]:(v==null?void 0:v.data)||[],te=n==="my"?Y:G;return e.jsxs("div",{className:"container mx-auto px-4 py-6",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"Attendance"}),e.jsx("p",{className:"text-gray-600",children:"Track your work hours and manage attendance"})]}),e.jsx("div",{className:"card mb-6",children:e.jsxs("div",{className:"card-content",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Current Status"}),e.jsx("button",{onClick:()=>W(),className:"p-2 text-gray-500 hover:text-gray-700 transition-colors",title:"Refresh status",children:e.jsx($,{className:"h-5 w-5"})})]}),q?e.jsx(S,{}):r?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 bg-success-50 rounded-lg border border-success-200",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"p-2 bg-success-500 rounded-full",children:e.jsx(ge,{className:"h-6 w-6 text-white"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-gray-900",children:"Clocked In"}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Since ",y(r.clockInAt)]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-2xl font-bold text-success-600",children:F(se(r.clockInAt))}),e.jsx("p",{className:"text-xs text-gray-500",children:"Worked"})]})]}),h()&&e.jsxs("div",{className:"flex items-center justify-between p-4 bg-warning-50 rounded-lg border border-warning-200",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"p-2 bg-warning-500 rounded-full",children:e.jsx(b,{className:"h-6 w-6 text-white"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-gray-900",children:"On Break"}),e.jsxs("p",{className:"text-sm text-gray-600 capitalize",children:[h().type," - Started ",y(h().startedAt)]})]})]}),e.jsx("button",{onClick:ee,disabled:A.isLoading,className:"btn btn-warning",children:A.isLoading?e.jsx(S,{size:"sm"}):"End Break"})]}),!h()&&e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs("button",{onClick:()=>B("break"),disabled:m.isLoading,className:"btn btn-secondary flex-1",children:[e.jsx(b,{className:"h-4 w-4 mr-2"}),m.isLoading?"Starting...":"Start Break"]}),e.jsxs("button",{onClick:()=>B("lunch"),disabled:m.isLoading,className:"btn btn-secondary flex-1",children:[e.jsx(b,{className:"h-4 w-4 mr-2"}),m.isLoading?"Starting...":"Lunch Break"]})]}),e.jsxs("div",{className:"pt-4 border-t",children:[e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Notes (Optional)"}),e.jsx("textarea",{value:O,onChange:s=>E(s.target.value),placeholder:"Add notes for clock out...",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500",rows:"2"})]}),e.jsxs("button",{onClick:X,disabled:C.isLoading,className:"btn btn-danger w-full",children:[e.jsx(R,{className:"h-4 w-4 mr-2"}),C.isLoading?"Clocking Out...":"Clock Out"]})]})]}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"p-4 bg-gray-50 rounded-full inline-block mb-4",children:e.jsx(me,{className:"h-12 w-12 text-gray-400"})}),e.jsx("p",{className:"text-gray-600 mb-4",children:"You are not clocked in"}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Notes (Optional)"}),e.jsx("textarea",{value:M,onChange:s=>L(s.target.value),placeholder:"Add notes for clock in...",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500",rows:"2"})]}),e.jsxs("button",{onClick:K,disabled:w.isLoading,className:"btn btn-primary w-full",children:[e.jsx(z,{className:"h-4 w-4 mr-2"}),w.isLoading?"Clocking In...":"Clock In"]})]})]})}),V&&e.jsx("div",{className:"card mb-6",children:e.jsx("div",{className:"card-content",children:e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs("button",{onClick:()=>D("my"),className:`flex-1 py-2 px-4 rounded-md font-medium transition-colors ${n==="my"?"bg-primary-500 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:[e.jsx(U,{className:"h-4 w-4 inline mr-2"}),"My Attendance"]}),e.jsxs("button",{onClick:()=>D("team"),className:`flex-1 py-2 px-4 rounded-md font-medium transition-colors ${n==="team"?"bg-primary-500 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:[e.jsx(xe,{className:"h-4 w-4 inline mr-2"}),"Team Attendance"]})]})})}),e.jsx("div",{className:"card mb-6",children:e.jsxs("div",{className:"card-content",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Filters"}),e.jsx(ye,{className:"h-5 w-5 text-gray-500"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Start Date"}),e.jsx("input",{type:"date",value:t.startDate,onChange:s=>u({...t,startDate:s.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"End Date"}),e.jsx("input",{type:"date",value:t.endDate,onChange:s=>u({...t,endDate:s.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500"})]}),n==="team"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Employee"}),e.jsxs("select",{value:t.userId,onChange:s=>u({...t,userId:s.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500",children:[e.jsx("option",{value:"",children:"All Employees"}),k==null?void 0:k.map(s=>e.jsxs("option",{value:s._id,children:[s.firstName," ",s.lastName]},s._id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Status"}),e.jsxs("select",{value:t.status,onChange:s=>u({...t,status:s.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500",children:[e.jsx("option",{value:"",children:"All Status"}),e.jsx("option",{value:"open",children:"Open"}),e.jsx("option",{value:"closed",children:"Closed"})]})]})]})]})]})}),e.jsx("div",{className:"card",children:e.jsxs("div",{className:"card-content",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:n==="my"?"My Attendance History":"Team Attendance"}),e.jsx("button",{onClick:()=>{n==="my"?Z():J()},className:"p-2 text-gray-500 hover:text-gray-700 transition-colors",title:"Refresh",children:e.jsx($,{className:"h-5 w-5"})})]}),te?e.jsx(S,{}):T.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(ue,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"No attendance records found"})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200",children:[n==="team"&&e.jsx("th",{className:"text-left py-3 px-4 font-semibold text-gray-700",children:"Employee"}),e.jsx("th",{className:"text-left py-3 px-4 font-semibold text-gray-700",children:"Date"}),e.jsx("th",{className:"text-left py-3 px-4 font-semibold text-gray-700",children:"Clock In"}),e.jsx("th",{className:"text-left py-3 px-4 font-semibold text-gray-700",children:"Clock Out"}),e.jsx("th",{className:"text-left py-3 px-4 font-semibold text-gray-700",children:"Duration"}),e.jsx("th",{className:"text-left py-3 px-4 font-semibold text-gray-700",children:"Breaks"}),e.jsx("th",{className:"text-left py-3 px-4 font-semibold text-gray-700",children:"Status"})]})}),e.jsx("tbody",{children:T.map(s=>{var a,l;return e.jsxs("tr",{className:"border-b border-gray-100 hover:bg-gray-50",children:[n==="team"&&e.jsx("td",{className:"py-3 px-4",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(U,{className:"h-4 w-4 text-gray-400 mr-2"}),e.jsxs("span",{className:"font-medium",children:[(a=s.user)==null?void 0:a.firstName," ",(l=s.user)==null?void 0:l.lastName]})]})}),e.jsx("td",{className:"py-3 px-4",children:he(s.clockInAt)}),e.jsx("td",{className:"py-3 px-4",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(z,{className:"h-4 w-4 text-success-500 mr-2"}),y(s.clockInAt)]})}),e.jsx("td",{className:"py-3 px-4",children:s.clockOutAt?e.jsxs("div",{className:"flex items-center",children:[e.jsx(R,{className:"h-4 w-4 text-danger-500 mr-2"}),y(s.clockOutAt)]}):e.jsx("span",{className:"text-gray-400",children:"-"})}),e.jsx("td",{className:"py-3 px-4",children:s.totalMinutes>0?F(s.totalMinutes):"-"}),e.jsx("td",{className:"py-3 px-4",children:s.breaks&&s.breaks.length>0?e.jsxs("div",{className:"flex items-center",children:[e.jsx(b,{className:"h-4 w-4 text-warning-500 mr-2"}),e.jsxs("span",{children:[s.breaks.length," break(s)"]})]}):e.jsx("span",{className:"text-gray-400",children:"-"})}),e.jsx("td",{className:"py-3 px-4",children:e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${s.status==="open"?"bg-success-100 text-success-700":"bg-gray-100 text-gray-700"}`,children:s.status==="open"?"Open":"Closed"})})]},s._id)})})]})})]})})]})};export{Ne as default};
