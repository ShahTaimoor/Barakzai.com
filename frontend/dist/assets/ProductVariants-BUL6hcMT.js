import{aC as q,r as u,c as F,o as e,S as $,R as I,N as Q,P as U,O as w,X as G,L as K,w as C,z as V,ca as y,B as X}from"./index-jd7Ax_Ed.js";import{u as P}from"./useMutation-n-l4Ns3H.js";import{D as H}from"./ConfirmationDialog-EbANb_5f.js";import{a as J}from"./useConfirmation-BnXgMCcj.js";import{V as b,a as d}from"./ValidatedInput-Cg4yPCj4.js";import{P as Y}from"./plus-C2o0386P.js";import{P as Z}from"./pen-square-CzKMgeH3.js";import{T as ee}from"./trash-2-DCbqoVbR.js";import"./shield-DYPDNaY8.js";import"./check-circle-8oGxTki5.js";import"./info-D4lm7fBv.js";import"./alert-circle-yrAHCiEw.js";import"./eye-off-Dv_sEjAY.js";import"./eye-DMmE8Niy.js";const ge=()=>{const r=q(),[n,h]=u.useState(""),[o,g]=u.useState(""),[s,l]=u.useState(""),[m,c]=u.useState(!1),[f,p]=u.useState(null),{data:t,isLoading:i,refetch:j}=F(["productVariants",o,s,n],()=>y.getVariants({baseProduct:o||void 0,variantType:s||void 0,search:n||void 0}),{select:a=>({variants:(a==null?void 0:a.variants)||[]})}),{data:N}=F(["products","all"],()=>X.getProducts({}),{select:a=>{var x;return{products:((x=a==null?void 0:a.data)==null?void 0:x.products)||[]}}}),S=(t==null?void 0:t.variants)||[],k=(N==null?void 0:N.products)||[],L=P(a=>y.deleteVariant(a),{onSuccess:()=>{V("Variant deleted successfully"),r.invalidateQueries("productVariants"),j()},onError:a=>{C(a,"ProductVariants")}}),{isDeleteDialogOpen:M,itemToDelete:v,openDeleteDialog:R,closeDeleteDialog:_,confirmDelete:B}=J(L.mutate),z=a=>{p(a),c(!0)},O=()=>{c(!1),p(null)},W=[{value:"",label:"All Types"},{value:"color",label:"Color"},{value:"warranty",label:"Warranty"},{value:"size",label:"Size"},{value:"finish",label:"Finish"},{value:"custom",label:"Custom"}];return e.jsxs("div",{className:"p-4 sm:p-6 lg:p-8",children:[e.jsx("div",{className:"mb-6",children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Product Variants"}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"Manage product variants and transformations"})]}),e.jsxs("button",{onClick:()=>c(!0),className:"btn btn-primary flex items-center gap-2",children:[e.jsx(Y,{className:"h-5 w-5"}),"Add Variant"]})]})}),e.jsx("div",{className:"bg-white rounded-lg shadow p-4 mb-6",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx($,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search variants...",value:n,onChange:a=>h(a.target.value),className:"input pl-10 w-full"})]}),e.jsx(b,{value:o,onChange:a=>g(a.target.value),options:[{value:"",label:"All Products"},...k.map(a=>({value:a._id,label:a.name}))],className:"w-full"}),e.jsx(b,{value:s,onChange:a=>l(a.target.value),options:W,className:"w-full"}),e.jsxs("button",{onClick:()=>j(),className:"btn btn-secondary flex items-center justify-center gap-2",children:[e.jsx(I,{className:"h-4 w-4"}),"Refresh"]})]})}),i?e.jsx(Q,{}):S.length===0?e.jsxs("div",{className:"bg-white rounded-lg shadow p-12 text-center",children:[e.jsx(U,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No variants found"}),e.jsx("p",{className:"text-gray-500 mb-4",children:"Get started by creating a new product variant."}),e.jsx("button",{onClick:()=>c(!0),className:"btn btn-primary",children:"Add Variant"})]}):e.jsx("div",{className:"bg-white rounded-lg shadow overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Base Product"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Variant Name"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Type"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Value"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Stock"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Retail Price"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Transformation Cost"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:S.map(a=>{var x,T,D,E,A;return e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-sm font-medium text-gray-900",children:((x=a.baseProduct)==null?void 0:x.name)||"N/A"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-sm text-gray-900",children:a.displayName})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:"px-2 py-1 text-xs font-semibold rounded-full bg-blue-100 text-blue-800",children:a.variantType})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:a.variantValue}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:((T=a.inventory)==null?void 0:T.currentStock)||0}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:["$",((E=(D=a.pricing)==null?void 0:D.retail)==null?void 0:E.toFixed(2))||"0.00"]}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:["$",((A=a.transformationCost)==null?void 0:A.toFixed(2))||"0.00"]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`px-2 py-1 text-xs font-semibold rounded-full ${a.status==="active"?"bg-green-100 text-green-800":a.status==="inactive"?"bg-gray-100 text-gray-800":"bg-red-100 text-red-800"}`,children:a.status})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[e.jsx("button",{onClick:()=>z(a),className:"text-blue-600 hover:text-blue-900",children:e.jsx(Z,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>R(a._id,a.displayName),className:"text-red-600 hover:text-red-900",children:e.jsx(ee,{className:"h-4 w-4"})})]})})]},a._id)})})]})})}),m&&e.jsx(te,{variant:f,products:k,isOpen:m,onClose:O,onSuccess:()=>{r.invalidateQueries("productVariants"),j()}}),e.jsx(H,{isOpen:M,onClose:_,onConfirm:B,itemName:(v==null?void 0:v.name)||"",itemType:"variant"})]})},te=({variant:r,products:n,isOpen:h,onClose:o,onSuccess:g})=>{q();const[s,l]=u.useState({baseProduct:"",variantName:"",variantType:"color",variantValue:"",displayName:"",description:"",pricing:{cost:0,retail:0,wholesale:0,distributor:0},transformationCost:0,sku:"",status:"active"});w.useEffect(()=>{var t;l(r?{baseProduct:((t=r.baseProduct)==null?void 0:t._id)||r.baseProduct||"",variantName:r.variantName||"",variantType:r.variantType||"color",variantValue:r.variantValue||"",displayName:r.displayName||"",description:r.description||"",pricing:r.pricing||{cost:0,retail:0,wholesale:0,distributor:0},transformationCost:r.transformationCost||0,sku:r.sku||"",status:r.status||"active"}:{baseProduct:"",variantName:"",variantType:"color",variantValue:"",displayName:"",description:"",pricing:{cost:0,retail:0,wholesale:0,distributor:0},transformationCost:0,sku:"",status:"active"})},[r,h]),w.useEffect(()=>{if(s.baseProduct&&s.variantValue){const t=n.find(i=>i._id===s.baseProduct);t&&!r&&l(i=>({...i,displayName:`${t.name} - ${s.variantValue}`}))}},[s.baseProduct,s.variantValue,n,r]),w.useEffect(()=>{if(s.baseProduct&&!r){const t=n.find(i=>i._id===s.baseProduct);t&&l(i=>({...i,pricing:{cost:t.pricing.cost+i.transformationCost,retail:t.pricing.retail+i.transformationCost,wholesale:t.pricing.wholesale+i.transformationCost,distributor:t.pricing.distributor?t.pricing.distributor+i.transformationCost:0}}))}},[s.baseProduct,s.transformationCost,n,r]);const m=P(t=>y.createVariant(t),{onSuccess:()=>{V("Variant created successfully"),o(),g()},onError:t=>{C(t,"ProductVariants")}}),c=P(({id:t,data:i})=>y.updateVariant(t,i),{onSuccess:()=>{V("Variant updated successfully"),o(),g()},onError:t=>{C(t,"ProductVariants")}}),f=t=>{t.preventDefault(),r?c.mutate({id:r._id,data:s}):m.mutate(s)},p=m.isLoading||c.isLoading;return h?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"sticky top-0 bg-white border-b border-gray-200 px-6 py-4 flex items-center justify-between",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:r?"Edit Variant":"Create Variant"}),e.jsx("button",{onClick:o,className:"text-gray-400 hover:text-gray-600",children:e.jsx(G,{className:"h-6 w-6"})})]}),e.jsxs("form",{onSubmit:f,className:"p-6 space-y-4",children:[e.jsx(b,{label:"Base Product",value:s.baseProduct,onChange:t=>l({...s,baseProduct:t.target.value}),options:[{value:"",label:"Select Base Product"},...n.map(t=>({value:t._id,label:t.name}))],required:!0,disabled:!!r}),e.jsx(b,{label:"Variant Type",value:s.variantType,onChange:t=>l({...s,variantType:t.target.value}),options:[{value:"color",label:"Color"},{value:"warranty",label:"Warranty"},{value:"size",label:"Size"},{value:"finish",label:"Finish"},{value:"custom",label:"Custom"}],required:!0,disabled:!!r}),e.jsx(d,{label:"Variant Value",type:"text",value:s.variantValue,onChange:t=>l({...s,variantValue:t.target.value}),placeholder:"e.g., Red, With Warranty, Large",required:!0,disabled:!!r}),e.jsx(d,{label:"Display Name",type:"text",value:s.displayName,onChange:t=>l({...s,displayName:t.target.value}),placeholder:"e.g., Spoiler - Red",required:!0}),e.jsx(d,{label:"Transformation Cost (per unit)",type:"number",value:s.transformationCost,onChange:t=>l({...s,transformationCost:parseFloat(t.target.value)||0}),min:"0",step:"0.01",required:!0}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(d,{label:"Retail Price",type:"number",value:s.pricing.retail,onChange:t=>l({...s,pricing:{...s.pricing,retail:parseFloat(t.target.value)||0}}),min:"0",step:"0.01",required:!0}),e.jsx(d,{label:"Wholesale Price",type:"number",value:s.pricing.wholesale,onChange:t=>l({...s,pricing:{...s.pricing,wholesale:parseFloat(t.target.value)||0}}),min:"0",step:"0.01",required:!0})]}),e.jsx(d,{label:"SKU (optional)",type:"text",value:s.sku,onChange:t=>l({...s,sku:t.target.value}),placeholder:"Auto-generated if left empty"}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t",children:[e.jsx("button",{type:"button",onClick:o,className:"btn btn-secondary",disabled:p,children:"Cancel"}),e.jsx(K,{type:"submit",isLoading:p,className:"btn btn-primary",children:r?"Update":"Create"})]})]})]})}):null};export{ge as default};
