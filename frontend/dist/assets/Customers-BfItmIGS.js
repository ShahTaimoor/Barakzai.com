import{r as x,o as e,L as ee,X as W,D as G,z as J,w as K,x as se,Q as y,ai as oe,S as le,U as ie,ae as ne,ar as me,as as xe,at as ue,au as he,an as pe,av as ge,a2 as re,aw as be,ax as je,ay as fe,az as te}from"./index-jd7Ax_Ed.js";import{u as Ne}from"./chartOfAccountsApi-DmTn-F78.js";import{u as ye,a as ve}from"./citiesApi-CNkIWyqV.js";import{u as Ce}from"./useFuzzySearch-BrpeiQaU.js";import{D as we}from"./ConfirmationDialog-EbANb_5f.js";import{a as Se}from"./useConfirmation-BnXgMCcj.js";import{D as ae}from"./download-bwqK3ulf.js";import{U as Ae}from"./upload-DdBv5t3-.js";import{F as Ee}from"./file-spreadsheet-BleMUJhf.js";import{C as ke}from"./check-circle-8oGxTki5.js";import{A as Ie}from"./alert-circle-yrAHCiEw.js";import{F as Le}from"./filter-CQLYjJyW.js";import{C as Te}from"./chevron-up-DEWj5144.js";import{C as Fe}from"./chevron-down-BFYGIyCo.js";import{P as ce}from"./phone-Dkvr6QGJ.js";import{N as Pe}from"./NotesPanel-Bd7HDD1M.js";import{P as Be}from"./plus-C2o0386P.js";import{M as Ue}from"./message-square-DtCe3QVP.js";import{P as De}from"./pen-square-CzKMgeH3.js";import{T as ze}from"./trash-2-DCbqoVbR.js";import"./shield-DYPDNaY8.js";import"./info-D4lm7fBv.js";import"./useMutation-n-l4Ns3H.js";import"./history-D1YUGYyd.js";import"./lock-DxijO8f_.js";const Me=({onImportComplete:t,filters:E={}})=>{const[k,v]=x.useState(!1),[b,j]=x.useState(!1),[m,N]=x.useState(null),[g,S]=x.useState(null),[l,i]=x.useState(!1),C=async()=>{try{v(!0);const d=await G.exportExcel(E),p=await G.downloadFile(d.data.filename),u=new Blob([p.data],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),w=document.createElement("a"),z=URL.createObjectURL(u);w.setAttribute("href",z),w.setAttribute("download",d.data.filename),w.style.visibility="hidden",document.body.appendChild(w),w.click(),document.body.removeChild(w),J(`Exported ${d.data.recordCount} customers to Excel`)}catch(d){K(d,"Excel Export")}finally{v(!1)}},h=d=>{const p=d.target.files[0];if(p){if(!["application/vnd.ms-excel","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"].includes(p.mimetype)&&!p.name.match(/\.(xlsx|xls)$/)){se("Invalid file type. Only Excel files are allowed."),d.target.value="";return}if(p.size>10*1024*1024){se("File size exceeds 10MB limit"),d.target.value="";return}N(p)}},f=async()=>{if(!m){y.error("Please select a file to import");return}try{j(!0);const d=await G.importExcel(m);S(d.data.results),d.data.results.success>0&&(J(`Successfully imported ${d.data.results.success} customers`),t&&t()),d.data.results.errors.length>0&&oe(`${d.data.results.errors.length} customers failed to import`)}catch(d){K(d,"Customer Import")}finally{j(!1)}},A=async()=>{try{const d=await G.downloadTemplate(),p=new Blob([d.data],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),u=document.createElement("a"),w=URL.createObjectURL(p);u.setAttribute("href",w),u.setAttribute("download","customer_template.xlsx"),u.style.visibility="hidden",document.body.appendChild(u),u.click(),document.body.removeChild(u),J("Template downloaded successfully")}catch(d){K(d,"Template Download")}},I=()=>{N(null),S(null),i(!1)};return e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Import / Export Customers"}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs("div",{className:"relative group",children:[e.jsxs("button",{onClick:A,className:"btn btn-outline btn-sm",children:[e.jsx(ae,{className:"h-4 w-4 mr-2"}),"Template"]}),e.jsxs("div",{className:"absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 px-3 py-2 bg-gray-900 text-white text-sm rounded-lg opacity-0 group-hover:opacity-100 transition-opacity duration-200 pointer-events-none whitespace-nowrap z-10",children:[e.jsxs("div",{className:"text-xs space-y-1",children:[e.jsx("div",{children:"• Download Excel template file"}),e.jsx("div",{children:"• Pre-formatted with correct columns"}),e.jsx("div",{children:"• Shows required and optional fields"}),e.jsx("div",{children:"• Use this to prepare import data"})]}),e.jsx("div",{className:"absolute top-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-l-4 border-r-4 border-t-4 border-transparent border-t-gray-900"})]})]}),e.jsxs("div",{className:"relative group",children:[e.jsxs(ee,{onClick:C,isLoading:k,className:"btn btn-secondary btn-sm",children:[e.jsx(ae,{className:"h-4 w-4 mr-2"}),"Export Excel"]}),e.jsxs("div",{className:"absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 px-3 py-2 bg-gray-900 text-white text-sm rounded-lg opacity-0 group-hover:opacity-100 transition-opacity duration-200 pointer-events-none whitespace-nowrap z-10",children:[e.jsxs("div",{className:"text-xs space-y-1",children:[e.jsx("div",{children:"• Exports all customers to Excel file"}),e.jsx("div",{children:"• Includes all customer data and fields"}),e.jsx("div",{children:"• File format: Excel (.xlsx)"}),e.jsx("div",{children:"• Filtered results based on current search"})]}),e.jsx("div",{className:"absolute top-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-l-4 border-r-4 border-t-4 border-transparent border-t-gray-900"})]})]}),e.jsxs("div",{className:"relative group",children:[e.jsxs("button",{onClick:()=>i(!0),className:"btn btn-primary btn-sm",children:[e.jsx(Ae,{className:"h-4 w-4 mr-2"}),"Import Customers"]}),e.jsxs("div",{className:"absolute bottom-full right-0 mb-2 px-3 py-2 bg-gray-900 text-white text-sm rounded-lg opacity-0 group-hover:opacity-100 transition-opacity duration-200 pointer-events-none whitespace-nowrap z-10",children:[e.jsxs("div",{className:"text-xs space-y-1",children:[e.jsx("div",{children:"• Download template for required format"}),e.jsx("div",{children:"• Required: Name, Business Name"}),e.jsx("div",{children:"• Supported: Excel (.xlsx), Max 10MB"}),e.jsx("div",{children:"• Duplicates will be skipped"})]}),e.jsx("div",{className:"absolute top-full right-4 w-0 h-0 border-l-4 border-r-4 border-t-4 border-transparent border-t-gray-900"})]})]})]})]}),l&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-md w-full mx-4",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Import Customers"}),e.jsx("button",{onClick:I,className:"text-gray-400 hover:text-gray-600",children:e.jsx(W,{className:"h-5 w-5"})})]}),e.jsx("div",{className:"p-6",children:g?e.jsxs("div",{children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-3",children:"Import Results"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{className:"text-center p-3 bg-green-50 rounded-lg",children:[e.jsx(ke,{className:"h-6 w-6 text-green-600 mx-auto mb-1"}),e.jsx("div",{className:"text-lg font-semibold text-green-600",children:g.success}),e.jsx("div",{className:"text-sm text-green-700",children:"Success"})]}),e.jsxs("div",{className:"text-center p-3 bg-red-50 rounded-lg",children:[e.jsx(Ie,{className:"h-6 w-6 text-red-600 mx-auto mb-1"}),e.jsx("div",{className:"text-lg font-semibold text-red-600",children:g.errors.length}),e.jsx("div",{className:"text-sm text-red-700",children:"Errors"})]})]}),g.errors.length>0&&e.jsxs("div",{className:"max-h-40 overflow-y-auto",children:[e.jsx("h5",{className:"font-medium text-gray-900 mb-2",children:"Errors:"}),e.jsxs("div",{className:"space-y-2",children:[g.errors.slice(0,10).map((d,p)=>e.jsxs("div",{className:"text-sm text-red-600 bg-red-50 p-2 rounded",children:["Row ",d.row,": ",d.error]},p)),g.errors.length>10&&e.jsxs("div",{className:"text-sm text-gray-500",children:["... and ",g.errors.length-10," more errors"]})]})]})]}),e.jsx("div",{className:"flex justify-end",children:e.jsx("button",{onClick:I,className:"btn btn-primary btn-sm",children:"Close"})})]}):e.jsxs("div",{children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Select Excel File"}),e.jsx("input",{type:"file",accept:".xlsx,.xls",onChange:h,className:"input w-full"})]}),m&&e.jsx("div",{className:"mb-4 p-3 bg-gray-50 rounded-lg",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(Ee,{className:"h-4 w-4 text-gray-600 mr-2"}),e.jsx("span",{className:"text-sm text-gray-700",children:m.name}),e.jsxs("span",{className:"text-xs text-gray-500 ml-auto",children:[(m.size/1024/1024).toFixed(2)," MB"]})]})}),e.jsxs("div",{className:"flex justify-end space-x-3",children:[e.jsx("button",{onClick:I,className:"btn btn-secondary btn-sm",children:"Cancel"}),e.jsx(ee,{onClick:f,isLoading:b,disabled:!m,className:"btn btn-primary btn-sm",children:"Import Customers"})]})]})})]})})]})},_e=({filters:t,onFiltersChange:E,onClearFilters:k})=>{const[v,b]=x.useState(!1),j=(l,i)=>{E({...t,[l]:i})},m=l=>{const i={...t};delete i[l],E(i)},N=()=>{E({}),k&&k()},g=Object.keys(t).some(l=>t[l]!==""&&t[l]!==null&&t[l]!==void 0),S=()=>Object.keys(t).filter(l=>t[l]!==""&&t[l]!==null&&t[l]!==void 0).length;return e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 cursor-pointer hover:bg-gray-50",onClick:()=>b(!v),children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(Le,{className:"h-5 w-5 text-gray-600"}),e.jsx("span",{className:"font-medium text-gray-900",children:"Filters"}),g&&e.jsxs("span",{className:"bg-blue-100 text-blue-800 text-xs font-medium px-2 py-1 rounded-full",children:[S()," active"]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[g&&e.jsx("button",{onClick:l=>{l.stopPropagation(),N()},className:"text-sm text-red-600 hover:text-red-800 font-medium",children:"Clear All"}),v?e.jsx(Te,{className:"h-4 w-4 text-gray-400"}):e.jsx(Fe,{className:"h-4 w-4 text-gray-400"})]})]}),v&&e.jsxs("div",{className:"border-t border-gray-200 p-4",children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx(le,{className:"h-4 w-4 inline mr-1"}),"Search Customers"]}),e.jsx("input",{type:"text",placeholder:"Name, email, or phone...",value:t.search||"",onChange:l=>j("search",l.target.value),className:"input text-sm"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx(ie,{className:"h-4 w-4 inline mr-1"}),"Status"]}),e.jsxs("select",{value:t.status||"",onChange:l=>j("status",l.target.value),className:"input text-sm",children:[e.jsx("option",{value:"",children:"All Statuses"}),e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"inactive",children:"Inactive"})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx(ne,{className:"h-4 w-4 inline mr-1"}),"Email Status"]}),e.jsxs("select",{value:t.emailStatus||"",onChange:l=>j("emailStatus",l.target.value),className:"input text-sm",children:[e.jsx("option",{value:"",children:"All Email Statuses"}),e.jsx("option",{value:"verified",children:"Verified"}),e.jsx("option",{value:"unverified",children:"Unverified"}),e.jsx("option",{value:"no-email",children:"No Email"})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx(ce,{className:"h-4 w-4 inline mr-1"}),"Phone Status"]}),e.jsxs("select",{value:t.phoneStatus||"",onChange:l=>j("phoneStatus",l.target.value),className:"input text-sm",children:[e.jsx("option",{value:"",children:"All Phone Statuses"}),e.jsx("option",{value:"verified",children:"Verified"}),e.jsx("option",{value:"unverified",children:"Unverified"}),e.jsx("option",{value:"no-phone",children:"No Phone"})]})]})]}),g&&e.jsxs("div",{className:"border-t border-gray-200 pt-4 mt-4",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-700 mb-3",children:"Active Filters:"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:Object.entries(t).map(([l,i])=>{if(!i||i==="")return null;let C,h;switch(l){case"search":C="Search",h=`"${i}"`;break;case"status":C="Status",h=i.charAt(0).toUpperCase()+i.slice(1);break;case"emailStatus":C="Email",h=i==="verified"?"Verified":i==="unverified"?"Unverified":i==="no-email"?"No Email":i;break;case"phoneStatus":C="Phone",h=i==="verified"?"Verified":i==="unverified"?"Unverified":i==="no-phone"?"No Phone":i;break;default:C=l.charAt(0).toUpperCase()+l.slice(1),h=i}return e.jsxs("span",{className:"inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-800",children:[C,": ",h,e.jsx("button",{onClick:()=>m(l),className:"ml-1 inline-flex items-center justify-center w-4 h-4 rounded-full hover:bg-blue-200",children:e.jsx(W,{className:"h-3 w-3"})})]},l)})})]})]})]})},R={name:"",email:"",phone:"",businessName:"",businessType:"wholesale",customerTier:"bronze",creditLimit:0,openingBalance:0,status:"active",ledgerAccount:"",addresses:[{type:"both",street:"",city:"",state:"",zipCode:"",country:"US",isDefault:!0}]},Re=({customer:t,onSave:E,onCancel:k,isSubmitting:v})=>{const{register:b,handleSubmit:j,formState:{errors:m},reset:N,setValue:g,watch:S,setError:l,clearErrors:i}=be({defaultValues:R}),[C,h]=x.useState(!1),[f,A]=x.useState({name:"",state:"",country:"US",description:"",isActive:!0}),[I,d]=x.useState(!1),[p,u]=x.useState(!1),[w,z]=x.useState(!1),[O,L]=x.useState(!1),[Z]=je(),[X]=fe(),[Y,{isLoading:$}]=ye(),q=S("addresses")||R.addresses,P=S("email"),U=S("businessName");x.useEffect(()=>{if(!P||P.trim()===""){u(!1),i("email");return}if(!/^[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,}$/i.test(P)){u(!1);return}if(t&&t.email&&t.email.toLowerCase()===P.toLowerCase()){u(!1),i("email");return}const a=setTimeout(async()=>{var r;try{d(!0);const o=(t==null?void 0:t._id)||null,c=await Z({email:P,excludeId:o}).unwrap();((r=c==null?void 0:c.data)==null?void 0:r.exists)??(c==null?void 0:c.exists)?(u(!0),l("email",{type:"manual",message:"Email already exists"})):(u(!1),i("email"))}catch(o){console.error("Error checking email:",o),u(!1)}finally{d(!1)}},500);return()=>clearTimeout(a)},[P,t,l,i]),x.useEffect(()=>{if(!U||U.trim()===""){L(!1),i("businessName");return}if(t&&t.businessName&&t.businessName.trim().toLowerCase()===U.trim().toLowerCase()){L(!1),i("businessName");return}const s=setTimeout(async()=>{var a;try{z(!0);const r=(t==null?void 0:t._id)||null,o=await X({businessName:U,excludeId:r}).unwrap();((a=o==null?void 0:o.data)==null?void 0:a.exists)??(o==null?void 0:o.exists)?(L(!0),l("businessName",{type:"manual",message:"Business name already exists"})):(L(!1),i("businessName"))}catch(r){console.error("Error checking business name:",r),L(!1)}finally{z(!1)}},500);return()=>clearTimeout(s)},[U,t,l,i]),x.useEffect(()=>{var s,a;t?(N({...R,...t,openingBalance:typeof t.openingBalance=="number"?t.openingBalance:t.pendingBalance||0,ledgerAccount:((s=t.ledgerAccount)==null?void 0:s._id)||t.ledgerAccount||"",addresses:(a=t.addresses)!=null&&a.length?t.addresses:R.addresses}),u(!1),L(!1),i("email"),i("businessName")):(N(R),u(!1),L(!1),i("email"),i("businessName"))},[t,N,i]);const D=(s,a,r)=>{const o=[...q];o[s]={...o[s],[a]:r},g("addresses",o,{shouldValidate:!1})},{data:B=[],isLoading:H}=Ne({accountType:"asset",accountCategory:"current_assets",includePartyAccounts:"true",isActive:"true"}),{data:V=[],isLoading:M}=ve(),Q=s=>{if(s.preventDefault(),!f.name.trim()){y.error("City name is required");return}Y(f).unwrap().then(()=>{y.success("City created successfully"),h(!1),A({name:"",state:"",country:"US",description:"",isActive:!0}),q.length>0&&D(0,"city",f.name)}).catch(a=>{var r;y.error(((r=a==null?void 0:a.data)==null?void 0:r.message)||"Failed to create city")})},F=x.useMemo(()=>{if(!Array.isArray(B))return[];const s=B.find(c=>(c.accountName||c.name||"").toLowerCase()==="accounts receivable"),a=B.filter(c=>{const T=(c.accountName||c.name||"").toLowerCase(),_=Array.isArray(c.tags)?c.tags:[];return T.includes("receivable")||_.includes("customer")||_.includes("accounts_receivable")||c.accountCode&&c.accountCode.startsWith("11")}),r=B.filter(c=>c.allowDirectPosting!==!1);let o=[];return s?o=[s,...a.filter(c=>c._id!==s._id&&c.id!==s.id)]:a.length>0?o=a:r.length>0?o=r:o=B,[...o].sort((c,T)=>{if(s){if(c._id===s._id||c.id===s.id)return-1;if(T._id===s._id||T.id===s.id)return 1}const _=(c.accountCode||"").toString(),de=(T.accountCode||"").toString();return _.localeCompare(de,void 0,{numeric:!0})})},[B]);x.useEffect(()=>{if(F.length>0){const s=F.find(a=>(a.accountName||a.name||"").toLowerCase()==="accounts receivable"||a.accountCode==="1130")||F[0];if(s&&(!t||!t.ledgerAccount)){const a=s._id||s.id;a&&g("ledgerAccount",a,{shouldValidate:!1})}}},[t,F,g]);const n=s=>{if(p){y.error("Please use a different email address");return}if(O){y.error("Please use a different business name");return}E(s),N(R),u(!1),L(!1)};return e.jsxs("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:[e.jsx("div",{className:"bg-white rounded-lg max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:t?"Edit Customer":"Add New Customer"}),e.jsx("button",{onClick:k,className:"p-2 text-gray-400 hover:text-gray-600",children:e.jsx(W,{className:"h-5 w-5"})})]}),e.jsxs("form",{onSubmit:j(n),className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Business Name *"}),e.jsxs("div",{className:"relative",children:[e.jsx(re,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx("input",{...b("businessName",{required:"Business name is required"}),className:`input pl-10 ${O?"border-red-500":""}`,placeholder:"Enter business name"}),w&&e.jsx("div",{className:"absolute right-3 top-1/2 transform -translate-y-1/2",children:e.jsx(te,{size:"sm"})})]}),m.businessName&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:m.businessName.message}),O&&!m.businessName&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:"Business name already exists"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Contact Person *"}),e.jsx("input",{...b("name",{required:"Contact person is required"}),className:"input",placeholder:"Enter contact person name"}),m.name&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:m.name.message})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Email"}),e.jsxs("div",{className:"relative",children:[e.jsx(ne,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx("input",{...b("email",{pattern:{value:/^[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,}$/i,message:"Invalid email address"}}),type:"text",className:`input pl-10 ${p?"border-red-500":""}`,placeholder:"Enter email address (optional)"}),I&&e.jsx("div",{className:"absolute right-3 top-1/2 transform -translate-y-1/2",children:e.jsx(te,{size:"sm"})})]}),m.email&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:m.email.message}),p&&!m.email&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:"Email already exists"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Phone"}),e.jsxs("div",{className:"relative",children:[e.jsx(ce,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx("input",{...b("phone"),type:"tel",className:"input pl-10",placeholder:"Enter phone number"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Business Type"}),e.jsxs("select",{...b("businessType"),className:"input",children:[e.jsx("option",{value:"individual",children:"Individual"}),e.jsx("option",{value:"retail",children:"Retail"}),e.jsx("option",{value:"wholesale",children:"Wholesale"}),e.jsx("option",{value:"distributor",children:"Distributor"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Customer Tier"}),e.jsxs("select",{...b("customerTier"),className:"input",children:[e.jsx("option",{value:"bronze",children:"Bronze"}),e.jsx("option",{value:"silver",children:"Silver"}),e.jsx("option",{value:"gold",children:"Gold"}),e.jsx("option",{value:"platinum",children:"Platinum"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Credit Limit ($)"}),e.jsx("input",{...b("creditLimit",{valueAsNumber:!0,min:{value:0,message:"Credit limit must be positive"}}),type:"number",step:"0.01",className:"input",placeholder:"0.00"}),m.creditLimit&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:m.creditLimit.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Opening Balance ($)"}),e.jsx("input",{...b("openingBalance",{valueAsNumber:!0}),type:"number",step:"0.01",className:"input",placeholder:"0.00"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Positive means the customer owes you. Use a negative value if you owe the customer."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Status"}),e.jsxs("select",{...b("status"),className:"input",children:[e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"inactive",children:"Inactive"}),e.jsx("option",{value:"suspended",children:"Suspended"})]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Address"}),e.jsx("div",{className:"space-y-4",children:q.map((s,a)=>e.jsx("div",{className:"border border-gray-200 rounded-lg p-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Street Address"}),e.jsx("input",{type:"text",value:s.street||"",onChange:r=>D(a,"street",r.target.value),className:"input",placeholder:"123 Main St"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"City *"}),e.jsxs("select",{value:s.city||"",onChange:r=>D(a,"city",r.target.value),className:"input",required:!0,disabled:M,children:[e.jsx("option",{value:"",children:"Select a city"}),V.map(r=>e.jsxs("option",{value:r.name,children:[r.name,r.state?`, ${r.state}`:""]},r._id||r.name))]}),M&&e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Loading cities..."}),!M&&V.length===0&&e.jsx("p",{className:"text-xs text-amber-600 mt-1",children:"No cities available. Please add cities first."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"State"}),e.jsx("input",{type:"text",value:s.state||"",onChange:r=>D(a,"state",r.target.value),className:"input",placeholder:"State"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"ZIP Code"}),e.jsx("input",{type:"text",value:s.zipCode||"",onChange:r=>D(a,"zipCode",r.target.value),className:"input",placeholder:"12345"})]})]})},a))})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Ledger Account ",e.jsx("span",{className:"text-gray-400 text-xs",children:"(Auto-linked)"})]}),H?e.jsx("div",{className:"input bg-gray-50 text-gray-500",children:"Loading ledger account..."}):(()=>{const s=S("ledgerAccount"),a=F.find(o=>(o._id||o.id)===s||(o.accountName||o.name||"").toLowerCase()==="accounts receivable"||o.accountCode==="1130")||F[0],r=a?`${a.accountCode||"1130"} - ${a.accountName||a.name||"Accounts Receivable"}`:"1130 - Accounts Receivable";return e.jsxs(e.Fragment,{children:[e.jsx("input",{type:"text",value:r,className:"input bg-gray-50 text-gray-700 cursor-not-allowed",readOnly:!0,disabled:!0}),e.jsx("input",{type:"hidden",...b("ledgerAccount")}),e.jsxs("p",{className:"text-xs text-blue-600 mt-1",children:[e.jsx("span",{className:"font-medium",children:"ℹ️ Information:"}),' Customers are automatically linked to the "Accounts Receivable" account (1130) for accounting purposes. This cannot be changed.']})]})})()]}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-6 border-t border-gray-200",children:[e.jsx("button",{type:"button",onClick:k,className:"btn btn-secondary",disabled:v,children:"Cancel"}),e.jsx("button",{type:"submit",className:"btn btn-primary",disabled:v,children:v?"Saving...":t?"Update Customer":"Add Customer"})]})]})]})}),C&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-[60]",children:e.jsx("div",{className:"bg-white rounded-lg max-w-md w-full",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Add New City"}),e.jsx("button",{onClick:()=>{h(!1),A({name:"",state:"",country:"US",description:"",isActive:!0})},className:"p-2 text-gray-400 hover:text-gray-600",children:e.jsx(W,{className:"h-5 w-5"})})]}),e.jsxs("form",{onSubmit:Q,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"City Name *"}),e.jsx("input",{type:"text",value:f.name,onChange:s=>A({...f,name:s.target.value}),className:"input",placeholder:"Enter city name",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"State"}),e.jsx("input",{type:"text",value:f.state,onChange:s=>A({...f,state:s.target.value}),className:"input",placeholder:"Enter state"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Country"}),e.jsx("input",{type:"text",value:f.country,onChange:s=>A({...f,country:s.target.value}),className:"input",placeholder:"Enter country"})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",id:"cityIsActive",checked:f.isActive,onChange:s=>A({...f,isActive:s.target.checked}),className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),e.jsx("label",{htmlFor:"cityIsActive",className:"ml-2 block text-sm text-gray-700",children:"Active"})]}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-4 border-t border-gray-200",children:[e.jsx("button",{type:"button",onClick:()=>{h(!1),A({name:"",state:"",country:"US",description:"",isActive:!0})},className:"btn btn-secondary",disabled:$,children:"Cancel"}),e.jsx("button",{type:"submit",className:"btn btn-primary",disabled:$,children:$?"Adding...":"Add City"})]})]})]})})})]})},xs=()=>{var M,Q,F;const[t,E]=x.useState(""),[k,v]=x.useState({}),[b,j]=x.useState(!1),[m,N]=x.useState(null),[g,S]=x.useState(!1),[l,i]=x.useState(null),C={search:t,limit:999999,...k},{data:h,isLoading:f,error:A,refetch:I}=me(C,{refetchOnMountOrArgChange:!0}),[d,{isLoading:p}]=xe(),[u,{isLoading:w}]=ue(),[z,{isLoading:O}]=he(),L=n=>{N(n),j(!0)},{confirmation:Z,confirmDelete:X,handleConfirm:Y,handleCancel:$}=Se(),q=n=>{const s=n.displayName||n.businessName||n.name||n.email||"Unknown Customer";X(s,"Customer",async()=>{var a;try{await z(n._id).unwrap(),y.success("Customer deleted successfully"),I()}catch(r){y.error(((a=r==null?void 0:r.data)==null?void 0:a.message)||"Failed to delete customer")}})},P=n=>{if(p||w){y.error("Please wait for the current request to complete");return}m?u({id:m._id,...n}).unwrap().then(()=>{y.success("Customer updated successfully"),j(!1),N(null),I()}).catch(s=>{var a;y.error(((a=s==null?void 0:s.data)==null?void 0:a.message)||"Failed to update customer")}):d(n).unwrap().then(()=>{y.success("Customer created successfully"),j(!1),N(null),I()}).catch(s=>{var a,r,o,c,T;if((s==null?void 0:s.status)===409||((a=s==null?void 0:s.data)==null?void 0:a.code)==="DUPLICATE_ENTRY"){const _=((r=s==null?void 0:s.data)==null?void 0:r.message)||((c=(o=s==null?void 0:s.data)==null?void 0:o.error)==null?void 0:c.message)||"Duplicate customer detected";y.error(_)}else y.error(((T=s==null?void 0:s.data)==null?void 0:T.message)||"Failed to create customer")})},U=n=>{v(n)},D=()=>{v({}),E("")},B=()=>{j(!1),N(null)},H=((M=h==null?void 0:h.data)==null?void 0:M.customers)||(h==null?void 0:h.customers)||[],V=Ce(H,t,["name","businessName","email","phone","displayName"],{threshold:.4,minScore:.3,limit:null});return f?e.jsx(pe,{message:"Loading customers..."}):A?e.jsx("div",{className:"text-center py-12",children:e.jsx("p",{className:"text-danger-600",children:"Failed to load customers"})}):e.jsxs("div",{className:"space-y-6 w-full ",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Customers"}),e.jsx("p",{className:"text-gray-600",children:"Manage your customer database"})]}),e.jsx("div",{className:"flex-shrink-0",children:e.jsxs("button",{onClick:()=>j(!0),className:"btn btn-primary btn-md w-full sm:w-auto",children:[e.jsx(Be,{className:"h-4 w-4 mr-2"}),"Add Customer"]})})]}),e.jsx("div",{className:"flex items-center space-x-4",children:e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(le,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search customers...",value:t,onChange:n=>E(n.target.value),className:"input pl-10"})]})}),e.jsx(Me,{onImportComplete:()=>I(),filters:C}),e.jsx(_e,{filters:k,onFiltersChange:U,onClearFilters:D}),V.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(ge,{className:"mx-auto h-12 w-12 text-gray-400"}),e.jsx("h3",{className:"mt-2 text-sm font-medium text-gray-900",children:"No customers found"}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:t?"Try adjusting your search terms.":"Get started by adding a new customer."})]}):e.jsx("div",{className:"card w-full",children:e.jsxs("div",{className:"card-content p-0 w-full",children:[e.jsx("div",{className:"bg-gray-50 px-8 py-6 border-b border-gray-200",children:e.jsxs("div",{className:"grid grid-cols-12 gap-4 items-center",children:[e.jsx("div",{className:"col-span-1",children:e.jsx("h3",{className:"text-base font-medium text-gray-700",children:"ID"})}),e.jsxs("div",{className:"col-span-3",children:[e.jsx("h3",{className:"text-base font-medium text-gray-700",children:"Business Name"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Contact Person"})]}),e.jsx("div",{className:"col-span-2",children:e.jsx("h3",{className:"text-base font-medium text-gray-700",children:"Email"})}),e.jsx("div",{className:"col-span-1",children:e.jsx("h3",{className:"text-base font-medium text-gray-700",children:"Phone"})}),e.jsx("div",{className:"col-span-1",children:e.jsx("h3",{className:"text-base font-medium text-gray-700",children:"Status"})}),e.jsx("div",{className:"col-span-1",children:e.jsx("h3",{className:"text-base font-medium text-gray-700",children:"Type"})}),e.jsx("div",{className:"col-span-1",children:e.jsx("h3",{className:"text-base font-medium text-gray-700",children:"Tier"})}),e.jsx("div",{className:"col-span-1",children:e.jsx("h3",{className:"text-base font-medium text-gray-700",children:"Credit"})}),e.jsx("div",{className:"col-span-1",children:e.jsx("h3",{className:"text-base font-medium text-gray-700",children:"Actions"})})]})}),e.jsx("div",{className:"divide-y divide-gray-200",children:V.map(n=>e.jsx("div",{className:"px-8 py-6 hover:bg-gray-50",children:e.jsxs("div",{className:"grid grid-cols-12 gap-4 items-center",children:[e.jsx("div",{className:"col-span-1",children:e.jsx("p",{className:"text-xs text-gray-500 font-mono cursor-help",title:n._id,children:n._id.slice(-6)})}),e.jsx("div",{className:"col-span-3",children:e.jsxs("div",{className:"flex items-center space-x-4",children:[n.businessType==="individual"?e.jsx(ie,{className:"h-6 w-6 text-gray-400"}):e.jsx(re,{className:"h-6 w-6 text-gray-400"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-base font-medium text-gray-900",children:n.businessName||n.displayName}),e.jsx("p",{className:"text-sm text-gray-500",children:n.name})]})]})}),e.jsx("div",{className:"col-span-2",children:e.jsx("p",{className:"text-sm text-gray-600",children:n.email})}),e.jsx("div",{className:"col-span-1",children:e.jsx("p",{className:"text-sm text-gray-600",children:n.phone||"-"})}),e.jsx("div",{className:"col-span-1",children:e.jsx("span",{className:`badge ${n.status==="active"?"badge-success":"badge-gray"}`,children:n.status})}),e.jsx("div",{className:"col-span-1",children:e.jsx("span",{className:`badge ${n.businessType==="wholesale"?"badge-info":"badge-gray"}`,children:n.businessType})}),e.jsx("div",{className:"col-span-1",children:e.jsx("span",{className:`badge ${n.customerTier==="gold"?"badge-warning":n.customerTier==="platinum"?"badge-info":"badge-gray"}`,children:n.customerTier})}),e.jsx("div",{className:"col-span-1",children:e.jsx("p",{className:"text-sm text-gray-600",children:Math.round(n.creditLimit)})}),e.jsx("div",{className:"col-span-1",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("button",{onClick:()=>{i({type:"Customer",id:n._id,name:n.businessName||n.name}),S(!0)},className:"text-green-600 hover:text-green-800",title:"Notes",children:e.jsx(Ue,{className:"h-5 w-5"})}),e.jsx("button",{onClick:()=>L(n),className:"text-primary-600 hover:text-primary-800",children:e.jsx(De,{className:"h-5 w-5"})}),e.jsx("button",{onClick:()=>q(n),className:"text-danger-600 hover:text-danger-800",children:e.jsx(ze,{className:"h-5 w-5"})})]})})]})},n._id))})]})}),b&&e.jsx(Re,{customer:m,onSave:P,onCancel:B,isSubmitting:p||w}),e.jsx(we,{isOpen:Z.isOpen,onClose:$,onConfirm:Y,itemName:((F=(Q=Z.message)==null?void 0:Q.match(/"([^"]*)"/))==null?void 0:F[1])||"",itemType:"Customer",isLoading:O}),g&&l&&e.jsx(Pe,{entityType:l.type,entityId:l.id,entityName:l.name,onClose:()=>{S(!1),i(null)}})]})};export{xs as Customers};
