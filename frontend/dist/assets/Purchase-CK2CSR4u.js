import{r as i,u as We,ab as Xe,ac as Ye,a6 as Ze,a7 as He,a8 as et,a9 as tt,aa as st,R as ve,p as e,a1 as at,ad as rt,ae as nt,P as ct,A as ot,Q as x,v as lt,L as it,af as dt}from"./index-Cw3xRKpc.js";import{a as ut}from"./productsApi-DhOlFJ93.js";import{b as mt,a as xt}from"./suppliersApi-p2D2rUxB.js";import{u as pt}from"./banksApi-DWzaClHP.js";import{u as ht}from"./useFuzzySearch-ZiMs9RBo.js";import{S as je}from"./SearchableDropdown-CdqaVq-Q.js";import{P as ft}from"./PrintModal-DmgjaKQ0.js";import{g as bt}from"./ComponentRegistry-Bivjkut0.js";import{D as yt}from"./download-B8XL5QGf.js";import{P as Ne}from"./plus-DxsvPhf3.js";import{P as gt}from"./phone-D5Mv4op6.js";import{T as we}from"./trash-2-D2rrIU_x.js";import{X as vt}from"./x-circle-MQqDWFsw.js";import"./chevron-down-BKU-tyXN.js";import"./check-DKrAXHMA.js";import"./useCompanyInfo-B4fVT8rp.js";import"./settingsApi-ygxRjDN0.js";import"./printer-Bdyt47kH.js";const jt=({item:k,index:d,onUpdateQuantity:y,onUpdateCost:v,onRemove:s})=>{var w,T,f,R,_;const N=k.costPerUnit*k.quantity,E=((T=(w=k.product)==null?void 0:w.inventory)==null?void 0:T.currentStock)||0,D=((R=(f=k.product)==null?void 0:f.inventory)==null?void 0:R.reorderPoint)||0,F=E<=D;return e.jsx("div",{className:`py-1 ${d%2===0?"bg-white":"bg-gray-50"}`,children:e.jsxs("div",{className:"grid grid-cols-12 gap-4 items-center",children:[e.jsx("div",{className:"col-span-1",children:e.jsx("span",{className:"text-sm font-medium text-gray-700 bg-gray-50 px-0.5 py-1 rounded border border-gray-200 block text-center h-8 flex items-center justify-center",children:d+1})}),e.jsx("div",{className:"col-span-6 flex items-center h-8",children:e.jsxs("span",{className:"font-medium text-sm truncate",children:[((_=k.product)==null?void 0:_.name)||"Unknown Product",F&&e.jsx("span",{className:"text-yellow-600 text-xs ml-2",children:"⚠️ Low Stock"})]})}),e.jsx("div",{className:"col-span-1",children:e.jsx("span",{className:"text-sm font-semibold text-gray-700 bg-gray-100 px-2 py-1 rounded border border-gray-200 block text-center h-8 flex items-center justify-center",children:E})}),e.jsx("div",{className:"col-span-1",children:e.jsx("input",{type:"number",value:k.quantity,onChange:j=>{var U;return y((U=k.product)==null?void 0:U._id,parseInt(j.target.value)||1)},className:"input text-center h-8",min:"1"})}),e.jsx("div",{className:"col-span-1",children:e.jsx("input",{type:"number",step:"0.01",value:k.costPerUnit,onChange:j=>{var U;return v((U=k.product)==null?void 0:U._id,parseFloat(j.target.value)||0)},className:"input text-center h-8",min:"0"})}),e.jsx("div",{className:"col-span-1",children:e.jsx("span",{className:"text-sm font-semibold text-gray-700 bg-gray-100 px-2 py-1 rounded border border-gray-200 block text-center h-8 flex items-center justify-center",children:N.toFixed(2)})}),e.jsx("div",{className:"col-span-1",children:e.jsx("button",{onClick:()=>{var j;return s((j=k.product)==null?void 0:j._id)},className:"btn btn-danger btn-sm h-8 w-full",children:e.jsx(we,{className:"h-4 w-4"})})})]})})},Nt=({onAddProduct:k,onRefetchReady:d})=>{const[y,v]=i.useState(""),[s,N]=i.useState(null),[E,D]=i.useState(1),[F,w]=i.useState("0"),T=i.useRef(null),{data:f,isLoading:R,error:_,refetch:j}=ut({limit:100,status:"active"},{keepPreviousData:!0,staleTime:0,refetchOnMountOrArgChange:!0});i.useEffect(()=>{d&&j&&typeof j=="function"&&d(j)},[d,j]);const U=ve.useMemo(()=>{var m,L,B;return f?Array.isArray(f)?f:(m=f==null?void 0:f.data)!=null&&m.products?f.data.products:f!=null&&f.products?f.products:(B=(L=f==null?void 0:f.data)==null?void 0:L.data)!=null&&B.products?f.data.data.products:[]:[]},[f]),O=ht(U,y,["name","description","brand","barcode","sku"],{threshold:.4,minScore:.3,limit:10}),W=m=>{N(m),w(m.pricing.cost.toString()),v(m.name)},$=()=>{if(s){if(!F||parseFloat(F)<=0){x.error("Please enter a valid cost per unit");return}k({product:s,quantity:E,costPerUnit:parseFloat(F)}),N(null),D(1),w("0"),v(""),setTimeout(()=>{T.current&&T.current.focus()},100)}},ae=m=>e.jsxs("div",{className:"flex items-center justify-between w-full",children:[e.jsx("div",{className:"font-medium",children:m.name}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("div",{className:"text-sm text-gray-600",children:["Stock: ",m.inventory.currentStock]}),e.jsxs("div",{className:"text-sm text-gray-600",children:["Cost: $",Math.round(m.pricing.cost)]})]})]});return e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-12 gap-4 items-end",children:[e.jsxs("div",{className:"col-span-7",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Product Search"}),e.jsx(je,{ref:T,placeholder:"Search or select product...",items:O||[],onSelect:W,onSearch:m=>{v(m),s&&m!==s.name&&(N(null),w("0"))},displayKey:ae,selectedItem:s,loading:R,emptyMessage:y.length>0?"No products found":"Start typing to search products...",value:s?s.name:y,showSelected:!0})]}),e.jsxs("div",{className:"col-span-1",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Stock"}),e.jsx("span",{className:"text-sm font-semibold text-gray-700 bg-gray-100 px-2 py-1 rounded border border-gray-200 block text-center h-10 flex items-center justify-center",children:s?s.inventory.currentStock:"0"})]}),e.jsxs("div",{className:"col-span-1",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Quantity"}),e.jsx("input",{type:"number",min:"1",value:E,onChange:m=>D(parseInt(m.target.value)||1),onKeyDown:m=>{m.key==="Enter"&&s&&(m.preventDefault(),$())},className:"input text-center",placeholder:"1 (Enter to add & focus search)"})]}),e.jsxs("div",{className:"col-span-1",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Cost"}),e.jsx("input",{type:"number",step:"1",value:F,onChange:m=>w(m.target.value),onKeyDown:m=>{m.key==="Enter"&&s&&(m.preventDefault(),$())},className:"input text-center",placeholder:"0 (Enter to add & focus search)",required:!0})]}),e.jsxs("div",{className:"col-span-1",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Amount"}),e.jsx("input",{type:"text",value:s?Math.round(E*parseFloat(F||0)):"",className:"input text-center font-medium",disabled:!0,placeholder:""})]}),e.jsxs("div",{className:"col-span-1",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:" "}),e.jsxs("button",{type:"button",onClick:$,className:"w-full btn btn-primary flex items-center justify-center px-3 py-2",disabled:!s,title:"Add to cart (or press Enter in Quantity/Cost fields - focus returns to search)",children:[e.jsx(Ne,{className:"h-4 w-4 mr-2"}),"Add"]})]})]})})},zt=({tabId:k,editData:d})=>{var ye,ge;const[y,v]=i.useState([]),[s,N]=i.useState(null),[E,D]=i.useState(""),[F,w]=i.useState(""),[T,f]=i.useState(!0),[R,_]=i.useState(new Date().toISOString().split("T")[0]),[j,U]=i.useState(""),[O,W]=i.useState(!0),[$,ae]=i.useState(!1),m=i.useRef(null),[L,B]=i.useState("cash"),[I,re]=i.useState(0),[P,X]=i.useState({type:"amount",value:0}),[Pe,de]=i.useState(!1),[Se,ue]=i.useState(null),[ke,Y]=i.useState(!1),[M,Z]=i.useState("pdf"),[ne,me]=i.useState(!1),xe=(()=>{const t=new Date,a=new Date;a.setMonth(t.getMonth()-1);const n=r=>{const o=r.getFullYear(),p=String(r.getMonth()+1).padStart(2,"0"),c=String(r.getDate()).padStart(2,"0");return`${o}-${p}-${c}`};return{from:n(a),to:n(t)}})(),[z,H]=i.useState(xe.from),[ee,te]=i.useState(xe.to),{updateTabTitle:pe,getActiveTab:he,openTab:Ce}=We(),[q,Ee]=i.useState(null),[K,{data:ce,isLoading:Fe,refetch:Te}]=mt(),{data:Pt}=pt(),[Ue]=Xe(),[Me]=Ye(),[Ie]=Ze(),[$e]=He(),[Ae]=et(),[De]=tt(),[Re]=st();i.useEffect(()=>{const t=()=>{ae(window.innerWidth<768)};return t(),window.addEventListener("resize",t),()=>window.removeEventListener("resize",t)},[]),i.useEffect(()=>{m.current&&m.current.focus()},[]),i.useEffect(()=>{if(d&&d.isEditMode&&d.invoiceId&&(d.supplier&&N(d.supplier),d.invoiceNumber&&(w(d.invoiceNumber),f(!1)),d.notes&&U(d.notes),d.items&&d.items.length>0)){const t=d.items.map(a=>({product:a.product,quantity:a.quantity,costPerUnit:a.unitCost||a.costPerUnit,totalCost:a.totalCost||a.quantity*(a.unitCost||a.costPerUnit)}));v(t)}},[d==null?void 0:d.invoiceId]);const{data:G,refetch:Q}=xt(s==null?void 0:s._id,{skip:!(s!=null&&s._id),staleTime:0,refetchOnMountOrArgChange:!0});i.useEffect(()=>{G!=null&&G.data&&N(G.data)},[G]),i.useEffect(()=>{E.length>0&&K(E)},[E,K]);const C=ve.useMemo(()=>ce||{data:{suppliers:[]}},[ce]);i.useEffect(()=>{var t;if(s&&((t=C==null?void 0:C.data)!=null&&t.suppliers)){const a=C.data.suppliers.find(n=>n._id===s._id);a&&(a.pendingBalance!==s.pendingBalance||a.advanceBalance!==s.advanceBalance||a.currentBalance!==s.currentBalance)&&N(a)}},[(ye=C==null?void 0:C.data)==null?void 0:ye.suppliers]),(t=>{i.useEffect(()=>{const a=n=>{if(!n.key)return;const r=n.key.toLowerCase(),p=n.ctrlKey||n.metaKey?`ctrl+${r}`:r;t[p]&&(n.preventDefault(),t[p]())};return document.addEventListener("keydown",a),()=>document.removeEventListener("keydown",a)},[t])})({"ctrl+f":()=>{const t=document.querySelector('input[placeholder*="Search products"]');t&&(t.focus(),t.select())},"ctrl+s":()=>{const t=document.querySelector('input[placeholder*="Search suppliers"]');t&&(t.focus(),t.select())},"ctrl+p":()=>{y.length>0?(ie(),x.success("Processing purchase...")):x.error("No items to purchase")},"ctrl+enter":()=>{y.length>0?ie():x.error("No items to purchase")},escape:()=>{y.length>0&&(v([]),x.success("Purchase items cleared"))},f1:()=>{x.success("Keyboard Shortcuts: Ctrl+F (Product Search), Ctrl+S (Supplier Search), Ctrl+P (Process Purchase), Esc (Clear Items)")}});const oe=t=>{if(!t)return"";const a=new Date,n=a.getFullYear(),r=String(a.getMonth()+1).padStart(2,"0"),o=String(a.getDate()).padStart(2,"0"),p=String(a.getTime()).slice(-6),c=Math.floor(Math.random()*1e3).toString().padStart(3,"0");return`PO-${(t.companyName||t.name||"SUP").split(" ").map(h=>h.charAt(0).toUpperCase()).join("").substring(0,3)}-${n}${r}${o}-${p}-${c}`},Oe=t=>{N(t),T&&t&&w(oe(t));const a=he();a&&t&&pe(a.id,`Purchase - ${t.displayName}`),y.length>0&&!(d!=null&&d.isEditMode)&&(v([]),x.success("Purchase items cleared due to supplier change. Please re-add products."))},_e=async t=>{var a,n,r,o,p;try{const c=await Ue(t).unwrap(),g=((a=c==null?void 0:c.invoice)==null?void 0:a.invoiceNumber)||((r=(n=c==null?void 0:c.data)==null?void 0:n.invoice)==null?void 0:r.invoiceNumber)||"Unknown",S=((c==null?void 0:c.inventoryUpdates)||((o=c==null?void 0:c.data)==null?void 0:o.inventoryUpdates)||[]).filter(b=>b.success).length;if(x.success(`Purchase invoice created successfully! Invoice ${g} created and ${S} products added to inventory.`),q&&typeof q=="function")try{q()}catch(b){console.warn("Failed to refetch products:",b)}if(Q&&typeof Q=="function")try{Q().then(b=>{var u;(u=b==null?void 0:b.data)!=null&&u.data&&N(b.data.data)}).catch(b=>{console.warn("Failed to refetch supplier:",b)})}catch(b){console.warn("Failed to call refetchSupplier:",b)}if(s&&K){const b=s.companyName||s.name||"";b&&K(b)}v([]),re(0),B("cash"),w(""),_(new Date().toISOString().split("T")[0]),U("");const h=he();h&&pe(h.id,"Purchase")}catch(c){x.error(((p=c==null?void 0:c.data)==null?void 0:p.message)||(c==null?void 0:c.message)||"Failed to complete purchase")}},Le=async(t,a)=>{var n,r,o,p,c,g;try{const l=await Me({id:t,...a}).unwrap(),S=((n=l==null?void 0:l.invoice)==null?void 0:n.invoiceNumber)||((o=(r=l==null?void 0:l.data)==null?void 0:r.invoice)==null?void 0:o.invoiceNumber)||"Unknown",b=((l==null?void 0:l.inventoryUpdates)||((p=l==null?void 0:l.data)==null?void 0:p.inventoryUpdates)||[]).filter(u=>u.success).length;if(x.success(`Purchase invoice updated successfully! Invoice ${S} updated and ${b} products adjusted in inventory.`),q&&typeof q=="function")try{q()}catch(u){console.warn("Failed to refetch products:",u)}if(s!=null&&s._id&&Q&&typeof Q=="function")try{Q().then(u=>{var V;(V=u==null?void 0:u.data)!=null&&V.data&&N(u.data.data)}).catch(u=>{var V;(V=u==null?void 0:u.message)!=null&&V.includes("has not been started")||console.warn("Failed to refetch supplier:",u)})}catch(u){(c=u==null?void 0:u.message)!=null&&c.includes("has not been started")||console.warn("Failed to call refetchSupplier:",u)}if(s&&K)try{const u=s.companyName||s.name||"";u&&K(u)}catch(u){console.warn("Failed to search suppliers:",u)}}catch(l){x.error(((g=l==null?void 0:l.data)==null?void 0:g.message)||(l==null?void 0:l.message)||"Failed to update purchase")}},Be=()=>{if(O||!s)return 0;const t=y.reduce((n,r)=>n+r.costPerUnit*r.quantity,0);let a=0;switch(s.businessType){case"manufacturer":a=.06;break;case"distributor":a=.07;break;case"wholesaler":a=.08;break;case"dropshipper":a=.05;break;default:a=.08}return s.rating>=5&&s.reliability==="excellent"&&(a*=.5),t*a},J=y.reduce((t,a)=>t+a.costPerUnit*a.quantity,0),se=Be(),le=P.type==="percentage"?J*P.value/100:P.value,A=J+se-le,fe=(s==null?void 0:s.pendingBalance)||0,qe=A+fe,Ke=t=>{v(a=>{var r;const n=a.find(o=>{var p,c;return((p=o.product)==null?void 0:p._id)===((c=t.product)==null?void 0:c._id)});return n?window.confirm(`"${((r=t.product)==null?void 0:r.name)||"Unknown Product"}" is already in the cart (Qty: ${n.quantity}).

Do you want to add ${t.quantity} more units?`)?a.map(p=>{var c,g;return((c=p.product)==null?void 0:c._id)===((g=t.product)==null?void 0:g._id)?{...p,quantity:p.quantity+t.quantity,costPerUnit:t.costPerUnit}:p}):a:[...a,t]})},Qe=(t,a)=>{if(a<=0){be(t);return}v(n=>n.map(r=>{var o;return((o=r.product)==null?void 0:o._id)===t?{...r,quantity:a}:r}))},ze=(t,a)=>{v(n=>n.map(r=>{var o;return((o=r.product)==null?void 0:o._id)===t?{...r,costPerUnit:a}:r}))},be=t=>{v(a=>a.filter(n=>{var r;return((r=n.product)==null?void 0:r._id)!==t}))},Ge=()=>{v(t=>{if(!t||t.length<2)return t;const a=r=>{const o=r.product;return o?typeof o=="string"?o:o.name||o.title||o.displayName||o.businessName||o.fullName||"":""};return[...t].sort((r,o)=>{const p=a(r).toString().toLowerCase(),c=a(o).toString().toLowerCase();return p<c?-1:p>c?1:0})})},Je=()=>{Y(!0)},Ve=async()=>{var t,a,n;me(!0);try{const r={...(s==null?void 0:s._id)&&{supplier:s._id},...z&&{dateFrom:z},...ee&&{dateTo:ee}};let o;if(M==="excel"?o=await Ie(r).unwrap():M==="csv"?o=await $e(r).unwrap():M==="json"?o=await De(r).unwrap():M==="pdf"&&(o=await Ae(r).unwrap()),o!=null&&o.filename||(t=o==null?void 0:o.data)!=null&&t.filename){const p=o.filename||o.data.filename;try{M==="pdf"&&await new Promise(l=>setTimeout(l,500));let c;try{c=await Re(p).unwrap()}catch(l){const S=(l==null?void 0:l.data)||((a=l==null?void 0:l.response)==null?void 0:a.data);if(S instanceof Blob){const h=new FileReader;h.onload=()=>{const b=h.result;try{const u=JSON.parse(b);x.error(u.message||"Download failed")}catch{x.error("Download failed")}},h.readAsText(S)}else typeof S=="object"&&S!==null?x.error(S.message||"Download failed"):x.error((l==null?void 0:l.message)||"Download failed");return}if(!c){x.error("Download failed: No data received from server");return}const g=c instanceof Blob?c:c.data;if(M==="pdf"){if(!g||!(g instanceof Blob)){x.error("Invalid PDF file received");return}if(g.size===0){x.error("PDF file is empty");return}if(g.type&&(g.type.includes("application/json")||g.type.includes("text/html"))){const h=new FileReader;h.onload=()=>{const b=h.result;try{const u=JSON.parse(b);x.error(u.message||"File not found or generation failed")}catch{x.error("Server returned error instead of PDF. Please try again.")}},h.readAsText(g);return}const l=URL.createObjectURL(g);if(window.open(l,"_blank"))x.success("PDF opened in new tab");else{const h=document.createElement("a");h.href=l,h.download=p,document.body.appendChild(h),h.click(),document.body.removeChild(h),x.success("PDF downloaded (popup was blocked)")}setTimeout(()=>URL.revokeObjectURL(l),1e4)}else{const l=c instanceof Blob?c:c.data,S=URL.createObjectURL(l),h=document.createElement("a");h.href=S,h.download=p,document.body.appendChild(h),h.click(),document.body.removeChild(h),setTimeout(()=>URL.revokeObjectURL(S),100),x.success(`${M.toUpperCase()} file downloaded successfully`)}Y(!1)}catch{x.error("Failed to download file")}}else x.error("Export failed: No filename received")}catch(r){x.error("Failed to export purchase data: "+(((n=r==null?void 0:r.data)==null?void 0:n.message)||(r==null?void 0:r.message)||"Unknown error"))}finally{me(!1)}},ie=()=>{if(y.length===0){x.error("No items to purchase");return}if(!s){x.error("Please select a supplier");return}let t=F;(!t||t.trim()==="")&&T&&(t=oe(s),w(t)),(!t||t.trim()==="")&&(t=oe(s),w(t));const a={supplier:s._id,supplierInfo:{name:s.name,email:s.email,phone:s.phone,companyName:s.companyName,address:s.address},items:y.map(n=>{var r;return{product:(r=n.product)==null?void 0:r._id,quantity:n.quantity,unitCost:n.costPerUnit,totalCost:n.quantity*n.costPerUnit}}),pricing:{subtotal:J,discountAmount:0,taxAmount:se,isTaxExempt:O,total:A},payment:{method:L,amount:I,remainingBalance:Math.max(0,A-I),isPartialPayment:I>0&&I<A,status:I>=A?"paid":I>0?"partial":"pending"},invoiceNumber:t,expectedDelivery:R,notes:j,terms:""};d!=null&&d.isEditMode?Le(d.invoiceId,a):_e(a)};return e.jsx(e.Fragment,{children:e.jsxs("div",{className:"space-y-4 lg:space-y-6",children:[e.jsxs("div",{className:`flex ${$?"flex-col space-y-4":"items-start justify-between"}`,children:[e.jsxs("div",{children:[e.jsx("h1",{className:`${$?"text-xl":"text-2xl"} font-bold text-gray-900`,children:"Purchase"}),e.jsx("p",{className:"text-gray-600",children:"Process purchase transactions"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("button",{onClick:Je,className:"btn btn-secondary btn-md",title:"Export Purchase Report",children:[e.jsx(yt,{className:"h-4 w-4 mr-2"}),"Export Purchase Report"]}),e.jsxs("button",{onClick:()=>{const t=bt("/purchase");if(t){const a=`tab_${Date.now()}_${Math.random().toString(36).substr(2,9)}`;Ce({title:"Purchase",path:"/purchase",component:t.component,icon:t.icon,allowMultiple:!0,props:{tabId:a}})}},className:"btn btn-primary btn-md",children:[e.jsx(Ne,{className:"h-4 w-4 mr-2"}),"New Purchase"]})]})]}),e.jsxs("div",{className:`flex ${$?"flex-col space-y-4":"items-start space-x-4"}`,children:[e.jsxs("div",{className:`${$?"w-full":"w-[500px] flex-shrink-0"}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Select Supplier"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[s&&e.jsx("button",{onClick:()=>{N(null),D(""),setTimeout(()=>{m.current&&m.current.focus()},100)},className:"text-xs text-blue-600 hover:text-blue-800 underline",title:"Change supplier",children:"Change Supplier"}),e.jsx("button",{onClick:()=>Te(),className:"text-xs text-blue-600 hover:text-blue-800 underline",title:"Refresh supplier data",children:"Refresh"})]})]}),e.jsx(je,{ref:m,placeholder:"Search suppliers by name, email, or business...",items:((ge=C==null?void 0:C.data)==null?void 0:ge.suppliers)||(C==null?void 0:C.suppliers)||[],onSelect:Oe,onSearch:D,displayKey:t=>e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:t.displayName}),e.jsxs("div",{className:"text-sm text-gray-600",children:["Outstanding Balance: $",(t.pendingBalance||0).toFixed(2)]})]}),selectedItem:s,loading:Fe,emptyMessage:E.length>0?"No suppliers found":"Start typing to search suppliers..."})]}),e.jsx("div",{className:`${$?"w-full":"flex-1"}`,children:s?e.jsx("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-3",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(at,{className:"h-5 w-5 text-gray-400"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium",children:s.displayName||s.name||s.companyName||"Unknown Supplier"}),e.jsx("p",{className:"text-sm text-gray-600 capitalize",children:s.businessType&&s.reliability?`${s.businessType} • ${s.reliability}`:s.businessType||s.reliability||"Supplier Information"}),e.jsxs("div",{className:"flex items-center space-x-4 mt-2",children:[e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("span",{className:"text-xs text-gray-500",children:"Outstanding Balance:"}),e.jsxs("span",{className:`text-sm font-medium ${(s.pendingBalance||0)>0?"text-red-600":"text-green-600"}`,children:["$",Math.round(s.pendingBalance||0)]})]}),s.phone&&e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(gt,{className:"h-3 w-3 text-gray-400"}),e.jsx("span",{className:"text-xs text-gray-500",children:s.phone})]}),s.email&&e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(rt,{className:"h-3 w-3 text-gray-400"}),e.jsx("span",{className:"text-xs text-gray-500",children:s.email})]})]}),s.address&&e.jsxs("div",{className:"flex items-center space-x-1 mt-1",children:[e.jsx(nt,{className:"h-3 w-3 text-gray-400"}),e.jsx("span",{className:"text-xs text-gray-500",children:s.address})]})]})]})}):e.jsx("div",{className:"hidden lg:block"})})]}),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Product Selection & Cart"})}),e.jsxs("div",{className:"card-content",children:[e.jsx("div",{className:"mb-6",children:e.jsx(Nt,{onAddProduct:Ke,onRefetchReady:Ee})}),y.length===0?e.jsxs("div",{className:"p-8 text-center text-gray-500 border-t border-gray-200",children:[e.jsx(ct,{className:"mx-auto h-12 w-12 text-gray-400"}),e.jsx("p",{className:"mt-2",children:"No items in cart"})]}):e.jsxs("div",{className:"space-y-4 border-t border-gray-200 pt-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h4",{className:"text-md font-medium text-gray-700",children:"Cart Items"}),e.jsxs("button",{type:"button",onClick:Ge,className:"btn btn-secondary btn-sm flex items-center space-x-2",title:"Sort products alphabetically",children:[e.jsx(ot,{className:"h-4 w-4"}),e.jsx("span",{children:"Sort A-Z"})]})]}),y.map((t,a)=>{var n;return e.jsx(jt,{item:t,index:a,onUpdateQuantity:Qe,onUpdateCost:ze,onRemove:be},(n=t.product)==null?void 0:n._id)})]})]})]}),y.length>0&&e.jsxs("div",{className:"bg-gradient-to-br from-blue-50 to-indigo-50 border-2 border-blue-200 rounded-lg max-w-5xl ml-auto mt-4",children:[e.jsxs("div",{className:"px-6 py-4 border-b border-blue-200",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 text-right mb-4",children:"Purchase Details"}),e.jsxs("div",{className:"flex flex-nowrap gap-3 items-end justify-end",children:[e.jsxs("div",{className:"flex flex-col w-44",children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Invoice Number"}),e.jsx("input",{type:"text",value:F,onChange:t=>w(t.target.value),className:"input h-8 text-sm",placeholder:T?"Auto-generated":"Enter invoice number",disabled:T})]}),e.jsxs("div",{className:"flex flex-col w-48",children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Expected Delivery"}),e.jsx("input",{type:"date",value:R,onChange:t=>_(t.target.value),className:"input h-8 text-sm"})]}),e.jsxs("div",{className:"flex flex-col w-40",children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Tax Status"}),e.jsxs("div",{className:"flex items-center space-x-1 px-2 py-1 border border-gray-200 rounded h-8",children:[e.jsx("input",{type:"checkbox",id:"taxExempt",checked:O,onChange:t=>W(t.target.checked),className:"h-3 w-3 text-primary-600 focus:ring-primary-500 border-gray-300 rounded"}),e.jsx("div",{className:"flex-1",children:e.jsx("label",{htmlFor:"taxExempt",className:"text-xs font-medium text-gray-700 cursor-pointer",children:"Tax Exempt"})}),O&&e.jsx("div",{className:"text-green-600 text-xs font-medium",children:"✓"})]})]}),e.jsxs("div",{className:"flex flex-col w-[28rem]",children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Notes"}),e.jsx("input",{type:"text",value:j,onChange:t=>U(t.target.value),className:"input h-8 text-sm",placeholder:"Additional notes..."})]})]})]}),e.jsx("div",{className:"bg-gradient-to-r from-blue-500 to-indigo-600 px-6 py-4",children:e.jsx("h3",{className:"text-lg font-semibold text-white",children:"Order Summary"})}),e.jsxs("div",{className:"px-6 py-4",children:[e.jsxs("div",{className:"space-y-3 mb-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-800 font-semibold",children:"Subtotal:"}),e.jsx("span",{className:"text-xl font-bold text-gray-900",children:J.toFixed(2)})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-800 font-semibold",children:O?"Tax (Exempt):":"Tax (8%):"}),e.jsx("span",{className:"text-xl font-bold text-gray-900",children:se.toFixed(2)})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-800 font-semibold",children:"Purchase Total:"}),e.jsx("span",{className:"text-xl font-bold text-gray-900",children:A.toFixed(2)})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-800 font-semibold",children:"Previous Outstanding:"}),e.jsx("span",{className:"text-xl font-bold text-red-600",children:fe.toFixed(2)})]}),e.jsxs("div",{className:"flex justify-between items-center text-xl font-bold border-t-2 border-blue-400 pt-3 mt-2",children:[e.jsx("span",{className:"text-blue-900",children:"Total Payables:"}),e.jsx("span",{className:"text-blue-900 text-3xl",children:qe.toFixed(2)})]})]}),e.jsxs("div",{className:"bg-white rounded-lg p-4 shadow-sm",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 items-start",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-800 mb-2",children:"Apply Discount"}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs("select",{value:P.type,onChange:t=>X({...P,type:t.target.value}),className:"px-3 py-2 border-2 border-blue-200 rounded-md bg-blue-50 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 font-medium h-[42px]",children:[e.jsx("option",{value:"amount",children:"Amount"}),e.jsx("option",{value:"percentage",children:"%"})]}),e.jsx("input",{type:"number",placeholder:P.type==="amount"?"Enter amount...":"Enter percentage...",value:P.value||"",onChange:t=>{const a=parseFloat(t.target.value)||0;X({...P,value:a})},className:"flex-1 px-3 py-2 border-2 border-blue-200 rounded-md bg-blue-50 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 font-medium text-gray-900 h-[42px]",min:"0",step:P.type==="percentage"?"0.1":"0.01"})]}),P.value>0&&e.jsx("div",{className:"text-sm text-green-700 font-semibold mt-2 bg-green-50 px-2 py-1 rounded",children:P.type==="percentage"?`${P.value}% = ${le.toFixed(2)} off`:`${P.value} off`})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-800 mb-2",children:"Payment Method"}),e.jsxs("select",{value:L,onChange:t=>B(t.target.value),className:"w-full px-3 py-2 border-2 border-blue-200 rounded-md bg-blue-50 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 font-medium text-gray-900 h-[42px]",children:[e.jsx("option",{value:"cash",children:"Cash"}),e.jsx("option",{value:"credit_card",children:"Credit Card"}),e.jsx("option",{value:"debit_card",children:"Debit Card"}),e.jsx("option",{value:"check",children:"Check"})]})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-800 mb-2",children:"Amount Paid"}),e.jsx("input",{type:"number",step:"0.01",value:I,onChange:t=>re(parseFloat(t.target.value)||0),onFocus:t=>t.target.select(),className:"w-full px-3 py-2 border-2 border-blue-200 rounded-md bg-blue-50 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 font-medium text-gray-900 text-lg h-[42px]",placeholder:"0.00"})]})]}),P.value>0&&e.jsx("div",{className:"mt-2",children:e.jsx("button",{onClick:()=>X({type:"amount",value:0}),className:"px-3 py-1 bg-red-600 text-white rounded-md hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-red-500 text-sm",children:"Clear Discount"})})]})]}),e.jsxs("div",{className:"flex space-x-3 mt-6 px-6 pb-6",children:[y.length>0&&e.jsxs("button",{onClick:()=>{v([]),N(null),D(""),W(!0),X({type:"amount",value:0}),re(0),B("cash"),x.success("Cart cleared")},className:"btn btn-secondary flex-1",children:[e.jsx(we,{className:"h-4 w-4 mr-2"}),"Clear Cart"]}),y.length>0&&e.jsxs("button",{onClick:()=>{const t={orderNumber:`PO-${Date.now()}`,orderType:"purchase",supplier:s==null?void 0:s._id,customer:s,customerInfo:s?{name:s.displayName,email:s.email,phone:s.phone,address:s.address||s.companyAddress||s.location,businessName:s.companyName}:null,items:y.map(a=>{var n;return{product:{name:((n=a.product)==null?void 0:n.name)||"Unknown Product"},quantity:a.quantity,unitPrice:a.costPerUnit}}),pricing:{subtotal:J,discountAmount:le,taxAmount:se,isTaxExempt:O,total:A},payment:{method:L,amountPaid:I,remainingBalance:A-I,isPartialPayment:I<A},createdAt:new Date,createdBy:{name:"Current User"},invoiceNumber:F,expectedDelivery:R,notes:j};ue(t),de(!0)},className:"btn btn-secondary flex-1",children:[e.jsx(lt,{className:"h-4 w-4 mr-2"}),"Print Preview"]}),e.jsxs(it,{onClick:ie,isLoading:!1,className:"btn btn-primary btn-lg flex-2",children:[e.jsx(dt,{className:"h-4 w-4 mr-2"}),d!=null&&d.isEditMode?"Update Purchase Invoice":"Complete Purchase & Update Inventory"]})]})]}),e.jsx(ft,{isOpen:Pe,onClose:()=>{de(!1),ue(null)},orderData:Se,documentTitle:"Purchase Invoice",partyLabel:"Supplier"}),ke&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-lg w-full",children:[e.jsxs("div",{className:"flex justify-between items-center p-6 border-b border-gray-200",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Export Purchase Report"}),e.jsx("button",{onClick:()=>{Y(!1),H(""),te("")},className:"text-gray-400 hover:text-gray-600 transition-colors",children:e.jsx(vt,{className:"h-6 w-6"})})]}),e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"Export Format"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("label",{className:"flex items-center p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-gray-50",children:[e.jsx("input",{type:"radio",name:"format",value:"pdf",checked:M==="pdf",onChange:t=>Z(t.target.value),className:"mr-3"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900",children:"PDF"}),e.jsx("div",{className:"text-sm text-gray-500",children:"Print-ready format"})]})]}),e.jsxs("label",{className:"flex items-center p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-gray-50",children:[e.jsx("input",{type:"radio",name:"format",value:"excel",checked:M==="excel",onChange:t=>Z(t.target.value),className:"mr-3"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900",children:"Excel"}),e.jsx("div",{className:"text-sm text-gray-500",children:"Spreadsheet format"})]})]}),e.jsxs("label",{className:"flex items-center p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-gray-50",children:[e.jsx("input",{type:"radio",name:"format",value:"csv",checked:M==="csv",onChange:t=>Z(t.target.value),className:"mr-3"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900",children:"CSV"}),e.jsx("div",{className:"text-sm text-gray-500",children:"Comma-separated values"})]})]}),e.jsxs("label",{className:"flex items-center p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-gray-50",children:[e.jsx("input",{type:"radio",name:"format",value:"json",checked:M==="json",onChange:t=>Z(t.target.value),className:"mr-3"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900",children:"JSON"}),e.jsx("div",{className:"text-sm text-gray-500",children:"Data format"})]})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"Date Range (Optional)"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-600 mb-1",children:"From Date"}),e.jsx("input",{type:"date",value:z,onChange:t=>H(t.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-primary-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-600 mb-1",children:"To Date"}),e.jsx("input",{type:"date",value:ee,onChange:t=>te(t.target.value),min:z,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-primary-500"})]})]}),(z||ee)&&e.jsx("button",{type:"button",onClick:()=>{H(""),te("")},className:"mt-2 text-sm text-primary-600 hover:text-primary-700",children:"Clear dates"})]}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-4 border-t border-gray-200",children:[e.jsx("button",{onClick:()=>{Y(!1),H(""),te("")},className:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50",disabled:ne,children:"Cancel"}),e.jsx("button",{onClick:Ve,disabled:ne,className:"px-4 py-2 text-sm font-medium text-white bg-primary-600 border border-transparent rounded-md hover:bg-primary-700 disabled:opacity-50 disabled:cursor-not-allowed",children:ne?"Exporting...":"Export"})]})]})})]})})]})})};export{zt as Purchase};
