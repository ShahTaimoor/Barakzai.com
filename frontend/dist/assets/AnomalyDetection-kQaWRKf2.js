import{r as q,c as w,o as e,N as M,R as D,I as i,G as _,P as o,av as A,ak as C,aM as Q,p as U,x as G,w as H,aY as S}from"./index-jd7Ax_Ed.js";import{X as I}from"./x-circle-CN1zMonK.js";import{A as T}from"./alert-circle-yrAHCiEw.js";import{I as m}from"./info-D4lm7fBv.js";import{F as V}from"./filter-CQLYjJyW.js";import{E as X}from"./eye-DMmE8Niy.js";const W=()=>{var h,p,u,g,j;const[t,r]=q.useState({type:"",severity:"",startDate:new Date(Date.now()-2592e6).toISOString().split("T")[0],endDate:new Date().toISOString().split("T")[0]}),{data:a,isLoading:P,error:$,refetch:k}=w(["anomalyDetection",t],()=>S.getAnomalies({startDate:t.startDate,endDate:t.endDate,type:t.type||void 0,severity:t.severity||void 0}),{refetchInterval:6e4,onError:s=>{G(H(s))}}),{data:l}=w("anomalyDetectionSummary",()=>S.getSummary(),{refetchInterval:6e4,onError:()=>{}}),n=((h=a==null?void 0:a.data)==null?void 0:h.anomalies)||[],c=(l==null?void 0:l.data)||{},x={critical:"bg-red-100 text-red-800 border-red-300",high:"bg-orange-100 text-orange-800 border-orange-300",medium:"bg-yellow-100 text-yellow-800 border-yellow-300",low:"bg-blue-100 text-blue-800 border-blue-300"},E={critical:I,high:i,medium:T,low:m},L={large_transaction:"Large Transaction",rapid_transactions:"Rapid Transactions",unusual_discount:"Unusual Discount",price_anomaly:"Price Anomaly",quantity_anomaly:"Quantity Anomaly",customer_anomaly:"Customer Anomaly",new_customer_large_transaction:"New Customer Large Transaction",negative_stock:"Negative Stock",sudden_stock_drop:"Sudden Stock Drop",duplicate_payment:"Duplicate Payment",large_payment:"Large Payment"},O={large_transaction:C,rapid_transactions:D,unusual_discount:Q,price_anomaly:C,quantity_anomaly:o,customer_anomaly:A,new_customer_large_transaction:A,negative_stock:o,sudden_stock_drop:o,duplicate_payment:_,large_payment:_};return P?e.jsx(M,{}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between space-y-4 sm:space-y-0",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Anomaly Detection & Fraud Prevention"}),e.jsx("p",{className:"text-gray-600",children:"AI-powered detection of unusual patterns and potential fraud"})]}),e.jsx("div",{className:"flex items-center space-x-3",children:e.jsxs("button",{onClick:()=>k(),className:"btn btn-secondary flex items-center",children:[e.jsx(D,{className:"h-4 w-4 mr-2"}),"Refresh"]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx("div",{className:"bg-white rounded-lg shadow p-4 border-l-4 border-red-500",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Critical Anomalies"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:((p=c.summary)==null?void 0:p.critical)||0})]}),e.jsx(I,{className:"h-8 w-8 text-red-400"})]})}),e.jsx("div",{className:"bg-white rounded-lg shadow p-4 border-l-4 border-orange-500",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"High Priority"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:((u=c.summary)==null?void 0:u.high)||0})]}),e.jsx(i,{className:"h-8 w-8 text-orange-400"})]})}),e.jsx("div",{className:"bg-white rounded-lg shadow p-4 border-l-4 border-yellow-500",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Medium Priority"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:((g=c.summary)==null?void 0:g.medium)||0})]}),e.jsx(T,{className:"h-8 w-8 text-yellow-400"})]})}),e.jsx("div",{className:"bg-white rounded-lg shadow p-4 border-l-4 border-blue-500",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Total Anomalies"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:((j=a==null?void 0:a.data)==null?void 0:j.total)||0})]}),e.jsx(m,{className:"h-8 w-8 text-blue-400"})]})})]}),e.jsx("div",{className:"bg-white rounded-lg shadow p-4",children:e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center space-y-3 sm:space-y-0 sm:space-x-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(V,{className:"h-5 w-5 text-gray-400"}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Filters:"})]}),e.jsxs("select",{value:t.type,onChange:s=>r({...t,type:s.target.value}),className:"input",children:[e.jsx("option",{value:"",children:"All Types"}),Object.entries(L).map(([s,d])=>e.jsx("option",{value:s,children:d},s))]}),e.jsxs("select",{value:t.severity,onChange:s=>r({...t,severity:s.target.value}),className:"input",children:[e.jsx("option",{value:"",children:"All Severities"}),e.jsx("option",{value:"critical",children:"Critical"}),e.jsx("option",{value:"high",children:"High"}),e.jsx("option",{value:"medium",children:"Medium"}),e.jsx("option",{value:"low",children:"Low"})]}),e.jsx("input",{type:"date",value:t.startDate,onChange:s=>r({...t,startDate:s.target.value}),className:"input"}),e.jsx("input",{type:"date",value:t.endDate,onChange:s=>r({...t,endDate:s.target.value}),className:"input"}),e.jsx("button",{onClick:()=>r({type:"",severity:"",startDate:new Date(Date.now()-30*24*60*60*1e3).toISOString().split("T")[0],endDate:new Date().toISOString().split("T")[0]}),className:"btn btn-secondary text-sm",children:"Clear Filters"})]})}),n.length>0?e.jsxs("div",{className:"bg-white rounded-lg shadow overflow-hidden",children:[e.jsx("div",{className:"px-6 py-4 border-b border-gray-200",children:e.jsxs("h2",{className:"text-lg font-semibold text-gray-900",children:["Detected Anomalies (",n.length,")"]})}),e.jsx("div",{className:"divide-y divide-gray-200",children:n.map((s,d)=>{var y,N,v,b;E[s.severity]||m;const F=O[s.type]||i;return e.jsx("div",{className:"p-6 hover:bg-gray-50 transition-colors",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-2",children:[e.jsx(F,{className:"h-5 w-5 text-gray-400"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:s.title}),e.jsx("span",{className:`px-2 py-1 text-xs font-semibold rounded-full border ${x[s.severity]||x.low}`,children:s.severity.toUpperCase()})]}),e.jsx("p",{className:"text-sm text-gray-600 mb-3",children:s.description}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:[s.amount&&e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Amount:"}),e.jsx("span",{className:"ml-2 font-semibold text-gray-900",children:U(s.amount)})]}),s.date&&e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Date:"}),e.jsx("span",{className:"ml-2 font-semibold text-gray-900",children:new Date(s.date).toLocaleDateString()})]}),s.customer&&e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Customer:"}),e.jsx("span",{className:"ml-2 font-semibold text-gray-900",children:((y=s.customer)==null?void 0:y.businessName)||((N=s.customer)==null?void 0:N.name)||"N/A"})]}),s.product&&e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Product:"}),e.jsx("span",{className:"ml-2 font-semibold text-gray-900",children:((v=s.product)==null?void 0:v.name)||((b=s.product)==null?void 0:b.sku)||"N/A"})]}),s.discountPercentage&&e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Discount:"}),e.jsxs("span",{className:"ml-2 font-semibold text-gray-900",children:[s.discountPercentage,"%"]})]}),s.quantity&&e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Quantity:"}),e.jsx("span",{className:"ml-2 font-semibold text-gray-900",children:s.quantity})]})]}),s.metadata&&Object.keys(s.metadata).length>0&&e.jsx("div",{className:"mt-3 pt-3 border-t border-gray-200",children:e.jsxs("details",{className:"text-sm",children:[e.jsx("summary",{className:"text-gray-500 cursor-pointer hover:text-gray-700",children:"View Details"}),e.jsx("div",{className:"mt-2 space-y-1",children:Object.entries(s.metadata).map(([f,R])=>e.jsxs("div",{className:"flex",children:[e.jsxs("span",{className:"text-gray-500 capitalize",children:[f.replace(/([A-Z])/g," $1").trim(),":"]}),e.jsx("span",{className:"ml-2 text-gray-900",children:String(R)})]},f))})]})})]}),e.jsx("div",{className:"ml-4",children:s.transactionId&&e.jsx("button",{className:"btn btn-outline btn-sm",title:"View Transaction",children:e.jsx(X,{className:"h-4 w-4"})})})]})},d)})})]}):e.jsxs("div",{className:"bg-white rounded-lg shadow p-12 text-center",children:[e.jsx(i,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No Anomalies Detected"}),e.jsx("p",{className:"text-gray-600",children:t.type||t.severity?"No anomalies match your current filters. Try adjusting your filters.":"Great! No suspicious activities detected in the selected period."})]})]})};export{W as default};
