import{bS as v,bQ as x,bT as j,bU as b,bV as y,R as c,bW as R,bX as N,bY as w,bZ as M,r as f,p as e,x as p,y as O,B as S,z as E}from"./index-WAoT78o_.js";import{C}from"./check-circle-Bs4hD_Mn.js";import{A as U}from"./alert-circle-ipmQBT-s.js";var T=function(a){v(o,a);function o(n,s){var t;return t=a.call(this)||this,t.client=n,t.setOptions(s),t.bindMethods(),t.updateResult(),t}var i=o.prototype;return i.bindMethods=function(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)},i.setOptions=function(s){this.options=this.client.defaultMutationOptions(s)},i.onUnsubscribe=function(){if(!this.listeners.length){var s;(s=this.currentMutation)==null||s.removeObserver(this)}},i.onMutationUpdate=function(s){this.updateResult();var t={listeners:!0};s.type==="success"?t.onSuccess=!0:s.type==="error"&&(t.onError=!0),this.notify(t)},i.getCurrentResult=function(){return this.currentResult},i.reset=function(){this.currentMutation=void 0,this.updateResult(),this.notify({listeners:!0})},i.mutate=function(s,t){return this.mutateOptions=t,this.currentMutation&&this.currentMutation.removeObserver(this),this.currentMutation=this.client.getMutationCache().build(this.client,x({},this.options,{variables:typeof s<"u"?s:this.options.variables})),this.currentMutation.addObserver(this),this.currentMutation.execute()},i.updateResult=function(){var s=this.currentMutation?this.currentMutation.state:j(),t=x({},s,{isLoading:s.status==="loading",isSuccess:s.status==="success",isError:s.status==="error",isIdle:s.status==="idle",mutate:this.mutate,reset:this.reset});this.currentResult=t},i.notify=function(s){var t=this;b.batch(function(){t.mutateOptions&&(s.onSuccess?(t.mutateOptions.onSuccess==null||t.mutateOptions.onSuccess(t.currentResult.data,t.currentResult.variables,t.currentResult.context),t.mutateOptions.onSettled==null||t.mutateOptions.onSettled(t.currentResult.data,null,t.currentResult.variables,t.currentResult.context)):s.onError&&(t.mutateOptions.onError==null||t.mutateOptions.onError(t.currentResult.error,t.currentResult.variables,t.currentResult.context),t.mutateOptions.onSettled==null||t.mutateOptions.onSettled(void 0,t.currentResult.error,t.currentResult.variables,t.currentResult.context))),s.listeners&&t.listeners.forEach(function(r){r(t.currentResult)})})},o}(y);function k(a,o,i){var n=c.useRef(!1),s=c.useState(0),t=s[1],r=R(a,o,i),d=N(),u=c.useRef();u.current?u.current.setOptions(r):u.current=new T(d,r);var l=u.current.getCurrentResult();c.useEffect(function(){n.current=!0;var h=u.current.subscribe(b.batchCalls(function(){n.current&&t(function(m){return m+1})}));return function(){n.current=!1,h()}},[]);var g=c.useCallback(function(h,m){u.current.mutate(h,m).catch(w)},[]);if(l.error&&M(void 0,u.current.options.useErrorBoundary,[l.error]))throw l.error;return x({},l,{mutate:g,mutateAsync:l.mutate})}const _=()=>{const[a,o]=f.useState(null),[i,n]=f.useState(!1),s=k(async()=>{const r=await fetch("/api/migration/update-invoice-prefix",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`}});if(!r.ok)throw new Error("Migration failed");return r.json()},{onSuccess:r=>{o(r),r.success?S(r.message):E(r.message),n(!1)},onError:r=>{O(r,"Migration"),n(!1)}}),t=()=>{window.confirm("Are you sure you want to update all ORD- invoices to SI- format? This action cannot be undone.")&&(n(!0),o(null),s.mutate())};return e.jsx("div",{className:"max-w-4xl mx-auto p-6",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Invoice Prefix Migration"}),e.jsx("p",{className:"text-gray-600",children:"Update existing ORD- invoices to SI- format"})]}),e.jsxs("button",{onClick:t,disabled:i,className:"btn btn-primary flex items-center space-x-2",children:[i?e.jsx(p,{className:"h-4 w-4 animate-spin"}):e.jsx(p,{className:"h-4 w-4"}),e.jsx("span",{children:i?"Running Migration...":"Run Migration"})]})]}),a&&e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 mb-6",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-4",children:[a.success?e.jsx(C,{className:"h-5 w-5 text-green-600"}):e.jsx(U,{className:"h-5 w-5 text-red-600"}),e.jsx("h3",{className:"font-semibold text-gray-900",children:"Migration Results"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-4",children:[e.jsxs("div",{className:"bg-white p-3 rounded border",children:[e.jsx("div",{className:"text-sm text-gray-600",children:"Total Found"}),e.jsx("div",{className:"text-2xl font-bold text-gray-900",children:a.total||0})]}),e.jsxs("div",{className:"bg-white p-3 rounded border",children:[e.jsx("div",{className:"text-sm text-gray-600",children:"Updated"}),e.jsx("div",{className:"text-2xl font-bold text-green-600",children:a.updated||0})]}),e.jsxs("div",{className:"bg-white p-3 rounded border",children:[e.jsx("div",{className:"text-sm text-gray-600",children:"Skipped"}),e.jsx("div",{className:"text-2xl font-bold text-yellow-600",children:a.skipped||0})]})]}),e.jsx("p",{className:"text-sm text-gray-700 mb-4",children:a.message}),a.updates&&a.updates.length>0&&e.jsxs("div",{className:"bg-white rounded border max-h-64 overflow-y-auto",children:[e.jsx("div",{className:"p-3 border-b bg-gray-50",children:e.jsx("h4",{className:"font-medium text-gray-900",children:"Update Details"})}),e.jsx("div",{className:"divide-y",children:a.updates.map((r,d)=>e.jsxs("div",{className:"p-3 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-sm font-mono text-gray-600",children:r.oldNumber}),e.jsx("span",{className:"text-gray-400",children:"→"}),e.jsx("span",{className:"text-sm font-mono text-gray-900",children:r.newNumber})]}),e.jsx("span",{className:`px-2 py-1 rounded text-xs font-medium ${r.status==="updated"?"bg-green-100 text-green-800":"bg-yellow-100 text-yellow-800"}`,children:r.status})]},d))})]})]}),e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[e.jsx("h3",{className:"font-semibold text-blue-900 mb-2",children:"What this migration does:"}),e.jsxs("ul",{className:"text-sm text-blue-800 space-y-1",children:[e.jsx("li",{children:"• Finds all existing invoices with ORD- prefix"}),e.jsx("li",{children:"• Updates them to use SI- prefix for consistency"}),e.jsx("li",{children:"• Example: ORD-20251004-0001 → SI-20251004-0001"}),e.jsx("li",{children:"• Skips any invoices that would create duplicates"}),e.jsx("li",{children:"• This action cannot be undone"})]})]})]})})};export{_ as default};
