import{u as qs,r as u,a as Us,b as _s,c as Ft,d as Qs,e as Ws,f as zs,g as Gs,h as Ks,i as Vs,j as Js,k as Hs,l as Xs,m as Ys,n as Zs,o as e,S as Rt,U as ea,p as ta,R as Oe,q as sa,s as aa,A as ra,t as na,X as la,v as he,w as X,x as f,y as ca,z as C,B as qt,C as Ke,D as ia}from"./index-jd7Ax_Ed.js";import{u as Ut}from"./useFuzzySearch-BrpeiQaU.js";import{S as oa}from"./SearchableDropdown-D6GNUAgH.js";import{P as da}from"./PrintModal-BkQ6aCj8.js";import{u as ma}from"./useCompanyInfo-kGS5xcZ6.js";import{N as ua}from"./NotesPanel-Bd7HDD1M.js";import{D as _t}from"./download-bwqK3ulf.js";import{P as Qt}from"./plus-C2o0386P.js";import{E as xa}from"./eye-off-Dv_sEjAY.js";import{E as Wt}from"./eye-DMmE8Niy.js";import{C as pa}from"./calculator-CPUBN-yA.js";import{H as ha}from"./history-D1YUGYyd.js";import{C as Ve}from"./check-circle-8oGxTki5.js";import{I as ba}from"./info-D4lm7fBv.js";import{A as ga}from"./alert-circle-yrAHCiEw.js";import{T as Je}from"./trash-2-DCbqoVbR.js";import{S as fa}from"./save-CRYWlTlc.js";import{F as ya}from"./filter-CQLYjJyW.js";import{M as ja}from"./message-square-DtCe3QVP.js";import{P as zt}from"./printer-BkLl9NNZ.js";import{P as Na}from"./pen-square-CzKMgeH3.js";import{X as He}from"./x-circle-CN1zMonK.js";import"./chevron-down-BFYGIyCo.js";import"./check-C5eRyuMu.js";import"./useMutation-n-l4Ns3H.js";import"./lock-DxijO8f_.js";const A=h=>h==null?"":typeof h=="string"||typeof h=="number"?h:typeof h=="object"?h.name||h.title||h.fullName||h.companyName||h.displayName||h.businessName||JSON.stringify(h):String(h),rr=()=>{var wt,St,Pt,Ct,kt,Tt,Dt,Mt,Ot;const{updateTabTitle:h,getActiveTab:S}=qs(),{companyInfo:be}=ma(),Gt=be.companyName||"Company Name",Xe=be.address||be.billingAddress||"",Ye=be.contactNumber||"",[k,Kt]=u.useState({fromDate:new Date(Date.now()-30*24*60*60*1e3).toISOString().split("T")[0],toDate:new Date().toISOString().split("T")[0],orderNumber:"",customer:"",status:"",orderType:""}),[Vt,Jt]=u.useState({page:1,limit:999999}),[Ht,va]=u.useState({key:"createdAt",direction:"desc"}),[Xt,Ze]=u.useState(!1),[ge,et]=u.useState(null),[fe,re]=u.useState(!1),[Yt,Ee]=u.useState(!1),[Zt,tt]=u.useState(!1),[es,st]=u.useState(null),[c,G]=u.useState(null),[wa,Sa]=u.useState(null),[o,ne]=u.useState(null),[B,F]=u.useState(""),[ye,le]=u.useState(-1),[Y,je]=u.useState(!0),[d,b]=u.useState({orderType:"wholesale",customer:"",items:[],notes:"",isTaxExempt:!0,orderNumber:""}),[U,Ie]=u.useState(!0),_=u.useCallback(t=>{const s=new Date,a=s.getFullYear(),r=String(s.getMonth()+1).padStart(2,"0"),n=String(s.getDate()).padStart(2,"0"),l=String(s.getTime()).slice(-4);return`SO-${(t?(t.businessName||t.name||t.displayName||"").split(" ").map(x=>x.charAt(0).toUpperCase()).join("").substring(0,3):"")||"GEN"}-${a}${r}${n}-${l}`},[]),[Z,ts]=u.useState("wholesale"),[y,me]=u.useState(null),[at,Ne]=u.useState(""),[M,K]=u.useState(1),[T,$]=u.useState(""),[rt,Ae]=u.useState(0),[nt,ve]=u.useState(!1),[Pa,lt]=u.useState(-1),[ss,as]=u.useState(0),[ct,$e]=u.useState(!1),[we,ce]=u.useState({}),[Se,ue]=u.useState(!1),[ee,ie]=u.useState({}),[te,rs]=u.useState(!1),[Q,xe]=u.useState(null),[P,Le]=u.useState({}),[ns,Pe]=u.useState(!1),[D,Ce]=u.useState("pdf"),[Be,it]=u.useState(!1),{hasPermission:ls,user:Fe}=Us(),ke=ls("view_cost_prices"),[ot,cs]=u.useState(!1),dt=u.useMemo(()=>{if(!Array.isArray(d.items)||d.items.length===0)return 0;const t=a=>{var r,n;return a?(r=a.product)!=null&&r._id?a.product._id:typeof a.product=="string"?a.product:(n=a.productData)!=null&&n._id?a.productData._id:null:null},s=a=>a?a.productData?a.productData:a.product&&typeof a.product=="object"?a.product:null:null;return d.items.reduce((a,r)=>{var v,L,I;const n=Number(r.quantity)||0,l=Number(r.unitPrice)||0,m=t(r),i=s(r),j=[m&&P[m]!==void 0?Number(P[m]):null,Number((v=i==null?void 0:i.pricing)==null?void 0:v.cost),Number((L=i==null?void 0:i.pricing)==null?void 0:L.purchasePrice),Number((I=i==null?void 0:i.pricing)==null?void 0:I.wholesaleCost),Number(i==null?void 0:i.costPrice),Number(i==null?void 0:i.purchasePrice)].find(N=>N!=null&&Number.isFinite(N))||0,g=(l-j)*n;return a+(Number.isFinite(g)?g:0)},0)},[d.items,P]),[Re,W]=u.useState(""),[Te,V]=u.useState(null),[De,O]=u.useState(-1),qe=u.useRef(null);u.useEffect(()=>{if(U){const t=_(o);b(s=>s.orderNumber===t?s:{...s,orderNumber:t})}},[U,o,_]),u.useEffect(()=>{if(fe){document.body.style.overflow="hidden";const t=setTimeout(()=>{const s=document.querySelector(".modal-product-search");s&&s.focus()},100);return()=>{clearTimeout(t),document.body.style.overflow="unset"}}else document.body.style.overflow="unset",W(""),V(null),O(-1)},[fe]),u.useEffect(()=>()=>{document.body.style.overflow="unset"},[]);const{data:oe,isLoading:is,error:mt,refetch:se}=_s({...k,...Vt,sortConfig:Ht},{refetchOnMountOrArgChange:!0}),{data:E,isLoading:Ca}=Ft(["customers",{search:"",limit:100}],()=>ia.getCustomers({search:"",limit:100}),{select:t=>{var s;return((s=t==null?void 0:t.data)==null?void 0:s.customers)||(t==null?void 0:t.customers)||[]},onError:t=>{console.error("Error fetching customers:",t)}}),{data:Ue,isLoading:os}=Ft(["products","all-active-so"],()=>qt.getProducts({limit:100,status:"active"}),{keepPreviousData:!0,staleTime:3e4,onError:t=>{console.error("Error fetching products:",t)}}),ut=((wt=Ue==null?void 0:Ue.data)==null?void 0:wt.products)||[],ds=Ut(ut,at,["name","description","brand"],{threshold:.4,minScore:.3,limit:50}),R=Ut(ut,Re,["name","description","brand"],{threshold:.4,minScore:.3,limit:50}),[ms,{isLoading:xt}]=Qs(),[us,{isLoading:pt}]=Ws(),[xs,{isLoading:ka}]=zs(),[ps,{isLoading:Ta}]=Gs(),[hs,{isLoading:Da}]=Ks(),[Ma,{isLoading:Oa}]=Vs(),[bs]=Js(),[gs]=Hs(),[fs]=Xs(),[ys]=Ys(),[js]=Zs(),ae=()=>{if(b({orderType:"wholesale",customer:"",items:[],notes:"",isTaxExempt:!0,orderNumber:U?_(o):""}),Ie(!0),ne(null),F(""),me(null),Ne(""),K(1),$(""),ce({}),ue(!1),ie({}),xe(null),Le({}),h&&S){const t=S();t&&h(t.id,"SO")}},ht=t=>{const s=E==null?void 0:E.find(a=>a._id===t);if(ne(s),b(a=>({...a,customer:t,orderNumber:U?_(s):a.orderNumber})),F(""),je(!1),le(-1),ce({}),ue(!1),ie({}),h&&S&&s){const a=S();a&&h(a.id,`SO - ${s.businessName||s.name||"Unknown"}`)}},Ns=t=>{if(F(t),le(-1),t===""&&(ne(null),je(!0),b(s=>({...s,customer:"",orderNumber:U?_(null):s.orderNumber})),h&&S)){const s=S();s&&h(s.id,"SO")}},vs=t=>{if(!Y||!B||!E)return;const s=E.filter(r=>(r.businessName||r.name||"").toLowerCase().includes(B.toLowerCase())||(r.email||"").toLowerCase().includes(B.toLowerCase())||(r.phone||"").includes(B)),a=s.length-1;switch(t.key){case"ArrowDown":t.preventDefault(),le(r=>r<a?r+1:0);break;case"ArrowUp":t.preventDefault(),le(r=>r>0?r-1:a);break;case"Enter":t.preventDefault(),ye>=0&&ye<s.length&&ht(s[ye]._id);break;case"Escape":F(""),le(-1);break}},_e=(t,s)=>{var a,r,n,l,m;return t?s==="wholesale"?((a=t.pricing)==null?void 0:a.wholesale)||((r=t.pricing)==null?void 0:r.retail)||0:s==="retail"?((n=t.pricing)==null?void 0:n.retail)||0:((l=t.pricing)==null?void 0:l.wholesale)||((m=t.pricing)==null?void 0:m.retail)||0:0},ws=async t=>{if(me(t),K(1),ve(!0),Ne(t.name),t._id)try{const a=await qt.getLastPurchasePrice(t._id);a.data&&a.data.lastPurchasePrice!==null?xe(a.data.lastPurchasePrice):xe(null)}catch(a){console.error("Error fetching last purchase price:",a),xe(null)}else xe(null);const s=_e(t,Z);Ae(s),$(s.toString())};u.useEffect(()=>{if(y){const t=_e(y,Z);Ae(t);const s=_e(y,Z==="wholesale"?"retail":"wholesale");(!T||T===s.toString()||T===rt.toString())&&$(t.toString())}},[Z,y]);const Ss=t=>{Ne(t),lt(-1),y&&t!==y.name&&(me(null),$(""),ve(!1)),t===""&&(me(null),$(""),ve(!1))},bt=t=>{t.key==="Enter"&&y&&(t.preventDefault(),gt())},Ps=t=>{var a,r,n,l,m,i,w,x,j;((a=t.inventory)==null?void 0:a.currentStock)<=(((r=t.inventory)==null?void 0:r.reorderPoint)||0),(n=t.inventory)==null||n.currentStock;let s=((l=t.pricing)==null?void 0:l.wholesale)||((m=t.pricing)==null?void 0:m.retail)||0;return Z==="wholesale"?s=((i=t.pricing)==null?void 0:i.wholesale)||((w=t.pricing)==null?void 0:w.retail)||0:Z==="retail"&&(s=((x=t.pricing)==null?void 0:x.retail)||0),e.jsxs("div",{className:"flex items-center justify-between w-full",children:[e.jsx("div",{className:"font-medium",children:t.name}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("div",{className:"text-sm text-gray-600",children:["Stock: ",((j=t.inventory)==null?void 0:j.currentStock)||0]}),e.jsxs("div",{className:"text-sm text-gray-600",children:["Price: $",Math.round(s)]})]})]})},gt=async()=>{var t,s,a,r,n;if(y){if(!T||parseFloat(T)<=0){f("Please enter a valid rate");return}if(((t=y.inventory)==null?void 0:t.currentStock)===0){f(`${y.name} is out of stock and cannot be added to the order.`);return}if(M>((s=y.inventory)==null?void 0:s.currentStock)){f(`Cannot add ${M} units. Only ${(a=y.inventory)==null?void 0:a.currentStock} units available in stock.`);return}try{const l=parseFloat(T)||rt;if(Q!==null&&l<Q){const g=Q-l,v=(g/Q*100).toFixed(1);if(!window.confirm(`⚠️ WARNING: Sale price ($${l}) is below cost price ($${Math.round(Q)}).

Loss per unit: $${Math.round(g)} (${v}%)
Total loss: $${Math.round(g*M)}

Do you want to proceed?`))return}const m=l*M,i=0,w=d.isTaxExempt?0:m*(((r=y.taxSettings)==null?void 0:r.taxRate)||0)/100,x=m-i+w;Q!==null&&Le(g=>({...g,[y._id]:Q}));const j={product:y._id,productData:y,quantity:M,unitPrice:l,discountPercent:0,taxRate:((n=y.taxSettings)==null?void 0:n.taxRate)||0,subtotal:m,discountAmount:i,taxAmount:w,total:x};b(g=>({...g,items:[...g.items,j]})),me(null),K(1),$(""),Ae(0),ve(!1),Ne(""),lt(-1),as(g=>g+1),setTimeout(()=>{qe.current&&qe.current.focus()},100);const p=(o==null?void 0:o.businessType)==="wholesale"?"wholesale":(o==null?void 0:o.businessType)==="distributor"?"distributor":"wholesale";C(`${y.name} added to order at ${p} price: ${Math.round(l)}`)}catch(l){X(l,"Product Price Check")}}},ft=t=>{const s=d.items[t];if(b(a=>({...a,items:a.items.filter((r,n)=>n!==t)})),Se&&s){const a=s.product.toString(),r={...we};delete r[a],ce(r);const n={...ee};delete n[a],ie(n)}if(s){const a=s.product.toString(),r={...P};delete r[a],Le(r)}},Cs=()=>{b(t=>{if(!t.items||t.items.length<2)return t;const s=r=>{const n=r.productData||r.product;return n?typeof n=="string"?n:n.name||n.title||n.displayName||n.businessName||n.fullName||"":""},a=[...t.items].sort((r,n)=>{const l=s(r).toString().toLowerCase(),m=s(n).toString().toLowerCase();return l<m?-1:l>m?1:0});return{...t,items:a}})},ks=async()=>{if(!o){f("Please select a customer first");return}if(d.items.length===0){f("Please add products to cart first");return}$e(!0);try{const t=await ca.getLastPrices(o._id),{prices:s,orderNumber:a,orderDate:r}=t.data;if(!s||Object.keys(s).length===0){f("No previous order found for this customer"),$e(!1);return}const n={},l={};d.items.forEach(p=>{const g=p.product.toString();n[g]=p.unitPrice}),ce(n);let m=0,i=0,w=0;const x=d.items.map(p=>{const g=p.product.toString();if(s[g]){const v=s[g].unitPrice,L=p.unitPrice;if(v!==L){m++,l[g]="updated";const I=v*p.quantity,N=d.isTaxExempt?0:I*(p.taxRate||0)/100,q=I-(p.discountAmount||0)+N;return{...p,unitPrice:v,subtotal:I,taxAmount:N,total:q}}else return i++,l[g]="unchanged",p}else return w++,l[g]="not-found",p});b(p=>({...p,items:x})),ie(l),ue(!0);const j=r?new Date(r).toLocaleDateString():"previous order";if(m>0){let p=`Applied prices from ${a||"previous order"} (${j}). Updated ${m} product(s).`;i>0&&(p+=` ${i} product(s) had same price.`),w>0&&(p+=` ${w} product(s) not found in previous order.`),C(p)}else i>0?C(`All products already have the same prices as in ${a||"previous order"} (${j}).`):f("No matching products found in previous order")}catch(t){X(t,"Apply Last Prices")}finally{$e(!1)}},Ts=()=>{if(Object.keys(we).length===0){f("No original prices to restore");return}let t=0;const s=d.items.map(a=>{const r=a.product.toString();if(we[r]!==void 0){t++;const n=we[r],l=n*a.quantity,m=d.isTaxExempt?0:l*(a.taxRate||0)/100,i=l-(a.discountAmount||0)+m;return{...a,unitPrice:n,subtotal:l,taxAmount:m,total:i}}return a});b(a=>({...a,items:s})),ue(!1),ce({}),ie({}),t>0&&C(`Restored original prices for ${t} product(s).`)},yt=()=>{const t=d.items.reduce((n,l)=>n+l.unitPrice*l.quantity,0),s=d.items.reduce((n,l)=>n+(l.discountAmount||0),0),a=d.isTaxExempt?0:t*.08,r=t-s+a;return{subtotal:t,totalDiscount:s,totalTax:a,total:r}},Me=(t,s)=>{Kt(a=>({...a,[t]:s})),Jt(a=>({...a,page:1}))},Ds=()=>{if(d.items.length===0){f("Please add at least one item to the order");return}const{subtotal:t,totalTax:s,total:a}=yt(),{payment:r,...n}=d,l=d.items.map(i=>({product:i.product,quantity:i.quantity,unitPrice:i.unitPrice,totalPrice:i.total,invoicedQuantity:0,remainingQuantity:i.quantity})),m={...n,items:l,subtotal:t,tax:s,total:a};ms(m).unwrap().then(()=>{if(ae(),C("Sales order created successfully"),h&&S){const i=S();i&&h(i.id,"SO")}se()}).catch(i=>{f(X(i))})},Ms=()=>{const t={...d,items:d.items.map(s=>({product:s.product,quantity:s.quantity,unitPrice:s.unitPrice,totalPrice:s.total,invoicedQuantity:s.invoicedQuantity||0,remainingQuantity:s.remainingQuantity||s.quantity}))};us({id:c._id,...t}).unwrap().then(()=>{if(re(!1),G(null),W(""),V(null),O(-1),ae(),C("Sales order updated successfully"),h&&S){const s=S();s&&h(s.id,"SO")}se()}).catch(s=>{var r;const a=((r=s==null?void 0:s.data)==null?void 0:r.message)||(s==null?void 0:s.message)||"Failed to update sales order";f(a)})},Os=t=>{window.confirm("Are you sure you want to delete this sales order?")&&xs(t).unwrap().then(()=>{C("Sales order deleted successfully"),se()}).catch(s=>{f(X(s))})},Es=t=>{window.confirm("Are you sure you want to confirm this pending sales order? This will change its status to confirmed and make it ready for invoicing.")&&ps(t).unwrap().then(()=>{C("Sales order confirmed successfully"),se()}).catch(s=>{f(X(s))})},Is=t=>{window.confirm("Are you sure you want to cancel this sales order? This action cannot be undone.")&&hs(t).unwrap().then(()=>{C("Sales order cancelled successfully"),se()}).catch(s=>{f(X(s))})},As=async()=>{var t;it(!0);try{const s={fromDate:k.fromDate,toDate:k.toDate,status:k.status,customer:k.customer,orderNumber:k.orderNumber,orderType:k.orderType};let a;if(D==="excel"?a=await bs(s).unwrap():D==="csv"?a=await gs(s).unwrap():D==="json"?a=await ys(s).unwrap():D==="pdf"&&(a=await fs(s).unwrap()),a!=null&&a.filename){const r=a.filename;try{D==="pdf"&&await new Promise(l=>setTimeout(l,500));let n;try{n=await js(r).unwrap()}catch{f("Download failed");return}if(!n){f("Download failed: No response received");return}if(!n){f("Download failed: No data received from server");return}if(D==="pdf"){const l=n;if(!l||!(l instanceof Blob)){if(typeof l=="string")f(`Server error: ${l.substring(0,100)}`);else if(l&&typeof l=="object"){let x=l.message||l.error;if(!x)try{const j=JSON.stringify(l);j==="{}"||j==="null"||j===""?(x=l.statusText||l.status||"Unknown server error",console.error("Download response error - empty object:",{blob:l,contentType:m})):x=j.substring(0,150)}catch{x="Invalid response format"}f(`Server error: ${x||"Unknown error"}`)}else f("Invalid PDF file received - expected Blob. Response type: "+typeof l);return}const m=l.type||"";if(m.includes("application/json")||m.includes("text/html")){const x=new FileReader;x.onload=()=>{const j=x.result;try{const p=JSON.parse(j);f(p.message||"File not found or generation failed")}catch{f("Server returned error instead of PDF. Please try again.")}},x.readAsText(l);return}if(l.size===0){f("PDF file is empty");return}if(l.type&&!l.type.includes("pdf")&&!l.type.includes("application/octet-stream")){const x=new FileReader;x.onload=()=>{const j=x.result;if(j.includes("<!DOCTYPE")||j.includes('{"error"')||j.includes('{"message"'))f("Server returned an error instead of PDF file");else{const p=URL.createObjectURL(l);if(window.open(p,"_blank"))C("PDF opened in new tab");else{const v=document.createElement("a");v.href=p,v.download=r,document.body.appendChild(v),v.click(),document.body.removeChild(v),C("PDF downloaded (popup was blocked)")}setTimeout(()=>URL.revokeObjectURL(p),1e4)}},x.readAsText(l.slice(0,100));return}const i=URL.createObjectURL(l);if(window.open(i,"_blank"))C("PDF opened in new tab");else{const x=document.createElement("a");x.href=i,x.download=r,document.body.appendChild(x),x.click(),document.body.removeChild(x),C("PDF downloaded (popup was blocked)")}setTimeout(()=>URL.revokeObjectURL(i),1e4)}else{const l=n instanceof Blob?n:new Blob([n],{type:D==="excel"?"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet":D==="csv"?"text/csv":"application/json"}),m=URL.createObjectURL(l),i=document.createElement("a");i.href=m,i.download=r,document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(m),C(`${D.toUpperCase()} file downloaded successfully`)}}catch(n){if(n.response)if(n.response.data instanceof Blob){const l=new FileReader;l.onload=()=>{const m=l.result;try{const i=JSON.parse(m);f(i.message||"Download failed")}catch{f("Download failed: "+m.substring(0,100))}},l.readAsText(n.response.data)}else f(((t=n.response.data)==null?void 0:t.message)||`Download failed: ${n.response.status}`);else f("Download failed: "+(n.message||"Unknown error"));return}}Pe(!1)}catch(s){X(s,"Export")}finally{it(!1)}},$s=t=>{var a,r;G(t),re(!0);const s=(t.items||[]).map(n=>({...n,productData:n.product||null}));if(b({orderType:t.orderType,customer:((a=t.customer)==null?void 0:a._id)||"",items:s,notes:t.notes||"",terms:t.terms||"",isTaxExempt:((r=t.pricing)==null?void 0:r.isTaxExempt)||!1,orderNumber:t.soNumber||t.orderNumber||t.invoiceNumber||""}),Ie(!(t.soNumber||t.orderNumber||t.invoiceNumber)),t.customer){if(ne(t.customer),F(t.customer.businessName||t.customer.name||""),h&&S){const n=S();n&&h(n.id,`SO - ${t.customer.businessName||t.customer.name||"Unknown"}`)}}else if(ne(null),F(""),je(!0),h&&S){const n=S();n&&h(n.id,"SO")}re(!0)},Ls=t=>{G(t),Ee(!0)},Bs=u.useCallback(t=>{var p,g,v,L,I;if(!t)return null;const s=t.customer||o||(t.customerInfo?{displayName:t.customerInfo.name,email:t.customerInfo.email,phone:t.customerInfo.phone,address:t.customerInfo.address,pendingBalance:t.customerInfo.pendingBalance}:null),a=t.customerInfo||(s?{name:s.displayName||s.businessName||s.name||"Customer",email:s.email||"",phone:s.phone||"",address:s.address||s.location||s.companyAddress||""}:null),n=(t.items||d.items||[]).map(N=>{const q=N.productData||N.product||N.productInfo||N.productDetails||{};return{...N,product:{name:q.name||N.productName||q.title||"Product"},quantity:Number(N.quantity)||0,unitPrice:Number(N.unitPrice!==void 0?N.unitPrice:N.rate!==void 0?N.rate:0)||0}}),l=n.reduce((N,q)=>N+(q.unitPrice||0)*(q.quantity||0),0),m=t.subtotal??((p=t.pricing)==null?void 0:p.subtotal)??l,i=t.discount??((g=t.pricing)==null?void 0:g.discountAmount)??0,w=t.total??((v=t.pricing)==null?void 0:v.total)??m-i,x=((L=t.payment)==null?void 0:L.amountPaid)||0,j=((I=t.payment)==null?void 0:I.remainingBalance)??w-x;return{...t,orderNumber:t.soNumber||t.orderNumber||t.invoiceNumber||d.orderNumber||_(s),customer:s,customerInfo:a,items:n,pricing:{subtotal:m,discountAmount:i,total:w},payment:{amountPaid:x,remainingBalance:j},createdAt:t.createdAt||new Date().toISOString()}},[d.items,d.orderNumber,_,o]),Qe=t=>{const s=Bs(t);s&&(st(s),tt(!0))},Fs=t=>{switch(t){case"closed":case"fully_invoiced":return e.jsx(Ve,{className:"h-4 w-4 text-green-500"});case"confirmed":case"partially_invoiced":return e.jsx(Ke,{className:"h-4 w-4 text-yellow-500"});case"cancelled":return e.jsx(He,{className:"h-4 w-4 text-red-500"});case"draft":return e.jsx(Ke,{className:"h-4 w-4 text-blue-500"});default:return e.jsx(Ke,{className:"h-4 w-4 text-gray-500"})}},jt=(oe==null?void 0:oe.salesOrders)||[],Rs=(oe==null?void 0:oe.pagination)||{},{subtotal:Nt,totalDiscount:We,totalTax:vt,total:ze}=yt();return e.jsxs("div",{className:"space-y-4 lg:space-y-6",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Sales Orders"}),e.jsx("p",{className:"text-gray-600",children:"Process sales order transactions"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("button",{onClick:()=>Pe(!0),className:"btn btn-secondary btn-md",title:"Export sales orders data",children:[e.jsx(_t,{className:"h-4 w-4 mr-2"}),"Export"]}),e.jsxs("button",{onClick:ae,className:"btn btn-primary btn-md",children:[e.jsx(Qt,{className:"h-4 w-4 mr-2"}),"New Sales Order"]})]})]}),e.jsxs("div",{className:"flex items-start space-x-4",children:[e.jsxs("div",{className:"w-[500px] flex-shrink-0",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Select Customer"}),o&&e.jsx("button",{onClick:()=>{if(ne(null),F(""),b(t=>({...t,customer:""})),le(-1),ce({}),ue(!1),ie({}),h&&S){const t=S();t&&h(t.id,"SO")}},className:"text-xs text-blue-600 hover:text-blue-800 underline",title:"Change customer",children:"Change Customer"})]}),e.jsx("div",{className:"flex items-center space-x-2",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("label",{className:"text-xs font-normal text-gray-400",children:"Price Type:"}),e.jsxs("select",{value:Z,onChange:t=>ts(t.target.value),className:"border border-gray-200 rounded-md px-2 py-1 text-xs text-gray-600 focus:outline-none focus:ring-1 focus:ring-primary-400 focus:border-primary-400",children:[e.jsx("option",{value:"wholesale",children:"Wholesale"}),e.jsx("option",{value:"retail",children:"Retail"}),e.jsx("option",{value:"custom",children:"Custom"})]})]})})]}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:Y?B:o&&(o.businessName||o.name)||"",onChange:t=>{Y&&Ns(t.target.value)},onKeyDown:vs,className:`input w-full pr-10 ${Y?"":"bg-gray-50 cursor-default"}`,placeholder:Y?"Search customers by name, email, or business...":"",readOnly:!Y}),e.jsx(Rt,{className:"absolute right-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"})]}),Y&&B&&e.jsx("div",{className:"mt-2 max-h-40 overflow-y-auto border border-gray-200 rounded-md bg-white shadow-lg",children:E==null?void 0:E.filter(t=>(t.businessName||t.name||"").toLowerCase().includes(B.toLowerCase())||(t.phone||"").includes(B)).map((t,s)=>e.jsxs("div",{onClick:()=>{ht(t._id),F(""),je(!1)},className:`px-3 py-2 cursor-pointer border-b border-gray-100 last:border-b-0 ${s===ye?"bg-blue-100 text-blue-900":"hover:bg-gray-100"}`,children:[e.jsx("div",{className:"font-medium text-gray-900",children:t.businessName||t.name||"Unknown"}),e.jsx("div",{className:"text-sm text-gray-600",children:(()=>{const a=t.pendingBalance||0,r=t.advanceBalance||0,n=a-r;return n<0?`Payables: $${Math.abs(n).toFixed(2)}`:`Receivables: $${n.toFixed(2)}`})()})]},t._id))})]}),e.jsx("div",{className:"flex-1",children:o?e.jsx("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-3",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(ea,{className:"h-5 w-5 text-gray-400"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium",children:o.businessName||o.name||"Unknown"}),e.jsxs("p",{className:"text-sm text-gray-600 capitalize",children:[o.businessType||"Business"," • ",o.phone||"No phone"]}),e.jsxs("div",{className:"flex items-center space-x-4 mt-2",children:[(()=>{const t=o.pendingBalance||0,s=o.advanceBalance||0,a=t-s,r=a<0,n=a>0;return t>0||s>0?e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("span",{className:"text-xs text-gray-500",children:r?"Payables:":"Receivables:"}),e.jsxs("span",{className:`text-sm font-medium ${r?"text-red-600":n?"text-green-600":"text-gray-600"}`,children:["$",Math.abs(a).toFixed(2)]})]}):null})(),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("span",{className:"text-xs text-gray-500",children:"Credit Limit:"}),e.jsxs("span",{className:`text-sm font-medium ${o.creditLimit>0?(o.currentBalance||0)+(o.pendingBalance||0)>=o.creditLimit*.9?"text-red-600":(o.currentBalance||0)+(o.pendingBalance||0)>=o.creditLimit*.7?"text-yellow-600":"text-blue-600":"text-gray-600"}`,children:["$",(o.creditLimit||0).toFixed(2)]}),o.creditLimit>0&&(o.currentBalance||0)+(o.pendingBalance||0)>=o.creditLimit*.9&&e.jsx("span",{className:"text-xs text-red-600 font-bold ml-1",children:"⚠️"})]}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("span",{className:"text-xs text-gray-500",children:"Available Credit:"}),e.jsxs("span",{className:`text-sm font-medium ${o.creditLimit>0?o.creditLimit-((o.currentBalance||0)+(o.pendingBalance||0))<=o.creditLimit*.1?"text-red-600":o.creditLimit-((o.currentBalance||0)+(o.pendingBalance||0))<=o.creditLimit*.3?"text-yellow-600":"text-green-600":"text-gray-600"}`,children:["$",(o.creditLimit-((o.currentBalance||0)+(o.pendingBalance||0))).toFixed(2)]})]})]})]})]})}):e.jsx("div",{className:"hidden lg:block"})})]}),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center lg:justify-between gap-3",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Product Selection & Cart"}),e.jsxs("div",{className:"flex flex-wrap items-center justify-start lg:justify-end gap-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("button",{onClick:()=>rs(!te),className:"btn btn-secondary btn-sm flex items-center space-x-2",title:te?"Hide purchase cost prices":"Show purchase cost prices",children:te?e.jsxs(e.Fragment,{children:[e.jsx(xa,{className:"h-4 w-4"}),e.jsx("span",{children:"Hide Cost"})]}):e.jsxs(e.Fragment,{children:[e.jsx(Wt,{className:"h-4 w-4"}),e.jsx("span",{children:"Show Cost"})]})}),(Fe==null?void 0:Fe.role)==="admin"&&d.items.length>0&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:()=>cs(t=>!t),className:"btn btn-secondary btn-sm flex items-center space-x-2",title:"Toggle estimated profit (BP)",children:[e.jsx(pa,{className:"h-4 w-4"}),e.jsx("span",{children:ot?"Hide BP":"Show BP"})]}),ot&&e.jsx("span",{className:`text-sm font-semibold ${dt>=0?"text-green-600":"text-red-600"}`,children:ta(dt||0)})]})]}),o&&d.items.length>0&&e.jsx(e.Fragment,{children:Se?e.jsxs("button",{onClick:Ts,className:"btn btn-secondary btn-sm flex items-center space-x-2",title:"Restore original/current prices",children:[e.jsx(sa,{className:"h-4 w-4 mr-2"}),"Restore Current Prices"]}):e.jsx("button",{onClick:ks,disabled:ct,className:"btn btn-secondary btn-sm flex items-center space-x-2",title:"Apply prices from last order for this customer",children:ct?e.jsxs(e.Fragment,{children:[e.jsx(Oe,{className:"h-4 w-4 mr-2 animate-spin"}),"Loading..."]}):e.jsxs(e.Fragment,{children:[e.jsx(ha,{className:"h-4 w-4 mr-2"}),"Apply Last Prices"]})})})]})]})}),e.jsxs("div",{className:"card-content",children:[e.jsx("div",{className:"mb-6",children:(()=>{var a,r;const t=ke&&te?"md:col-span-6":"md:col-span-7",s=nt?Math.round(M*parseFloat(T||0)):0;return e.jsxs("div",{className:"grid grid-cols-12 gap-4 items-end",children:[e.jsxs("div",{className:`col-span-12 ${t}`,children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Product Search"}),e.jsx(oa,{ref:qe,placeholder:"Search or select product...",items:ds||[],onSelect:ws,onSearch:Ss,displayKey:Ps,selectedItem:y,loading:os,emptyMessage:"No products found",value:at},ss)]}),e.jsxs("div",{className:"col-span-6 md:col-span-1",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Stock"}),e.jsx("span",{className:"text-sm font-semibold text-gray-700 bg-gray-100 px-2 py-1 rounded border border-gray-200 block text-center h-10 flex items-center justify-center",children:y?((a=y.inventory)==null?void 0:a.currentStock)||0:"0"})]}),e.jsxs("div",{className:"col-span-6 md:col-span-1",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Quantity"}),e.jsx("input",{type:"number",min:"1",max:(r=y==null?void 0:y.inventory)==null?void 0:r.currentStock,value:M,onChange:n=>K(parseInt(n.target.value)||1),onKeyDown:bt,onFocus:n=>n.target.select(),className:"input text-center",placeholder:"1 (Enter to add & focus search)",autoFocus:nt})]}),te&&ke&&e.jsxs("div",{className:"col-span-6 md:col-span-1",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Cost"}),e.jsx("span",{className:"text-sm font-semibold text-red-700 bg-red-50 px-2 py-1 rounded border border-red-200 block text-center h-10 flex items-center justify-center",title:"Last Purchase Price",children:Q!==null?`$${Math.round(Q)}`:y?"N/A":"$0"})]}),e.jsxs("div",{className:"col-span-6 md:col-span-1",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Rate"}),e.jsx("input",{type:"number",step:"1",value:T,onChange:n=>$(n.target.value),onKeyDown:bt,onFocus:n=>n.target.select(),className:"input text-center",placeholder:"0 (Enter to add & focus search)",required:!0})]}),e.jsxs("div",{className:"col-span-6 md:col-span-1",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Amount"}),e.jsx("span",{className:"text-sm font-semibold text-gray-700 bg-gray-100 px-2 py-1 rounded border border-gray-200 block text-center h-10 flex items-center justify-center",children:s})]}),e.jsx("div",{className:"col-span-6 md:col-span-1 flex items-end",children:e.jsxs("button",{type:"button",onClick:gt,className:"btn btn-primary w-full flex items-center justify-center px-3 py-2",disabled:!y,title:"Add to cart (or press Enter in Quantity/Rate fields - focus returns to search)",children:[e.jsx(Qt,{className:"h-4 w-4 mr-2"}),"Add"]})})]})})()}),d.items.length===0?e.jsxs("div",{className:"p-8 text-center text-gray-500 border-t border-gray-200",children:[e.jsx(aa,{className:"mx-auto h-12 w-12 text-gray-400"}),e.jsx("p",{className:"mt-2",children:"No items in cart"})]}):e.jsxs("div",{className:"space-y-4 border-t border-gray-200 pt-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h4",{className:"text-md font-medium text-gray-700",children:"Cart Items"}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs("button",{type:"button",onClick:Cs,className:"btn btn-secondary btn-sm flex items-center space-x-2",title:"Sort products alphabetically",children:[e.jsx(ra,{className:"h-4 w-4"}),e.jsx("span",{children:"Sort A-Z"})]}),Se&&Object.keys(ee).length>0&&e.jsxs("div",{className:"flex items-center space-x-3 text-xs",children:[e.jsx("span",{className:"text-gray-600 font-medium",children:"Price Status:"}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(Ve,{className:"h-3 w-3 text-green-600"}),e.jsx("span",{className:"text-gray-600",children:"Updated"})]}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(ba,{className:"h-3 w-3 text-blue-600"}),e.jsx("span",{className:"text-gray-600",children:"Same Price"})]}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(ga,{className:"h-3 w-3 text-yellow-600"}),e.jsx("span",{className:"text-gray-600",children:"Not in Last Order"})]})]})]})]}),d.items.map((t,s)=>{var l,m,i,w,x,j,p,g,v,L,I,N,q,Et,It,At,$t,Lt;const a=t.productData||t.product,r=t.unitPrice*t.quantity,n=((l=a==null?void 0:a.inventory)==null?void 0:l.currentStock)<=(((m=a==null?void 0:a.inventory)==null?void 0:m.reorderPoint)||0);return e.jsx("div",{className:`py-1 ${s%2===0?"bg-white":"bg-gray-50"}`,children:e.jsxs("div",{className:"grid grid-cols-12 gap-4 items-center",children:[e.jsx("div",{className:"col-span-1",children:e.jsx("span",{className:"text-sm font-medium text-gray-700 bg-gray-50 px-0.5 py-1 rounded border border-gray-200 block text-center h-8 flex items-center justify-center",children:s+1})}),e.jsx("div",{className:`${te&&ke?"col-span-5":"col-span-6"} flex items-center h-8`,children:e.jsxs("span",{className:"font-medium text-sm truncate",children:[A(a==null?void 0:a.name)||"Unknown Product",n&&e.jsx("span",{className:"text-yellow-600 text-xs ml-2",children:"⚠️ Low Stock"}),P[(i=t.product)==null?void 0:i.toString()]!==void 0&&t.unitPrice<P[(w=t.product)==null?void 0:w.toString()]&&e.jsx("span",{className:"text-xs ml-2 px-1.5 py-0.5 rounded bg-red-100 text-red-700 font-bold",title:`Sale price below cost! Loss: $${Math.round(P[(x=t.product)==null?void 0:x.toString()]-t.unitPrice)} per unit`,children:"⚠️ Below Cost"}),Se&&ee[(j=t.product)==null?void 0:j.toString()]&&e.jsx("span",{className:`text-xs ml-2 px-1.5 py-0.5 rounded ${ee[(p=t.product)==null?void 0:p.toString()]==="updated"?"bg-green-100 text-green-700":ee[(g=t.product)==null?void 0:g.toString()]==="unchanged"?"bg-blue-100 text-blue-700":"bg-yellow-100 text-yellow-700"}`,children:ee[(v=t.product)==null?void 0:v.toString()]==="updated"?"Updated":ee[(L=t.product)==null?void 0:L.toString()]==="unchanged"?"Same Price":"Not in Last Order"})]})}),e.jsx("div",{className:"col-span-1",children:e.jsx("span",{className:"text-sm font-semibold text-gray-700 bg-gray-100 px-2 py-1 rounded border border-gray-200 block text-center h-8 flex items-center justify-center",children:((I=a==null?void 0:a.inventory)==null?void 0:I.currentStock)||0})}),e.jsx("div",{className:"col-span-1",children:e.jsx("input",{type:"number",value:t.quantity,onChange:Ge=>{const z=parseInt(Ge.target.value)||1;if(z<=0){ft(s);return}b(J=>({...J,items:J.items.map((de,H)=>H===s?{...de,quantity:z,total:z*de.unitPrice}:de)}))},className:"input text-center h-8",min:"1"})}),te&&ke&&e.jsx("div",{className:"col-span-1",children:e.jsx("span",{className:"text-sm font-semibold text-red-700 bg-red-50 px-2 py-1 rounded border border-red-200 block text-center h-8 flex items-center justify-center",title:"Last Purchase Price",children:P[(N=t.product)==null?void 0:N.toString()]!==void 0?`$${Math.round(P[(q=t.product)==null?void 0:q.toString()])}`:"N/A"})}),e.jsx("div",{className:"col-span-1",children:e.jsx("input",{type:"number",step:"0.01",value:t.unitPrice,onChange:Ge=>{var de;const z=parseFloat(Ge.target.value)||0,J=P[(de=t.product)==null?void 0:de.toString()];if(J!==void 0&&z<J){const H=J-z,pe=(H/J*100).toFixed(1);if(!window.confirm(`⚠️ WARNING: Sale price ($${z}) is below cost price ($${Math.round(J)}).

Loss per unit: $${Math.round(H)} (${pe}%)
Total loss: $${Math.round(H*t.quantity)}

Do you want to proceed?`))return}b(H=>({...H,items:H.items.map((pe,Bt)=>Bt===s?{...pe,unitPrice:z,total:pe.quantity*z}:pe)}))},className:`input text-center h-8 ${P[(Et=t.product)==null?void 0:Et.toString()]!==void 0&&t.unitPrice<P[(It=t.product)==null?void 0:It.toString()]?"border-red-500 bg-red-50":""}`,title:P[(At=t.product)==null?void 0:At.toString()]!==void 0&&t.unitPrice<P[($t=t.product)==null?void 0:$t.toString()]?`⚠️ WARNING: Sale price ($${Math.round(t.unitPrice)}) is below cost price ($${Math.round(P[(Lt=t.product)==null?void 0:Lt.toString()])})`:"",min:"0"})}),e.jsx("div",{className:"col-span-1",children:e.jsx("span",{className:"text-sm font-semibold text-gray-700 bg-gray-100 px-2 py-1 rounded border border-gray-200 block text-center h-8 flex items-center justify-center",children:Math.round(r)})}),e.jsx("div",{className:"col-span-1",children:e.jsx("button",{onClick:()=>ft(s),className:"btn btn-danger btn-sm h-8 w-full",children:e.jsx(Je,{className:"h-4 w-4"})})})]})},s)})]})]})]}),d.items.length>0&&!fe&&e.jsxs("div",{className:"bg-gradient-to-br from-blue-50 to-indigo-50 border-2 border-blue-200 rounded-lg max-w-5xl ml-auto mt-4",children:[e.jsxs("div",{className:"px-6 py-4 border-b border-blue-200",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 text-right mb-4",children:"Sales Order Details"}),e.jsxs("div",{className:"flex flex-nowrap gap-3 items-end justify-end",children:[e.jsxs("div",{className:"flex flex-col w-44",children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Order Type"}),e.jsxs("select",{value:d.orderType,onChange:t=>b(s=>({...s,orderType:t.target.value})),className:"input h-8 text-sm",children:[e.jsx("option",{value:"retail",children:"Retail"}),e.jsx("option",{value:"wholesale",children:"Wholesale"}),e.jsx("option",{value:"return",children:"Return"}),e.jsx("option",{value:"exchange",children:"Exchange"})]})]}),e.jsxs("div",{className:"flex flex-col w-40",children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Tax Status"}),e.jsxs("div",{className:"flex items-center space-x-1 px-2 py-1 border border-gray-200 rounded h-8",children:[e.jsx("input",{type:"checkbox",id:"taxExempt",checked:d.isTaxExempt,onChange:t=>b(s=>({...s,isTaxExempt:t.target.checked})),className:"h-3 w-3 text-primary-600 focus:ring-primary-500 border-gray-300 rounded"}),e.jsx("div",{className:"flex-1",children:e.jsx("label",{htmlFor:"taxExempt",className:"text-xs font-medium text-gray-700 cursor-pointer",children:"Tax Exempt"})}),d.isTaxExempt&&e.jsx("div",{className:"text-green-600 text-xs font-medium",children:"✓"})]})]}),e.jsxs("div",{className:"flex flex-col w-72",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-1",children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 m-0",children:"Invoice Number"}),e.jsxs("label",{htmlFor:"soAutoGenerateInvoice",className:"flex items-center space-x-1 text-[11px] text-gray-600 cursor-pointer select-none",children:[e.jsx("input",{type:"checkbox",id:"soAutoGenerateInvoice",checked:U,onChange:t=>{const s=t.target.checked;if(Ie(s),s){const a=_(o);b(r=>({...r,orderNumber:a}))}},className:"h-3 w-3 text-primary-600 focus:ring-primary-500 border-gray-300 rounded"}),e.jsx("span",{children:"Auto-generate"})]})]}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:d.orderNumber,onChange:t=>b(s=>({...s,orderNumber:t.target.value})),className:"w-full input pr-16 h-8 text-sm",placeholder:U?"Auto-generated":"Enter invoice number",disabled:U}),U&&e.jsx("button",{type:"button",onClick:()=>{const t=_(o);b(s=>({...s,orderNumber:t}))},className:"absolute right-2 top-1/2 transform -translate-y-1/2 text-[11px] text-primary-600 hover:text-primary-800 font-medium",children:"Regenerate"})]})]}),e.jsxs("div",{className:"flex flex-col w-[28rem]",children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Notes"}),e.jsx("input",{type:"text",value:d.notes,onChange:t=>b(s=>({...s,notes:t.target.value})),className:"input h-8 text-sm",placeholder:"Additional notes..."})]})]})]}),e.jsx("div",{className:"bg-gradient-to-r from-blue-500 to-indigo-600 px-6 py-4",children:e.jsx("h3",{className:"text-lg font-semibold text-white",children:"Order Summary"})}),e.jsx("div",{className:"px-6 py-4",children:e.jsxs("div",{className:"space-y-3 mb-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-800 font-semibold",children:"Subtotal:"}),e.jsx("span",{className:"text-xl font-bold text-gray-900",children:Math.round(Nt)})]}),We>0&&e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-800 font-semibold",children:"Discount:"}),e.jsxs("span",{className:"text-xl font-bold text-red-600",children:["-",Math.round(We)]})]}),!d.isTaxExempt&&e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-800 font-semibold",children:"Tax (8%):"}),e.jsx("span",{className:"text-xl font-bold text-gray-900",children:Math.round(vt)})]}),o&&(()=>{const t=o.pendingBalance||0,s=o.advanceBalance||0,a=t-s;return t>0||s>0?e.jsxs("div",{className:"flex justify-between items-center mt-2",children:[e.jsx("span",{className:"text-gray-800 font-semibold",children:a<0?"Previous Advance:":"Previous Balance:"}),e.jsxs("span",{className:`text-xl font-bold ${a<0?"text-green-600":"text-red-600"}`,children:[a<0?"-":"+",Math.abs(Math.round(a))]})]}):null})(),e.jsxs("div",{className:"flex justify-between items-center text-xl font-bold border-t-2 border-blue-400 pt-3 mt-2",children:[e.jsx("span",{className:"text-blue-900",children:"Total:"}),e.jsx("span",{className:"text-blue-900 text-3xl",children:Math.round(ze)})]}),o&&(()=>{const t=o.pendingBalance||0,s=o.advanceBalance||0,a=t-s;if(!(t>0||s>0))return null;const n=ze+a,l=n<0;return e.jsxs("div",{className:"flex justify-between items-center text-lg font-bold border-t-2 border-red-400 pt-3 mt-2",children:[e.jsx("span",{className:l?"text-green-700":"text-red-700",children:l?"Total Advance:":"Total Payables:"}),e.jsx("span",{className:`text-2xl ${l?"text-green-700":"text-red-700"}`,children:Math.abs(Math.round(n))})]})})()]})}),e.jsxs("div",{className:"flex space-x-3 mt-6 px-6 pb-6",children:[e.jsxs("button",{onClick:ae,className:"btn btn-secondary flex-1",children:[e.jsx(Je,{className:"h-4 w-4 mr-2"}),"Clear Cart"]}),e.jsxs("button",{onClick:()=>{const t={soNumber:d.orderNumber||`SO-${Date.now()}`,orderNumber:d.orderNumber||`SO-${Date.now()}`,customer:o,items:d.items.map(s=>({product:s.productData,quantity:s.quantity,unitPrice:s.unitPrice,totalPrice:s.total})),subtotal:Nt,discount:We,tax:vt,total:ze,orderType:d.orderType||"wholesale",status:"draft",paymentMethod:d.paymentMethod,isTaxExempt:d.isTaxExempt,notes:d.notes,createdAt:new Date().toISOString()};Qe(t)},className:"btn btn-secondary flex-1",children:[e.jsx(na,{className:"h-4 w-4 mr-2"}),"Print Preview"]}),e.jsxs("button",{onClick:Ds,disabled:xt||d.items.length===0,className:"btn btn-primary btn-lg flex-2",children:[e.jsx(fa,{className:"h-4 w-4 mr-2"}),xt?"Creating...":"Create Sales Order"]})]})]}),fe&&c&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",onClick:t=>{t.target===t.currentTarget&&(re(!1),G(null),W(""),V(null),O(-1),ae())},children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-4xl w-full mx-4 max-h-[90vh] overflow-y-auto",onClick:t=>t.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Edit Sales Order Details"}),e.jsx("button",{onClick:()=>{re(!1),G(null),W(""),V(null),O(-1),ae()},className:"text-gray-400 hover:text-gray-600",children:e.jsx(la,{className:"h-6 w-6"})})]}),e.jsxs("div",{className:"p-6",children:[e.jsx("div",{className:"mb-4",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Customer Selection"}),e.jsx("input",{type:"text",placeholder:"Search customers...",value:B,onChange:t=>F(t.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"}),B&&((St=E==null?void 0:E.customers)==null?void 0:St.length)>0&&e.jsx("div",{className:"mt-2 max-h-40 overflow-y-auto border border-gray-200 rounded-md bg-white shadow-lg",children:E.customers.slice(0,5).map(t=>e.jsxs("div",{onClick:()=>{b(s=>({...s,customer:t._id})),F(t.businessName||t.name)},className:"px-3 py-2 hover:bg-gray-100 cursor-pointer border-b border-gray-100 last:border-b-0",children:[e.jsx("div",{className:"font-medium",children:t.businessName||t.name}),e.jsx("div",{className:"text-sm text-gray-600",children:t.email})]},t._id))})]})}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Order Type"}),e.jsxs("select",{value:d.orderType,onChange:t=>b(s=>({...s,orderType:t.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"retail",children:"Retail"}),e.jsx("option",{value:"wholesale",children:"Wholesale"}),e.jsx("option",{value:"return",children:"Return"}),e.jsx("option",{value:"exchange",children:"Exchange"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Tax Status"}),e.jsxs("div",{className:"flex items-center space-x-2 px-3 py-2 border border-gray-300 rounded-md",children:[e.jsx("input",{type:"checkbox",id:"taxExempt",checked:d.isTaxExempt,onChange:t=>b(s=>({...s,isTaxExempt:t.target.checked})),className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),e.jsx("label",{htmlFor:"taxExempt",className:"text-sm font-medium text-gray-700 cursor-pointer",children:"Tax Exempt"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Notes"}),e.jsx("textarea",{value:d.notes,onChange:t=>b(s=>({...s,notes:t.target.value})),placeholder:"Add any notes or comments...",rows:"3",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Terms & Conditions"}),e.jsx("textarea",{value:d.terms,onChange:t=>b(s=>({...s,terms:t.target.value})),placeholder:"Add terms and conditions...",rows:"3",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]})]}),e.jsxs("div",{className:"px-6 py-4 border-t border-blue-200",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-900 mb-3",children:"Product Selection & Cart Items"}),e.jsx("div",{className:"mb-4",children:e.jsxs("div",{className:"grid grid-cols-12 gap-4 items-end",children:[e.jsxs("div",{className:"col-span-6",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Product Search"}),e.jsx("input",{type:"text",placeholder:"Search or type product name...",value:Re,onChange:t=>{t.stopPropagation(),W(t.target.value),O(-1)},onFocus:t=>t.stopPropagation(),onKeyDown:t=>{var a;if(t.stopPropagation(),!(R!=null&&R.length))return;const s=Math.min(R.length-1,4);switch(t.key){case"ArrowDown":t.preventDefault(),O(r=>r<s?r+1:0);break;case"ArrowUp":t.preventDefault(),O(r=>r>0?r-1:s);break;case"Enter":if(t.preventDefault(),De>=0&&R[De]){const r=R[De];V(r),$(((a=r.pricing)==null?void 0:a.retail)||0),K(1),W(r.name),O(-1),setTimeout(()=>{const n=document.querySelector(".modal-quantity-input");n&&n.focus()},100)}break;case"Escape":t.preventDefault(),O(-1);break}},className:"modal-product-search w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",autoFocus:!0}),Re&&(R==null?void 0:R.length)>0&&e.jsx("div",{className:"mt-2 max-h-40 overflow-y-auto border border-gray-200 rounded-md bg-white shadow-lg",children:R.slice(0,5).map((t,s)=>{var a,r;return e.jsxs("div",{onClick:()=>{var n;V(t),$(((n=t.pricing)==null?void 0:n.retail)||0),K(1),W(t.name),O(-1),setTimeout(()=>{const l=document.querySelector(".modal-quantity-input");l&&l.focus()},100)},className:`px-3 py-2 cursor-pointer border-b border-gray-100 last:border-b-0 ${De===s?"bg-blue-100 border-blue-200":"hover:bg-gray-100"}`,children:[e.jsx("div",{className:"font-medium",children:t.name}),e.jsxs("div",{className:"text-sm text-gray-600",children:["Stock: ",((a=t.inventory)==null?void 0:a.currentStock)||0," | Price: ",((r=t.pricing)==null?void 0:r.retail)||0]})]},t._id)})})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Quantity"}),e.jsx("input",{type:"number",min:"1",value:M,onChange:t=>K(parseInt(t.target.value)||1),className:"modal-quantity-input w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"1"})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Sale Price Per Unit"}),e.jsx("input",{type:"number",step:"0.01",min:"0",value:T,onChange:t=>$(parseFloat(t.target.value)||0),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"0.00"})]}),e.jsx("div",{className:"col-span-2",children:e.jsx("button",{type:"button",onClick:()=>{if(Te&&M>0&&T>=0){const t={product:Te._id,quantity:M,unitPrice:T,subtotal:M*T,productData:Te};b(s=>({...s,items:[...s.items,t]})),V(null),W(""),K(1),$(""),O(-1)}},disabled:!Te||M<=0||T<0,className:"w-full px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:bg-gray-300 disabled:cursor-not-allowed",children:"Add Product"})})]})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h5",{className:"text-sm font-medium text-gray-700 mb-2",children:"Current Items:"}),d.items.length===0?e.jsx("p",{className:"text-sm text-gray-500 italic",children:"No items in this order"}):d.items.map((t,s)=>{var a,r;return e.jsxs("div",{className:"flex items-center p-3 bg-white border border-gray-200 rounded-lg",children:[e.jsx("div",{className:"font-medium text-gray-900 min-w-[200px] mr-4",children:((a=t.productData)==null?void 0:a.name)||"Unknown Product"}),e.jsxs("div",{className:"flex items-center space-x-3 ml-auto",children:[e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("label",{className:"text-xs text-gray-600",children:"Qty:"}),e.jsx("input",{type:"number",min:"1",value:t.quantity,onChange:n=>{const l=[...d.items],m=Math.max(1,parseInt(n.target.value)||1);l[s].quantity=m,l[s].subtotal=m*l[s].unitPrice,b(i=>({...i,items:l}))},className:"w-16 px-2 py-1 text-sm border border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-blue-500"})]}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("label",{className:"text-xs text-gray-600",children:"× Sale Price:"}),e.jsx("input",{type:"number",step:"0.01",min:"0",value:t.unitPrice,onChange:n=>{const l=[...d.items],m=parseFloat(n.target.value)||0;l[s].unitPrice=m,l[s].subtotal=l[s].quantity*m,b(i=>({...i,items:l}))},className:"w-20 px-2 py-1 text-sm border border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-blue-500"})]}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("label",{className:"text-xs text-gray-600",children:"="}),e.jsx("span",{className:"text-sm font-medium text-gray-900 min-w-[60px]",children:((r=t.subtotal)==null?void 0:r.toFixed(2))||(t.quantity*t.unitPrice).toFixed(2)})]}),e.jsx("button",{type:"button",onClick:()=>{const n=d.items.filter((l,m)=>m!==s);b(l=>({...l,items:n}))},className:"px-2 py-1 text-sm bg-red-200 text-red-700 rounded hover:bg-red-300 ml-2",title:"Remove item",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]})]},s)})]})]}),e.jsxs("div",{className:"flex items-center justify-end space-x-3 p-6 border-t border-gray-200",children:[e.jsx("button",{onClick:()=>{re(!1),G(null),W(""),V(null),O(-1),ae()},className:"px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 border border-gray-300 rounded-md hover:bg-gray-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500",children:"Cancel"}),e.jsx("button",{onClick:Ms,disabled:pt||d.items.length===0,className:"px-4 py-2 text-sm font-medium text-white bg-blue-600 border border-transparent rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:bg-gray-300 disabled:cursor-not-allowed",children:pt?"Updating...":"Update Sales Order"})]})]})}),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ya,{className:"h-5 w-5 text-gray-400"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Filters"})]})}),e.jsx("div",{className:"card-content",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-6 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"From Date"}),e.jsx("input",{type:"date",value:k.fromDate,onChange:t=>Me("fromDate",t.target.value),className:"input h-[42px]"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"To Date"}),e.jsx("input",{type:"date",value:k.toDate,onChange:t=>Me("toDate",t.target.value),className:"input h-[42px]"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Order Number"}),e.jsx("input",{type:"text",placeholder:"Contains...",value:k.orderNumber,onChange:t=>Me("orderNumber",t.target.value),className:"input h-[42px]"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Status"}),e.jsxs("select",{value:k.status,onChange:t=>Me("status",t.target.value),className:"input h-[42px]",children:[e.jsx("option",{value:"",children:"All Statuses"}),e.jsx("option",{value:"draft",children:"Pending"}),e.jsx("option",{value:"confirmed",children:"Confirmed"}),e.jsx("option",{value:"partially_invoiced",children:"Partially Invoiced"}),e.jsx("option",{value:"fully_invoiced",children:"Fully Invoiced"}),e.jsx("option",{value:"cancelled",children:"Cancelled"}),e.jsx("option",{value:"closed",children:"Closed"})]})]}),e.jsx("div",{className:"flex items-end",children:e.jsxs("button",{onClick:()=>se(),className:"btn btn-primary w-full flex items-center justify-center space-x-2 h-[42px]",children:[e.jsx(Rt,{className:"h-4 w-4"}),e.jsx("span",{children:"Search"})]})})]})})]}),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h3",{className:"text-lg font-medium text-gray-900",children:["Sales Orders From: ",he(k.fromDate)," To: ",he(k.toDate)]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("span",{className:"text-sm text-gray-500",children:[Rs.totalItems||0," records"]}),e.jsx("button",{onClick:()=>se(),className:"p-2 text-gray-400 hover:text-gray-600",title:"Refresh",children:e.jsx(Oe,{className:"h-4 w-4"})})]})]})}),e.jsx("div",{className:"card-content p-0",children:is?e.jsxs("div",{className:"p-8 text-center",children:[e.jsx(Oe,{className:"h-8 w-8 animate-spin mx-auto text-gray-400"}),e.jsx("p",{className:"mt-2 text-gray-500",children:"Loading sales orders..."})]}):mt?e.jsx("div",{className:"p-8 text-center text-red-600",children:e.jsxs("p",{children:["Error loading sales orders: ",X(mt).message]})}):jt.length===0?e.jsx("div",{className:"p-8 text-center text-gray-500",children:e.jsx("p",{children:"No sales orders found for the selected criteria."})}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Date"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Order #"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Customer"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Type"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Total"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:jt.map((t,s)=>{var a,r,n;return e.jsxs("tr",{className:s%2===0?"bg-white":"bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:he(t.createdAt)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:t.soNumber}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:((a=t.customer)==null?void 0:a.displayName)||((r=t.customer)==null?void 0:r.businessName)||((n=t.customer)==null?void 0:n.name)||"Walk-in"}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 capitalize",children:t.orderType}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:e.jsxs("div",{className:"flex items-center space-x-1",children:[Fs(t.status),e.jsx("span",{className:"capitalize",children:t.status==="draft"?"Pending":t.status.replace("_"," ")})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:Math.round(t.total||0)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{onClick:()=>{et({type:"SalesOrder",id:t._id,name:t.soNumber}),Ze(!0)},className:"text-green-600 hover:text-green-900",title:"Notes",children:e.jsx(ja,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>Ls(t),className:"text-blue-600 hover:text-blue-900",title:"View",children:e.jsx(Wt,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>Qe(t),className:"text-gray-600 hover:text-gray-900",title:"Print",children:e.jsx(zt,{className:"h-4 w-4"})}),t.status==="draft"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>$s(t),className:"text-indigo-600 hover:text-indigo-900",title:"Edit",children:e.jsx(Na,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>Es(t._id),className:"text-green-600 hover:text-green-900",title:"Confirm Order",children:e.jsx(Ve,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>Is(t._id),className:"text-red-600 hover:text-red-900",title:"Cancel Order",children:e.jsx(He,{className:"h-4 w-4"})})]}),t.status==="draft"&&e.jsx("button",{onClick:()=>Os(t._id),className:"text-red-600 hover:text-red-900",title:"Delete",children:e.jsx(Je,{className:"h-4 w-4"})})]})})]},t._id)})})]})})})]}),Yt&&c&&e.jsx("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50",children:e.jsx("div",{className:"relative top-10 mx-auto p-5 border w-4/5 max-w-4xl shadow-lg rounded-md bg-white",children:e.jsxs("div",{className:"mt-3",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h3",{className:"text-2xl font-bold text-gray-900",children:"Sales Order"}),e.jsx("button",{onClick:()=>{Ee(!1),G(null)},className:"text-gray-400 hover:text-gray-600 transition-colors",children:e.jsx("svg",{className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsxs("div",{className:"mb-6 text-center",children:[e.jsx("h4",{className:"text-lg font-semibold text-gray-900 mb-2",children:Gt}),Xe&&e.jsx("p",{className:"text-sm text-gray-600",children:Xe}),Ye&&e.jsxs("p",{className:"text-sm text-gray-600",children:["Phone: ",Ye]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-6 mb-6",children:[e.jsxs("div",{children:[e.jsx("h5",{className:"font-semibold text-gray-900 mb-2",children:"Sales Order Details"}),e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"SO Number:"})," ",c.soNumber]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Date:"})," ",he(c.createdAt)]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Order Type:"})," ",c.orderType||"Standard"]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Status:"}),e.jsx("span",{className:`ml-2 px-2 py-1 rounded-full text-xs font-medium ${c.status==="draft"?"bg-gray-100 text-gray-800":c.status==="confirmed"?"bg-blue-100 text-blue-800":c.status==="partially_invoiced"?"bg-yellow-100 text-yellow-800":c.status==="fully_invoiced"?"bg-green-100 text-green-800":c.status==="cancelled"?"bg-red-100 text-red-800":"bg-gray-100 text-gray-800"}`,children:c.status==="draft"?"Pending":c.status.replace("_"," ")})]}),c.expectedDelivery&&e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Expected Delivery:"})," ",he(c.expectedDelivery)]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("h5",{className:"font-semibold text-gray-900 mb-2",children:"Customer Details"}),e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Customer:"})," ",A(((Pt=c.customer)==null?void 0:Pt.displayName)||((Ct=c.customer)==null?void 0:Ct.businessName)||((kt=c.customer)==null?void 0:kt.name))||"Walk-in"]}),((Tt=c.customer)==null?void 0:Tt.email)&&e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Email:"})," ",A(c.customer.email)]}),((Dt=c.customer)==null?void 0:Dt.phone)&&e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Phone:"})," ",A(c.customer.phone)]}),((Mt=c.customer)==null?void 0:Mt.address)&&e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Address:"})," ",A(c.customer.address)]}),((Ot=c.customer)==null?void 0:Ot.contactPerson)&&e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Contact:"})," ",A(c.customer.contactPerson)]}),e.jsx("div",{className:"mt-3 pt-2 border-t border-gray-200",children:e.jsxs("p",{className:`font-semibold ${(()=>{var r,n;const t=((r=c.customer)==null?void 0:r.pendingBalance)||0,s=((n=c.customer)==null?void 0:n.advanceBalance)||0;return t-s<0?"text-red-600":"text-green-600"})()}`,children:[e.jsx("span",{className:"font-medium",children:(()=>{var r,n;const t=((r=c.customer)==null?void 0:r.pendingBalance)||0,s=((n=c.customer)==null?void 0:n.advanceBalance)||0;return t-s<0?"Current Payables:":"Current Receivables:"})()})," ",Math.round((()=>{var a,r;const t=((a=c.customer)==null?void 0:a.pendingBalance)||0,s=((r=c.customer)==null?void 0:r.advanceBalance)||0;return Math.abs(t-s)})())]})})]})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("h5",{className:"font-semibold text-gray-900 mb-3",children:"Items Ordered"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full border border-gray-200 rounded-lg",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider border-b border-gray-200",children:"#"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider border-b border-gray-200",children:"Product"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider border-b border-gray-200",children:"Quantity"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider border-b border-gray-200",children:"Unit Price"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider border-b border-gray-200",children:"Total Price"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:c.items&&c.items.map((t,s)=>{var a;return e.jsxs("tr",{className:s%2===0?"bg-white":"bg-gray-50",children:[e.jsx("td",{className:"px-4 py-3 text-sm text-gray-900 border-b border-gray-200",children:s+1}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-900 border-b border-gray-200",children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:A(t.product)||"Unknown Product"}),((a=t.product)==null?void 0:a.description)&&e.jsx("div",{className:"text-gray-500 text-xs",children:A(t.product.description)})]})}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-900 text-right border-b border-gray-200",children:t.quantity}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-900 text-right border-b border-gray-200",children:Math.round(t.unitPrice||t.price||0)}),e.jsx("td",{className:"px-4 py-3 text-sm font-medium text-gray-900 text-right border-b border-gray-200",children:Math.round(t.totalPrice||t.quantity*(t.unitPrice||t.price||0))})]},s)})})]})})]}),e.jsx("div",{className:"flex justify-end mb-6",children:e.jsx("div",{className:"w-80",children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Subtotal:"}),e.jsx("span",{className:"font-medium",children:Math.round(c.subtotal||0)})]}),c.tax&&c.tax>0&&e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Tax:"}),e.jsx("span",{className:"font-medium",children:Math.round(c.tax)})]}),c.discount&&c.discount>0&&e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Discount:"}),e.jsxs("span",{className:"font-medium text-green-600",children:["-",Math.round(c.discount)]})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"SO Total:"}),e.jsx("span",{className:"font-medium",children:Math.round(c.total||0)})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:(()=>{var r,n;const t=((r=c.customer)==null?void 0:r.pendingBalance)||0,s=((n=c.customer)==null?void 0:n.advanceBalance)||0;return t-s<0?"Payables:":"Receivables:"})()}),e.jsx("span",{className:`font-medium ${(()=>{var r,n;const t=((r=c.customer)==null?void 0:r.pendingBalance)||0,s=((n=c.customer)==null?void 0:n.advanceBalance)||0;return t-s<0?"text-red-600":"text-green-600"})()}`,children:Math.round((()=>{var a,r;const t=((a=c.customer)==null?void 0:a.pendingBalance)||0,s=((r=c.customer)==null?void 0:r.advanceBalance)||0;return Math.abs(t-s)})())})]}),e.jsxs("div",{className:"flex justify-between text-lg font-bold border-t pt-2",children:[e.jsxs("span",{children:["Total ",(()=>{var r,n;const t=((r=c.customer)==null?void 0:r.pendingBalance)||0,s=((n=c.customer)==null?void 0:n.advanceBalance)||0;return t-s<0?"Payables":"Receivables"})(),":"]}),e.jsx("span",{className:"text-red-600",children:Math.round((c.total||0)+(()=>{var a,r;const t=((a=c.customer)==null?void 0:a.pendingBalance)||0,s=((r=c.customer)==null?void 0:r.advanceBalance)||0;return Math.abs(t-s)})())})]})]})})}),c.paymentMethod&&e.jsxs("div",{className:"mb-6",children:[e.jsx("h5",{className:"font-semibold text-gray-900 mb-2",children:"Payment Information"}),e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Payment Method:"})," ",A(c.paymentMethod)]}),c.paymentStatus&&e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Payment Status:"})," ",A(c.paymentStatus)]})]})]}),c.notes&&e.jsxs("div",{className:"mb-6",children:[e.jsx("h5",{className:"font-semibold text-gray-900 mb-2",children:"Notes"}),e.jsx("p",{className:"text-sm text-gray-600 bg-gray-50 p-3 rounded border",children:A(c.notes)})]}),c.terms&&e.jsxs("div",{className:"mb-6",children:[e.jsx("h5",{className:"font-semibold text-gray-900 mb-2",children:"Terms & Conditions"}),e.jsx("p",{className:"text-sm text-gray-600 bg-gray-50 p-3 rounded border",children:A(c.terms)})]}),e.jsxs("div",{className:"flex justify-between items-center pt-4 border-t",children:[e.jsxs("div",{className:"text-xs text-gray-500",children:["Generated on ",new Date().toLocaleDateString()," at ",new Date().toLocaleTimeString()]}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsxs("button",{onClick:()=>Qe(c),className:"btn btn-primary flex items-center",children:[e.jsx(zt,{className:"h-4 w-4 mr-2"}),"Print"]}),e.jsx("button",{onClick:()=>{Ee(!1),G(null)},className:"btn btn-secondary",children:"Close"})]})]})]})})}),ns&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-md w-full",children:[e.jsxs("div",{className:"flex justify-between items-center p-6 border-b border-gray-200",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Export Sales Orders"}),e.jsx("button",{onClick:()=>Pe(!1),className:"text-gray-400 hover:text-gray-600 transition-colors",children:e.jsx(He,{className:"h-6 w-6"})})]}),e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"Export Format"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("label",{className:"flex items-center p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-gray-50",children:[e.jsx("input",{type:"radio",name:"format",value:"pdf",checked:D==="pdf",onChange:t=>Ce(t.target.value),className:"mr-3"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900",children:"PDF"}),e.jsx("div",{className:"text-sm text-gray-500",children:"Print-ready format"})]})]}),e.jsxs("label",{className:"flex items-center p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-gray-50",children:[e.jsx("input",{type:"radio",name:"format",value:"excel",checked:D==="excel",onChange:t=>Ce(t.target.value),className:"mr-3"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900",children:"Excel"}),e.jsx("div",{className:"text-sm text-gray-500",children:"Spreadsheet format"})]})]}),e.jsxs("label",{className:"flex items-center p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-gray-50",children:[e.jsx("input",{type:"radio",name:"format",value:"csv",checked:D==="csv",onChange:t=>Ce(t.target.value),className:"mr-3"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900",children:"CSV"}),e.jsx("div",{className:"text-sm text-gray-500",children:"Comma-separated values"})]})]}),e.jsxs("label",{className:"flex items-center p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-gray-50",children:[e.jsx("input",{type:"radio",name:"format",value:"json",checked:D==="json",onChange:t=>Ce(t.target.value),className:"mr-3"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900",children:"JSON"}),e.jsx("div",{className:"text-sm text-gray-500",children:"Data format"})]})]})]})]}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-4 border-t border-gray-200",children:[e.jsx("button",{type:"button",onClick:()=>Pe(!1),className:"btn btn-secondary",disabled:Be,children:"Cancel"}),e.jsx("button",{type:"button",onClick:As,className:"btn btn-primary",disabled:Be,children:Be?e.jsxs(e.Fragment,{children:[e.jsx(Oe,{className:"h-4 w-4 mr-2 animate-spin"}),"Exporting..."]}):e.jsxs(e.Fragment,{children:[e.jsx(_t,{className:"h-4 w-4 mr-2"}),"Export"]})})]})]})})]})}),e.jsx(da,{isOpen:Zt,onClose:()=>{tt(!1),st(null)},orderData:es,documentTitle:"Sales Order",partyLabel:"Customer"}),Xt&&ge&&e.jsx(ua,{entityType:ge.type,entityId:ge.id,entityName:ge.name,onClose:()=>{Ze(!1),et(null)}})]})};export{rr as default};
