import{r as d,u as ze,ab as Ge,ac as Je,a6 as Ve,a7 as We,a8 as Xe,a9 as Ye,aa as Ze,R as be,p as e,a1 as He,ad as et,ae as tt,P as st,A as at,Q as m,v as rt,L as nt,af as ct}from"./index-WAoT78o_.js";import{a as ot}from"./productsApi-PDeXJ7KD.js";import{a as lt,b as it}from"./suppliersApi-CVrNDSoD.js";import{u as dt}from"./banksApi-CIM6curw.js";import{u as ut}from"./useFuzzySearch-3T44_vhU.js";import{S as ye}from"./SearchableDropdown-CP_BnlHv.js";import{P as mt}from"./PrintModal-CytjqKcs.js";import{g as xt}from"./ComponentRegistry-FQ3Cu5y6.js";import{D as pt}from"./download-CqTUNGzV.js";import{P as ge}from"./plus-CNtrfzq0.js";import{P as ht}from"./phone-ehtvFRIM.js";import{T as ve}from"./trash-2-DLkCb2w3.js";import{X as ft}from"./x-circle-B_We_keY.js";import"./chevron-down-BWZz_AVk.js";import"./check-C3uKB0YI.js";import"./useCompanyInfo-pvMQvuFr.js";import"./settingsApi-CbNzY-DL.js";import"./printer-CLmMJmx9.js";const bt=({item:v,index:l,onUpdateQuantity:y,onUpdateCost:p,onRemove:a})=>{var N,f,L,A,R;const j=v.costPerUnit*v.quantity,U=((f=(N=v.product)==null?void 0:N.inventory)==null?void 0:f.currentStock)||0,k=((A=(L=v.product)==null?void 0:L.inventory)==null?void 0:A.reorderPoint)||0,T=U<=k;return e.jsx("div",{className:`py-1 ${l%2===0?"bg-white":"bg-gray-50"}`,children:e.jsxs("div",{className:"grid grid-cols-12 gap-4 items-center",children:[e.jsx("div",{className:"col-span-1",children:e.jsx("span",{className:"text-sm font-medium text-gray-700 bg-gray-50 px-0.5 py-1 rounded border border-gray-200 block text-center h-8 flex items-center justify-center",children:l+1})}),e.jsx("div",{className:"col-span-6 flex items-center h-8",children:e.jsxs("span",{className:"font-medium text-sm truncate",children:[((R=v.product)==null?void 0:R.name)||"Unknown Product",T&&e.jsx("span",{className:"text-yellow-600 text-xs ml-2",children:"⚠️ Low Stock"})]})}),e.jsx("div",{className:"col-span-1",children:e.jsx("span",{className:"text-sm font-semibold text-gray-700 bg-gray-100 px-2 py-1 rounded border border-gray-200 block text-center h-8 flex items-center justify-center",children:U})}),e.jsx("div",{className:"col-span-1",children:e.jsx("input",{type:"number",value:v.quantity,onChange:S=>{var C;return y((C=v.product)==null?void 0:C._id,parseInt(S.target.value)||1)},className:"input text-center h-8",min:"1"})}),e.jsx("div",{className:"col-span-1",children:e.jsx("input",{type:"number",step:"0.01",value:v.costPerUnit,onChange:S=>{var C;return p((C=v.product)==null?void 0:C._id,parseFloat(S.target.value)||0)},className:"input text-center h-8",min:"0"})}),e.jsx("div",{className:"col-span-1",children:e.jsx("span",{className:"text-sm font-semibold text-gray-700 bg-gray-100 px-2 py-1 rounded border border-gray-200 block text-center h-8 flex items-center justify-center",children:j.toFixed(2)})}),e.jsx("div",{className:"col-span-1",children:e.jsx("button",{onClick:()=>{var S;return a((S=v.product)==null?void 0:S._id)},className:"btn btn-danger btn-sm h-8 w-full",children:e.jsx(ve,{className:"h-4 w-4"})})})]})})},yt=({onAddProduct:v})=>{const[l,y]=d.useState(""),[p,a]=d.useState(null),[j,U]=d.useState(1),[k,T]=d.useState("0"),N=d.useRef(null),{data:f,isLoading:L,error:A}=ot({limit:100,status:"active"},{keepPreviousData:!0,staleTime:3e4}),R=be.useMemo(()=>{var u,K,$;return f?Array.isArray(f)?f:(u=f==null?void 0:f.data)!=null&&u.products?f.data.products:f!=null&&f.products?f.products:($=(K=f==null?void 0:f.data)==null?void 0:K.data)!=null&&$.products?f.data.data.products:[]:[]},[f]),S=ut(R,l,["name","description","brand","barcode","sku"],{threshold:.4,minScore:.3,limit:10}),C=u=>{a(u),T(u.pricing.cost.toString()),y(u.name)},F=()=>{if(p){if(!k||parseFloat(k)<=0){m.error("Please enter a valid cost per unit");return}v({product:p,quantity:j,costPerUnit:parseFloat(k)}),a(null),U(1),T("0"),y(""),setTimeout(()=>{N.current&&N.current.focus()},100)}},q=u=>e.jsxs("div",{className:"flex items-center justify-between w-full",children:[e.jsx("div",{className:"font-medium",children:u.name}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("div",{className:"text-sm text-gray-600",children:["Stock: ",u.inventory.currentStock]}),e.jsxs("div",{className:"text-sm text-gray-600",children:["Cost: $",Math.round(u.pricing.cost)]})]})]});return e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-12 gap-4 items-end",children:[e.jsxs("div",{className:"col-span-7",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Product Search"}),e.jsx(ye,{ref:N,placeholder:"Search or select product...",items:S||[],onSelect:C,onSearch:u=>{y(u),p&&u!==p.name&&(a(null),T("0"))},displayKey:q,selectedItem:p,loading:L,emptyMessage:l.length>0?"No products found":"Start typing to search products...",value:p?p.name:l,showSelected:!0})]}),e.jsxs("div",{className:"col-span-1",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Stock"}),e.jsx("span",{className:"text-sm font-semibold text-gray-700 bg-gray-100 px-2 py-1 rounded border border-gray-200 block text-center h-10 flex items-center justify-center",children:p?p.inventory.currentStock:"0"})]}),e.jsxs("div",{className:"col-span-1",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Quantity"}),e.jsx("input",{type:"number",min:"1",value:j,onChange:u=>U(parseInt(u.target.value)||1),onKeyDown:u=>{u.key==="Enter"&&p&&(u.preventDefault(),F())},className:"input text-center",placeholder:"1 (Enter to add & focus search)"})]}),e.jsxs("div",{className:"col-span-1",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Cost"}),e.jsx("input",{type:"number",step:"1",value:k,onChange:u=>T(u.target.value),onKeyDown:u=>{u.key==="Enter"&&p&&(u.preventDefault(),F())},className:"input text-center",placeholder:"0 (Enter to add & focus search)",required:!0})]}),e.jsxs("div",{className:"col-span-1",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Amount"}),e.jsx("input",{type:"text",value:p?Math.round(j*parseFloat(k||0)):"",className:"input text-center font-medium",disabled:!0,placeholder:""})]}),e.jsxs("div",{className:"col-span-1",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:" "}),e.jsxs("button",{type:"button",onClick:F,className:"w-full btn btn-primary flex items-center justify-center px-3 py-2",disabled:!p,title:"Add to cart (or press Enter in Quantity/Cost fields - focus returns to search)",children:[e.jsx(ge,{className:"h-4 w-4 mr-2"}),"Add"]})]})]})})},Ot=({tabId:v,editData:l})=>{var he,fe;const[y,p]=d.useState([]),[a,j]=d.useState(null),[U,k]=d.useState(""),[T,N]=d.useState(""),[f,L]=d.useState(!0),[A,R]=d.useState(new Date().toISOString().split("T")[0]),[S,C]=d.useState(""),[F,q]=d.useState(!0),[u,K]=d.useState(!1),$=d.useRef(null),[Y,Z]=d.useState("cash"),[M,H]=d.useState(0),[g,Q]=d.useState({type:"amount",value:0}),[je,ce]=d.useState(!1),[Ne,oe]=d.useState(null),[we,z]=d.useState(!1),[E,G]=d.useState("pdf"),[ee,le]=d.useState(!1),ie=(()=>{const t=new Date,s=new Date;s.setMonth(t.getMonth()-1);const n=r=>{const o=r.getFullYear(),x=String(r.getMonth()+1).padStart(2,"0"),c=String(r.getDate()).padStart(2,"0");return`${o}-${x}-${c}`};return{from:n(s),to:n(t)}})(),[_,J]=d.useState(ie.from),[V,W]=d.useState(ie.to),{updateTabTitle:de,getActiveTab:ue,openTab:Pe}=ze(),[me,{data:te,isLoading:Se,refetch:ke}]=lt(),{data:vt}=dt(),[Ce]=Ge(),[Ee]=Je(),[Ue]=Ve(),[Te]=We(),[Fe]=Xe(),[Me]=Ye(),[Ie]=Ze();d.useEffect(()=>{const t=()=>{K(window.innerWidth<768)};return t(),window.addEventListener("resize",t),()=>window.removeEventListener("resize",t)},[]),d.useEffect(()=>{$.current&&$.current.focus()},[]),d.useEffect(()=>{if(l&&l.isEditMode&&l.invoiceId&&(l.supplier&&j(l.supplier),l.invoiceNumber&&(N(l.invoiceNumber),L(!1)),l.notes&&C(l.notes),l.items&&l.items.length>0)){const t=l.items.map(s=>({product:s.product,quantity:s.quantity,costPerUnit:s.unitCost||s.costPerUnit,totalCost:s.totalCost||s.quantity*(s.unitCost||s.costPerUnit)}));p(t)}},[l==null?void 0:l.invoiceId]);const{data:B}=it(a==null?void 0:a._id,{skip:!(a!=null&&a._id)||!(l!=null&&l.isEditMode)});d.useEffect(()=>{B!=null&&B.data&&j(B.data)},[B]),d.useEffect(()=>{U.length>0&&me(U)},[U,me]);const w=be.useMemo(()=>te||{data:{suppliers:[]}},[te]);d.useEffect(()=>{var t;if(a&&((t=w==null?void 0:w.data)!=null&&t.suppliers)){const s=w.data.suppliers.find(n=>n._id===a._id);s&&(s.pendingBalance!==a.pendingBalance||s.advanceBalance!==a.advanceBalance||s.currentBalance!==a.currentBalance)&&j(s)}},[(he=w==null?void 0:w.data)==null?void 0:he.suppliers]),(t=>{d.useEffect(()=>{const s=n=>{if(!n.key)return;const r=n.key.toLowerCase(),x=n.ctrlKey||n.metaKey?`ctrl+${r}`:r;t[x]&&(n.preventDefault(),t[x]())};return document.addEventListener("keydown",s),()=>document.removeEventListener("keydown",s)},[t])})({"ctrl+f":()=>{const t=document.querySelector('input[placeholder*="Search products"]');t&&(t.focus(),t.select())},"ctrl+s":()=>{const t=document.querySelector('input[placeholder*="Search suppliers"]');t&&(t.focus(),t.select())},"ctrl+p":()=>{y.length>0?(re(),m.success("Processing purchase...")):m.error("No items to purchase")},"ctrl+enter":()=>{y.length>0?re():m.error("No items to purchase")},escape:()=>{y.length>0&&(p([]),m.success("Purchase items cleared"))},f1:()=>{m.success("Keyboard Shortcuts: Ctrl+F (Product Search), Ctrl+S (Supplier Search), Ctrl+P (Process Purchase), Esc (Clear Items)")}});const se=t=>{if(!t)return"";const s=new Date,n=s.getFullYear(),r=String(s.getMonth()+1).padStart(2,"0"),o=String(s.getDate()).padStart(2,"0"),x=String(s.getTime()).slice(-6),c=Math.floor(Math.random()*1e3).toString().padStart(3,"0");return`PO-${(t.companyName||t.name||"SUP").split(" ").map(h=>h.charAt(0).toUpperCase()).join("").substring(0,3)}-${n}${r}${o}-${x}-${c}`},$e=t=>{j(t),f&&t&&N(se(t));const s=ue();s&&t&&de(s.id,`Purchase - ${t.displayName}`),y.length>0&&!(l!=null&&l.isEditMode)&&(p([]),m.success("Purchase items cleared due to supplier change. Please re-add products."))},Ae=async t=>{var s,n,r,o,x;try{const c=await Ce(t).unwrap(),i=((s=c==null?void 0:c.invoice)==null?void 0:s.invoiceNumber)||((r=(n=c==null?void 0:c.data)==null?void 0:n.invoice)==null?void 0:r.invoiceNumber)||"Unknown",P=((c==null?void 0:c.inventoryUpdates)||((o=c==null?void 0:c.data)==null?void 0:o.inventoryUpdates)||[]).filter(D=>D.success).length;m.success(`Purchase invoice created successfully! Invoice ${i} created and ${P} products added to inventory.`),p([]),j(null),H(0),Z("cash"),N(""),R(new Date().toISOString().split("T")[0]),C("");const h=ue();h&&de(h.id,"Purchase")}catch(c){m.error(((x=c==null?void 0:c.data)==null?void 0:x.message)||(c==null?void 0:c.message)||"Failed to complete purchase")}},Re=async(t,s)=>{var n,r,o,x,c;try{const i=await Ee({id:t,...s}).unwrap(),b=((n=i==null?void 0:i.invoice)==null?void 0:n.invoiceNumber)||((o=(r=i==null?void 0:i.data)==null?void 0:r.invoice)==null?void 0:o.invoiceNumber)||"Unknown",h=((i==null?void 0:i.inventoryUpdates)||((x=i==null?void 0:i.data)==null?void 0:x.inventoryUpdates)||[]).filter(D=>D.success).length;m.success(`Purchase invoice updated successfully! Invoice ${b} updated and ${h} products adjusted in inventory.`)}catch(i){m.error(((c=i==null?void 0:i.data)==null?void 0:c.message)||(i==null?void 0:i.message)||"Failed to update purchase")}},De=()=>{if(F||!a)return 0;const t=y.reduce((n,r)=>n+r.costPerUnit*r.quantity,0);let s=0;switch(a.businessType){case"manufacturer":s=.06;break;case"distributor":s=.07;break;case"wholesaler":s=.08;break;case"dropshipper":s=.05;break;default:s=.08}return a.rating>=5&&a.reliability==="excellent"&&(s*=.5),t*s},O=y.reduce((t,s)=>t+s.costPerUnit*s.quantity,0),X=De(),ae=g.type==="percentage"?O*g.value/100:g.value,I=O+X-ae,xe=(a==null?void 0:a.pendingBalance)||0,Le=I+xe,_e=t=>{p(s=>{var r;const n=s.find(o=>{var x,c;return((x=o.product)==null?void 0:x._id)===((c=t.product)==null?void 0:c._id)});return n?window.confirm(`"${((r=t.product)==null?void 0:r.name)||"Unknown Product"}" is already in the cart (Qty: ${n.quantity}).

Do you want to add ${t.quantity} more units?`)?s.map(x=>{var c,i;return((c=x.product)==null?void 0:c._id)===((i=t.product)==null?void 0:i._id)?{...x,quantity:x.quantity+t.quantity,costPerUnit:t.costPerUnit}:x}):s:[...s,t]})},Be=(t,s)=>{if(s<=0){pe(t);return}p(n=>n.map(r=>{var o;return((o=r.product)==null?void 0:o._id)===t?{...r,quantity:s}:r}))},Oe=(t,s)=>{p(n=>n.map(r=>{var o;return((o=r.product)==null?void 0:o._id)===t?{...r,costPerUnit:s}:r}))},pe=t=>{p(s=>s.filter(n=>{var r;return((r=n.product)==null?void 0:r._id)!==t}))},qe=()=>{p(t=>{if(!t||t.length<2)return t;const s=r=>{const o=r.product;return o?typeof o=="string"?o:o.name||o.title||o.displayName||o.businessName||o.fullName||"":""};return[...t].sort((r,o)=>{const x=s(r).toString().toLowerCase(),c=s(o).toString().toLowerCase();return x<c?-1:x>c?1:0})})},Ke=()=>{z(!0)},Qe=async()=>{var t,s,n;le(!0);try{const r={...(a==null?void 0:a._id)&&{supplier:a._id},..._&&{dateFrom:_},...V&&{dateTo:V}};let o;if(E==="excel"?o=await Ue(r).unwrap():E==="csv"?o=await Te(r).unwrap():E==="json"?o=await Me(r).unwrap():E==="pdf"&&(o=await Fe(r).unwrap()),o!=null&&o.filename||(t=o==null?void 0:o.data)!=null&&t.filename){const x=o.filename||o.data.filename;try{E==="pdf"&&await new Promise(b=>setTimeout(b,500));let c;try{c=await Ie(x).unwrap()}catch(b){const P=(b==null?void 0:b.data)||((s=b==null?void 0:b.response)==null?void 0:s.data);if(P instanceof Blob){const h=new FileReader;h.onload=()=>{const D=h.result;try{const ne=JSON.parse(D);m.error(ne.message||"Download failed")}catch{m.error("Download failed")}},h.readAsText(P)}else typeof P=="object"&&P!==null?m.error(P.message||"Download failed"):m.error((b==null?void 0:b.message)||"Download failed");return}if(!c){m.error("Download failed: No data received from server");return}const i=c instanceof Blob?c:c.data;if(E==="pdf"){if(!i||!(i instanceof Blob)){m.error("Invalid PDF file received");return}if(i.size===0){m.error("PDF file is empty");return}if(i.type&&(i.type.includes("application/json")||i.type.includes("text/html"))){const h=new FileReader;h.onload=()=>{const D=h.result;try{const ne=JSON.parse(D);m.error(ne.message||"File not found or generation failed")}catch{m.error("Server returned error instead of PDF. Please try again.")}},h.readAsText(i);return}const b=URL.createObjectURL(i);if(window.open(b,"_blank"))m.success("PDF opened in new tab");else{const h=document.createElement("a");h.href=b,h.download=x,document.body.appendChild(h),h.click(),document.body.removeChild(h),m.success("PDF downloaded (popup was blocked)")}setTimeout(()=>URL.revokeObjectURL(b),1e4)}else{const b=c instanceof Blob?c:c.data,P=URL.createObjectURL(b),h=document.createElement("a");h.href=P,h.download=x,document.body.appendChild(h),h.click(),document.body.removeChild(h),setTimeout(()=>URL.revokeObjectURL(P),100),m.success(`${E.toUpperCase()} file downloaded successfully`)}z(!1)}catch{m.error("Failed to download file")}}else m.error("Export failed: No filename received")}catch(r){m.error("Failed to export purchase data: "+(((n=r==null?void 0:r.data)==null?void 0:n.message)||(r==null?void 0:r.message)||"Unknown error"))}finally{le(!1)}},re=()=>{if(y.length===0){m.error("No items to purchase");return}if(!a){m.error("Please select a supplier");return}let t=T;(!t||t.trim()==="")&&f&&(t=se(a),N(t)),(!t||t.trim()==="")&&(t=se(a),N(t));const s={supplier:a._id,supplierInfo:{name:a.name,email:a.email,phone:a.phone,companyName:a.companyName,address:a.address},items:y.map(n=>{var r;return{product:(r=n.product)==null?void 0:r._id,quantity:n.quantity,unitCost:n.costPerUnit,totalCost:n.quantity*n.costPerUnit}}),pricing:{subtotal:O,discountAmount:0,taxAmount:X,isTaxExempt:F,total:I},payment:{method:Y,amount:M,remainingBalance:Math.max(0,I-M),isPartialPayment:M>0&&M<I,status:M>=I?"paid":M>0?"partial":"pending"},invoiceNumber:t,expectedDelivery:A,notes:S,terms:""};l!=null&&l.isEditMode?Re(l.invoiceId,s):Ae(s)};return e.jsx(e.Fragment,{children:e.jsxs("div",{className:"space-y-4 lg:space-y-6",children:[e.jsxs("div",{className:`flex ${u?"flex-col space-y-4":"items-start justify-between"}`,children:[e.jsxs("div",{children:[e.jsx("h1",{className:`${u?"text-xl":"text-2xl"} font-bold text-gray-900`,children:"Purchase"}),e.jsx("p",{className:"text-gray-600",children:"Process purchase transactions"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("button",{onClick:Ke,className:"btn btn-secondary btn-md",title:"Export Purchase Report",children:[e.jsx(pt,{className:"h-4 w-4 mr-2"}),"Export Purchase Report"]}),e.jsxs("button",{onClick:()=>{const t=xt("/purchase");if(t){const s=`tab_${Date.now()}_${Math.random().toString(36).substr(2,9)}`;Pe({title:"Purchase",path:"/purchase",component:t.component,icon:t.icon,allowMultiple:!0,props:{tabId:s}})}},className:"btn btn-primary btn-md",children:[e.jsx(ge,{className:"h-4 w-4 mr-2"}),"New Purchase"]})]})]}),e.jsxs("div",{className:`flex ${u?"flex-col space-y-4":"items-start space-x-4"}`,children:[e.jsxs("div",{className:`${u?"w-full":"w-[500px] flex-shrink-0"}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Select Supplier"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[a&&e.jsx("button",{onClick:()=>{j(null),k(""),setTimeout(()=>{$.current&&$.current.focus()},100)},className:"text-xs text-blue-600 hover:text-blue-800 underline",title:"Change supplier",children:"Change Supplier"}),e.jsx("button",{onClick:()=>ke(),className:"text-xs text-blue-600 hover:text-blue-800 underline",title:"Refresh supplier data",children:"Refresh"})]})]}),e.jsx(ye,{ref:$,placeholder:"Search suppliers by name, email, or business...",items:((fe=w==null?void 0:w.data)==null?void 0:fe.suppliers)||(w==null?void 0:w.suppliers)||[],onSelect:$e,onSearch:k,displayKey:t=>e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:t.displayName}),e.jsxs("div",{className:"text-sm text-gray-600",children:["Outstanding Balance: $",(t.pendingBalance||0).toFixed(2)]})]}),selectedItem:a,loading:Se,emptyMessage:U.length>0?"No suppliers found":"Start typing to search suppliers..."})]}),e.jsx("div",{className:`${u?"w-full":"flex-1"}`,children:a?e.jsx("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-3",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(He,{className:"h-5 w-5 text-gray-400"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium",children:a.displayName||a.name||a.companyName||"Unknown Supplier"}),e.jsx("p",{className:"text-sm text-gray-600 capitalize",children:a.businessType&&a.reliability?`${a.businessType} • ${a.reliability}`:a.businessType||a.reliability||"Supplier Information"}),e.jsxs("div",{className:"flex items-center space-x-4 mt-2",children:[e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("span",{className:"text-xs text-gray-500",children:"Outstanding Balance:"}),e.jsxs("span",{className:`text-sm font-medium ${(a.pendingBalance||0)>0?"text-red-600":"text-green-600"}`,children:["$",Math.round(a.pendingBalance||0)]})]}),a.phone&&e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(ht,{className:"h-3 w-3 text-gray-400"}),e.jsx("span",{className:"text-xs text-gray-500",children:a.phone})]}),a.email&&e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(et,{className:"h-3 w-3 text-gray-400"}),e.jsx("span",{className:"text-xs text-gray-500",children:a.email})]})]}),a.address&&e.jsxs("div",{className:"flex items-center space-x-1 mt-1",children:[e.jsx(tt,{className:"h-3 w-3 text-gray-400"}),e.jsx("span",{className:"text-xs text-gray-500",children:a.address})]})]})]})}):e.jsx("div",{className:"hidden lg:block"})})]}),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Product Selection & Cart"})}),e.jsxs("div",{className:"card-content",children:[e.jsx("div",{className:"mb-6",children:e.jsx(yt,{onAddProduct:_e})}),y.length===0?e.jsxs("div",{className:"p-8 text-center text-gray-500 border-t border-gray-200",children:[e.jsx(st,{className:"mx-auto h-12 w-12 text-gray-400"}),e.jsx("p",{className:"mt-2",children:"No items in cart"})]}):e.jsxs("div",{className:"space-y-4 border-t border-gray-200 pt-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h4",{className:"text-md font-medium text-gray-700",children:"Cart Items"}),e.jsxs("button",{type:"button",onClick:qe,className:"btn btn-secondary btn-sm flex items-center space-x-2",title:"Sort products alphabetically",children:[e.jsx(at,{className:"h-4 w-4"}),e.jsx("span",{children:"Sort A-Z"})]})]}),y.map((t,s)=>{var n;return e.jsx(bt,{item:t,index:s,onUpdateQuantity:Be,onUpdateCost:Oe,onRemove:pe},(n=t.product)==null?void 0:n._id)})]})]})]}),y.length>0&&e.jsxs("div",{className:"bg-gradient-to-br from-blue-50 to-indigo-50 border-2 border-blue-200 rounded-lg max-w-5xl ml-auto mt-4",children:[e.jsxs("div",{className:"px-6 py-4 border-b border-blue-200",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 text-right mb-4",children:"Purchase Details"}),e.jsxs("div",{className:"flex flex-nowrap gap-3 items-end justify-end",children:[e.jsxs("div",{className:"flex flex-col w-44",children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Invoice Number"}),e.jsx("input",{type:"text",value:T,onChange:t=>N(t.target.value),className:"input h-8 text-sm",placeholder:f?"Auto-generated":"Enter invoice number",disabled:f})]}),e.jsxs("div",{className:"flex flex-col w-48",children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Expected Delivery"}),e.jsx("input",{type:"date",value:A,onChange:t=>R(t.target.value),className:"input h-8 text-sm"})]}),e.jsxs("div",{className:"flex flex-col w-40",children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Tax Status"}),e.jsxs("div",{className:"flex items-center space-x-1 px-2 py-1 border border-gray-200 rounded h-8",children:[e.jsx("input",{type:"checkbox",id:"taxExempt",checked:F,onChange:t=>q(t.target.checked),className:"h-3 w-3 text-primary-600 focus:ring-primary-500 border-gray-300 rounded"}),e.jsx("div",{className:"flex-1",children:e.jsx("label",{htmlFor:"taxExempt",className:"text-xs font-medium text-gray-700 cursor-pointer",children:"Tax Exempt"})}),F&&e.jsx("div",{className:"text-green-600 text-xs font-medium",children:"✓"})]})]}),e.jsxs("div",{className:"flex flex-col w-[28rem]",children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Notes"}),e.jsx("input",{type:"text",value:S,onChange:t=>C(t.target.value),className:"input h-8 text-sm",placeholder:"Additional notes..."})]})]})]}),e.jsx("div",{className:"bg-gradient-to-r from-blue-500 to-indigo-600 px-6 py-4",children:e.jsx("h3",{className:"text-lg font-semibold text-white",children:"Order Summary"})}),e.jsxs("div",{className:"px-6 py-4",children:[e.jsxs("div",{className:"space-y-3 mb-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-800 font-semibold",children:"Subtotal:"}),e.jsx("span",{className:"text-xl font-bold text-gray-900",children:O.toFixed(2)})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-800 font-semibold",children:F?"Tax (Exempt):":"Tax (8%):"}),e.jsx("span",{className:"text-xl font-bold text-gray-900",children:X.toFixed(2)})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-800 font-semibold",children:"Purchase Total:"}),e.jsx("span",{className:"text-xl font-bold text-gray-900",children:I.toFixed(2)})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-800 font-semibold",children:"Previous Outstanding:"}),e.jsx("span",{className:"text-xl font-bold text-red-600",children:xe.toFixed(2)})]}),e.jsxs("div",{className:"flex justify-between items-center text-xl font-bold border-t-2 border-blue-400 pt-3 mt-2",children:[e.jsx("span",{className:"text-blue-900",children:"Total Payables:"}),e.jsx("span",{className:"text-blue-900 text-3xl",children:Le.toFixed(2)})]})]}),e.jsxs("div",{className:"bg-white rounded-lg p-4 shadow-sm",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 items-start",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-800 mb-2",children:"Apply Discount"}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs("select",{value:g.type,onChange:t=>Q({...g,type:t.target.value}),className:"px-3 py-2 border-2 border-blue-200 rounded-md bg-blue-50 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 font-medium h-[42px]",children:[e.jsx("option",{value:"amount",children:"Amount"}),e.jsx("option",{value:"percentage",children:"%"})]}),e.jsx("input",{type:"number",placeholder:g.type==="amount"?"Enter amount...":"Enter percentage...",value:g.value||"",onChange:t=>{const s=parseFloat(t.target.value)||0;Q({...g,value:s})},className:"flex-1 px-3 py-2 border-2 border-blue-200 rounded-md bg-blue-50 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 font-medium text-gray-900 h-[42px]",min:"0",step:g.type==="percentage"?"0.1":"0.01"})]}),g.value>0&&e.jsx("div",{className:"text-sm text-green-700 font-semibold mt-2 bg-green-50 px-2 py-1 rounded",children:g.type==="percentage"?`${g.value}% = ${ae.toFixed(2)} off`:`${g.value} off`})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-800 mb-2",children:"Payment Method"}),e.jsxs("select",{value:Y,onChange:t=>Z(t.target.value),className:"w-full px-3 py-2 border-2 border-blue-200 rounded-md bg-blue-50 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 font-medium text-gray-900 h-[42px]",children:[e.jsx("option",{value:"cash",children:"Cash"}),e.jsx("option",{value:"credit_card",children:"Credit Card"}),e.jsx("option",{value:"debit_card",children:"Debit Card"}),e.jsx("option",{value:"check",children:"Check"})]})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-800 mb-2",children:"Amount Paid"}),e.jsx("input",{type:"number",step:"0.01",value:M,onChange:t=>H(parseFloat(t.target.value)||0),onFocus:t=>t.target.select(),className:"w-full px-3 py-2 border-2 border-blue-200 rounded-md bg-blue-50 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 font-medium text-gray-900 text-lg h-[42px]",placeholder:"0.00"})]})]}),g.value>0&&e.jsx("div",{className:"mt-2",children:e.jsx("button",{onClick:()=>Q({type:"amount",value:0}),className:"px-3 py-1 bg-red-600 text-white rounded-md hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-red-500 text-sm",children:"Clear Discount"})})]})]}),e.jsxs("div",{className:"flex space-x-3 mt-6 px-6 pb-6",children:[y.length>0&&e.jsxs("button",{onClick:()=>{p([]),j(null),k(""),q(!0),Q({type:"amount",value:0}),H(0),Z("cash"),m.success("Cart cleared")},className:"btn btn-secondary flex-1",children:[e.jsx(ve,{className:"h-4 w-4 mr-2"}),"Clear Cart"]}),y.length>0&&e.jsxs("button",{onClick:()=>{const t={orderNumber:`PO-${Date.now()}`,orderType:"purchase",supplier:a==null?void 0:a._id,customer:a,customerInfo:a?{name:a.displayName,email:a.email,phone:a.phone,address:a.address||a.companyAddress||a.location,businessName:a.companyName}:null,items:y.map(s=>{var n;return{product:{name:((n=s.product)==null?void 0:n.name)||"Unknown Product"},quantity:s.quantity,unitPrice:s.costPerUnit}}),pricing:{subtotal:O,discountAmount:ae,taxAmount:X,isTaxExempt:F,total:I},payment:{method:Y,amountPaid:M,remainingBalance:I-M,isPartialPayment:M<I},createdAt:new Date,createdBy:{name:"Current User"},invoiceNumber:T,expectedDelivery:A,notes:S};oe(t),ce(!0)},className:"btn btn-secondary flex-1",children:[e.jsx(rt,{className:"h-4 w-4 mr-2"}),"Print Preview"]}),e.jsxs(nt,{onClick:re,isLoading:!1,className:"btn btn-primary btn-lg flex-2",children:[e.jsx(ct,{className:"h-4 w-4 mr-2"}),l!=null&&l.isEditMode?"Update Purchase Invoice":"Complete Purchase & Update Inventory"]})]})]}),e.jsx(mt,{isOpen:je,onClose:()=>{ce(!1),oe(null)},orderData:Ne,documentTitle:"Purchase Invoice",partyLabel:"Supplier"}),we&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-lg w-full",children:[e.jsxs("div",{className:"flex justify-between items-center p-6 border-b border-gray-200",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Export Purchase Report"}),e.jsx("button",{onClick:()=>{z(!1),J(""),W("")},className:"text-gray-400 hover:text-gray-600 transition-colors",children:e.jsx(ft,{className:"h-6 w-6"})})]}),e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"Export Format"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("label",{className:"flex items-center p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-gray-50",children:[e.jsx("input",{type:"radio",name:"format",value:"pdf",checked:E==="pdf",onChange:t=>G(t.target.value),className:"mr-3"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900",children:"PDF"}),e.jsx("div",{className:"text-sm text-gray-500",children:"Print-ready format"})]})]}),e.jsxs("label",{className:"flex items-center p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-gray-50",children:[e.jsx("input",{type:"radio",name:"format",value:"excel",checked:E==="excel",onChange:t=>G(t.target.value),className:"mr-3"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900",children:"Excel"}),e.jsx("div",{className:"text-sm text-gray-500",children:"Spreadsheet format"})]})]}),e.jsxs("label",{className:"flex items-center p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-gray-50",children:[e.jsx("input",{type:"radio",name:"format",value:"csv",checked:E==="csv",onChange:t=>G(t.target.value),className:"mr-3"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900",children:"CSV"}),e.jsx("div",{className:"text-sm text-gray-500",children:"Comma-separated values"})]})]}),e.jsxs("label",{className:"flex items-center p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-gray-50",children:[e.jsx("input",{type:"radio",name:"format",value:"json",checked:E==="json",onChange:t=>G(t.target.value),className:"mr-3"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900",children:"JSON"}),e.jsx("div",{className:"text-sm text-gray-500",children:"Data format"})]})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"Date Range (Optional)"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-600 mb-1",children:"From Date"}),e.jsx("input",{type:"date",value:_,onChange:t=>J(t.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-primary-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-600 mb-1",children:"To Date"}),e.jsx("input",{type:"date",value:V,onChange:t=>W(t.target.value),min:_,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-primary-500"})]})]}),(_||V)&&e.jsx("button",{type:"button",onClick:()=>{J(""),W("")},className:"mt-2 text-sm text-primary-600 hover:text-primary-700",children:"Clear dates"})]}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-4 border-t border-gray-200",children:[e.jsx("button",{onClick:()=>{z(!1),J(""),W("")},className:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50",disabled:ee,children:"Cancel"}),e.jsx("button",{onClick:Qe,disabled:ee,className:"px-4 py-2 text-sm font-medium text-white bg-primary-600 border border-transparent rounded-md hover:bg-primary-700 disabled:opacity-50 disabled:cursor-not-allowed",children:ee?"Exporting...":"Export"})]})]})})]})})]})})};export{Ot as Purchase};
