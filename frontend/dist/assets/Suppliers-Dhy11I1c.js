import{r as u,o as e,L as ne,X as J,W as Q,z as D,w as G,x as ie,Q as f,ai as oe,S as ce,a2 as V,ae as de,aA as me,az as W}from"./index-jd7Ax_Ed.js";import{u as xe}from"./useFuzzySearch-BrpeiQaU.js";import{D as re}from"./download-bwqK3ulf.js";import{U as ue}from"./upload-DdBv5t3-.js";import{F as he}from"./file-spreadsheet-BleMUJhf.js";import{C as pe}from"./check-circle-8oGxTki5.js";import{A as ge}from"./alert-circle-yrAHCiEw.js";import{F as je}from"./filter-CQLYjJyW.js";import{C as ye}from"./chevron-up-DEWj5144.js";import{C as be}from"./chevron-down-BFYGIyCo.js";import{P as ve}from"./phone-Dkvr6QGJ.js";import{N as Ne}from"./NotesPanel-Bd7HDD1M.js";import{b as fe,c as we,d as Ce,e as Se,f as Ae,g as ke,h as Ee}from"./suppliersApi-CEk3wVdz.js";import{u as Pe}from"./chartOfAccountsApi-DmTn-F78.js";import{a as Te}from"./citiesApi-CNkIWyqV.js";import{P as Le}from"./plus-C2o0386P.js";import{S as Ie}from"./star-DDOZYr3u.js";import{M as Fe}from"./message-square-DtCe3QVP.js";import{P as Be}from"./pen-square-CzKMgeH3.js";import{T as ze}from"./trash-2-DCbqoVbR.js";import"./useMutation-n-l4Ns3H.js";import"./history-D1YUGYyd.js";import"./lock-DxijO8f_.js";const Oe=({onImportComplete:a,filters:k={}})=>{const[E,C]=u.useState(!1),[t,r]=u.useState(!1),[w,v]=u.useState(null),[g,y]=u.useState(null),[i,x]=u.useState(!1),j=async()=>{try{C(!0);const c=await Q.exportExcel(k),b=await Q.downloadFile(c.data.filename),N=new Blob([b.data],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),A=document.createElement("a"),P=URL.createObjectURL(N);A.setAttribute("href",P),A.setAttribute("download",c.data.filename),A.style.visibility="hidden",document.body.appendChild(A),A.click(),document.body.removeChild(A),D(`Exported ${c.data.recordCount} suppliers to Excel`)}catch(c){G(c,"Excel Export")}finally{C(!1)}},h=c=>{const b=c.target.files[0];if(b){if(!["application/vnd.ms-excel","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"].includes(b.mimetype)&&!b.name.match(/\.(xlsx|xls)$/)){ie("Invalid file type. Only Excel files are allowed."),c.target.value="";return}if(b.size>10*1024*1024){ie("File size exceeds 10MB limit"),c.target.value="";return}v(b)}},O=async()=>{if(!w){f.error("Please select a file to import");return}try{r(!0);const c=await Q.importExcel(w);y(c.data.results),c.data.results.success>0&&(D(`Successfully imported ${c.data.results.success} suppliers`),a&&a()),c.data.results.errors.length>0&&oe(`${c.data.results.errors.length} suppliers failed to import`)}catch(c){G(c,"Supplier Import")}finally{r(!1)}},F=async()=>{try{const c=await Q.downloadTemplate(),b=new Blob([c.data],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),N=document.createElement("a"),A=URL.createObjectURL(b);N.setAttribute("href",A),N.setAttribute("download","supplier_template.xlsx"),N.style.visibility="hidden",document.body.appendChild(N),N.click(),document.body.removeChild(N),D("Template downloaded successfully")}catch(c){G(c,"Template Download")}},S=()=>{v(null),y(null),x(!1)};return e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Import / Export Suppliers"}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs("div",{className:"relative group",children:[e.jsxs("button",{onClick:F,className:"btn btn-outline btn-sm",children:[e.jsx(re,{className:"h-4 w-4 mr-2"}),"Template"]}),e.jsxs("div",{className:"absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 px-3 py-2 bg-gray-900 text-white text-sm rounded-lg opacity-0 group-hover:opacity-100 transition-opacity duration-200 pointer-events-none whitespace-nowrap z-10",children:[e.jsxs("div",{className:"text-xs space-y-1",children:[e.jsx("div",{children:"• Download Excel template file"}),e.jsx("div",{children:"• Pre-formatted with correct columns"}),e.jsx("div",{children:"• Shows required and optional fields"}),e.jsx("div",{children:"• Use this to prepare import data"})]}),e.jsx("div",{className:"absolute top-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-l-4 border-r-4 border-t-4 border-transparent border-t-gray-900"})]})]}),e.jsxs("div",{className:"relative group",children:[e.jsxs(ne,{onClick:j,isLoading:E,className:"btn btn-secondary btn-sm",children:[e.jsx(re,{className:"h-4 w-4 mr-2"}),"Export Excel"]}),e.jsxs("div",{className:"absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 px-3 py-2 bg-gray-900 text-white text-sm rounded-lg opacity-0 group-hover:opacity-100 transition-opacity duration-200 pointer-events-none whitespace-nowrap z-10",children:[e.jsxs("div",{className:"text-xs space-y-1",children:[e.jsx("div",{children:"• Exports all suppliers to Excel file"}),e.jsx("div",{children:"• Includes all supplier data and fields"}),e.jsx("div",{children:"• File format: Excel (.xlsx)"}),e.jsx("div",{children:"• Filtered results based on current search"})]}),e.jsx("div",{className:"absolute top-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-l-4 border-r-4 border-t-4 border-transparent border-t-gray-900"})]})]}),e.jsxs("div",{className:"relative group",children:[e.jsxs("button",{onClick:()=>x(!0),className:"btn btn-primary btn-sm",children:[e.jsx(ue,{className:"h-4 w-4 mr-2"}),"Import Suppliers"]}),e.jsxs("div",{className:"absolute bottom-full right-0 mb-2 px-3 py-2 bg-gray-900 text-white text-sm rounded-lg opacity-0 group-hover:opacity-100 transition-opacity duration-200 pointer-events-none whitespace-nowrap z-10",children:[e.jsxs("div",{className:"text-xs space-y-1",children:[e.jsx("div",{children:"• Download template for required format"}),e.jsx("div",{children:"• Required: Company Name, Contact Person"}),e.jsx("div",{children:"• Supported: Excel (.xlsx), Max 10MB"}),e.jsx("div",{children:"• Duplicates will be skipped"})]}),e.jsx("div",{className:"absolute top-full right-4 w-0 h-0 border-l-4 border-r-4 border-t-4 border-transparent border-t-gray-900"})]})]})]})]}),i&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-md w-full mx-4",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Import Suppliers"}),e.jsx("button",{onClick:S,className:"text-gray-400 hover:text-gray-600",children:e.jsx(J,{className:"h-5 w-5"})})]}),e.jsx("div",{className:"p-6",children:g?e.jsxs("div",{children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-3",children:"Import Results"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{className:"text-center p-3 bg-green-50 rounded-lg",children:[e.jsx(pe,{className:"h-6 w-6 text-green-600 mx-auto mb-1"}),e.jsx("div",{className:"text-lg font-semibold text-green-600",children:g.success}),e.jsx("div",{className:"text-sm text-green-700",children:"Success"})]}),e.jsxs("div",{className:"text-center p-3 bg-red-50 rounded-lg",children:[e.jsx(ge,{className:"h-6 w-6 text-red-600 mx-auto mb-1"}),e.jsx("div",{className:"text-lg font-semibold text-red-600",children:g.errors.length}),e.jsx("div",{className:"text-sm text-red-700",children:"Errors"})]})]}),g.errors.length>0&&e.jsxs("div",{className:"max-h-40 overflow-y-auto",children:[e.jsx("h5",{className:"font-medium text-gray-900 mb-2",children:"Errors:"}),e.jsxs("div",{className:"space-y-2",children:[g.errors.slice(0,10).map((c,b)=>e.jsxs("div",{className:"text-sm text-red-600 bg-red-50 p-2 rounded",children:["Row ",c.row,": ",c.error]},b)),g.errors.length>10&&e.jsxs("div",{className:"text-sm text-gray-500",children:["... and ",g.errors.length-10," more errors"]})]})]})]}),e.jsx("div",{className:"flex justify-end",children:e.jsx("button",{onClick:S,className:"btn btn-primary btn-sm",children:"Close"})})]}):e.jsxs("div",{children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Select Excel File"}),e.jsx("input",{type:"file",accept:".xlsx,.xls",onChange:h,className:"input w-full"})]}),w&&e.jsx("div",{className:"mb-4 p-3 bg-gray-50 rounded-lg",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(he,{className:"h-4 w-4 text-gray-600 mr-2"}),e.jsx("span",{className:"text-sm text-gray-700",children:w.name}),e.jsxs("span",{className:"text-xs text-gray-500 ml-auto",children:[(w.size/1024/1024).toFixed(2)," MB"]})]})}),e.jsxs("div",{className:"flex justify-end space-x-3",children:[e.jsx("button",{onClick:S,className:"btn btn-secondary btn-sm",children:"Cancel"}),e.jsx(ne,{onClick:O,isLoading:t,disabled:!w,className:"btn btn-primary btn-sm",children:"Import Suppliers"})]})]})})]})})]})},$e=({filters:a,onFiltersChange:k,onClearFilters:E})=>{const[C,t]=u.useState(!1),r=(i,x)=>{k({...a,[i]:x})},w=i=>{const x={...a};delete x[i],k(x)},v=()=>{k({}),E&&E()},g=Object.keys(a).some(i=>a[i]!==""&&a[i]!==null&&a[i]!==void 0),y=()=>Object.keys(a).filter(i=>a[i]!==""&&a[i]!==null&&a[i]!==void 0).length;return e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 cursor-pointer hover:bg-gray-50",onClick:()=>t(!C),children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(je,{className:"h-5 w-5 text-gray-600"}),e.jsx("span",{className:"font-medium text-gray-900",children:"Filters"}),g&&e.jsxs("span",{className:"bg-blue-100 text-blue-800 text-xs font-medium px-2 py-1 rounded-full",children:[y()," active"]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[g&&e.jsx("button",{onClick:i=>{i.stopPropagation(),v()},className:"text-sm text-red-600 hover:text-red-800 font-medium",children:"Clear All"}),C?e.jsx(ye,{className:"h-4 w-4 text-gray-400"}):e.jsx(be,{className:"h-4 w-4 text-gray-400"})]})]}),C&&e.jsxs("div",{className:"border-t border-gray-200 p-4 space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx(ce,{className:"h-4 w-4 inline mr-1"}),"Search Suppliers"]}),e.jsx("input",{type:"text",placeholder:"Company name, contact...",value:a.search||"",onChange:i=>r("search",i.target.value),className:"input text-sm"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx(V,{className:"h-4 w-4 inline mr-1"}),"Status"]}),e.jsxs("select",{value:a.status||"",onChange:i=>r("status",i.target.value),className:"input text-sm",children:[e.jsx("option",{value:"",children:"All Statuses"}),e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"inactive",children:"Inactive"})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx(de,{className:"h-4 w-4 inline mr-1"}),"Email Status"]}),e.jsxs("select",{value:a.emailStatus||"",onChange:i=>r("emailStatus",i.target.value),className:"input text-sm",children:[e.jsx("option",{value:"",children:"All Email Statuses"}),e.jsx("option",{value:"verified",children:"Verified"}),e.jsx("option",{value:"unverified",children:"Unverified"}),e.jsx("option",{value:"no-email",children:"No Email"})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx(ve,{className:"h-4 w-4 inline mr-1"}),"Phone Status"]}),e.jsxs("select",{value:a.phoneStatus||"",onChange:i=>r("phoneStatus",i.target.value),className:"input text-sm",children:[e.jsx("option",{value:"",children:"All Phone Statuses"}),e.jsx("option",{value:"verified",children:"Verified"}),e.jsx("option",{value:"unverified",children:"Unverified"}),e.jsx("option",{value:"no-phone",children:"No Phone"})]})]})]}),g&&e.jsxs("div",{className:"border-t border-gray-200 pt-4",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-700 mb-3",children:"Active Filters:"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:Object.entries(a).map(([i,x])=>{if(!x||x==="")return null;let j,h;switch(i){case"search":j="Search",h=`"${x}"`;break;case"status":j="Status",h=x.charAt(0).toUpperCase()+x.slice(1);break;case"emailStatus":j="Email",h=x==="verified"?"Verified":x==="unverified"?"Unverified":x==="no-email"?"No Email":x;break;case"phoneStatus":j="Phone",h=x==="verified"?"Verified":x==="unverified"?"Unverified":x==="no-phone"?"No Phone":x;break;default:j=i.charAt(0).toUpperCase()+i.slice(1),h=x}return e.jsxs("span",{className:"inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-800",children:[j,": ",h,e.jsx("button",{onClick:()=>w(i),className:"ml-1 inline-flex items-center justify-center w-4 h-4 rounded-full hover:bg-blue-200",children:e.jsx(J,{className:"h-3 w-3"})})]},i)})})]})]})]})},Z={companyName:"",contactPerson:{name:"",title:""},email:"",phone:"",website:"",businessType:"wholesaler",paymentTerms:"net30",creditLimit:0,openingBalance:0,rating:3,reliability:"average",minOrderAmount:0,minOrderQuantity:1,leadTime:7,status:"active",notes:"",ledgerAccount:"",addresses:[{type:"both",street:"",city:"",state:"",zipCode:"",country:"US",isDefault:!0}]},Me=({supplier:a,onSave:k,onCancel:E,isOpen:C})=>{var q;const[t,r]=u.useState(()=>({...Z})),[w,v]=u.useState(!1),[g,y]=u.useState(!1),[i,x]=u.useState(!1),[j,h]=u.useState(!1),[O,F]=u.useState(!1),[S,c]=u.useState(!1),[b]=Ae(),[N]=ke(),[A]=Ee(),{data:P=[],isLoading:X}=Pe({accountType:"liability",accountCategory:"current_liabilities",includePartyAccounts:"true",isActive:"true"}),{data:$=[],isLoading:M}=Te(),L=u.useMemo(()=>{if(!Array.isArray(P))return[];const l=P.filter(s=>{const m=(s.accountName||s.name||"").toLowerCase(),d=Array.isArray(s.tags)?s.tags:[];return m.includes("payable")||d.includes("supplier")||d.includes("accounts_payable")||s.accountCode&&s.accountCode.startsWith("21")}),o=P.filter(s=>s.allowDirectPosting!==!1);return[...l.length>0?l:o.length>0?o:P].sort((s,m)=>{const d=(s.accountCode||"").toString(),T=(m.accountCode||"").toString();return d.localeCompare(T,void 0,{numeric:!0})})},[P]);u.useEffect(()=>{var l,o,n,s;if(L.length>0){const m=L.find(d=>(d.accountName||d.name||"").toLowerCase()==="accounts payable"||d.accountCode==="2110")||L[0];if(a){const d=typeof a.openingBalance=="number"?a.openingBalance:a.pendingBalance&&a.pendingBalance>0?a.pendingBalance:a.advanceBalance?-a.advanceBalance:0;r({...Z,...a,contactPerson:{name:((l=a.contactPerson)==null?void 0:l.name)||"",title:((o=a.contactPerson)==null?void 0:o.title)||""},addresses:(n=a.addresses)!=null&&n.length?a.addresses:Z.addresses,openingBalance:d,ledgerAccount:((s=a.ledgerAccount)==null?void 0:s._id)||a.ledgerAccount||m._id||m.id||""})}else{const d=m._id||m.id;d&&r(T=>({...T,ledgerAccount:d}))}}},[a,L]),u.useEffect(()=>{if(!t.email||t.email.trim()===""){y(!1);return}if(!/^[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,}$/i.test(t.email)){y(!1);return}if(a&&a.email&&a.email.toLowerCase()===t.email.toLowerCase()){y(!1);return}const o=setTimeout(async()=>{var n;try{v(!0);const s=(a==null?void 0:a._id)||null,m=await b({email:t.email,excludeId:s}).unwrap(),d=((n=m==null?void 0:m.data)==null?void 0:n.exists)??(m==null?void 0:m.exists);y(!!d)}catch(s){console.error("Error checking email:",s),y(!1)}finally{v(!1)}},500);return()=>clearTimeout(o)},[t.email,a]),u.useEffect(()=>{if(!t.companyName||t.companyName.trim()===""){h(!1);return}if(a&&a.companyName&&a.companyName.trim().toLowerCase()===t.companyName.trim().toLowerCase()){h(!1);return}const l=setTimeout(async()=>{var o;try{x(!0);const n=(a==null?void 0:a._id)||null,s=await N({companyName:t.companyName,excludeId:n}).unwrap(),m=((o=s==null?void 0:s.data)==null?void 0:o.exists)??(s==null?void 0:s.exists);h(!!m)}catch(n){console.error("Error checking company name:",n),h(!1)}finally{x(!1)}},500);return()=>clearTimeout(l)},[t.companyName,a]),u.useEffect(()=>{var o,n;if(!((o=t.contactPerson)!=null&&o.name)||t.contactPerson.name.trim()===""){c(!1);return}if(a&&((n=a.contactPerson)!=null&&n.name)&&a.contactPerson.name.trim().toLowerCase()===t.contactPerson.name.trim().toLowerCase()){c(!1);return}const l=setTimeout(async()=>{var s;try{F(!0);const m=(a==null?void 0:a._id)||null,d=await A({contactName:t.contactPerson.name,excludeId:m}).unwrap(),T=((s=d==null?void 0:d.data)==null?void 0:s.exists)??(d==null?void 0:d.exists);c(!!T)}catch(m){console.error("Error checking contact name:",m),c(!1)}finally{F(!1)}},500);return()=>clearTimeout(l)},[(q=t.contactPerson)==null?void 0:q.name,a]),u.useEffect(()=>{y(!1),h(!1),c(!1)},[a]);const R=l=>{var o,n,s;if(l.preventDefault(),!((o=t.companyName)!=null&&o.trim())){f.error("Company name is required");return}if(!((s=(n=t.contactPerson)==null?void 0:n.name)!=null&&s.trim())){f.error("Contact name is required");return}if(g){f.error("Please use a different email address");return}if(j){f.error("Please use a different company name");return}if(S){f.error("Please use a different contact name");return}k({...t,creditLimit:parseFloat(t.creditLimit)||0,openingBalance:parseFloat(t.openingBalance)||0})},B=(l,o,n)=>{const s=[...t.addresses];s[l]={...s[l],[o]:n},r({...t,addresses:s})};return C?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:e.jsx("div",{className:"bg-white rounded-lg max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:a?"Edit Supplier":"Add New Supplier"}),e.jsx("button",{onClick:E,className:"p-2 text-gray-400 hover:text-gray-600",children:e.jsx(J,{className:"h-5 w-5"})})]}),e.jsxs("form",{onSubmit:R,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Company Information"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Company Name *"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",required:!0,value:t.companyName,onChange:l=>r({...t,companyName:l.target.value}),className:`input ${j?"border-red-500":""}`,placeholder:"Enter company name"}),i&&e.jsx("div",{className:"absolute right-3 top-1/2 transform -translate-y-1/2",children:e.jsx(W,{size:"sm"})})]}),j&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:"Company name already exists"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Business Type"}),e.jsxs("select",{value:t.businessType,onChange:l=>r({...t,businessType:l.target.value}),className:"input",children:[e.jsx("option",{value:"manufacturer",children:"Manufacturer"}),e.jsx("option",{value:"distributor",children:"Distributor"}),e.jsx("option",{value:"wholesaler",children:"Wholesaler"}),e.jsx("option",{value:"dropshipper",children:"Dropshipper"}),e.jsx("option",{value:"other",children:"Other"})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Ledger Account ",e.jsx("span",{className:"text-gray-400 text-xs",children:"(Auto-linked)"})]}),X?e.jsx("div",{className:"input bg-gray-50 text-gray-500",children:"Loading ledger account..."}):(()=>{const l=t.ledgerAccount,o=L.find(s=>(s._id||s.id)===l||(s.accountName||s.name||"").toLowerCase()==="accounts payable"||s.accountCode==="2110")||L[0],n=o?`${o.accountCode||"2110"} - ${o.accountName||o.name||"Accounts Payable"}`:"2110 - Accounts Payable";return e.jsxs(e.Fragment,{children:[e.jsx("input",{type:"text",value:n,className:"input bg-gray-50 text-gray-700 cursor-not-allowed",readOnly:!0,disabled:!0}),e.jsx("input",{type:"hidden",value:t.ledgerAccount}),e.jsxs("p",{className:"text-xs text-blue-600 mt-1",children:[e.jsx("span",{className:"font-medium",children:"ℹ️ Information:"}),' Suppliers are automatically linked to the "Accounts Payable" account (2110) for accounting purposes. This cannot be changed.']})]})})()]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Contact Person"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Name *"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",required:!0,value:t.contactPerson.name,onChange:l=>r({...t,contactPerson:{...t.contactPerson,name:l.target.value}}),className:`input ${S?"border-red-500":""}`,placeholder:"Enter full name"}),O&&e.jsx("div",{className:"absolute right-3 top-1/2 transform -translate-y-1/2",children:e.jsx(W,{size:"sm"})})]}),S&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:"Contact name already exists"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Title"}),e.jsx("input",{type:"text",value:t.contactPerson.title,onChange:l=>r({...t,contactPerson:{...t.contactPerson,title:l.target.value}}),className:"input",placeholder:"Job title"})]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Contact Information"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Email"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"email",value:t.email,onChange:l=>r({...t,email:l.target.value}),className:`input ${g?"border-red-500":""}`,placeholder:"email@company.com (optional)"}),w&&e.jsx("div",{className:"absolute right-3 top-1/2 transform -translate-y-1/2",children:e.jsx(W,{size:"sm"})})]}),g&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:"Email already exists"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Phone"}),e.jsx("input",{type:"tel",value:t.phone,onChange:l=>r({...t,phone:l.target.value}),className:"input",placeholder:"(555) 123-4567"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Website"}),e.jsx("input",{type:"url",value:t.website,onChange:l=>r({...t,website:l.target.value}),className:"input",placeholder:"https://company.com"})]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Business Terms"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Payment Terms"}),e.jsxs("select",{value:t.paymentTerms,onChange:l=>r({...t,paymentTerms:l.target.value}),className:"input",children:[e.jsx("option",{value:"cash",children:"Cash"}),e.jsx("option",{value:"net15",children:"Net 15"}),e.jsx("option",{value:"net30",children:"Net 30"}),e.jsx("option",{value:"net45",children:"Net 45"}),e.jsx("option",{value:"net60",children:"Net 60"}),e.jsx("option",{value:"net90",children:"Net 90"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Credit Limit ($)"}),e.jsx("input",{type:"number",min:"0",value:t.creditLimit,onChange:l=>r({...t,creditLimit:parseFloat(l.target.value)||0}),className:"input",placeholder:"0"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Opening Balance ($)"}),e.jsx("input",{type:"number",step:"0.01",value:t.openingBalance,onChange:l=>r({...t,openingBalance:parseFloat(l.target.value)||0}),className:"input",placeholder:"0.00"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Positive means you owe the supplier. Use a negative value if the supplier has an advance/credit."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Lead Time (days)"}),e.jsx("input",{type:"number",min:"0",value:t.leadTime,onChange:l=>r({...t,leadTime:parseInt(l.target.value)||0}),className:"input",placeholder:"7"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Min Order Amount ($)"}),e.jsx("input",{type:"number",min:"0",value:t.minOrderAmount,onChange:l=>r({...t,minOrderAmount:parseFloat(l.target.value)||0}),className:"input",placeholder:"0"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Rating (1-5)"}),e.jsxs("select",{value:t.rating,onChange:l=>r({...t,rating:parseInt(l.target.value)}),className:"input",children:[e.jsx("option",{value:1,children:"1 Star"}),e.jsx("option",{value:2,children:"2 Stars"}),e.jsx("option",{value:3,children:"3 Stars"}),e.jsx("option",{value:4,children:"4 Stars"}),e.jsx("option",{value:5,children:"5 Stars"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Reliability"}),e.jsxs("select",{value:t.reliability,onChange:l=>r({...t,reliability:l.target.value}),className:"input",children:[e.jsx("option",{value:"excellent",children:"Excellent"}),e.jsx("option",{value:"good",children:"Good"}),e.jsx("option",{value:"average",children:"Average"}),e.jsx("option",{value:"poor",children:"Poor"})]})]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Address"}),e.jsx("div",{className:"space-y-4",children:t.addresses.map((l,o)=>e.jsx("div",{className:"border border-gray-200 rounded-lg p-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Street Address"}),e.jsx("input",{type:"text",value:l.street,onChange:n=>B(o,"street",n.target.value),className:"input",placeholder:"123 Main St"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"City *"}),e.jsxs("select",{value:l.city||"",onChange:n=>B(o,"city",n.target.value),className:"input",required:!0,disabled:M,children:[e.jsx("option",{value:"",children:"Select a city"}),Array.isArray($)&&$.map(n=>e.jsxs("option",{value:n.name,children:[n.name,n.state?`, ${n.state}`:""]},n._id||n.name))]}),M&&e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Loading cities..."}),!M&&$.length===0&&e.jsx("p",{className:"text-xs text-amber-600 mt-1",children:"No cities available. Please add cities first."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"State"}),e.jsx("input",{type:"text",value:l.state,onChange:n=>B(o,"state",n.target.value),className:"input",placeholder:"State"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"ZIP Code"}),e.jsx("input",{type:"text",value:l.zipCode,onChange:n=>B(o,"zipCode",n.target.value),className:"input",placeholder:"12345"})]})]})},o))})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Status & Notes"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Status"}),e.jsxs("select",{value:t.status,onChange:l=>r({...t,status:l.target.value}),className:"input",children:[e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"inactive",children:"Inactive"}),e.jsx("option",{value:"suspended",children:"Suspended"}),e.jsx("option",{value:"blacklisted",children:"Blacklisted"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Notes"}),e.jsx("textarea",{value:t.notes,onChange:l=>r({...t,notes:l.target.value}),className:"input",rows:"3",placeholder:"Additional notes about this supplier..."})]})]})]}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-6 border-t border-gray-200",children:[e.jsx("button",{type:"button",onClick:E,className:"btn btn-secondary",children:"Cancel"}),e.jsx("button",{type:"submit",className:"btn btn-primary",children:a?"Update Supplier":"Add Supplier"})]})]})]})})}):null},cs=()=>{var n;const[a,k]=u.useState(""),[E,C]=u.useState({}),[t,r]=u.useState(null),[w,v]=u.useState(!1),[g,y]=u.useState(!1),[i,x]=u.useState(null),j={search:a,limit:999999,...E},{data:h,isLoading:O,error:F,refetch:S}=fe(j,{refetchOnMountOrArgChange:!0}),[c,{isLoading:b}]=we(),[N,{isLoading:A}]=Ce(),[P,{isLoading:X}]=Se(),$=s=>{C(s)},M=()=>{C({}),k("")},L=((n=h==null?void 0:h.data)==null?void 0:n.suppliers)||(h==null?void 0:h.suppliers)||[],R=xe(L,a,["companyName","contactPerson.name","email","phone"],{threshold:.4,minScore:.3,limit:null}),B=s=>{var d,T,Y,H,K,ee,se,te,ae,le;const m={companyName:(d=s.companyName)==null?void 0:d.trim(),contactPerson:{name:(Y=(T=s.contactPerson)==null?void 0:T.name)==null?void 0:Y.trim(),title:(K=(H=s.contactPerson)==null?void 0:H.title)==null?void 0:K.trim()},email:((ee=s.email)==null?void 0:ee.trim())||void 0,phone:((se=s.phone)==null?void 0:se.trim())||void 0,website:((te=s.website)==null?void 0:te.trim())||void 0,businessType:s.businessType,paymentTerms:s.paymentTerms,creditLimit:Number(s.creditLimit)||0,rating:Number(s.rating)||3,reliability:s.reliability,minOrderAmount:Number(s.minOrderAmount)||0,minOrderQuantity:Number(s.minOrderQuantity)||1,leadTime:Number(s.leadTime)||7,status:s.status,notes:((ae=s.notes)==null?void 0:ae.trim())||void 0,addresses:((le=s.addresses)==null?void 0:le.map(p=>{var I,z,U,_;return{type:p.type,street:(I=p.street)==null?void 0:I.trim(),city:(z=p.city)==null?void 0:z.trim(),state:(U=p.state)==null?void 0:U.trim(),zipCode:(_=p.zipCode)==null?void 0:_.trim(),country:p.country||"US",isDefault:p.isDefault||!1}}))||[]};t?N({id:t._id,data:m}).unwrap().then(()=>{f.success("Supplier updated successfully!"),v(!1),r(null),S()}).catch(p=>{var I;f.error(((I=p==null?void 0:p.data)==null?void 0:I.message)||"Failed to update supplier")}):c(m).unwrap().then(()=>{f.success("Supplier created successfully!"),v(!1),r(null),S()}).catch(p=>{var U,_;const I=((U=p==null?void 0:p.data)==null?void 0:U.message)||"Failed to create supplier",z=(_=p==null?void 0:p.data)==null?void 0:_.errors;z&&Array.isArray(z)?f.error(`${I}: ${z.join(", ")}`):f.error(I)})},q=s=>{r(s),v(!0)},l=s=>{window.confirm(`Are you sure you want to delete ${s.companyName}?`)&&P(s._id).unwrap().then(()=>{f.success("Supplier deleted successfully!"),S()}).catch(m=>{var d;f.error(((d=m==null?void 0:m.data)==null?void 0:d.message)||"Failed to delete supplier")})},o=()=>{r(null),v(!0)};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Suppliers"}),e.jsx("p",{className:"text-gray-600",children:"Manage your supplier relationships and information"})]}),e.jsx("div",{className:"flex-shrink-0",children:e.jsxs("button",{onClick:o,className:"btn btn-primary btn-md w-full sm:w-auto",children:[e.jsx(Le,{className:"h-4 w-4 mr-2"}),"Add Supplier"]})})]}),e.jsx("div",{className:"flex items-center space-x-4",children:e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(ce,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search suppliers...",value:a,onChange:s=>k(s.target.value),className:"input pl-10"})]})}),e.jsx(Oe,{onImportComplete:()=>queryClient.invalidateQueries("suppliers"),filters:j}),e.jsx($e,{filters:E,onFiltersChange:$,onClearFilters:M}),O?e.jsx(me,{count:6}):F?e.jsx("div",{className:"card",children:e.jsxs("div",{className:"card-content text-center py-12",children:[e.jsx(V,{className:"mx-auto h-12 w-12 text-red-400"}),e.jsx("h3",{className:"mt-4 text-lg font-medium text-gray-900",children:"Error loading suppliers"}),e.jsx("p",{className:"mt-2 text-gray-600",children:F.message})]})}):R.length>0?e.jsx("div",{className:"card w-full",children:e.jsxs("div",{className:"card-content p-0 w-full",children:[e.jsx("div",{className:"bg-gray-50 px-8 py-6 border-b border-gray-200",children:e.jsxs("div",{className:"grid grid-cols-12 gap-6 items-center",children:[e.jsxs("div",{className:"col-span-4",children:[e.jsx("h3",{className:"text-base font-medium text-gray-700",children:"Company Name"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Contact Person"})]}),e.jsx("div",{className:"col-span-2",children:e.jsx("h3",{className:"text-base font-medium text-gray-700",children:"Email"})}),e.jsx("div",{className:"col-span-1",children:e.jsx("h3",{className:"text-base font-medium text-gray-700",children:"Phone"})}),e.jsx("div",{className:"col-span-1",children:e.jsx("h3",{className:"text-base font-medium text-gray-700",children:"Status"})}),e.jsx("div",{className:"col-span-1",children:e.jsx("h3",{className:"text-base font-medium text-gray-700",children:"Type"})}),e.jsx("div",{className:"col-span-1",children:e.jsx("h3",{className:"text-base font-medium text-gray-700",children:"Rating"})}),e.jsx("div",{className:"col-span-1",children:e.jsx("h3",{className:"text-base font-medium text-gray-700",children:"Credit"})}),e.jsx("div",{className:"col-span-1",children:e.jsx("h3",{className:"text-base font-medium text-gray-700",children:"Actions"})})]})}),e.jsx("div",{className:"divide-y divide-gray-200",children:R.map(s=>e.jsx("div",{className:"px-8 py-6 hover:bg-gray-50",children:e.jsxs("div",{className:"grid grid-cols-12 gap-6 items-center",children:[e.jsx("div",{className:"col-span-4",children:e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx(V,{className:"h-6 w-6 text-gray-400"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-base font-medium text-gray-900",children:s.companyName}),e.jsx("p",{className:"text-sm text-gray-500",children:s.contactPerson.name})]})]})}),e.jsx("div",{className:"col-span-2",children:e.jsx("p",{className:"text-sm text-gray-600",children:s.email||"-"})}),e.jsx("div",{className:"col-span-1",children:e.jsx("p",{className:"text-sm text-gray-600",children:s.phone||"-"})}),e.jsx("div",{className:"col-span-1",children:e.jsx("span",{className:`badge ${s.status==="active"?"badge-success":s.status==="inactive"?"badge-gray":s.status==="suspended"?"badge-danger":"badge-gray"}`,children:s.status})}),e.jsx("div",{className:"col-span-1",children:e.jsx("span",{className:`badge ${s.businessType==="wholesaler"?"badge-info":"badge-gray"}`,children:s.businessType})}),e.jsx("div",{className:"col-span-1",children:e.jsxs("div",{className:"flex items-center",children:[[...Array(5)].map((m,d)=>e.jsx(Ie,{className:`h-3 w-3 ${d<s.rating?"text-yellow-400 fill-current":"text-gray-300"}`},d)),e.jsxs("span",{className:"ml-1 text-xs text-gray-600",children:["(",s.rating,")"]})]})}),e.jsx("div",{className:"col-span-1",children:e.jsx("p",{className:"text-sm text-gray-600",children:Math.round(s.creditLimit||0)})}),e.jsx("div",{className:"col-span-1",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("button",{onClick:()=>{x({type:"Supplier",id:s._id,name:s.companyName}),y(!0)},className:"text-green-600 hover:text-green-800",title:"Notes",children:e.jsx(Fe,{className:"h-5 w-5"})}),e.jsx("button",{onClick:()=>q(s),className:"text-primary-600 hover:text-primary-800",children:e.jsx(Be,{className:"h-5 w-5"})}),e.jsx("button",{onClick:()=>l(s),className:"text-danger-600 hover:text-danger-800",children:e.jsx(ze,{className:"h-5 w-5"})})]})})]})},s._id))})]})}):e.jsx("div",{className:"card",children:e.jsxs("div",{className:"card-content text-center py-12",children:[e.jsx(V,{className:"mx-auto h-12 w-12 text-gray-400"}),e.jsx("h3",{className:"mt-4 text-lg font-medium text-gray-900",children:"No suppliers found"}),e.jsx("p",{className:"mt-2 text-gray-600",children:a?"Try adjusting your search terms.":"Get started by adding your first supplier"}),!a&&e.jsx("button",{onClick:o,className:"mt-4 btn btn-primary",children:"Add Your First Supplier"})]})}),e.jsx(Me,{supplier:t,onSave:B,onCancel:()=>{v(!1),r(null)},isOpen:w}),g&&i&&e.jsx(Ne,{entityType:i.type,entityId:i.id,entityName:i.name,onClose:()=>{y(!1),x(null)}})]})};export{cs as Suppliers};
