import{aC as A,r as c,c as C,o as e,S as $,R as E,N as I,P as B,ca as L,O as P,X as _,L as Q,w as D,z as M,cb as F,B as R}from"./index-jd7Ax_Ed.js";import{u as O}from"./useMutation-n-l4Ns3H.js";import{V as v,a as V}from"./ValidatedInput-Cg4yPCj4.js";import{P as U}from"./plus-C2o0386P.js";import{A as q}from"./alert-circle-yrAHCiEw.js";import"./check-circle-8oGxTki5.js";import"./eye-off-Dv_sEjAY.js";import"./eye-DMmE8Niy.js";const ee=()=>{const o=A(),[w,u]=c.useState(""),[m,s]=c.useState(""),[n,x]=c.useState(""),[f,d]=c.useState(!1),{data:p,isLoading:g,refetch:y}=C(["productTransformations",m,n],()=>F.getTransformations({baseProduct:m||void 0,status:n||void 0}),{select:t=>({transformations:(t==null?void 0:t.transformations)||[]})}),{data:l}=C(["products","all"],()=>R.getProducts({}),{select:t=>{var i;return{products:((i=t==null?void 0:t.data)==null?void 0:i.products)||[]}}}),h=(p==null?void 0:p.transformations)||[],j=(l==null?void 0:l.products)||[],N=()=>{d(!1)},S=[{value:"",label:"All Statuses"},{value:"pending",label:"Pending"},{value:"in_progress",label:"In Progress"},{value:"completed",label:"Completed"},{value:"cancelled",label:"Cancelled"}];return e.jsxs("div",{className:"p-4 sm:p-6 lg:p-8",children:[e.jsx("div",{className:"mb-6",children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Product Transformations"}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"Convert base products to variants and track transformations"})]}),e.jsxs("button",{onClick:()=>d(!0),className:"btn btn-primary flex items-center gap-2",children:[e.jsx(U,{className:"h-5 w-5"}),"New Transformation"]})]})}),e.jsx("div",{className:"bg-white rounded-lg shadow p-4 mb-6",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx($,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search transformations...",value:w,onChange:t=>u(t.target.value),className:"input pl-10 w-full"})]}),e.jsx(v,{value:m,onChange:t=>s(t.target.value),options:[{value:"",label:"All Products"},...j.map(t=>({value:t._id,label:t.name}))],className:"w-full"}),e.jsx(v,{value:n,onChange:t=>x(t.target.value),options:S,className:"w-full"}),e.jsxs("button",{onClick:()=>y(),className:"btn btn-secondary flex items-center justify-center gap-2",children:[e.jsx(E,{className:"h-4 w-4"}),"Refresh"]})]})}),g?e.jsx(I,{}):h.length===0?e.jsxs("div",{className:"bg-white rounded-lg shadow p-12 text-center",children:[e.jsx(B,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No transformations found"}),e.jsx("p",{className:"text-gray-500 mb-4",children:"Get started by creating a new product transformation."}),e.jsx("button",{onClick:()=>d(!0),className:"btn btn-primary",children:"New Transformation"})]}):e.jsx("div",{className:"bg-white rounded-lg shadow overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Transformation #"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Base Product"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Target Variant"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Quantity"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Unit Cost"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Total Cost"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Date"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Performed By"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:h.map(t=>{var i,b,a,r,k,T;return e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-sm font-medium text-gray-900",children:t.transformationNumber})}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[e.jsx("div",{className:"text-sm text-gray-900",children:((i=t.baseProduct)==null?void 0:i.name)||t.baseProductName}),e.jsxs("div",{className:"text-xs text-gray-500",children:["Stock: ",t.baseProductStockBefore," → ",t.baseProductStockAfter]})]}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[e.jsx("div",{className:"text-sm text-gray-900",children:((b=t.targetVariant)==null?void 0:b.displayName)||t.targetVariantName}),e.jsxs("div",{className:"text-xs text-gray-500",children:["Stock: ",t.variantStockBefore," → ",t.variantStockAfter]})]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:t.quantity}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:["$",((a=t.unitTransformationCost)==null?void 0:a.toFixed(2))||"0.00"]}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:["$",((r=t.totalTransformationCost)==null?void 0:r.toFixed(2))||"0.00"]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:new Date(t.transformationDate).toLocaleDateString()}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:[(k=t.performedBy)==null?void 0:k.firstName," ",(T=t.performedBy)==null?void 0:T.lastName]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`px-2 py-1 text-xs font-semibold rounded-full ${t.status==="completed"?"bg-green-100 text-green-800":t.status==="pending"?"bg-yellow-100 text-yellow-800":t.status==="in_progress"?"bg-blue-100 text-blue-800":"bg-red-100 text-red-800"}`,children:t.status})})]},t._id)})})]})})}),f&&e.jsx(z,{products:j,isOpen:f,onClose:N,onSuccess:()=>{o.invalidateQueries("productTransformations"),o.invalidateQueries("productVariants"),o.invalidateQueries("products"),y()}})]})},z=({products:o,isOpen:w,onClose:u,onSuccess:m})=>{var i,b;A();const[s,n]=c.useState({baseProduct:"",targetVariant:"",quantity:1,unitTransformationCost:0,notes:""}),[x,f]=c.useState([]),[d,p]=c.useState(null),[g,y]=c.useState(null),{data:l}=C(["productVariants",s.baseProduct],()=>L.getVariantsByBaseProduct(s.baseProduct),{enabled:!!s.baseProduct,select:a=>({variants:(a==null?void 0:a.variants)||[]})});P.useEffect(()=>{l!=null&&l.variants&&f(l.variants)},[l]),P.useEffect(()=>{if(s.baseProduct){const a=o.find(r=>r._id===s.baseProduct);p(a),n(r=>({...r,targetVariant:""}))}},[s.baseProduct,o]),P.useEffect(()=>{if(s.targetVariant){const a=x.find(r=>r._id===s.targetVariant);y(a),a&&n(r=>({...r,unitTransformationCost:a.transformationCost||0}))}},[s.targetVariant,x]);const h=O(a=>F.createTransformation(a),{onSuccess:()=>{M("Transformation completed successfully"),u(),m(),n({baseProduct:"",targetVariant:"",quantity:1,unitTransformationCost:0,notes:""})},onError:a=>{D(a,"ProductTransformations")}}),j=a=>{a.preventDefault(),h.mutate(s)},N=h.isLoading,S=s.quantity*s.unitTransformationCost,t=((i=d==null?void 0:d.inventory)==null?void 0:i.currentStock)||0;return w?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"sticky top-0 bg-white border-b border-gray-200 px-6 py-4 flex items-center justify-between",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Create Product Transformation"}),e.jsx("button",{onClick:u,className:"text-gray-400 hover:text-gray-600",children:e.jsx(_,{className:"h-6 w-6"})})]}),e.jsxs("form",{onSubmit:j,className:"p-6 space-y-4",children:[e.jsx(v,{label:"Base Product",value:s.baseProduct,onChange:a=>n({...s,baseProduct:a.target.value}),options:[{value:"",label:"Select Base Product"},...o.map(a=>{var r;return{value:a._id,label:`${a.name} (Stock: ${((r=a.inventory)==null?void 0:r.currentStock)||0})`}})],required:!0}),s.baseProduct&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(B,{className:"h-5 w-5 text-blue-600"}),e.jsx("span",{className:"font-medium text-blue-900",children:"Available Stock"})]}),e.jsxs("p",{className:"text-sm text-blue-700",children:[t," units available for transformation"]})]}),e.jsx(v,{label:"Target Variant",value:s.targetVariant,onChange:a=>n({...s,targetVariant:a.target.value}),options:[{value:"",label:"Select Variant"},...x.filter(a=>a.status==="active").map(a=>{var r;return{value:a._id,label:`${a.displayName} (Current Stock: ${((r=a.inventory)==null?void 0:r.currentStock)||0})`}})],required:!0}),x.length===0&&e.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(q,{className:"h-5 w-5 text-yellow-600"}),e.jsx("span",{className:"text-sm text-yellow-800",children:"No variants found for this product. Please create a variant first."})]})})]}),e.jsx(V,{label:"Quantity",type:"number",value:s.quantity,onChange:a=>n({...s,quantity:parseInt(a.target.value)||1}),min:"1",max:t,required:!0}),s.quantity>t&&e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(q,{className:"h-5 w-5 text-red-600"}),e.jsxs("span",{className:"text-sm text-red-800",children:["Insufficient stock. Available: ",t,", Requested: ",s.quantity]})]})}),e.jsx(V,{label:"Unit Transformation Cost",type:"number",value:s.unitTransformationCost,onChange:a=>n({...s,unitTransformationCost:parseFloat(a.target.value)||0}),min:"0",step:"0.01",required:!0,disabled:!!g}),g&&e.jsx("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Using variant default cost:"}),e.jsxs("span",{className:"text-sm font-medium text-gray-900",children:["$",((b=g.transformationCost)==null?void 0:b.toFixed(2))||"0.00"]})]})}),e.jsx("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Total Transformation Cost:"}),e.jsxs("span",{className:"text-lg font-bold text-gray-900",children:["$",S.toFixed(2)]})]})}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Notes (optional)"}),e.jsx("textarea",{value:s.notes,onChange:a=>n({...s,notes:a.target.value}),rows:3,className:"input w-full",placeholder:"Add any additional notes about this transformation..."})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t",children:[e.jsx("button",{type:"button",onClick:u,className:"btn btn-secondary",disabled:N,children:"Cancel"}),e.jsx(Q,{type:"submit",isLoading:N,disabled:s.quantity>t||!s.baseProduct||!s.targetVariant,className:"btn btn-primary",children:"Execute Transformation"})]})]})]})}):null};export{ee as default};
