import{r as l,br as z,bs as G,bt as Y,o as e,p as E,b2 as q,R as W,q as J,z as T,x as g,w as H}from"./index-jd7Ax_Ed.js";import{u as X}from"./chartOfAccountsApi-DmTn-F78.js";import{P as ee}from"./printer-BkLl9NNZ.js";import{L as b}from"./loader-2-B6KGLAUo.js";import{S as te}from"./save-CRYWlTlc.js";const ue=()=>{var R;const[o,u]=l.useState({cashAccount:"CASH IN HAND",voucherDate:new Date().toISOString().split("T")[0],voucherNo:"",paymentType:"CASH"}),[y,B]=l.useState([]),[h,f]=l.useState([]),[N,D]=l.useState(!1),[ae,j]=l.useState([]),[x,m]=l.useState([]),[L,{data:se,isFetching:v}]=z(),{data:d,isLoading:F,error:re}=G(void 0,{refetchOnMountOrArgChange:!0}),{data:i}=X({accountType:"asset",accountCategory:"current_assets",isActive:"true"},{refetchOnMountOrArgChange:!0}),w=(i==null?void 0:i.data)||(i==null?void 0:i.accounts)||i||[],C=Array.isArray(w)?w.filter(t=>{var a,r;return((a=t==null?void 0:t.accountName)==null?void 0:a.toLowerCase().includes("cash"))||((r=t==null?void 0:t.accountName)==null?void 0:r.toLowerCase().includes("bank"))}):[];(R=C.find(t=>{var a;return(a=t.accountName)==null?void 0:a.toLowerCase().includes("cash in hand")}))!=null&&R.accountName,l.useEffect(()=>{if(d){const t=(d==null?void 0:d.data)||d||[];B(t)}},[d]),l.useEffect(()=>{if(!o.voucherNo){const t=new Date,a=t.getFullYear(),r=String(t.getMonth()+1).padStart(2,"0"),s=String(t.getDate()).padStart(2,"0"),n=Math.floor(Math.random()*1e4);u(c=>({...c,voucherNo:`CR-${a}${r}${s}${n}`}))}},[o.voucherNo]);const M=async()=>{if(h.length===0){g("Please select at least one city");return}const t=h.join(",");L({cities:t,showZeroBalance:N}).unwrap().then(a=>{var n;const r=((n=a==null?void 0:a.data)==null?void 0:n.customers)||(a==null?void 0:a.customers)||(a==null?void 0:a.data)||a||[];j(r);const s=r.map(c=>({customerId:c._id,accountName:c.accountName||c.businessName||c.name,balance:c.balance||c.pendingBalance||0,particular:"",amount:""}));m(s)}).catch(a=>{console.error("Error loading customers:",a),g(H(a))})},$=t=>{f(a=>a.includes(t)?a.filter(r=>r!==t):[...a,t])},P=()=>{f([]),j([]),m([])},S=(t,a,r)=>{m(s=>{const n=[...s];return n[t]={...n[t],[a]:r},n})},A=x.reduce((t,a)=>{const r=parseFloat(a.amount)||0;return t+r},0),[I,{isLoading:ne}]=Y(),O=()=>{const t=x.filter(s=>parseFloat(s.amount)>0);if(t.length===0){g("Please enter at least one amount");return}const a=t.map(s=>({customer:s.customerId,amount:parseFloat(s.amount),particular:s.particular||"Cash Receipt"})),r={voucherDate:o.voucherDate,cashAccount:o.cashAccount,paymentType:o.paymentType,receipts:a};I(r).unwrap().then(s=>{var k;T((s==null?void 0:s.message)||`Successfully created ${((k=s==null?void 0:s.data)==null?void 0:k.count)||t.length} cash receipt(s)`),m(p=>p.map(U=>({...U,particular:"",amount:""})));const n=new Date,c=n.getFullYear(),V=String(n.getMonth()+1).padStart(2,"0"),_=String(n.getDate()).padStart(2,"0"),Q=Math.floor(Math.random()*1e4);u(p=>({...p,voucherNo:`CR-${c}${V}${_}${Q}`}))}).catch(s=>{g(H(s))})},Z=()=>{m(t=>t.map(a=>({...a,particular:"",amount:""})))},K=()=>{T("Print functionality coming soon")};return e.jsxs("div",{className:"space-y-6 p-6 bg-gray-50 min-h-screen",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-800 mb-6",children:"Cash Receipt Voucher"}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Cash Account"}),e.jsxs("select",{value:o.cashAccount,onChange:t=>u(a=>({...a,cashAccount:t.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"CASH IN HAND",children:"CASH IN HAND"}),C.map(t=>e.jsx("option",{value:t.accountName,children:t.accountName},t._id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Payment Type"}),e.jsxs("select",{value:o.paymentType,onChange:t=>u(a=>({...a,paymentType:t.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"CASH",children:"CASH"}),e.jsx("option",{value:"CHECK",children:"CHECK"}),e.jsx("option",{value:"BANK_TRANSFER",children:"BANK TRANSFER"}),e.jsx("option",{value:"OTHER",children:"OTHER"})]})]}),e.jsxs("div",{className:"bg-blue-50 p-4 rounded-md",children:[e.jsx("div",{className:"text-sm text-gray-600",children:"Total:"}),e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:E(A)})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Voucher Date"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"date",value:o.voucherDate,onChange:t=>u(a=>({...a,voucherDate:t.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"}),e.jsx(q,{className:"absolute right-3 top-2.5 h-5 w-5 text-gray-400 pointer-events-none"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Voucher No"}),e.jsx("input",{type:"text",value:o.voucherNo,readOnly:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-md bg-gray-50 focus:outline-none"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",id:"showZeroBalance",checked:N,onChange:t=>D(t.target.checked),className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),e.jsx("label",{htmlFor:"showZeroBalance",className:"text-sm text-gray-700",children:"Show Zero Balance"})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs("button",{onClick:K,className:"flex-1 px-4 py-2 bg-gray-500 text-white rounded-md hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-gray-500 flex items-center justify-center",children:[e.jsx(ee,{className:"h-4 w-4 mr-2"}),"Print"]}),e.jsx("button",{onClick:P,className:"flex-1 px-4 py-2 bg-gray-500 text-white rounded-md hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-gray-500",children:"UnSelect All"}),e.jsxs("button",{onClick:M,disabled:v||h.length===0,className:"flex-1 px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center",children:[v?e.jsx(b,{className:"h-4 w-4 mr-2 animate-spin"}):e.jsx(W,{className:"h-4 w-4 mr-2"}),"Load"]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Select Cities"}),e.jsx("div",{className:"border border-gray-300 rounded-md h-64 overflow-y-auto bg-white",children:F?e.jsxs("div",{className:"p-4 text-center text-gray-500",children:[e.jsx(b,{className:"h-5 w-5 animate-spin mx-auto mb-2"}),"Loading cities..."]}):y.length===0?e.jsx("div",{className:"p-4 text-center text-gray-500",children:"No cities available"}):e.jsx("div",{className:"p-2",children:y.map(t=>e.jsxs("div",{className:"flex items-center p-2 hover:bg-gray-50",children:[e.jsx("input",{type:"checkbox",id:`city-${t}`,checked:h.includes(t),onChange:()=>$(t),className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded mr-2"}),e.jsx("label",{htmlFor:`city-${t}`,className:"text-sm text-gray-700 cursor-pointer flex-1",children:t})]},t))})})]})]})]}),x.length>0&&e.jsxs("div",{className:"bg-white rounded-lg shadow",children:[e.jsx("div",{className:"p-4 border-b border-gray-200",children:e.jsx("h2",{className:"text-lg font-semibold text-gray-800",children:"Customer Receipts"})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Account Name"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Balance"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Particular"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Amount"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:x.map((t,a)=>e.jsxs("tr",{className:parseFloat(t.amount)>0?"bg-yellow-50":"",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:t.accountName}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:E(t.balance)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("input",{type:"text",value:t.particular,onChange:r=>S(a,"particular",r.target.value),placeholder:"Enter description",className:"w-full px-3 py-1 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("input",{type:"number",value:t.amount,onChange:r=>S(a,"amount",r.target.value),placeholder:"0.00",min:"0",step:"0.01",className:"w-full px-3 py-1 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm"})})]},t.customerId))})]})})]}),e.jsxs("div",{className:"flex justify-end space-x-4 bg-white rounded-lg shadow p-6",children:[e.jsxs("button",{onClick:O,disabled:createBatchMutation.isLoading||A===0,className:"px-6 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed flex items-center",children:[createBatchMutation.isLoading?e.jsx(b,{className:"h-4 w-4 mr-2 animate-spin"}):e.jsx(te,{className:"h-4 w-4 mr-2"}),"Save"]}),e.jsx("button",{disabled:!0,className:"px-6 py-2 bg-gray-400 text-white rounded-md cursor-not-allowed flex items-center",children:"Update"}),e.jsxs("button",{onClick:Z,className:"px-6 py-2 bg-gray-500 text-white rounded-md hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-gray-500 flex items-center",children:[e.jsx(J,{className:"h-4 w-4 mr-2"}),"Reset"]})]})]})};export{ue as default};
