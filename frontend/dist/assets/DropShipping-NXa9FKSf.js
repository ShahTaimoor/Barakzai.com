import{aC as Se,r as l,c as q,B as we,o as e,a2 as Ae,U as Ce,P as Pe,R as me,L as Re,Q as y,c3 as Ie,W as oe,D as ke}from"./index-jd7Ax_Ed.js";import{u as Te}from"./useMutation-n-l4Ns3H.js";import{S as L}from"./SearchableDropdown-D6GNUAgH.js";import{P as ue}from"./phone-Dkvr6QGJ.js";import{P as de}from"./plus-C2o0386P.js";import{T as Be}from"./trash-2-DCbqoVbR.js";import{S as De}from"./save-CRYWlTlc.js";import"./chevron-down-BFYGIyCo.js";import"./check-C5eRyuMu.js";const Ke=()=>{var ce,ie;const pe=Se(),[u,M]=l.useState(null),[R,Q]=l.useState(""),[_,$]=l.useState(0),[E,O]=l.useState(""),[K,U]=l.useState(""),[W,v]=l.useState(0),[I,z]=l.useState(0),[i,G]=l.useState(null),[H,J]=l.useState(""),[xe,V]=l.useState(0),[j,X]=l.useState("wholesale"),[Y,Z]=l.useState(""),[ee,f]=l.useState(0),[k,te]=l.useState(0),[he,se]=l.useState(0),[p,T]=l.useState(null),[B,S]=l.useState(""),[g,D]=l.useState(1),[w,A]=l.useState(""),[C,h]=l.useState(""),[x,P]=l.useState([]),[je,ge]=l.useState(new Date().toISOString().split("T")[0]),{data:N}=q(["suppliers-drop-shipping",{search:R}],()=>R.length>0?oe.searchSuppliers(R):oe.getActiveSuppliers(),{keepPreviousData:!0}),{data:b}=q(["customers-drop-shipping",{search:H}],()=>ke.getCustomers({search:H,limit:100}),{keepPreviousData:!0,onError:t=>{console.error("Customers fetch error:",t)}}),{data:Ne}=q(["products-drop-shipping",{search:B}],()=>we.getProducts({search:B,limit:50}),{keepPreviousData:!0,enabled:B.length>0,select:t=>{var s;return((s=t==null?void 0:t.data)==null?void 0:s.products)||(t==null?void 0:t.products)||[]}}),ae=Te(Ie.createTransaction,{onSuccess:()=>{pe.invalidateQueries("drop-shipping"),y.success("Drop shipping transaction created successfully"),re()},onError:t=>{var s,a;y.error(((a=(s=t.response)==null?void 0:s.data)==null?void 0:a.message)||"Failed to create transaction")}}),be=t=>{M(t),$(t.pendingBalance||0)},ye=t=>{G(t);const s=t.pendingBalance||0,a=t.advanceBalance||0,n=s-a;V(n)},ve=t=>{var s,a,n,o;T(t),S(t.name),A(((s=t.pricing)==null?void 0:s.cost)||0),h(j==="retail"?((a=t.pricing)==null?void 0:a.retail)||0:j==="wholesale"?((n=t.pricing)==null?void 0:n.wholesale)||0:((o=t.pricing)==null?void 0:o.wholesale)||0)};l.useEffect(()=>{var t,s;p&&(j==="retail"?h(((t=p.pricing)==null?void 0:t.retail)||0):j==="wholesale"&&h(((s=p.pricing)==null?void 0:s.wholesale)||0))},[j,p]);const le=()=>{if(!p){y.error("Please select a product");return}const t=g*(w||0),s=g*(C||0),a=s-t,n={product:p,quantity:g,supplierRate:w||0,supplierAmount:t,customerRate:C||0,customerAmount:s,profitAmount:a,profitMargin:s>0?a/s*100:0};P([...x,n]);const o=[...x,n].reduce((m,r)=>m+r.supplierAmount,0),d=[...x,n].reduce((m,r)=>m+r.customerAmount,0);v(o),f(d),T(null),S(""),D(1),A(""),h("")},ne=t=>{const s=x.filter((o,d)=>d!==t);P(s);const a=s.reduce((o,d)=>o+d.supplierAmount,0),n=s.reduce((o,d)=>o+d.customerAmount,0);v(a),f(n)},F=(t,s,a)=>{const n=x.map((m,r)=>{if(r===t){const c={...m,[s]:a};return(s==="quantity"||s==="supplierRate")&&(c.supplierAmount=c.quantity*c.supplierRate),(s==="quantity"||s==="customerRate")&&(c.customerAmount=c.quantity*c.customerRate),c.profitAmount=c.customerAmount-c.supplierAmount,c.profitMargin=c.customerAmount>0?c.profitAmount/c.customerAmount*100:0,c}return m});P(n);const o=n.reduce((m,r)=>m+r.supplierAmount,0),d=n.reduce((m,r)=>m+r.customerAmount,0);v(o),f(d)},fe=()=>{var s;if(!u){y.error("Please select a supplier");return}if(!i){y.error("Please select a customer");return}if(x.length===0){y.error("Please add at least one product");return}const t={supplier:u._id,customer:i._id,supplierInfo:{companyName:u.companyName,contactPerson:((s=u.contactPerson)==null?void 0:s.name)||"",email:u.email||"",phone:u.phone||""},customerInfo:{displayName:i.displayName||i.name,businessName:i.businessName||"",email:i.email||"",phone:i.phone||"",businessType:i.businessType||""},billNumber:E,supplierDescription:K,customerDescription:Y,rateType:j,items:x.map(a=>({product:a.product._id,quantity:a.quantity,supplierRate:a.supplierRate,customerRate:a.customerRate})),transactionDate:je,supplierPayment:{amount:I,method:I===W?"account":"cash"},customerPayment:{amount:k,method:k===ee?"account":"cash"}};ae.mutate(t)},re=()=>{M(null),Q(""),$(0),O(""),U(""),v(0),z(0),G(null),J(""),V(0),X("wholesale"),Z(""),f(0),te(0),se(0),T(null),S(""),D(1),A(""),h(""),P([]),ge(new Date().toISOString().split("T")[0])};return e.jsxs("div",{className:"container mx-auto p-6",children:[e.jsx("div",{className:"flex items-center justify-between mb-6",children:e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Drop Shipping"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Manage drop shipping transactions"})]})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 flex items-center",children:[e.jsx(Ae,{className:"h-5 w-5 mr-2 text-blue-600"}),"Supplier Detail"]}),(u==null?void 0:u.phone)&&e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(ue,{className:"h-3 w-3 text-gray-400"}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:u.phone})]})]})}),e.jsxs("div",{className:"card-content space-y-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-4 mb-2 flex-wrap",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Supplier"}),u&&e.jsxs("div",{className:"flex items-center space-x-1 whitespace-nowrap",children:[e.jsx("span",{className:"text-xs text-gray-500",children:"Outstanding Balance:"}),e.jsxs("span",{className:`text-sm font-medium ${(_||0)>0?"text-red-600":"text-green-600"}`,children:["$",Math.round(_||0)]})]})]}),e.jsx(L,{placeholder:"Select supplier...",items:((ce=N==null?void 0:N.data)==null?void 0:ce.suppliers)||(N==null?void 0:N.suppliers)||[],onSelect:be,onSearch:Q,displayKey:t=>t.companyName,selectedItem:u})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Bill No"}),e.jsx("input",{type:"text",value:E,onChange:t=>O(t.target.value),className:"input",placeholder:"Enter bill number"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Description"}),e.jsx("textarea",{value:K,onChange:t=>U(t.target.value),className:"input",rows:"2",placeholder:"Supplier description"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Invoice Amount"}),e.jsx("input",{type:"number",value:W,className:"input bg-yellow-50 border-yellow-200",disabled:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Paid Amount"}),e.jsx("input",{type:"number",value:I,onChange:t=>z(parseFloat(t.target.value)||0),className:"input",placeholder:"0"})]})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 flex items-center",children:[e.jsx(Ce,{className:"h-5 w-5 mr-2 text-green-600"}),"Customer Detail"]}),(i==null?void 0:i.phone)&&e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(ue,{className:"h-3 w-3 text-gray-400"}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:i.phone})]})]})}),e.jsxs("div",{className:"card-content space-y-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-4 mb-2 flex-wrap",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Customer"}),i&&(()=>{const t=xe||0,s=t<0,a=t>0,n=Math.abs(t)>0,o=i.currentBalance||0,d=i.pendingBalance||0,m=o+d,r=i.creditLimit||0,c=r>0?r-m:0;return e.jsxs("div",{className:"flex items-center gap-x-4 gap-y-1 flex-wrap",children:[n&&e.jsxs("div",{className:"flex items-center space-x-1 whitespace-nowrap",children:[e.jsx("span",{className:"text-xs text-gray-500",children:s?"Payables:":"Receivables:"}),e.jsxs("span",{className:`text-sm font-medium ${s?"text-red-600":a?"text-green-600":"text-gray-600"}`,children:["$",Math.abs(t).toFixed(2)]})]}),r>0&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center space-x-1 whitespace-nowrap",children:[e.jsx("span",{className:"text-xs text-gray-500",children:"Credit Limit:"}),e.jsxs("span",{className:`text-sm font-medium ${m>=r*.9?"text-red-600":m>=r*.7?"text-yellow-600":"text-blue-600"}`,children:["$",r.toFixed(2)]}),m>=r*.9&&e.jsx("span",{className:"text-xs text-red-600 font-bold ml-1",children:"⚠️"})]}),e.jsxs("div",{className:"flex items-center space-x-1 whitespace-nowrap",children:[e.jsx("span",{className:"text-xs text-gray-500",children:"Available Credit:"}),e.jsxs("span",{className:`text-sm font-medium ${c<=r*.1?"text-red-600":c<=r*.3?"text-yellow-600":"text-green-600"}`,children:["$",c.toFixed(2)]})]})]})]})})()]}),e.jsx(L,{placeholder:"Select customer...",items:((ie=b==null?void 0:b.data)==null?void 0:ie.customers)||(b==null?void 0:b.customers)||[],onSelect:ye,onSearch:J,displayKey:t=>t.displayName||t.name,selectedItem:i})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Rate"}),e.jsxs("select",{value:j,onChange:t=>X(t.target.value),className:"input",children:[e.jsx("option",{value:"retail",children:"Retail Price"}),e.jsx("option",{value:"wholesale",children:"Wholesale Price"}),e.jsx("option",{value:"custom",children:"Custom"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Description"}),e.jsx("textarea",{value:Y,onChange:t=>Z(t.target.value),className:"input",rows:"2",placeholder:"Customer description"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Invoice Amount"}),e.jsx("input",{type:"number",value:ee,className:"input bg-yellow-50 border-yellow-200",disabled:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Received Amount"}),e.jsx("input",{type:"number",value:k,onChange:t=>te(parseFloat(t.target.value)||0),className:"input",placeholder:"0"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Customer Amount"}),e.jsx("input",{type:"number",value:he,onChange:t=>se(parseFloat(t.target.value)||0),className:"input",placeholder:"0"})]}),e.jsxs("button",{onClick:le,className:"w-full btn btn-success flex items-center justify-center",disabled:!p,children:[e.jsx(de,{className:"h-4 w-4 mr-2"}),"Add"]})]})]})]}),e.jsxs("div",{className:"card mt-6",children:[e.jsx("div",{className:"card-header",children:e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 flex items-center",children:[e.jsx(Pe,{className:"h-5 w-5 mr-2 text-purple-600"}),"Product Details"]})}),e.jsxs("div",{className:"card-content",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-12 gap-4 mb-4",children:[e.jsxs("div",{className:"md:col-span-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Product"}),e.jsx(L,{placeholder:"--Select--",items:Ne||[],onSelect:ve,onSearch:S,displayKey:t=>t.name,selectedItem:p})]}),e.jsx("div",{className:"md:col-span-1",children:e.jsx("button",{className:"btn btn-secondary w-full mt-7",children:e.jsx(me,{className:"h-4 w-4"})})}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Quantity"}),e.jsx("input",{type:"number",value:g,onChange:t=>D(parseInt(t.target.value)||1),className:"input",min:"1"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Supplier Rate"}),e.jsx("input",{type:"number",value:w,onChange:t=>A(t.target.value),className:"input",placeholder:"0"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Supplier Amount"}),e.jsx("input",{type:"number",value:g*(w||0),className:"input bg-gray-50",disabled:!0})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Customer Rate"}),e.jsx("input",{type:"number",value:C,onChange:t=>h(t.target.value),className:"input",placeholder:"0"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Customer Amount"}),e.jsx("input",{type:"number",value:g*(C||0),className:"input bg-gray-50",disabled:!0})]})]}),e.jsxs("button",{onClick:le,className:"btn btn-success flex items-center",disabled:!p,children:[e.jsx(de,{className:"h-4 w-4 mr-2"}),"Add"]})]})]}),x.length>0&&e.jsxs("div",{className:"card mt-6",children:[e.jsx("div",{className:"card-header",children:e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Product List"})}),e.jsx("div",{className:"card-content",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gray-50 border-b",children:[e.jsx("th",{className:"px-4 py-2 text-left text-sm font-medium text-gray-700",children:"S.No"}),e.jsx("th",{className:"px-4 py-2 text-left text-sm font-medium text-gray-700",children:"Product"}),e.jsx("th",{className:"px-4 py-2 text-left text-sm font-medium text-gray-700",children:"Quantity"}),e.jsx("th",{className:"px-4 py-2 text-left text-sm font-medium text-gray-700",children:"S_Rate"}),e.jsx("th",{className:"px-4 py-2 text-left text-sm font-medium text-gray-700",children:"S_Amount"}),e.jsx("th",{className:"px-4 py-2 text-left text-sm font-medium text-gray-700",children:"C_Rate"}),e.jsx("th",{className:"px-4 py-2 text-left text-sm font-medium text-gray-700",children:"C_Amount"}),e.jsx("th",{className:"px-4 py-2 text-left text-sm font-medium text-gray-700",children:"Action"})]})}),e.jsx("tbody",{children:x.map((t,s)=>e.jsxs("tr",{className:"border-b hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-2 text-sm",children:s+1}),e.jsx("td",{className:"px-4 py-2 text-sm font-medium",children:t.product.name}),e.jsx("td",{className:"px-4 py-2",children:e.jsx("input",{type:"number",value:t.quantity,onChange:a=>{const n=parseFloat(a.target.value)||1;n<=0?ne(s):F(s,"quantity",n)},className:"input text-center h-8 w-20",min:"1"})}),e.jsx("td",{className:"px-4 py-2",children:e.jsx("input",{type:"number",step:"0.01",value:t.supplierRate,onChange:a=>F(s,"supplierRate",parseFloat(a.target.value)||0),className:"input text-center h-8 w-24",min:"0"})}),e.jsx("td",{className:"px-4 py-2 text-sm",children:t.supplierAmount.toFixed(2)}),e.jsx("td",{className:"px-4 py-2",children:e.jsx("input",{type:"number",step:"0.01",value:t.customerRate,onChange:a=>F(s,"customerRate",parseFloat(a.target.value)||0),className:"input text-center h-8 w-24",min:"0"})}),e.jsx("td",{className:"px-4 py-2 text-sm",children:t.customerAmount.toFixed(2)}),e.jsx("td",{className:"px-4 py-2",children:e.jsx("button",{onClick:()=>ne(s),className:"text-red-600 hover:text-red-800",children:e.jsx(Be,{className:"h-4 w-4"})})})]},s))})]})})})]}),e.jsxs("div",{className:"mt-6 flex gap-4",children:[e.jsxs(Re,{onClick:fe,isLoading:ae.isLoading,className:"btn btn-primary",children:[e.jsx(De,{className:"h-4 w-4 mr-2"}),"Save"]}),e.jsxs("button",{onClick:re,className:"btn btn-secondary",children:[e.jsx(me,{className:"h-4 w-4 mr-2"}),"Reset"]})]})]})};export{Ke as default};
