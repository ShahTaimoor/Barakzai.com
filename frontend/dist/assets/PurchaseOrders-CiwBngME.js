import{u as Tt,r as o,V as Ot,W as Et,B as It,Y as Mt,Z as $t,_ as At,$ as Ut,a0 as qt,a1 as Ft,o as e,S as ge,a2 as _t,P as Lt,A as zt,t as Qt,v as _,R as Ye,Q as f,C as Bt,a3 as Rt}from"./index-jd7Ax_Ed.js";import{u as Ze}from"./useFuzzySearch-BrpeiQaU.js";import"./SearchableDropdown-D6GNUAgH.js";import{u as Kt}from"./useCompanyInfo-kGS5xcZ6.js";import{D as Vt}from"./download-bwqK3ulf.js";import{P as Je}from"./plus-C2o0386P.js";import{P as Wt}from"./phone-Dkvr6QGJ.js";import{T as be}from"./trash-2-DCbqoVbR.js";import{S as Gt}from"./save-CRYWlTlc.js";import{F as Ht}from"./filter-CQLYjJyW.js";import{E as Xt}from"./eye-DMmE8Niy.js";import{P as et}from"./printer-BkLl9NNZ.js";import{P as Yt}from"./pen-square-CzKMgeH3.js";import{C as fe}from"./check-circle-8oGxTki5.js";import{X as ye}from"./x-circle-CN1zMonK.js";import"./chevron-down-BFYGIyCo.js";import"./check-C5eRyuMu.js";const h=g=>g==null?"":typeof g=="string"||typeof g=="number"?g:typeof g=="object"?g.name||g.title||g.fullName||g.companyName||JSON.stringify(g):String(g),Zt=({status:g})=>{const x={draft:{color:"bg-gray-100 text-gray-800",icon:Rt,label:"Pending"},confirmed:{color:"bg-blue-100 text-blue-800",icon:fe,label:"Confirmed"},partially_received:{color:"bg-yellow-100 text-yellow-800",icon:Bt,label:"Partially Received"},fully_received:{color:"bg-green-100 text-green-800",icon:fe,label:"Fully Received"},cancelled:{color:"bg-red-100 text-red-800",icon:ye,label:"Cancelled"},closed:{color:"bg-gray-100 text-gray-800",icon:ye,label:"Closed"}},m=x[g]||x.draft,je=m.icon;return e.jsxs("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${m.color}`,children:[e.jsx(je,{className:"h-3 w-3 mr-1"}),m.label]})},Ss=({tabId:g})=>{var Ue,qe,Fe,_e,Le,ze,Qe,Be,Re,Ke,Ve,We,Ge;const{updateTabTitle:x,getActiveTab:m,openTab:je}=Tt(),{companyInfo:se}=Kt(),Ne=se.companyName||"Company Name",ae=se.address||se.billingAddress||"",ne=se.contactNumber||"",[T,tt]=o.useState({fromDate:new Date().toISOString().split("T")[0],toDate:new Date().toISOString().split("T")[0],poNumber:"",supplier:"",status:"",paymentStatus:""}),[st,at]=o.useState({page:1,limit:999999}),[nt,Jt]=o.useState({key:"createdAt",direction:"desc"}),[V,re]=o.useState(!1),[rt,oe]=o.useState(!1),[l,I]=o.useState(null),[u,L]=o.useState(null),[P,y]=o.useState(""),[le,W]=o.useState(-1),[M,de]=o.useState(!0),[G,$]=o.useState(1),[H,A]=o.useState(0),[i,d]=o.useState({supplier:"",items:[],invoiceNumber:"",expectedDelivery:new Date().toISOString().split("T")[0],notes:"",terms:"",isTaxExempt:!0}),[N,X]=o.useState(null),[z,Y]=o.useState(""),[Z,me]=o.useState(1),[xe,Q]=o.useState(""),[U,J]=o.useState(-1),[ue,q]=o.useState(""),[ie,B]=o.useState(null),[ce,v]=o.useState(-1),ee=o.useRef(null),[es,ts]=o.useState(null);o.useEffect(()=>{ee.current&&ee.current.focus()},[]),o.useEffect(()=>{if(V){document.body.style.overflow="hidden";const t=setTimeout(()=>{const s=document.querySelector(".modal-product-search input");s&&s.focus()},100);return()=>{clearTimeout(t),document.body.style.overflow="unset"}}else q(""),B(null),$(1),A(0),v(-1)},[V]);const{data:R,isLoading:lt,error:ve,refetch:F}=Ot({...T,...st,sortConfig:nt},{refetchOnMountOrArgChange:!0}),{data:j,isLoading:ss}=useQuery(["suppliers",{search:"",limit:100}],()=>Et.getSuppliers({search:"",limit:100}),{select:t=>{var s;return((s=t==null?void 0:t.data)==null?void 0:s.suppliers)||(t==null?void 0:t.suppliers)||[]},onError:t=>{console.error("Error fetching suppliers:",t)}}),{data:pe,isLoading:as}=useQuery(["products","all-active-po"],()=>It.getProducts({limit:100,status:"active"}),{keepPreviousData:!0,staleTime:3e4,onError:t=>{console.error("Error fetching products:",t)}}),we=((Ue=pe==null?void 0:pe.data)==null?void 0:Ue.products)||[],S=Ze(we,z,["name","description","brand"],{threshold:.4,minScore:.3,limit:50}),w=Ze(we,ue,["name","description","brand"],{threshold:.4,minScore:.3,limit:50});o.useEffect(()=>{if(U>=0&&z&&S){const t=document.querySelector(".product-list-container"),s=t==null?void 0:t.querySelector(`[data-product-index="${U}"]`);s&&t&&s.scrollIntoView({behavior:"smooth",block:"nearest",inline:"nearest"})}},[U,z,S]);const[it,{isLoading:Ce}]=Mt(),[ct,{isLoading:Pe}]=$t(),[ot,{isLoading:ns}]=At(),[dt,{isLoading:rs}]=Ut(),[mt,{isLoading:ls}]=qt(),[is,{isLoading:cs}]=Ft(),K=()=>{if(d({supplier:"",items:[],invoiceNumber:"",expectedDelivery:new Date().toISOString().split("T")[0],notes:"",terms:"",isTaxExempt:!0}),L(null),y(""),X(null),Y(""),me(1),Q(""),x&&m){const t=m();t&&x(t.id,"PO")}},Se=t=>{const s=j==null?void 0:j.find(a=>a._id===t);if(L(s),d(a=>({...a,supplier:t})),y(""),W(-1),de(!1),x&&m&&s){const a=m();a&&x(a.id,`PO - ${s.companyName||s.name||"Unknown"}`)}},xt=t=>{if(y(t),W(-1),t===""&&(L(null),d(s=>({...s,supplier:""})),de(!0),x&&m)){const s=m();s&&x(s.id,"PO")}},ut=t=>{if(!M||!P||!j)return;const s=j.filter(n=>(n.companyName||n.name||"").toLowerCase().includes(P.toLowerCase())||(n.phone||"").includes(P)),a=s.length-1;switch(t.key){case"ArrowDown":t.preventDefault(),W(n=>n<a?n+1:0);break;case"ArrowUp":t.preventDefault(),W(n=>n>0?n-1:a);break;case"Enter":t.preventDefault(),le>=0&&le<s.length&&Se(s[le]._id);break;case"Escape":y(""),W(-1);break}},ke=t=>{var s;X(t),Q(((s=t.pricing)==null?void 0:s.cost)||""),Y(t.name),J(-1)},pt=t=>{Y(t),J(-1),N&&t!==N.name&&(X(null),Q("")),t===""&&(X(null),Q(""))},ht=t=>{if(!z||!S)return;const s=S,a=s.length-1;switch(t.key){case"ArrowDown":t.preventDefault(),J(n=>n<a?n+1:0);break;case"ArrowUp":t.preventDefault(),J(n=>n>0?n-1:a);break;case"Enter":t.preventDefault(),U>=0&&U<s.length&&ke(s[U]);break;case"Escape":Y(""),J(-1);break}},De=t=>{t.key==="Enter"&&N&&(t.preventDefault(),Te())},Te=()=>{var n;if(!N||Z<=0){f.error("Please select a product and enter quantity");return}const t=parseFloat(xe)||((n=N.pricing)==null?void 0:n.cost)||0,s=t*Z,a={product:N._id,productData:N,quantity:Z,costPerUnit:t,totalCost:s};d(r=>({...r,items:[...r.items,a]})),X(null),Y(""),me(1),Q(""),setTimeout(()=>{ee.current&&ee.current.focus()},100)},Oe=t=>{d(s=>({...s,items:s.items.filter((a,n)=>n!==t)}))},gt=()=>{d(t=>{if(!t.items||t.items.length<2)return t;const s=n=>{const r=n.productData||n.product;return r?typeof r=="string"?r:r.name||r.title||r.displayName||r.businessName||r.fullName||"":""},a=[...t.items].sort((n,r)=>{const c=s(n).toString().toLowerCase(),p=s(r).toString().toLowerCase();return c<p?-1:c>p?1:0});return{...t,items:a}})},Ee=()=>{const t=i.items.reduce((c,p)=>c+p.totalCost,0),s=i.isTaxExempt?0:t*.08,a=t+s,n=(u==null?void 0:u.pendingBalance)||0,r=a+n;return{subtotal:t,tax:s,total:a,supplierOutstanding:n,totalPayables:r}},te=(t,s)=>{tt(a=>({...a,[t]:s})),at(a=>({...a,page:1}))},bt=()=>{if(i.items.length===0){f.error("Please add at least one item to the order");return}if(!i.supplier){f.error("Please select a supplier");return}const{subtotal:t,tax:s,total:a}=Ee(),n={...i,subtotal:t,tax:s,total:a};it(n).unwrap().then(()=>{if(K(),f.success("Purchase order created successfully"),x&&m){const r=m();r&&x(r.id,"PO")}F()}).catch(r=>{var c;f.error(((c=r==null?void 0:r.data)==null?void 0:c.message)||"Failed to create purchase order")})},ft=()=>{const t={...i,items:i.items.map(s=>({product:s.product,quantity:s.quantity,costPerUnit:s.costPerUnit,totalCost:s.totalCost,receivedQuantity:s.receivedQuantity||0,remainingQuantity:s.remainingQuantity||s.quantity}))};ct({id:l._id,...t}).unwrap().then(()=>{if(re(!1),I(null),K(),f.success("Purchase order updated successfully"),x&&m){const s=m();s&&x(s.id,"PO")}F()}).catch(s=>{var n;const a=((n=s==null?void 0:s.data)==null?void 0:n.message)||(s==null?void 0:s.message)||"Failed to update purchase order";f.error(a)})},yt=t=>{window.confirm("Are you sure you want to delete this purchase order?")&&ot(t).unwrap().then(()=>{f.success("Purchase order deleted successfully"),F()}).catch(s=>{var a;f.error(((a=s==null?void 0:s.data)==null?void 0:a.message)||"Failed to delete purchase order")})},jt=t=>{window.confirm("Are you sure you want to confirm this pending purchase order? This will change its status to confirmed and make it ready for receiving.")&&dt(t).unwrap().then(()=>{f.success("Purchase order confirmed successfully"),F()}).catch(s=>{var a;f.error(((a=s==null?void 0:s.data)==null?void 0:a.message)||"Failed to confirm purchase order")})},Nt=t=>{window.confirm("Are you sure you want to cancel this purchase order? This action cannot be undone.")&&mt(t).unwrap().then(()=>{f.success("Purchase order cancelled successfully"),F()}).catch(s=>{var a;f.error(((a=s==null?void 0:s.data)==null?void 0:a.message)||"Failed to cancel purchase order")})},vt=t=>{var n;I(t);const s=(t.items||[]).map(r=>{var p,O,k;let c=r.costPerUnit||0;return c===0&&((O=(p=r.product)==null?void 0:p.pricing)!=null&&O.cost)&&(c=r.product.pricing.cost),{product:((k=r.product)==null?void 0:k._id)||r.product,quantity:r.quantity,costPerUnit:c,totalCost:r.totalCost||r.quantity*c,receivedQuantity:r.receivedQuantity||0,remainingQuantity:r.remainingQuantity||r.quantity,productData:r.product||null}}),a={supplier:((n=t.supplier)==null?void 0:n._id)||"",items:s,expectedDelivery:t.expectedDelivery?new Date(t.expectedDelivery).toISOString().split("T")[0]:new Date().toISOString().split("T")[0],notes:t.notes||"",terms:t.terms||"",isTaxExempt:t.isTaxExempt!==void 0?t.isTaxExempt:!0};if(d(a),t.supplier){if(L(t.supplier),y(t.supplier.companyName||t.supplier.name||""),x&&m){const r=m();r&&x(r.id,`PO - ${t.supplier.companyName||t.supplier.name||"Unknown"}`)}}else if(L(null),y(""),x&&m){const r=m();r&&x(r.id,"PO")}re(!0)},wt=t=>{I(t),oe(!0)},he=t=>{var n,r,c,p,O,k,D,E,C;const s=`
      <html>
        <head>
          <title>Purchase Order - ${t.poNumber}</title>
          <style>
            @media print {
              @page { size: A4; margin: 0.5in; }
              body { font-family: Arial, sans-serif; font-size: 14px; line-height: 1.2; color: #000; margin: 0; padding: 0; }
              .container { max-width: 800px; margin: 0 auto; }
              .header { text-align: center; margin-bottom: 20px; }
              .header h1 { font-size: 24px; font-weight: bold; margin: 0 0 4px 0; color: #000; }
              .header p { margin: 2px 0; font-size: 14px; color: #6b7280; }
              .details-grid { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 20px; margin-bottom: 20px; }
              .details-section h5 { font-size: 16px; font-weight: 600; color: #000; margin: 0 0 8px 0; }
              .details-section p { margin: 2px 0; font-size: 14px; color: #374151; }
              .details-section .font-medium { font-weight: 500; }
              .status-badge { display: inline-block; padding: 4px 8px; border-radius: 9999px; font-size: 12px; font-weight: 500; background-color: #f3f4f6; color: #374151; }
              .outstanding-balance { margin-top: 8px; padding-top: 6px; border-top: 1px solid #e5e7eb; }
              .outstanding-balance p { font-weight: 600; color: #dc2626; }
              .items-section { margin-bottom: 20px; }
              .items-section h5 { font-size: 16px; font-weight: 600; color: #000; margin: 0 0 8px 0; }
              .items-table { width: 100%; border-collapse: collapse; border: 1px solid #e5e7eb; border-radius: 8px; overflow: hidden; }
              .items-table thead { background-color: #f9fafb; }
              .items-table th { padding: 8px; text-align: left; font-size: 14px; font-weight: 600; color: #000; border-bottom: 1px solid #e5e7eb; }
              .items-table td { padding: 8px; font-size: 14px; color: #374151; border-bottom: 1px solid #e5e7eb; }
              .items-table tr:last-child td { border-bottom: none; }
              .items-table tr:nth-child(even) { background-color: #f9fafb; }
              .product-info { display: flex; flex-direction: column; }
              .product-name { font-weight: 500; color: #000; }
              .product-description { font-size: 12px; color: #6b7280; margin-top: 2px; }
              .text-right { text-align: right; }
              .totals-section { display: flex; justify-content: flex-end; margin-bottom: 20px; }
              .totals-container { width: 320px; }
              .totals-section .space-y-2 > * + * { margin-top: 4px; }
              .totals-section .flex { display: flex; justify-content: space-between; }
              .totals-section .text-sm { font-size: 14px; }
              .totals-section .text-gray-600 { color: #6b7280; }
              .totals-section .font-medium { font-weight: 500; }
              .totals-section .text-lg { font-size: 18px; }
              .totals-section .font-bold { font-weight: 700; }
              .totals-section .border-t { border-top: 1px solid #e5e7eb; }
              .totals-section .pt-2 { padding-top: 8px; }
              .totals-section .text-red-600 { color: #dc2626; }
              .notes-section { margin-bottom: 20px; }
              .notes-section h5 { font-size: 16px; font-weight: 600; color: #000; margin: 0 0 8px 0; }
              .notes-content { font-size: 14px; color: #374151; background-color: #f9fafb; padding: 8px; border-radius: 8px; border: 1px solid #e5e7eb; }
              .footer { display: flex; justify-content: space-between; align-items: center; padding-top: 12px; border-top: 1px solid #e5e7eb; }
              .footer .text-xs { font-size: 12px; line-height: 1.1; }
              .footer .text-gray-500 { color: #6b7280; }
              .footer .flex { display: flex; }
              .footer .space-x-3 > * + * { margin-left: 12px; }
              .footer .btn { padding: 8px 16px; border-radius: 6px; font-size: 14px; font-weight: 500; cursor: pointer; }
              .footer .btn-primary { background-color: #3b82f6; color: white; }
              .footer .btn-secondary { background-color: #6b7280; color: white; }
              .footer .flex .items-center { align-items: center; }
              .footer .mr-2 { margin-right: 8px; }
            }
          </style>
        </head>
        <body>
          <div class="container">
            <!-- Header -->
            <div class="header">
              <h1>${Ne}</h1>
              ${ae?`<p>${ae}</p>`:""}
              ${ne?`<p>Phone: ${ne}</p>`:""}
            </div>
            
            <!-- Details Section -->
            <div class="details-grid">
              <div class="details-section">
                <h5>Purchase Order Details</h5>
                <p><span class="font-medium">PO Number:</span> ${t.poNumber}</p>
                <p><span class="font-medium">Date:</span> ${_(t.createdAt)}</p>
                <p><span class="font-medium">Status:</span> 
                  <span class="status-badge">${t.status==="draft"?"Pending":t.status.replace("_"," ")}</span>
                </p>
                ${t.expectedDelivery?`<p><span class="font-medium">Expected Delivery:</span> ${_(t.expectedDelivery)}</p>`:""}
              </div>
              <div class="details-section">
                <!-- Empty middle column for spacing -->
              </div>
              <div class="details-section" style="text-align: right;">
                <h5>Supplier Details</h5>
                <p><span class="font-medium">Company:</span> ${h(((n=t.supplier)==null?void 0:n.companyName)||((r=t.supplier)==null?void 0:r.name))||"Unknown"}</p>
                ${(c=t.supplier)!=null&&c.email?`<p><span class="font-medium">Email:</span> ${h(t.supplier.email)}</p>`:""}
                ${(p=t.supplier)!=null&&p.phone?`<p><span class="font-medium">Phone:</span> ${h(t.supplier.phone)}</p>`:""}
                ${(O=t.supplier)!=null&&O.contactPerson?`<p><span class="font-medium">Contact:</span> ${h(t.supplier.contactPerson)}</p>`:""}
                <div class="outstanding-balance">
                  <p>
                    <span class="font-medium">Outstanding Balance:</span> ${Math.round(((k=t.supplier)==null?void 0:k.pendingBalance)||0)}
                  </p>
                </div>
              </div>
            </div>
            
            <!-- Items Section -->
            <div class="items-section">
              <h5>Items Ordered</h5>
              <table class="items-table">
                <thead>
                  <tr>
                    <th>#</th>
                    <th>PRODUCT</th>
                    <th class="text-right">QUANTITY</th>
                    <th class="text-right">UNIT COST</th>
                    <th class="text-right">TOTAL COST</th>
                  </tr>
                </thead>
                <tbody>
                  ${((D=t.items)==null?void 0:D.map((b,Dt)=>{var He,Xe;return`
                    <tr>
                      <td>${Dt+1}</td>
                      <td>
                        <div class="product-info">
                          <div class="product-name">${h((He=b.product)==null?void 0:He.name)||"Unknown Product"}</div>
                          ${(Xe=b.product)!=null&&Xe.description?`<div class="product-description">${b.product.description}</div>`:""}
                        </div>
                      </td>
                      <td class="text-right">${b.quantity}</td>
                      <td class="text-right">${Math.round(b.unitCost||b.cost||0)}</td>
                      <td class="text-right">${Math.round(b.totalCost||b.quantity*(b.unitCost||b.cost||0))}</td>
                    </tr>
                  `}).join(""))||""}
                </tbody>
              </table>
            </div>
            
            <!-- Totals Section -->
            <div class="totals-section">
              <div class="totals-container">
                <div class="space-y-2">
                  <div class="flex text-sm">
                    <span class="text-gray-600">Subtotal:</span>
                    <span class="font-medium">${Math.round(t.subtotal||0)}</span>
                  </div>
                  ${t.tax&&t.tax>0?`
                    <div class="flex text-sm">
                      <span class="text-gray-600">Tax:</span>
                      <span class="font-medium">${Math.round(t.tax)}</span>
                    </div>
                  `:""}
                  <div class="flex text-sm">
                    <span class="text-gray-600">PO Total:</span>
                    <span class="font-medium">${Math.round(t.total||0)}</span>
                  </div>
                  <div class="flex text-sm">
                    <span class="text-gray-600">Previous Outstanding:</span>
                    <span class="font-medium text-red-600">${Math.round(((E=t.supplier)==null?void 0:E.pendingBalance)||0)}</span>
                  </div>
                  <div class="flex text-lg font-bold border-t pt-2">
                    <span>Total Payables:</span>
                    <span class="text-red-600">${Math.round((t.total||0)+(((C=t.supplier)==null?void 0:C.pendingBalance)||0))}</span>
                  </div>
                </div>
              </div>
            </div>
            
            ${t.notes?`
              <div class="notes-section">
                <h5>Notes</h5>
                <div class="notes-content">${t.notes}</div>
              </div>
            `:""}
            
            ${t.terms?`
              <div class="notes-section">
                <h5>Terms</h5>
                <div class="notes-content">${t.terms}</div>
              </div>
            `:""}
            
            <!-- Footer -->
            <div class="footer">
              <div class="text-xs text-gray-500">
                Generated on ${new Date().toLocaleDateString()} at ${new Date().toLocaleTimeString()}
              </div>
            </div>
          </div>
        </body>
      </html>
    `,a=window.open("","_blank");a.document.write(s),a.document.close(),a.focus(),a.print(),a.close()},Ct=()=>{f.success("Export functionality coming soon")},Ie=((qe=R==null?void 0:R.data)==null?void 0:qe.purchaseOrders)||[],Pt=((Fe=R==null?void 0:R.data)==null?void 0:Fe.pagination)||{},{subtotal:Me,tax:$e,total:Ae,supplierOutstanding:St,totalPayables:kt}=Ee();return e.jsxs("div",{className:"space-y-4 lg:space-y-6",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Purchase Orders"}),e.jsx("p",{className:"text-gray-600",children:"Process purchase order transactions"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("button",{onClick:Ct,className:"btn btn-secondary btn-md",children:[e.jsx(Vt,{className:"h-4 w-4 mr-2"}),"Export"]}),e.jsxs("button",{onClick:K,className:"btn btn-primary btn-md",children:[e.jsx(Je,{className:"h-4 w-4 mr-2"}),"New Purchase Order"]})]})]}),e.jsxs("div",{className:"flex items-start space-x-4",children:[e.jsxs("div",{className:"w-[500px] flex-shrink-0",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Select Supplier"}),u&&e.jsx("button",{onClick:()=>{if(L(null),y(""),de(!0),d(t=>({...t,supplier:""})),x&&m){const t=m();t&&x(t.id,"PO")}},className:"text-xs text-blue-600 hover:text-blue-800 underline",children:"Change Supplier"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:M?P:u&&(u.companyName||u.name)||"",onChange:t=>{M&&xt(t.target.value)},onKeyDown:ut,className:`input w-full pr-10 ${M?"":"bg-gray-50 cursor-default"}`,placeholder:M?"Search suppliers by name, email, or business...":"",readOnly:!M}),e.jsx(ge,{className:"absolute right-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"})]}),M&&P&&e.jsx("div",{className:"mt-2 max-h-40 overflow-y-auto border border-gray-200 rounded-md bg-white shadow-lg",children:j==null?void 0:j.filter(t=>(t.companyName||t.name||"").toLowerCase().includes(P.toLowerCase())||(t.phone||"").includes(P)).map((t,s)=>e.jsxs("div",{onClick:()=>{Se(t._id),y(t.companyName||t.name||"")},className:`px-3 py-2 cursor-pointer border-b border-gray-100 last:border-b-0 ${s===le?"bg-blue-100 text-blue-900":"hover:bg-gray-100"}`,children:[e.jsx("div",{className:"font-medium text-gray-900",children:h(t.companyName||t.name)||"Unknown"}),e.jsxs("div",{className:"text-sm text-gray-600",children:["Outstanding Balance: $",(t.pendingBalance||0).toFixed(2)]})]},t._id))})]}),e.jsx("div",{className:"flex-1",children:u?e.jsx("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-3",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(_t,{className:"h-5 w-5 text-gray-400"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium",children:u.companyName||u.name||"Unknown"}),e.jsxs("p",{className:"text-sm text-gray-600 capitalize",children:[u.businessType||"Business"," • ",u.reliability||"Standard"]}),e.jsxs("div",{className:"flex items-center space-x-4 mt-2",children:[e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("span",{className:"text-xs text-gray-500",children:"Outstanding Balance:"}),e.jsx("span",{className:`text-sm font-medium ${(u.outstandingBalance||0)>0?"text-red-600":"text-green-600"}`,children:Math.round(u.outstandingBalance||0)})]}),u.phone&&e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(Wt,{className:"h-3 w-3 text-gray-400"}),e.jsx("span",{className:"text-xs text-gray-500",children:u.phone})]})]})]})]})}):e.jsx("div",{className:"hidden lg:block"})})]}),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Product Selection & Cart"})}),e.jsxs("div",{className:"card-content",children:[e.jsx("div",{className:"mb-6",children:e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-12 gap-4 items-end",children:[e.jsxs("div",{className:"col-span-7",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Product Search"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{ref:ee,type:"text",value:z,onChange:t=>pt(t.target.value),onKeyDown:ht,className:"input w-full pr-10 h-12",placeholder:"Search or select product..."}),e.jsx(ge,{className:"absolute right-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"})]}),z&&S&&e.jsx("div",{className:"product-list-container mt-2 max-h-40 overflow-y-auto border border-gray-200 rounded-md bg-white shadow-lg",children:S.map((t,s)=>{var a,n;return e.jsx("div",{"data-product-index":s,onClick:()=>ke(t),className:`px-3 py-2 cursor-pointer border-b border-gray-100 last:border-b-0 ${s===U?"bg-blue-100 text-blue-900":"hover:bg-gray-100"}`,children:e.jsxs("div",{className:"flex items-center justify-between w-full",children:[e.jsx("div",{className:"font-medium",children:h(t.name)}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("div",{className:"text-sm text-gray-600",children:["Stock: ",((a=t.inventory)==null?void 0:a.currentStock)||0]}),e.jsxs("div",{className:"text-sm text-gray-600",children:["Cost: $",Math.round(((n=t.pricing)==null?void 0:n.cost)||0)]})]})]})},t._id)})})]}),e.jsxs("div",{className:"col-span-1",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Stock"}),e.jsx("span",{className:"text-sm font-semibold text-gray-700 bg-gray-100 px-2 py-1.5 rounded border border-gray-200 block text-center h-12 flex items-center justify-center",children:N?((_e=N.inventory)==null?void 0:_e.currentStock)||0:"0"})]}),e.jsxs("div",{className:"col-span-1",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Quantity"}),e.jsx("input",{type:"number",min:"1",value:Z,onChange:t=>me(parseInt(t.target.value)||1),onKeyDown:De,className:"input text-center h-12",placeholder:"1 (Enter to add & focus search)"})]}),e.jsxs("div",{className:"col-span-1",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Cost"}),e.jsx("input",{type:"number",step:"1",value:xe,onChange:t=>Q(t.target.value),onKeyDown:De,className:"input text-center h-12",placeholder:"0 (Enter to add & focus search)",required:!0})]}),e.jsxs("div",{className:"col-span-1",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Amount"}),e.jsx("span",{className:"text-sm font-semibold text-gray-700 bg-gray-100 px-2 py-1.5 rounded border border-gray-200 block text-center h-12 flex items-center justify-center",children:N?Math.round(Z*parseFloat(xe||0)):0})]}),e.jsxs("div",{className:"col-span-1",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:" "}),e.jsxs("button",{type:"button",onClick:Te,className:"w-full btn btn-primary flex items-center justify-center px-3 h-12",disabled:!N,title:"Add to cart (or press Enter in Quantity/Cost fields - focus returns to search)",children:[e.jsx(Je,{className:"h-4 w-4 mr-2"}),"Add"]})]})]})})}),i.items.length===0?e.jsxs("div",{className:"p-8 text-center text-gray-500 border-t border-gray-200",children:[e.jsx(Lt,{className:"mx-auto h-12 w-12 text-gray-400"}),e.jsx("p",{className:"mt-2",children:"No items in cart"})]}):e.jsxs("div",{className:"space-y-4 border-t border-gray-200 pt-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h4",{className:"text-md font-medium text-gray-700",children:"Cart Items"}),e.jsxs("button",{type:"button",onClick:gt,className:"btn btn-secondary btn-sm flex items-center space-x-2",title:"Sort products alphabetically",children:[e.jsx(zt,{className:"h-4 w-4"}),e.jsx("span",{children:"Sort A-Z"})]})]}),i.items.map((t,s)=>{var c,p,O;const a=t.productData||t.product,n=t.costPerUnit*t.quantity,r=((c=a==null?void 0:a.inventory)==null?void 0:c.currentStock)<=(((p=a==null?void 0:a.inventory)==null?void 0:p.reorderPoint)||0);return e.jsx("div",{className:`py-1 ${s%2===0?"bg-white":"bg-gray-50"}`,children:e.jsxs("div",{className:"grid grid-cols-12 gap-4 items-center",children:[e.jsx("div",{className:"col-span-1",children:e.jsx("span",{className:"text-sm font-medium text-gray-700 bg-gray-50 px-0.5 py-1 rounded border border-gray-200 block text-center h-8 flex items-center justify-center",children:s+1})}),e.jsx("div",{className:"col-span-6 flex items-center h-8",children:e.jsxs("span",{className:"font-medium text-sm truncate",children:[h(a==null?void 0:a.name)||"Unknown Product",r&&e.jsx("span",{className:"text-yellow-600 text-xs ml-2",children:"⚠️ Low"})]})}),e.jsx("div",{className:"col-span-1",children:e.jsx("span",{className:"text-sm font-semibold text-gray-700 bg-gray-100 px-2 py-1 rounded border border-gray-200 block text-center h-8 flex items-center justify-center",children:((O=a==null?void 0:a.inventory)==null?void 0:O.currentStock)||0})}),e.jsx("div",{className:"col-span-1",children:e.jsx("input",{type:"number",value:t.quantity,onChange:k=>{const D=parseInt(k.target.value)||1;if(D<=0){Oe(s);return}d(E=>({...E,items:E.items.map((C,b)=>b===s?{...C,quantity:D,totalCost:D*C.costPerUnit}:C)}))},className:"input text-center h-8",min:"1"})}),e.jsx("div",{className:"col-span-1",children:e.jsx("input",{type:"number",step:"0.01",value:t.costPerUnit,onChange:k=>{const D=parseFloat(k.target.value)||0;d(E=>({...E,items:E.items.map((C,b)=>b===s?{...C,costPerUnit:D,totalCost:C.quantity*D}:C)}))},className:"input text-center h-8",min:"0"})}),e.jsx("div",{className:"col-span-1",children:e.jsx("span",{className:"text-sm font-semibold text-gray-700 bg-gray-100 px-2 py-1 rounded border border-gray-200 block text-center h-8 flex items-center justify-center",children:Math.round(n)})}),e.jsx("div",{className:"col-span-1",children:e.jsx("button",{onClick:()=>Oe(s),className:"btn btn-danger btn-sm h-8 w-full",children:e.jsx(be,{className:"h-4 w-4"})})})]})},s)})]})]})]}),i.items.length>0&&!V&&e.jsxs("div",{className:"bg-gradient-to-br from-blue-50 to-indigo-50 border-2 border-blue-200 rounded-lg max-w-5xl ml-auto mt-4",children:[e.jsx("div",{className:"px-6 py-4 border-b border-blue-200",children:e.jsx("h3",{className:"text-lg font-medium text-gray-900 text-right",children:"Purchase Order Details"})}),e.jsxs("div",{className:"px-6 py-4",children:[e.jsxs("div",{className:"flex flex-nowrap gap-3 items-end justify-end",children:[e.jsxs("div",{className:"flex flex-col w-44",children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Invoice Number"}),e.jsx("input",{type:"text",value:i.invoiceNumber||"Auto-generated",onChange:t=>d(s=>({...s,invoiceNumber:t.target.value})),className:"input h-8 text-sm",placeholder:"Auto-generated",disabled:!0})]}),e.jsxs("div",{className:"flex flex-col w-48",children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Expected Delivery"}),e.jsx("input",{type:"date",value:i.expectedDelivery,onChange:t=>d(s=>({...s,expectedDelivery:t.target.value})),className:"input h-8 text-sm"})]}),e.jsxs("div",{className:"flex flex-col w-40",children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Tax Status"}),e.jsxs("div",{className:"flex items-center space-x-1 px-2 py-1 border border-gray-200 rounded h-8",children:[e.jsx("input",{type:"checkbox",id:"taxExempt",checked:i.isTaxExempt,onChange:t=>d(s=>({...s,isTaxExempt:t.target.checked})),className:"h-3 w-3 text-primary-600 focus:ring-primary-500 border-gray-300 rounded"}),e.jsx("div",{className:"flex-1",children:e.jsx("label",{htmlFor:"taxExempt",className:"text-xs font-medium text-gray-700 cursor-pointer",children:"Tax Exempt"})}),i.isTaxExempt&&e.jsx("div",{className:"text-green-600 text-xs font-medium",children:"✓"})]})]}),e.jsxs("div",{className:"flex flex-col w-[28rem]",children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Notes"}),e.jsx("input",{type:"text",value:i.notes,onChange:t=>d(s=>({...s,notes:t.target.value})),className:"input h-8 text-sm",placeholder:"Additional notes..."})]})]}),e.jsx("div",{className:"bg-gradient-to-r from-blue-500 to-indigo-600 px-6 py-4 border-t border-blue-200 mt-6",children:e.jsx("h3",{className:"text-lg font-semibold text-white",children:"Order Summary"})}),e.jsx("div",{className:"px-6 py-4",children:e.jsxs("div",{className:"space-y-3 mb-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-800 font-semibold",children:"Subtotal:"}),e.jsx("span",{className:"text-xl font-bold text-gray-900",children:Math.round(Me)})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-800 font-semibold",children:i.isTaxExempt?"Tax (Exempt):":"Tax (8%):"}),e.jsx("span",{className:"text-xl font-bold text-gray-900",children:Math.round($e)})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-800 font-semibold",children:"PO Total:"}),e.jsx("span",{className:"text-xl font-bold text-gray-900",children:Math.round(Ae)})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-800 font-semibold",children:"Previous Outstanding:"}),e.jsx("span",{className:"text-xl font-bold text-red-600",children:Math.round(St)})]}),e.jsxs("div",{className:"flex justify-between items-center text-xl font-bold border-t-2 border-blue-400 pt-3 mt-2",children:[e.jsx("span",{className:"text-blue-900",children:"Total Payables:"}),e.jsx("span",{className:"text-blue-900 text-3xl",children:Math.round(kt)})]})]})}),e.jsxs("div",{className:"flex space-x-3 mt-6 px-6 pb-6",children:[i.items.length>0&&!V&&e.jsxs("button",{onClick:K,className:"btn btn-secondary flex-1",children:[e.jsx(be,{className:"h-4 w-4 mr-2"}),"Clear Cart"]}),i.items.length>0&&e.jsxs("button",{onClick:()=>{const t={poNumber:`PO-${Date.now()}`,supplier:u,items:i.items.map(s=>({product:S==null?void 0:S.find(n=>n._id===s.product),quantity:s.quantity,unitCost:s.costPerUnit,totalCost:s.quantity*s.costPerUnit})),subtotal:Me,tax:$e,total:Ae,expectedDelivery:i.expectedDelivery,notes:i.notes,terms:i.terms,createdAt:new Date().toISOString()};he(t)},className:"btn btn-secondary flex-1",children:[e.jsx(Qt,{className:"h-4 w-4 mr-2"}),"Print Preview"]}),e.jsxs("button",{onClick:bt,disabled:Ce||i.items.length===0,className:"btn btn-primary btn-lg flex-2",children:[e.jsx(Gt,{className:"h-4 w-4 mr-2"}),Ce?"Creating...":"Create Purchase Order"]})]})]})]}),V&&l&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",onClick:t=>t.stopPropagation(),children:e.jsx("div",{className:"bg-white rounded-lg shadow-xl max-w-6xl w-full mx-4 max-h-[90vh] overflow-y-auto",onClick:t=>t.stopPropagation(),onKeyDown:t=>t.stopPropagation(),children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Edit Purchase Order"}),e.jsx("button",{onClick:()=>{re(!1),I(null),y(""),q(""),B(null),$(1),A(0),v(-1),K()},className:"bg-gray-600 text-white px-4 py-2 rounded-lg hover:bg-gray-700",children:"Close"})]}),e.jsxs("div",{className:"bg-gradient-to-br from-blue-50 to-indigo-50 border-2 border-blue-200 rounded-lg mb-6",children:[e.jsx("div",{className:"px-6 py-4 border-b border-blue-200",children:e.jsx("h3",{className:"text-lg font-medium text-gray-900 text-right",children:"Edit Purchase Order Details"})}),e.jsxs("div",{className:"px-6 py-4",children:[e.jsx("div",{className:"mb-4",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Supplier Selection"}),e.jsx("input",{type:"text",placeholder:"Search suppliers...",value:P,onChange:t=>y(t.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"}),P&&((Le=j==null?void 0:j.suppliers)==null?void 0:Le.length)>0&&e.jsx("div",{className:"mt-2 max-h-40 overflow-y-auto border border-gray-200 rounded-md bg-white shadow-lg",children:j.suppliers.slice(0,5).map(t=>e.jsxs("div",{onClick:()=>{d(s=>({...s,supplier:t._id})),y(t.companyName||t.name)},className:"px-3 py-2 hover:bg-gray-100 cursor-pointer border-b border-gray-100 last:border-b-0",children:[e.jsx("div",{className:"font-medium",children:t.companyName||t.name}),e.jsx("div",{className:"text-sm text-gray-600",children:t.email})]},t._id))}),i.supplier&&e.jsxs("div",{className:"mt-2 p-2 bg-blue-50 rounded border",children:[e.jsxs("div",{className:"text-sm font-medium text-blue-900",children:["Selected: ",((ze=l==null?void 0:l.supplierInfo)==null?void 0:ze.companyName)||((Qe=l==null?void 0:l.supplierInfo)==null?void 0:Qe.name)||"Supplier"]}),e.jsx("button",{type:"button",onClick:()=>{d(t=>({...t,supplier:null})),y("")},className:"text-xs text-blue-600 hover:text-blue-800 mt-1",children:"Clear selection"})]})]})}),e.jsxs("div",{className:"flex flex-nowrap gap-3 items-end justify-end",children:[e.jsxs("div",{className:"flex flex-col w-44",children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Invoice Number"}),e.jsx("input",{type:"text",value:i.invoiceNumber||"Auto-generated",onChange:t=>d(s=>({...s,invoiceNumber:t.target.value})),className:"input h-8 text-sm",placeholder:"Auto-generated",disabled:!0})]}),e.jsxs("div",{className:"flex flex-col w-48",children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Expected Delivery"}),e.jsx("input",{type:"date",value:i.expectedDelivery,onChange:t=>d(s=>({...s,expectedDelivery:t.target.value})),className:"input h-8 text-sm"})]}),e.jsxs("div",{className:"flex flex-col w-40",children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Tax Status"}),e.jsxs("div",{className:"flex items-center space-x-1 px-2 py-1 border border-gray-200 rounded h-8",children:[e.jsx("input",{type:"checkbox",id:"taxExemptEdit",checked:i.isTaxExempt,onChange:t=>d(s=>({...s,isTaxExempt:t.target.checked})),className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),e.jsx("label",{htmlFor:"taxExemptEdit",className:"text-xs text-gray-700",children:"Tax Exempt"})]})]})]}),e.jsx("div",{className:"mt-4",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Notes"}),e.jsx("textarea",{value:i.notes,onChange:t=>d(s=>({...s,notes:t.target.value})),className:"input h-16 text-sm resize-none",placeholder:"Add any notes or comments..."})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Terms & Conditions"}),e.jsx("textarea",{value:i.terms,onChange:t=>d(s=>({...s,terms:t.target.value})),className:"input h-16 text-sm resize-none",placeholder:"Add terms and conditions..."})]})]})})]}),e.jsxs("div",{className:"px-6 py-4 border-t border-blue-200",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-900 mb-3",children:"Product Selection & Cart Items"}),e.jsx("div",{className:"mb-4",children:e.jsxs("div",{className:"grid grid-cols-12 gap-4 items-end",children:[e.jsxs("div",{className:"col-span-6",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Product Search"}),e.jsx("input",{type:"text",placeholder:"Search or type product name...",value:ue,onChange:t=>{t.stopPropagation(),q(t.target.value),v(-1)},onFocus:t=>t.stopPropagation(),onKeyDown:t=>{var a;if(t.stopPropagation(),!(w!=null&&w.length))return;const s=Math.min(w.length-1,4);switch(t.key){case"ArrowDown":t.preventDefault(),v(n=>n<s?n+1:0);break;case"ArrowUp":t.preventDefault(),v(n=>n>0?n-1:s);break;case"Enter":if(t.preventDefault(),ce>=0&&w[ce]){const n=w[ce];B(n),A(((a=n.pricing)==null?void 0:a.costPrice)||0),$(1),q(n.name),v(-1),setTimeout(()=>{const r=document.querySelector(".modal-quantity-input");r&&r.focus()},100)}break;case"Escape":t.preventDefault(),v(-1);break}},className:"modal-product-search w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",autoFocus:!0}),ue&&(w==null?void 0:w.length)>0&&e.jsx("div",{className:"mt-2 max-h-40 overflow-y-auto border border-gray-200 rounded-md bg-white shadow-lg",children:w.slice(0,5).map((t,s)=>{var a,n;return e.jsxs("div",{onClick:()=>{var r;B(t),A(((r=t.pricing)==null?void 0:r.costPrice)||0),$(1),q(t.name),v(-1),setTimeout(()=>{const c=document.querySelector(".modal-quantity-input");c&&c.focus()},100)},className:`px-3 py-2 cursor-pointer border-b border-gray-100 last:border-b-0 ${ce===s?"bg-blue-100 border-blue-200":"hover:bg-gray-100"}`,children:[e.jsx("div",{className:"font-medium",children:t.name}),e.jsxs("div",{className:"text-sm text-gray-600",children:["Stock: ",((a=t.inventory)==null?void 0:a.currentStock)||0," | Cost: ",((n=t.pricing)==null?void 0:n.costPrice)||0]})]},t._id)})})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Quantity"}),e.jsx("input",{type:"number",min:"1",value:G,onChange:t=>$(parseInt(t.target.value)||1),className:"modal-quantity-input w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"1"})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Cost Per Unit"}),e.jsx("input",{type:"number",step:"0.01",value:H,onChange:t=>A(parseFloat(t.target.value)||0),className:"modal-cost-input w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"0.00"})]}),e.jsx("div",{className:"col-span-2",children:e.jsx("button",{type:"button",onClick:()=>{if(ie&&G>0&&H>=0){const t={product:ie._id,quantity:G,costPerUnit:H,totalCost:G*H,productData:ie};d(s=>({...s,items:[...s.items,t]})),B(null),q(""),$(1),A(0),v(-1)}},disabled:!ie||G<=0||H<0,className:"w-full px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:bg-gray-300 disabled:cursor-not-allowed",children:"Add Product"})})]})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h5",{className:"text-sm font-medium text-gray-700 mb-2",children:"Current Items:"}),i.items.length===0?e.jsx("p",{className:"text-sm text-gray-500 italic",children:"No items in this order"}):i.items.map((t,s)=>{var a;return e.jsxs("div",{className:"flex items-center p-3 bg-white border border-gray-200 rounded-lg",children:[e.jsx("div",{className:"font-medium text-gray-900 min-w-[200px] mr-4",children:((a=t.productData)==null?void 0:a.name)||"Unknown Product"}),e.jsxs("div",{className:"flex items-center space-x-3 ml-auto",children:[e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("label",{className:"text-xs text-gray-600",children:"Qty:"}),e.jsx("input",{type:"number",min:"1",value:t.quantity,onChange:n=>{const r=[...i.items],c=Math.max(1,parseInt(n.target.value)||1);r[s].quantity=c,r[s].totalCost=c*r[s].costPerUnit,d(p=>({...p,items:r}))},className:"w-16 px-2 py-1 text-sm border border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-blue-500"})]}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("label",{className:"text-xs text-gray-600",children:"× Cost:"}),e.jsx("input",{type:"number",step:"0.01",min:"0",value:t.costPerUnit,onChange:n=>{const r=[...i.items],c=parseFloat(n.target.value)||0;r[s].costPerUnit=c,r[s].totalCost=r[s].quantity*c,d(p=>({...p,items:r}))},className:"w-20 px-2 py-1 text-sm border border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-blue-500"})]}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("label",{className:"text-xs text-gray-600",children:"="}),e.jsx("span",{className:"text-sm font-medium text-gray-900 min-w-[60px]",children:t.totalCost.toFixed(2)})]}),e.jsx("button",{type:"button",onClick:()=>{const n=i.items.filter((r,c)=>c!==s);d(r=>({...r,items:n}))},className:"px-2 py-1 text-sm bg-red-200 text-red-700 rounded hover:bg-red-300 ml-2",title:"Remove item",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]})]},s)})]})]}),e.jsxs("div",{className:"px-6 py-4 border-t border-blue-200",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-900 mb-3",children:"Order Items Summary"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"bg-white rounded-lg p-3 border border-gray-200",children:[e.jsx("div",{className:"text-xs text-gray-600 mb-1",children:"Total Items"}),e.jsx("div",{className:"text-lg font-semibold text-gray-900",children:i.items.length})]}),e.jsxs("div",{className:"bg-white rounded-lg p-3 border border-gray-200",children:[e.jsx("div",{className:"text-xs text-gray-600 mb-1",children:"Total Quantity"}),e.jsx("div",{className:"text-lg font-semibold text-gray-900",children:i.items.reduce((t,s)=>t+s.quantity,0)})]}),e.jsxs("div",{className:"bg-white rounded-lg p-3 border border-gray-200",children:[e.jsx("div",{className:"text-xs text-gray-600 mb-1",children:"Total Cost"}),e.jsx("div",{className:"text-lg font-semibold text-blue-600",children:Math.round(i.items.reduce((t,s)=>t+s.totalCost,0))})]})]})]}),e.jsx("div",{className:"px-6 py-4 border-t border-blue-200 bg-white rounded-b-lg",children:e.jsx("div",{className:"flex justify-end",children:e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-sm text-gray-600 mb-1",children:"Total Payables"}),e.jsx("div",{className:"text-2xl font-bold text-blue-900",children:Math.round(i.items.reduce((t,s)=>t+s.totalCost,0))})]})})}),e.jsxs("div",{className:"flex items-center justify-end space-x-3 p-6 border-t border-gray-200",children:[e.jsx("button",{onClick:()=>{re(!1),I(null),y(""),q(""),B(null),$(1),A(0),v(-1),K()},className:"px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 border border-gray-300 rounded-md hover:bg-gray-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500",children:"Cancel"}),e.jsx("button",{onClick:ft,disabled:Pe||i.items.length===0,className:"px-4 py-2 text-sm font-medium text-white bg-blue-600 border border-transparent rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:bg-gray-300 disabled:cursor-not-allowed",children:Pe?"Updating...":"Update Purchase Order"})]})]})]})})}),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Ht,{className:"h-5 w-5 text-gray-400"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Filters"})]})}),e.jsx("div",{className:"card-content",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-6 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"From Date"}),e.jsx("input",{type:"date",value:T.fromDate,onChange:t=>te("fromDate",t.target.value),className:"input h-[42px]"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"To Date"}),e.jsx("input",{type:"date",value:T.toDate,onChange:t=>te("toDate",t.target.value),className:"input h-[42px]"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"PO Number"}),e.jsx("input",{type:"text",placeholder:"Contains...",value:T.poNumber,onChange:t=>te("poNumber",t.target.value),className:"input h-[42px]"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Status"}),e.jsxs("select",{value:T.status,onChange:t=>te("status",t.target.value),className:"input h-[42px]",children:[e.jsx("option",{value:"",children:"All Statuses"}),e.jsx("option",{value:"draft",children:"Pending"}),e.jsx("option",{value:"confirmed",children:"Confirmed"}),e.jsx("option",{value:"partially_received",children:"Partially Received"}),e.jsx("option",{value:"fully_received",children:"Fully Received"}),e.jsx("option",{value:"cancelled",children:"Cancelled"}),e.jsx("option",{value:"closed",children:"Closed"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Payment Status"}),e.jsxs("select",{value:T.paymentStatus,onChange:t=>te("paymentStatus",t.target.value),className:"input h-[42px]",children:[e.jsx("option",{value:"",children:"All Payment Statuses"}),e.jsx("option",{value:"pending",children:"Pending"}),e.jsx("option",{value:"paid",children:"Paid"}),e.jsx("option",{value:"partial",children:"Partial"}),e.jsx("option",{value:"refunded",children:"Refunded"})]})]}),e.jsx("div",{className:"flex items-end",children:e.jsxs("button",{onClick:()=>F(),className:"btn btn-primary w-full flex items-center justify-center space-x-2 h-[42px]",children:[e.jsx(ge,{className:"h-4 w-4"}),e.jsx("span",{children:"Search"})]})})]})})]}),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h3",{className:"text-lg font-medium text-gray-900",children:["Purchase Orders From: ",_(T.fromDate)," To: ",_(T.toDate)]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("span",{className:"text-sm text-gray-500",children:[Pt.totalItems||0," records"]}),e.jsx("button",{onClick:()=>F(),className:"p-2 text-gray-400 hover:text-gray-600",title:"Refresh",children:e.jsx(Ye,{className:"h-4 w-4"})})]})]})}),e.jsx("div",{className:"card-content p-0",children:lt?e.jsxs("div",{className:"p-8 text-center",children:[e.jsx(Ye,{className:"h-8 w-8 animate-spin mx-auto text-gray-400"}),e.jsx("p",{className:"mt-2 text-gray-500",children:"Loading purchase orders..."})]}):ve?e.jsx("div",{className:"p-8 text-center text-red-600",children:e.jsxs("p",{children:["Error loading purchase orders: ",ve.message]})}):Ie.length===0?e.jsx("div",{className:"p-8 text-center text-gray-500",children:e.jsx("p",{children:"No purchase orders found for the selected criteria."})}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Date"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"PO #"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Supplier"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Total"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:Ie.map((t,s)=>e.jsxs("tr",{className:s%2===0?"bg-white":"bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:_(t.createdAt)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:t.poNumber}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:h(t.supplier)||"Unknown"}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:e.jsx(Zt,{status:t.status})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:Math.round(t.total||0)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{onClick:()=>wt(t),className:"text-blue-600 hover:text-blue-900",title:"View",children:e.jsx(Xt,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>he(t),className:"text-gray-600 hover:text-gray-900",title:"Print",children:e.jsx(et,{className:"h-4 w-4"})}),(t.status==="draft"||t.status==="confirmed"||t.status==="partially_received"||t.status==="cancelled")&&e.jsx("button",{onClick:()=>vt(t),className:"text-indigo-600 hover:text-indigo-900",title:"Edit",children:e.jsx(Yt,{className:"h-4 w-4"})}),t.status==="draft"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>jt(t._id),className:"text-green-600 hover:text-green-900",title:"Confirm Order",children:e.jsx(fe,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>Nt(t._id),className:"text-red-600 hover:text-red-900",title:"Cancel Order",children:e.jsx(ye,{className:"h-4 w-4"})})]}),(t.status==="draft"||t.status==="cancelled"||t.status==="confirmed"||t.status==="partially_received"||!t.supplier)&&e.jsx("button",{onClick:()=>yt(t._id),className:"text-red-600 hover:text-red-900",title:"Delete",children:e.jsx(be,{className:"h-4 w-4"})})]})})]},t._id))})]})})})]}),rt&&l&&e.jsx("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50",children:e.jsx("div",{className:"relative top-10 mx-auto p-5 border w-4/5 max-w-4xl shadow-lg rounded-md bg-white",children:e.jsxs("div",{className:"mt-3",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h3",{className:"text-2xl font-bold text-gray-900",children:"Purchase Order"}),e.jsx("button",{onClick:()=>{oe(!1),I(null)},className:"text-gray-400 hover:text-gray-600 transition-colors",children:e.jsx("svg",{className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsxs("div",{className:"mb-6 text-center",children:[e.jsx("h4",{className:"text-lg font-semibold text-gray-900 mb-2",children:Ne}),ae&&e.jsx("p",{className:"text-sm text-gray-600",children:ae}),ne&&e.jsxs("p",{className:"text-sm text-gray-600",children:["Phone: ",ne]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-6 mb-6",children:[e.jsxs("div",{children:[e.jsx("h5",{className:"font-semibold text-gray-900 mb-2",children:"Purchase Order Details"}),e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"PO Number:"})," ",l.poNumber]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Date:"})," ",_(l.createdAt)]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Status:"}),e.jsx("span",{className:`ml-2 px-2 py-1 rounded-full text-xs font-medium ${l.status==="draft"?"bg-gray-100 text-gray-800":l.status==="confirmed"?"bg-blue-100 text-blue-800":l.status==="partially_received"?"bg-yellow-100 text-yellow-800":l.status==="fully_received"?"bg-green-100 text-green-800":l.status==="cancelled"?"bg-red-100 text-red-800":"bg-gray-100 text-gray-800"}`,children:l.status==="draft"?"Pending":l.status.replace("_"," ")})]}),l.expectedDelivery&&e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Expected Delivery:"})," ",_(l.expectedDelivery)]})]})]}),e.jsx("div",{}),e.jsxs("div",{className:"text-right",children:[e.jsx("h5",{className:"font-semibold text-gray-900 mb-2",children:"Supplier Details"}),e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Company:"})," ",h(l.supplier)||"Unknown"]}),((Be=l.supplier)==null?void 0:Be.email)&&e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Email:"})," ",h(l.supplier.email)]}),((Re=l.supplier)==null?void 0:Re.phone)&&e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Phone:"})," ",h(l.supplier.phone)]}),((Ke=l.supplier)==null?void 0:Ke.contactPerson)&&e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Contact:"})," ",h(l.supplier.contactPerson)]}),e.jsx("div",{className:"mt-3 pt-2 border-t border-gray-200",children:e.jsxs("p",{className:"font-semibold text-red-600",children:[e.jsx("span",{className:"font-medium",children:"Outstanding Balance:"})," ",Math.round(((Ve=l.supplier)==null?void 0:Ve.pendingBalance)||0)]})})]})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("h5",{className:"font-semibold text-gray-900 mb-3",children:"Items Ordered"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full border border-gray-200 rounded-lg",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider border-b border-gray-200",children:"#"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider border-b border-gray-200",children:"Product"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider border-b border-gray-200",children:"Quantity"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider border-b border-gray-200",children:"Unit Cost"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider border-b border-gray-200",children:"Total Cost"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:l.items&&l.items.map((t,s)=>{var a;return e.jsxs("tr",{className:s%2===0?"bg-white":"bg-gray-50",children:[e.jsx("td",{className:"px-4 py-3 text-sm text-gray-900 border-b border-gray-200",children:s+1}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-900 border-b border-gray-200",children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:h(t.product)||"Unknown Product"}),((a=t.product)==null?void 0:a.description)&&e.jsx("div",{className:"text-gray-500 text-xs",children:h(t.product.description)})]})}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-900 text-right border-b border-gray-200",children:t.quantity}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-900 text-right border-b border-gray-200",children:Math.round(t.costPerUnit||0)}),e.jsx("td",{className:"px-4 py-3 text-sm font-medium text-gray-900 text-right border-b border-gray-200",children:Math.round(t.totalCost||0)})]},s)})})]})})]}),e.jsx("div",{className:"flex justify-end mb-6",children:e.jsx("div",{className:"w-80",children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Subtotal:"}),e.jsx("span",{className:"font-medium",children:Math.round(l.subtotal||0)})]}),l.tax&&l.tax>0&&e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Tax:"}),e.jsx("span",{className:"font-medium",children:Math.round(l.tax)})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"PO Total:"}),e.jsx("span",{className:"font-medium",children:Math.round(l.total||0)})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Previous Outstanding:"}),e.jsx("span",{className:"font-medium text-red-600",children:Math.round(((We=l.supplier)==null?void 0:We.pendingBalance)||0)})]}),e.jsxs("div",{className:"flex justify-between text-lg font-bold border-t pt-2",children:[e.jsx("span",{children:"Total Payables:"}),e.jsx("span",{className:"text-red-600",children:Math.round((l.total||0)+(((Ge=l.supplier)==null?void 0:Ge.pendingBalance)||0))})]})]})})}),l.notes&&e.jsxs("div",{className:"mb-6",children:[e.jsx("h5",{className:"font-semibold text-gray-900 mb-2",children:"Notes"}),e.jsx("p",{className:"text-sm text-gray-600 bg-gray-50 p-3 rounded border",children:h(l.notes)})]}),l.terms&&e.jsxs("div",{className:"mb-6",children:[e.jsx("h5",{className:"font-semibold text-gray-900 mb-2",children:"Terms & Conditions"}),e.jsx("p",{className:"text-sm text-gray-600 bg-gray-50 p-3 rounded border",children:h(l.terms)})]}),e.jsxs("div",{className:"flex justify-between items-center pt-4 border-t",children:[e.jsxs("div",{className:"text-xs text-gray-500",children:["Generated on ",new Date().toLocaleDateString()," at ",new Date().toLocaleTimeString()]}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsxs("button",{onClick:()=>he(l),className:"btn btn-primary flex items-center",children:[e.jsx(et,{className:"h-4 w-4 mr-2"}),"Print"]}),e.jsx("button",{onClick:()=>{oe(!1),I(null)},className:"btn btn-secondary",children:"Close"})]})]})]})})})]})};export{Ss as PurchaseOrders};
