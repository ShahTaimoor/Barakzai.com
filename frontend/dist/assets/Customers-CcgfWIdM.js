import{r as u,ar as de,as as oe,at as me,au as xe,p as e,L as K,X as G,B as H,y as J,z as ee,Q as C,ai as ue,S as ae,U as le,ad as ie,d as he,av as pe,aw as ge,ax as be,ao as je,ay as fe,a1 as ne,az as Ne,aA as ye,aB as ve,aC as se}from"./index-Cw3xRKpc.js";import{u as Ce}from"./chartOfAccountsApi-D_feYQra.js";import{u as we,a as Se}from"./citiesApi-jw-g4twr.js";import{u as Ae}from"./useFuzzySearch-ZiMs9RBo.js";import{D as Ee}from"./ConfirmationDialog-CxU4qXW2.js";import{a as ke}from"./useConfirmation-BJ-PhpCl.js";import{D as te}from"./download-B8XL5QGf.js";import{U as Le}from"./upload-BX7dAFuH.js";import{F as Ie}from"./file-spreadsheet-DnPvONRj.js";import{C as Te}from"./check-circle-C7396OEq.js";import{A as Fe}from"./alert-circle-HQsWpy-L.js";import{F as Pe}from"./filter-bwJnrGXq.js";import{C as Ue}from"./chevron-up-CBQVXqcQ.js";import{C as Be}from"./chevron-down-BKU-tyXN.js";import{P as re}from"./phone-D5Mv4op6.js";import{N as De}from"./NotesPanel-CiNYxO-7.js";import{P as Me}from"./plus-DxsvPhf3.js";import{M as ze}from"./message-square-BY9VhxYt.js";import{P as Re}from"./pen-square-XPG_rn4Q.js";import{T as _e}from"./trash-2-D2rrIU_x.js";import"./shield-Bzu0Nlf_.js";import"./info-9RksQo07.js";import"./history-B8jJndAB.js";import"./lock-WdI7bfPW.js";const Oe=({onImportComplete:t,filters:L={}})=>{const[f,w]=u.useState(null),[x,N]=u.useState(null),[j,v]=u.useState(!1),[A,{isLoading:E}]=de(),[l,{isLoading:n}]=oe(),{refetch:S}=me(void 0,{skip:!0}),[g]=xe(),y=async()=>{try{const d=await A(L).unwrap();if(d.downloadUrl){const h=d.filename||"customers.xlsx",b=await g(h).unwrap(),c=b instanceof Blob?b:new Blob([b]),p=document.createElement("a"),F=URL.createObjectURL(c);p.setAttribute("href",F),p.setAttribute("download",h),p.style.visibility="hidden",document.body.appendChild(p),p.click(),document.body.removeChild(p),URL.revokeObjectURL(F)}H(`Exported ${d.recordCount||0} customers to Excel`)}catch(d){J(d,"Excel Export")}},k=d=>{const h=d.target.files[0];if(h){if(!["application/vnd.ms-excel","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"].includes(h.mimetype)&&!h.name.match(/\.(xlsx|xls)$/)){ee("Invalid file type. Only Excel files are allowed."),d.target.value="";return}if(h.size>10*1024*1024){ee("File size exceeds 10MB limit"),d.target.value="";return}w(h)}},U=async()=>{var d,h,b;if(!f){C.error("Please select a file to import");return}try{const c=await l(f).unwrap();if(N((c==null?void 0:c.results)||c),((d=c==null?void 0:c.results)==null?void 0:d.success)>0||(c==null?void 0:c.success)>0){const F=((h=c==null?void 0:c.results)==null?void 0:h.success)||(c==null?void 0:c.success);H(`Successfully imported ${F} customers`),t&&t()}const p=((b=c==null?void 0:c.results)==null?void 0:b.errors)||(c==null?void 0:c.errors)||[];p.length>0&&ue(`${p.length} customers failed to import`)}catch(c){J(c,"Customer Import")}},R=async()=>{try{const d=await S(),h=d.data instanceof Blob?d.data:new Blob([d.data],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),b=document.createElement("a"),c=URL.createObjectURL(h);b.setAttribute("href",c),b.setAttribute("download","customer_template.xlsx"),b.style.visibility="hidden",document.body.appendChild(b),b.click(),document.body.removeChild(b),URL.revokeObjectURL(c),H("Template downloaded successfully")}catch(d){J(d,"Template Download")}},I=()=>{w(null),N(null),v(!1)};return e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Import / Export Customers"}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs("div",{className:"relative group",children:[e.jsxs("button",{onClick:R,className:"btn btn-outline btn-sm",children:[e.jsx(te,{className:"h-4 w-4 mr-2"}),"Template"]}),e.jsxs("div",{className:"absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 px-3 py-2 bg-gray-900 text-white text-sm rounded-lg opacity-0 group-hover:opacity-100 transition-opacity duration-200 pointer-events-none whitespace-nowrap z-10",children:[e.jsxs("div",{className:"text-xs space-y-1",children:[e.jsx("div",{children:"• Download Excel template file"}),e.jsx("div",{children:"• Pre-formatted with correct columns"}),e.jsx("div",{children:"• Shows required and optional fields"}),e.jsx("div",{children:"• Use this to prepare import data"})]}),e.jsx("div",{className:"absolute top-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-l-4 border-r-4 border-t-4 border-transparent border-t-gray-900"})]})]}),e.jsxs("div",{className:"relative group",children:[e.jsxs(K,{onClick:y,isLoading:E,className:"btn btn-secondary btn-sm",children:[e.jsx(te,{className:"h-4 w-4 mr-2"}),"Export Excel"]}),e.jsxs("div",{className:"absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 px-3 py-2 bg-gray-900 text-white text-sm rounded-lg opacity-0 group-hover:opacity-100 transition-opacity duration-200 pointer-events-none whitespace-nowrap z-10",children:[e.jsxs("div",{className:"text-xs space-y-1",children:[e.jsx("div",{children:"• Exports all customers to Excel file"}),e.jsx("div",{children:"• Includes all customer data and fields"}),e.jsx("div",{children:"• File format: Excel (.xlsx)"}),e.jsx("div",{children:"• Filtered results based on current search"})]}),e.jsx("div",{className:"absolute top-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-l-4 border-r-4 border-t-4 border-transparent border-t-gray-900"})]})]}),e.jsxs("div",{className:"relative group",children:[e.jsxs("button",{onClick:()=>v(!0),className:"btn btn-primary btn-sm",children:[e.jsx(Le,{className:"h-4 w-4 mr-2"}),"Import Customers"]}),e.jsxs("div",{className:"absolute bottom-full right-0 mb-2 px-3 py-2 bg-gray-900 text-white text-sm rounded-lg opacity-0 group-hover:opacity-100 transition-opacity duration-200 pointer-events-none whitespace-nowrap z-10",children:[e.jsxs("div",{className:"text-xs space-y-1",children:[e.jsx("div",{children:"• Download template for required format"}),e.jsx("div",{children:"• Required: Name, Business Name"}),e.jsx("div",{children:"• Supported: Excel (.xlsx), Max 10MB"}),e.jsx("div",{children:"• Duplicates will be skipped"})]}),e.jsx("div",{className:"absolute top-full right-4 w-0 h-0 border-l-4 border-r-4 border-t-4 border-transparent border-t-gray-900"})]})]})]})]}),j&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-md w-full mx-4",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Import Customers"}),e.jsx("button",{onClick:I,className:"text-gray-400 hover:text-gray-600",children:e.jsx(G,{className:"h-5 w-5"})})]}),e.jsx("div",{className:"p-6",children:x?e.jsxs("div",{children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-3",children:"Import Results"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{className:"text-center p-3 bg-green-50 rounded-lg",children:[e.jsx(Te,{className:"h-6 w-6 text-green-600 mx-auto mb-1"}),e.jsx("div",{className:"text-lg font-semibold text-green-600",children:x.success}),e.jsx("div",{className:"text-sm text-green-700",children:"Success"})]}),e.jsxs("div",{className:"text-center p-3 bg-red-50 rounded-lg",children:[e.jsx(Fe,{className:"h-6 w-6 text-red-600 mx-auto mb-1"}),e.jsx("div",{className:"text-lg font-semibold text-red-600",children:x.errors.length}),e.jsx("div",{className:"text-sm text-red-700",children:"Errors"})]})]}),x.errors.length>0&&e.jsxs("div",{className:"max-h-40 overflow-y-auto",children:[e.jsx("h5",{className:"font-medium text-gray-900 mb-2",children:"Errors:"}),e.jsxs("div",{className:"space-y-2",children:[x.errors.slice(0,10).map((d,h)=>e.jsxs("div",{className:"text-sm text-red-600 bg-red-50 p-2 rounded",children:["Row ",d.row,": ",d.error]},h)),x.errors.length>10&&e.jsxs("div",{className:"text-sm text-gray-500",children:["... and ",x.errors.length-10," more errors"]})]})]})]}),e.jsx("div",{className:"flex justify-end",children:e.jsx("button",{onClick:I,className:"btn btn-primary btn-sm",children:"Close"})})]}):e.jsxs("div",{children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Select Excel File"}),e.jsx("input",{type:"file",accept:".xlsx,.xls",onChange:k,className:"input w-full"})]}),f&&e.jsx("div",{className:"mb-4 p-3 bg-gray-50 rounded-lg",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(Ie,{className:"h-4 w-4 text-gray-600 mr-2"}),e.jsx("span",{className:"text-sm text-gray-700",children:f.name}),e.jsxs("span",{className:"text-xs text-gray-500 ml-auto",children:[(f.size/1024/1024).toFixed(2)," MB"]})]})}),e.jsxs("div",{className:"flex justify-end space-x-3",children:[e.jsx("button",{onClick:I,className:"btn btn-secondary btn-sm",children:"Cancel"}),e.jsx(K,{onClick:U,isLoading:n,disabled:!f,className:"btn btn-primary btn-sm",children:"Import Customers"})]})]})})]})})]})},$e=({filters:t,onFiltersChange:L,onClearFilters:f})=>{const[w,x]=u.useState(!1),N=(l,n)=>{L({...t,[l]:n})},j=l=>{const n={...t};delete n[l],L(n)},v=()=>{L({}),f&&f()},A=Object.keys(t).some(l=>t[l]!==""&&t[l]!==null&&t[l]!==void 0),E=()=>Object.keys(t).filter(l=>t[l]!==""&&t[l]!==null&&t[l]!==void 0).length;return e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 cursor-pointer hover:bg-gray-50",onClick:()=>x(!w),children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(Pe,{className:"h-5 w-5 text-gray-600"}),e.jsx("span",{className:"font-medium text-gray-900",children:"Filters"}),A&&e.jsxs("span",{className:"bg-blue-100 text-blue-800 text-xs font-medium px-2 py-1 rounded-full",children:[E()," active"]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[A&&e.jsx("button",{onClick:l=>{l.stopPropagation(),v()},className:"text-sm text-red-600 hover:text-red-800 font-medium",children:"Clear All"}),w?e.jsx(Ue,{className:"h-4 w-4 text-gray-400"}):e.jsx(Be,{className:"h-4 w-4 text-gray-400"})]})]}),w&&e.jsxs("div",{className:"border-t border-gray-200 p-4",children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx(ae,{className:"h-4 w-4 inline mr-1"}),"Search Customers"]}),e.jsx("input",{type:"text",placeholder:"Name, email, or phone...",value:t.search||"",onChange:l=>N("search",l.target.value),className:"input text-sm"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx(le,{className:"h-4 w-4 inline mr-1"}),"Status"]}),e.jsxs("select",{value:t.status||"",onChange:l=>N("status",l.target.value),className:"input text-sm",children:[e.jsx("option",{value:"",children:"All Statuses"}),e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"inactive",children:"Inactive"})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx(ie,{className:"h-4 w-4 inline mr-1"}),"Email Status"]}),e.jsxs("select",{value:t.emailStatus||"",onChange:l=>N("emailStatus",l.target.value),className:"input text-sm",children:[e.jsx("option",{value:"",children:"All Email Statuses"}),e.jsx("option",{value:"verified",children:"Verified"}),e.jsx("option",{value:"unverified",children:"Unverified"}),e.jsx("option",{value:"no-email",children:"No Email"})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx(re,{className:"h-4 w-4 inline mr-1"}),"Phone Status"]}),e.jsxs("select",{value:t.phoneStatus||"",onChange:l=>N("phoneStatus",l.target.value),className:"input text-sm",children:[e.jsx("option",{value:"",children:"All Phone Statuses"}),e.jsx("option",{value:"verified",children:"Verified"}),e.jsx("option",{value:"unverified",children:"Unverified"}),e.jsx("option",{value:"no-phone",children:"No Phone"})]})]})]}),A&&e.jsxs("div",{className:"border-t border-gray-200 pt-4 mt-4",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-700 mb-3",children:"Active Filters:"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:Object.entries(t).map(([l,n])=>{if(!n||n==="")return null;let S,g;switch(l){case"search":S="Search",g=`"${n}"`;break;case"status":S="Status",g=n.charAt(0).toUpperCase()+n.slice(1);break;case"emailStatus":S="Email",g=n==="verified"?"Verified":n==="unverified"?"Unverified":n==="no-email"?"No Email":n;break;case"phoneStatus":S="Phone",g=n==="verified"?"Verified":n==="unverified"?"Unverified":n==="no-phone"?"No Phone":n;break;default:S=l.charAt(0).toUpperCase()+l.slice(1),g=n}return e.jsxs("span",{className:"inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-800",children:[S,": ",g,e.jsx("button",{onClick:()=>j(l),className:"ml-1 inline-flex items-center justify-center w-4 h-4 rounded-full hover:bg-blue-200",children:e.jsx(G,{className:"h-3 w-3"})})]},l)})})]})]})]})},$={name:"",email:"",phone:"",businessName:"",businessType:"wholesale",customerTier:"bronze",creditLimit:0,openingBalance:0,status:"active",ledgerAccount:"",addresses:[{type:"both",street:"",city:"",state:"",zipCode:"",country:"US",isDefault:!0}]},qe=({customer:t,onSave:L,onCancel:f,isSubmitting:w})=>{const{register:x,handleSubmit:N,formState:{errors:j},reset:v,setValue:A,watch:E,setError:l,clearErrors:n}=Ne({defaultValues:$}),[S,g]=u.useState(!1),[y,k]=u.useState({name:"",state:"",country:"US",description:"",isActive:!0}),[U,R]=u.useState(!1),[I,d]=u.useState(!1),[h,b]=u.useState(!1),[c,p]=u.useState(!1),[F]=ye(),[W]=ve(),[X,{isLoading:q}]=we(),V=E("addresses")||$.addresses,B=E("email"),M=E("businessName");u.useEffect(()=>{if(!B||B.trim()===""){d(!1),n("email");return}if(!/^[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,}$/i.test(B)){d(!1);return}if(t&&t.email&&t.email.toLowerCase()===B.toLowerCase()){d(!1),n("email");return}const a=setTimeout(async()=>{var r;try{R(!0);const m=(t==null?void 0:t._id)||null,o=await F({email:B,excludeId:m}).unwrap();((r=o==null?void 0:o.data)==null?void 0:r.exists)??(o==null?void 0:o.exists)?(d(!0),l("email",{type:"manual",message:"Email already exists"})):(d(!1),n("email"))}catch{d(!1)}finally{R(!1)}},500);return()=>clearTimeout(a)},[B,t,l,n]),u.useEffect(()=>{if(!M||M.trim()===""){p(!1),n("businessName");return}if(t&&t.businessName&&t.businessName.trim().toLowerCase()===M.trim().toLowerCase()){p(!1),n("businessName");return}const s=setTimeout(async()=>{var a;try{b(!0);const r=(t==null?void 0:t._id)||null,m=await W({businessName:M,excludeId:r}).unwrap();((a=m==null?void 0:m.data)==null?void 0:a.exists)??(m==null?void 0:m.exists)?(p(!0),l("businessName",{type:"manual",message:"Business name already exists"})):(p(!1),n("businessName"))}catch{p(!1)}finally{b(!1)}},500);return()=>clearTimeout(s)},[M,t,l,n]),u.useEffect(()=>{var s,a;t?(v({...$,...t,openingBalance:typeof t.openingBalance=="number"?t.openingBalance:t.pendingBalance||0,ledgerAccount:((s=t.ledgerAccount)==null?void 0:s._id)||t.ledgerAccount||"",addresses:(a=t.addresses)!=null&&a.length?t.addresses:$.addresses}),d(!1),p(!1),n("email"),n("businessName")):(v($),d(!1),p(!1),n("email"),n("businessName"))},[t,v,n]);const z=(s,a,r)=>{const m=[...V];m[s]={...m[s],[a]:r},A("addresses",m,{shouldValidate:!1})},{data:D=[],isLoading:Y}=Ce({accountType:"asset",accountCategory:"current_assets",includePartyAccounts:"true",isActive:"true"}),{data:Q=[],isLoading:_}=Se(),Z=s=>{if(s.preventDefault(),!y.name.trim()){C.error("City name is required");return}X(y).unwrap().then(()=>{C.success("City created successfully"),g(!1),k({name:"",state:"",country:"US",description:"",isActive:!0}),V.length>0&&z(0,"city",y.name)}).catch(a=>{var r;C.error(((r=a==null?void 0:a.data)==null?void 0:r.message)||"Failed to create city")})},P=u.useMemo(()=>{if(!Array.isArray(D))return[];const s=D.find(o=>(o.accountName||o.name||"").toLowerCase()==="accounts receivable"),a=D.filter(o=>{const T=(o.accountName||o.name||"").toLowerCase(),O=Array.isArray(o.tags)?o.tags:[];return T.includes("receivable")||O.includes("customer")||O.includes("accounts_receivable")||o.accountCode&&o.accountCode.startsWith("11")}),r=D.filter(o=>o.allowDirectPosting!==!1);let m=[];return s?m=[s,...a.filter(o=>o._id!==s._id&&o.id!==s.id)]:a.length>0?m=a:r.length>0?m=r:m=D,[...m].sort((o,T)=>{if(s){if(o._id===s._id||o.id===s.id)return-1;if(T._id===s._id||T.id===s.id)return 1}const O=(o.accountCode||"").toString(),ce=(T.accountCode||"").toString();return O.localeCompare(ce,void 0,{numeric:!0})})},[D]);u.useEffect(()=>{if(P.length>0){const s=P.find(a=>(a.accountName||a.name||"").toLowerCase()==="accounts receivable"||a.accountCode==="1130")||P[0];if(s&&(!t||!t.ledgerAccount)){const a=s._id||s.id;a&&A("ledgerAccount",a,{shouldValidate:!1})}}},[t,P,A]);const i=s=>{if(I){C.error("Please use a different email address");return}if(c){C.error("Please use a different business name");return}L(s),v($),d(!1),p(!1)};return e.jsxs("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:[e.jsx("div",{className:"bg-white rounded-lg max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:t?"Edit Customer":"Add New Customer"}),e.jsx("button",{onClick:f,className:"p-2 text-gray-400 hover:text-gray-600",children:e.jsx(G,{className:"h-5 w-5"})})]}),e.jsxs("form",{onSubmit:N(i),className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Business Name *"}),e.jsxs("div",{className:"relative",children:[e.jsx(ne,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx("input",{...x("businessName",{required:"Business name is required"}),className:`input pl-10 ${c?"border-red-500":""}`,placeholder:"Enter business name"}),h&&e.jsx("div",{className:"absolute right-3 top-1/2 transform -translate-y-1/2",children:e.jsx(se,{size:"sm"})})]}),j.businessName&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:j.businessName.message}),c&&!j.businessName&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:"Business name already exists"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Contact Person *"}),e.jsx("input",{...x("name",{required:"Contact person is required"}),className:"input",placeholder:"Enter contact person name"}),j.name&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:j.name.message})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Email"}),e.jsxs("div",{className:"relative",children:[e.jsx(ie,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx("input",{...x("email",{pattern:{value:/^[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,}$/i,message:"Invalid email address"}}),type:"text",className:`input pl-10 ${I?"border-red-500":""}`,placeholder:"Enter email address (optional)"}),U&&e.jsx("div",{className:"absolute right-3 top-1/2 transform -translate-y-1/2",children:e.jsx(se,{size:"sm"})})]}),j.email&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:j.email.message}),I&&!j.email&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:"Email already exists"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Phone"}),e.jsxs("div",{className:"relative",children:[e.jsx(re,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx("input",{...x("phone"),type:"tel",className:"input pl-10",placeholder:"Enter phone number"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Business Type"}),e.jsxs("select",{...x("businessType"),className:"input",children:[e.jsx("option",{value:"individual",children:"Individual"}),e.jsx("option",{value:"retail",children:"Retail"}),e.jsx("option",{value:"wholesale",children:"Wholesale"}),e.jsx("option",{value:"distributor",children:"Distributor"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Customer Tier"}),e.jsxs("select",{...x("customerTier"),className:"input",children:[e.jsx("option",{value:"bronze",children:"Bronze"}),e.jsx("option",{value:"silver",children:"Silver"}),e.jsx("option",{value:"gold",children:"Gold"}),e.jsx("option",{value:"platinum",children:"Platinum"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Credit Limit ($)"}),e.jsx("input",{...x("creditLimit",{valueAsNumber:!0,min:{value:0,message:"Credit limit must be positive"}}),type:"number",step:"0.01",className:"input",placeholder:"0.00"}),j.creditLimit&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:j.creditLimit.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Opening Balance ($)"}),e.jsx("input",{...x("openingBalance",{valueAsNumber:!0}),type:"number",step:"0.01",className:"input",placeholder:"0.00"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Positive means the customer owes you. Use a negative value if you owe the customer."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Status"}),e.jsxs("select",{...x("status"),className:"input",children:[e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"inactive",children:"Inactive"}),e.jsx("option",{value:"suspended",children:"Suspended"})]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Address"}),e.jsx("div",{className:"space-y-4",children:V.map((s,a)=>e.jsx("div",{className:"border border-gray-200 rounded-lg p-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Street Address"}),e.jsx("input",{type:"text",value:s.street||"",onChange:r=>z(a,"street",r.target.value),className:"input",placeholder:"123 Main St"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"City *"}),e.jsxs("select",{value:s.city||"",onChange:r=>z(a,"city",r.target.value),className:"input",required:!0,disabled:_,children:[e.jsx("option",{value:"",children:"Select a city"}),Q.map(r=>e.jsxs("option",{value:r.name,children:[r.name,r.state?`, ${r.state}`:""]},r._id||r.name))]}),_&&e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Loading cities..."}),!_&&Q.length===0&&e.jsx("p",{className:"text-xs text-amber-600 mt-1",children:"No cities available. Please add cities first."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"State"}),e.jsx("input",{type:"text",value:s.state||"",onChange:r=>z(a,"state",r.target.value),className:"input",placeholder:"State"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"ZIP Code"}),e.jsx("input",{type:"text",value:s.zipCode||"",onChange:r=>z(a,"zipCode",r.target.value),className:"input",placeholder:"12345"})]})]})},a))})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Ledger Account ",e.jsx("span",{className:"text-gray-400 text-xs",children:"(Auto-linked)"})]}),Y?e.jsx("div",{className:"input bg-gray-50 text-gray-500",children:"Loading ledger account..."}):(()=>{const s=E("ledgerAccount"),a=P.find(m=>(m._id||m.id)===s||(m.accountName||m.name||"").toLowerCase()==="accounts receivable"||m.accountCode==="1130")||P[0],r=a?`${a.accountCode||"1130"} - ${a.accountName||a.name||"Accounts Receivable"}`:"1130 - Accounts Receivable";return e.jsxs(e.Fragment,{children:[e.jsx("input",{type:"text",value:r,className:"input bg-gray-50 text-gray-700 cursor-not-allowed",readOnly:!0,disabled:!0}),e.jsx("input",{type:"hidden",...x("ledgerAccount")}),e.jsxs("p",{className:"text-xs text-blue-600 mt-1",children:[e.jsx("span",{className:"font-medium",children:"ℹ️ Information:"}),' Customers are automatically linked to the "Accounts Receivable" account (1130) for accounting purposes. This cannot be changed.']})]})})()]}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-6 border-t border-gray-200",children:[e.jsx("button",{type:"button",onClick:f,className:"btn btn-secondary",disabled:w,children:"Cancel"}),e.jsx("button",{type:"submit",className:"btn btn-primary",disabled:w,children:w?"Saving...":t?"Update Customer":"Add Customer"})]})]})]})}),S&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-[60]",children:e.jsx("div",{className:"bg-white rounded-lg max-w-md w-full",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Add New City"}),e.jsx("button",{onClick:()=>{g(!1),k({name:"",state:"",country:"US",description:"",isActive:!0})},className:"p-2 text-gray-400 hover:text-gray-600",children:e.jsx(G,{className:"h-5 w-5"})})]}),e.jsxs("form",{onSubmit:Z,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"City Name *"}),e.jsx("input",{type:"text",value:y.name,onChange:s=>k({...y,name:s.target.value}),className:"input",placeholder:"Enter city name",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"State"}),e.jsx("input",{type:"text",value:y.state,onChange:s=>k({...y,state:s.target.value}),className:"input",placeholder:"Enter state"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Country"}),e.jsx("input",{type:"text",value:y.country,onChange:s=>k({...y,country:s.target.value}),className:"input",placeholder:"Enter country"})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",id:"cityIsActive",checked:y.isActive,onChange:s=>k({...y,isActive:s.target.checked}),className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),e.jsx("label",{htmlFor:"cityIsActive",className:"ml-2 block text-sm text-gray-700",children:"Active"})]}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-4 border-t border-gray-200",children:[e.jsx("button",{type:"button",onClick:()=>{g(!1),k({name:"",state:"",country:"US",description:"",isActive:!0})},className:"btn btn-secondary",disabled:q,children:"Cancel"}),e.jsx("button",{type:"submit",className:"btn btn-primary",disabled:q,children:q?"Adding...":"Add City"})]})]})]})})})]})},hs=()=>{var _,Z,P;const[t,L]=u.useState(""),[f,w]=u.useState({}),[x,N]=u.useState(!1),[j,v]=u.useState(null),[A,E]=u.useState(!1),[l,n]=u.useState(null),S={search:t,limit:999999,...f},{data:g,isLoading:y,error:k,refetch:U}=he(S,{refetchOnMountOrArgChange:!0}),[R,{isLoading:I}]=pe(),[d,{isLoading:h}]=ge(),[b,{isLoading:c}]=be(),p=i=>{v(i),N(!0)},{confirmation:F,confirmDelete:W,handleConfirm:X,handleCancel:q}=ke(),V=i=>{const s=i.displayName||i.businessName||i.name||i.email||"Unknown Customer";W(s,"Customer",async()=>{var a;try{await b(i._id).unwrap(),C.success("Customer deleted successfully"),U()}catch(r){C.error(((a=r==null?void 0:r.data)==null?void 0:a.message)||"Failed to delete customer")}})},B=i=>{if(I||h){C.error("Please wait for the current request to complete");return}j?d({id:j._id,...i}).unwrap().then(()=>{C.success("Customer updated successfully"),N(!1),v(null),U()}).catch(s=>{var a;C.error(((a=s==null?void 0:s.data)==null?void 0:a.message)||"Failed to update customer")}):R(i).unwrap().then(()=>{C.success("Customer created successfully"),N(!1),v(null),U()}).catch(s=>{var a,r,m,o,T;if((s==null?void 0:s.status)===409||((a=s==null?void 0:s.data)==null?void 0:a.code)==="DUPLICATE_ENTRY"){const O=((r=s==null?void 0:s.data)==null?void 0:r.message)||((o=(m=s==null?void 0:s.data)==null?void 0:m.error)==null?void 0:o.message)||"Duplicate customer detected";C.error(O)}else C.error(((T=s==null?void 0:s.data)==null?void 0:T.message)||"Failed to create customer")})},M=i=>{w(i)},z=()=>{w({}),L("")},D=()=>{N(!1),v(null)},Y=((_=g==null?void 0:g.data)==null?void 0:_.customers)||(g==null?void 0:g.customers)||[],Q=Ae(Y,t,["name","businessName","email","phone","displayName"],{threshold:.4,minScore:.3,limit:null});return y?e.jsx(je,{message:"Loading customers..."}):k?e.jsx("div",{className:"text-center py-12",children:e.jsx("p",{className:"text-danger-600",children:"Failed to load customers"})}):e.jsxs("div",{className:"space-y-6 w-full ",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Customers"}),e.jsx("p",{className:"text-gray-600",children:"Manage your customer database"})]}),e.jsx("div",{className:"flex-shrink-0",children:e.jsxs("button",{onClick:()=>N(!0),className:"btn btn-primary btn-md w-full sm:w-auto",children:[e.jsx(Me,{className:"h-4 w-4 mr-2"}),"Add Customer"]})})]}),e.jsx("div",{className:"flex items-center space-x-4",children:e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(ae,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search customers...",value:t,onChange:i=>L(i.target.value),className:"input pl-10"})]})}),e.jsx(Oe,{onImportComplete:()=>U(),filters:S}),e.jsx($e,{filters:f,onFiltersChange:M,onClearFilters:z}),Q.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(fe,{className:"mx-auto h-12 w-12 text-gray-400"}),e.jsx("h3",{className:"mt-2 text-sm font-medium text-gray-900",children:"No customers found"}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:t?"Try adjusting your search terms.":"Get started by adding a new customer."})]}):e.jsx("div",{className:"card w-full",children:e.jsxs("div",{className:"card-content p-0 w-full",children:[e.jsx("div",{className:"bg-gray-50 px-8 py-6 border-b border-gray-200",children:e.jsxs("div",{className:"grid grid-cols-12 gap-4 items-center",children:[e.jsx("div",{className:"col-span-1",children:e.jsx("h3",{className:"text-base font-medium text-gray-700",children:"ID"})}),e.jsxs("div",{className:"col-span-3",children:[e.jsx("h3",{className:"text-base font-medium text-gray-700",children:"Business Name"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Contact Person"})]}),e.jsx("div",{className:"col-span-2",children:e.jsx("h3",{className:"text-base font-medium text-gray-700",children:"Email"})}),e.jsx("div",{className:"col-span-1",children:e.jsx("h3",{className:"text-base font-medium text-gray-700",children:"Phone"})}),e.jsx("div",{className:"col-span-1",children:e.jsx("h3",{className:"text-base font-medium text-gray-700",children:"Status"})}),e.jsx("div",{className:"col-span-1",children:e.jsx("h3",{className:"text-base font-medium text-gray-700",children:"Type"})}),e.jsx("div",{className:"col-span-1",children:e.jsx("h3",{className:"text-base font-medium text-gray-700",children:"Tier"})}),e.jsx("div",{className:"col-span-1",children:e.jsx("h3",{className:"text-base font-medium text-gray-700",children:"Credit"})}),e.jsx("div",{className:"col-span-1",children:e.jsx("h3",{className:"text-base font-medium text-gray-700",children:"Actions"})})]})}),e.jsx("div",{className:"divide-y divide-gray-200",children:Q.map(i=>e.jsx("div",{className:"px-8 py-6 hover:bg-gray-50",children:e.jsxs("div",{className:"grid grid-cols-12 gap-4 items-center",children:[e.jsx("div",{className:"col-span-1",children:e.jsx("p",{className:"text-xs text-gray-500 font-mono cursor-help",title:i._id,children:i._id.slice(-6)})}),e.jsx("div",{className:"col-span-3",children:e.jsxs("div",{className:"flex items-center space-x-4",children:[i.businessType==="individual"?e.jsx(le,{className:"h-6 w-6 text-gray-400"}):e.jsx(ne,{className:"h-6 w-6 text-gray-400"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-base font-medium text-gray-900",children:i.businessName||i.displayName}),e.jsx("p",{className:"text-sm text-gray-500",children:i.name})]})]})}),e.jsx("div",{className:"col-span-2",children:e.jsx("p",{className:"text-sm text-gray-600",children:i.email})}),e.jsx("div",{className:"col-span-1",children:e.jsx("p",{className:"text-sm text-gray-600",children:i.phone||"-"})}),e.jsx("div",{className:"col-span-1",children:e.jsx("span",{className:`badge ${i.status==="active"?"badge-success":"badge-gray"}`,children:i.status})}),e.jsx("div",{className:"col-span-1",children:e.jsx("span",{className:`badge ${i.businessType==="wholesale"?"badge-info":"badge-gray"}`,children:i.businessType})}),e.jsx("div",{className:"col-span-1",children:e.jsx("span",{className:`badge ${i.customerTier==="gold"?"badge-warning":i.customerTier==="platinum"?"badge-info":"badge-gray"}`,children:i.customerTier})}),e.jsx("div",{className:"col-span-1",children:e.jsx("p",{className:"text-sm text-gray-600",children:Math.round(i.creditLimit)})}),e.jsx("div",{className:"col-span-1",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("button",{onClick:()=>{n({type:"Customer",id:i._id,name:i.businessName||i.name}),E(!0)},className:"text-green-600 hover:text-green-800",title:"Notes",children:e.jsx(ze,{className:"h-5 w-5"})}),e.jsx("button",{onClick:()=>p(i),className:"text-primary-600 hover:text-primary-800",children:e.jsx(Re,{className:"h-5 w-5"})}),e.jsx("button",{onClick:()=>V(i),className:"text-danger-600 hover:text-danger-800",children:e.jsx(_e,{className:"h-5 w-5"})})]})})]})},i._id))})]})}),x&&e.jsx(qe,{customer:j,onSave:B,onCancel:D,isSubmitting:I||h}),e.jsx(Ee,{isOpen:F.isOpen,onClose:q,onConfirm:X,itemName:((P=(Z=F.message)==null?void 0:Z.match(/"([^"]*)"/))==null?void 0:P[1])||"",itemType:"Customer",isLoading:c}),A&&l&&e.jsx(De,{entityType:l.type,entityId:l.id,entityName:l.name,onClose:()=>{E(!1),n(null)}})]})};export{hs as Customers};
