import{D as U,G as Y,r as h,R as Z,y as E,p as e,O as $,x as ee,a2 as L,S as te,ak as q,T as se,aO as ae,aH as re,Q as S}from"./index-Cw3xRKpc.js";import{F as ne}from"./filter-bwJnrGXq.js";import{D as ce}from"./download-B8XL5QGf.js";import{P as le}from"./printer-Bdyt47kH.js";/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ie=U("Book",[["path",{d:"M4 19.5v-15A2.5 2.5 0 0 1 6.5 2H20v20H6.5a2.5 2.5 0 0 1 0-5H20",key:"t4utmx"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const y=U("FileDown",[["path",{d:"M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z",key:"1nnpy2"}],["polyline",{points:"14 2 14 8 20 8",key:"1ew0cm"}],["path",{d:"M12 18v-6",key:"17g6i2"}],["path",{d:"m9 15 3 3 3-3",key:"1npd3o"}]]),de=Y.injectEndpoints({endpoints:o=>({getLedgerEntries:o.query({query:c=>({url:"account-ledger",method:"get",params:c}),providesTags:[{type:"Accounting",id:"LEDGER_ENTRIES"}]}),getAccountsList:o.query({query:()=>({url:"account-ledger/accounts",method:"get"}),providesTags:[{type:"Accounting",id:"ACCOUNTS_LIST"}]}),getAllEntries:o.query({query:c=>({url:"account-ledger/all-entries",method:"get",params:c}),providesTags:[{type:"Accounting",id:"ALL_ENTRIES"}]}),exportLedger:o.mutation({query:c=>({url:"account-ledger/all-entries",method:"get",params:c,responseType:"blob"})})}),overrideExisting:!1}),{useGetAccountsListQuery:oe,useGetAllEntriesQuery:xe,useExportLedgerMutation:me}=de,he=({type:o})=>{const c={asset:{bg:"bg-green-100",text:"text-green-800",label:"Asset"},liability:{bg:"bg-red-100",text:"text-red-800",label:"Liability"},equity:{bg:"bg-blue-100",text:"text-blue-800",label:"Equity"},revenue:{bg:"bg-purple-100",text:"text-purple-800",label:"Revenue"},expense:{bg:"bg-orange-100",text:"text-orange-800",label:"Expense"}},s=c[o]||c.asset;return e.jsx("span",{className:`inline-flex items-center px-2 py-0.5 rounded text-xs font-medium ${s.bg} ${s.text}`,children:s.label})},Ne=()=>{var F,R,M;const c=(()=>{const t=new Date,n=new Date;return n.setMonth(t.getMonth()-1),{startDate:n.toISOString().split("T")[0],endDate:t.toISOString().split("T")[0]}})(),[s,k]=h.useState(null),[a,f]=h.useState({startDate:c.startDate,endDate:c.endDate,accountCode:"",accountName:"",customerName:"",supplierName:""}),[b,I]=h.useState(!0),[m,_]=h.useState(""),[j,v]=h.useState(!1),[A,B]=h.useState(!1),[H]=me();Z.useEffect(()=>{const t=n=>{j&&!n.target.closest(".relative")&&v(!1)};return document.addEventListener("mousedown",t),()=>document.removeEventListener("mousedown",t)},[j]);const{data:w,isLoading:P}=oe(void 0,{onError:t=>E(t,"Error fetching accounts")}),{data:i,isLoading:z,refetch:G}=xe(a,{skip:!(a.accountCode||a.startDate||a.endDate||a.accountName),onError:t=>E(t,"Error fetching ledger entries")}),Q=t=>{k(t),f({...a,accountCode:t.accountCode})},C=(t,n)=>{f({...a,[t]:n})},V=()=>{f({startDate:c.startDate,endDate:c.endDate,accountCode:"",accountName:""}),k(null)},l=t=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(t||0),D=t=>new Date(t).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}),N=async(t="csv")=>{var n,u;if(!((u=(n=i==null?void 0:i.data)==null?void 0:n.entries)!=null&&u.length)){S.error("No data to export");return}try{B(!0),v(!1);const r={export:t};a.startDate&&(r.startDate=a.startDate),a.endDate&&(r.endDate=a.endDate),a.accountCode&&(r.accountCode=a.accountCode),a.accountName&&(r.accountName=a.accountName);const x=await H(r).unwrap(),K=t==="excel"?"xlsx":t;let W=`account-ledger-${(s==null?void 0:s.accountCode)||"all"}-${new Date().toISOString().split("T")[0]}.${K}`;const X=x instanceof Blob?x:new Blob([x]),O=window.URL.createObjectURL(X),g=document.createElement("a");g.href=O,g.download=W,document.body.appendChild(g),g.click(),document.body.removeChild(g),window.URL.revokeObjectURL(O),S.success(`Ledger exported as ${t.toUpperCase()} successfully`)}catch(r){E(r,"Export ledger"),S.error("Failed to export ledger")}finally{B(!1)}},J=()=>{window.print()};if(P)return e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx($,{})});const T=((F=w==null?void 0:w.data)==null?void 0:F.groupedAccounts)||{},p=((R=i==null?void 0:i.data)==null?void 0:R.entries)||[],d=((M=i==null?void 0:i.data)==null?void 0:M.summary)||{};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold text-gray-900 flex items-center",children:[e.jsx(ie,{className:"h-8 w-8 mr-2 text-primary-600"}),"Account Ledger"]}),e.jsx("p",{className:"mt-1 text-sm text-gray-600",children:"View detailed transaction history for all accounts"})]}),e.jsxs("div",{className:"flex space-x-2 no-print",children:[e.jsxs("button",{onClick:()=>I(!b),className:"btn btn-secondary flex items-center",children:[e.jsx(ne,{className:"h-4 w-4 mr-2"}),b?"Hide Filters":"Show Filters"]}),p.length>0&&e.jsxs("div",{className:"relative",children:[e.jsxs("button",{onClick:()=>v(!j),disabled:A,className:"btn btn-secondary flex items-center",children:[e.jsx(ce,{className:"h-4 w-4 mr-2"}),A?"Exporting...":"Export"]}),j&&e.jsx("div",{className:"absolute right-0 mt-2 w-48 bg-white rounded-md shadow-lg z-50 border border-gray-200",children:e.jsxs("div",{className:"py-1",children:[e.jsxs("button",{onClick:()=>N("csv"),className:"w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 flex items-center",children:[e.jsx(y,{className:"h-4 w-4 mr-2"}),"Export as CSV"]}),e.jsxs("button",{onClick:()=>N("excel"),className:"w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 flex items-center",children:[e.jsx(y,{className:"h-4 w-4 mr-2"}),"Export as Excel"]}),e.jsxs("button",{onClick:()=>N("pdf"),className:"w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 flex items-center",children:[e.jsx(y,{className:"h-4 w-4 mr-2"}),"Export as PDF"]}),e.jsxs("button",{onClick:()=>N("json"),className:"w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 flex items-center",children:[e.jsx(y,{className:"h-4 w-4 mr-2"}),"Export as JSON"]}),e.jsx("div",{className:"border-t border-gray-200 my-1"}),e.jsxs("button",{onClick:J,className:"w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 flex items-center",children:[e.jsx(le,{className:"h-4 w-4 mr-2"}),"Print View"]})]})})]}),e.jsxs("button",{onClick:()=>G(),className:"btn btn-primary flex items-center",children:[e.jsx(ee,{className:"h-4 w-4 mr-2"}),"Refresh"]})]})]}),e.jsxs("div",{className:"grid grid-cols-12 gap-6",children:[e.jsx("div",{className:"col-span-12 lg:col-span-3 no-print",children:e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsxs("h2",{className:"text-lg font-semibold flex items-center",children:[e.jsx(L,{className:"h-5 w-5 mr-2"}),"Accounts"]})}),e.jsxs("div",{className:"card-content p-0",children:[e.jsx("div",{className:"p-4 border-b",children:e.jsxs("div",{className:"relative",children:[e.jsx(te,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search accounts...",className:"input pl-10",value:m,onChange:t=>_(t.target.value)})]})}),e.jsxs("div",{className:"max-h-[calc(100vh-300px)] overflow-y-auto",children:[Object.entries(T).map(([t,n])=>{const u=n.filter(r=>{if(!m.trim())return!0;const x=m.toLowerCase();return r.accountCode.toLowerCase().includes(x)||r.accountName.toLowerCase().includes(x)||r.description&&r.description.toLowerCase().includes(x)});return u.length===0?null:e.jsxs("div",{className:"border-b last:border-b-0",children:[e.jsx("div",{className:"px-4 py-2 bg-gray-50 border-b",children:e.jsx("h3",{className:"font-medium text-sm text-gray-700 uppercase",children:t})}),e.jsx("div",{children:u.map(r=>e.jsx("button",{onClick:()=>Q(r),className:`w-full text-left px-4 py-3 hover:bg-gray-50 transition-colors border-b last:border-b-0 ${(s==null?void 0:s._id)===r._id?"bg-primary-50 border-l-4 border-l-primary-500":""}`,children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900 truncate",children:r.accountCode}),e.jsx("div",{className:"text-xs text-gray-600 truncate",children:r.accountName}),r.transactionCount>0&&e.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:[r.transactionCount," transactions"]})]}),e.jsx("div",{className:"text-right ml-2",children:e.jsx("div",{className:`text-sm font-semibold ${r.currentBalance>=0?"text-green-600":"text-red-600"}`,children:l(Math.abs(r.currentBalance))})})]})},r._id))})]},t)}),m.trim()&&Object.values(T).flat().filter(t=>{const n=m.toLowerCase();return t.accountCode.toLowerCase().includes(n)||t.accountName.toLowerCase().includes(n)||t.description&&t.description.toLowerCase().includes(n)}).length===0&&e.jsxs("div",{className:"p-4 text-center text-sm text-gray-500",children:['No accounts found matching "',m,'"']})]})]})]})}),e.jsxs("div",{className:"col-span-12 lg:col-span-9",children:[b&&e.jsxs("div",{className:"card mb-6 no-print",children:[e.jsx("div",{className:"card-header",children:e.jsx("h3",{className:"text-lg font-semibold",children:"Filters"})}),e.jsx("div",{className:"card-content",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Start Date"}),e.jsx("input",{type:"date",value:a.startDate,onChange:t=>C("startDate",t.target.value),className:"input"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"End Date"}),e.jsx("input",{type:"date",value:a.endDate,onChange:t=>C("endDate",t.target.value),className:"input"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Account Name"}),e.jsx("input",{type:"text",placeholder:"Search by account, customer, or supplier name...",value:a.accountName,onChange:t=>C("accountName",t.target.value),className:"input"})]}),e.jsx("div",{className:"flex items-end",children:e.jsx("button",{onClick:V,className:"btn btn-secondary w-full",children:"Clear Filters"})})]})})]}),s&&e.jsxs("div",{className:"card mb-6 print-only",children:[e.jsxs("div",{className:"print-header hidden print:block mb-4",children:[e.jsx("h2",{className:"text-2xl font-bold text-center",children:"Account Ledger"}),e.jsxs("div",{className:"text-center mt-2",children:[e.jsxs("p",{className:"font-semibold",children:[s.accountCode," - ",s.accountName]}),a.startDate&&a.endDate&&e.jsxs("p",{className:"text-sm text-gray-600",children:["Period: ",D(a.startDate)," to ",D(a.endDate)]}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Generated: ",new Date().toLocaleString()]})]})]}),e.jsx("div",{className:"no-print",children:e.jsx("div",{className:"card-content",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs("h2",{className:"text-xl font-bold text-gray-900",children:[s.accountCode," - ",s.accountName]}),e.jsx(he,{type:s.accountType})]}),s.description&&e.jsx("p",{className:"text-sm text-gray-600 mt-2",children:s.description}),e.jsxs("div",{className:"mt-3 flex items-center space-x-4 text-sm",children:[e.jsxs("span",{className:"text-gray-600",children:["Normal Balance: ",e.jsx("span",{className:"font-medium capitalize",children:s.normalBalance})]}),e.jsx("span",{className:"text-gray-400",children:"|"}),e.jsxs("span",{className:"text-gray-600",children:["Category: ",e.jsx("span",{className:"font-medium capitalize",children:s.accountCategory.replace("_"," ")})]}),s.openingBalance!==void 0&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-gray-400",children:"|"}),e.jsxs("span",{className:"text-gray-600",children:["Opening Balance: ",e.jsx("span",{className:`font-medium ${(s.openingBalance||0)>=0?"text-green-600":"text-red-600"}`,children:l(Math.abs(s.openingBalance||0))})]})]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-sm text-gray-600",children:"Current Balance"}),e.jsx("div",{className:`text-2xl font-bold ${s.currentBalance>=0?"text-green-600":"text-red-600"}`,children:l(Math.abs(s.currentBalance))})]})]})})})]}),d.totalEntries>0&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-4 mb-6",children:[e.jsx("div",{className:"card",children:e.jsx("div",{className:"card-content",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Opening Balance"}),e.jsx("p",{className:`text-xl font-bold ${(d.openingBalance||0)>=0?"text-green-600":"text-red-600"}`,children:l(Math.abs(d.openingBalance||0))})]}),e.jsx(q,{className:"h-8 w-8 text-gray-500"})]})})}),e.jsx("div",{className:"card",children:e.jsx("div",{className:"card-content",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Total Debits"}),e.jsx("p",{className:"text-xl font-bold text-green-600",children:l(d.totalDebits)})]}),e.jsx(se,{className:"h-8 w-8 text-green-500"})]})})}),e.jsx("div",{className:"card",children:e.jsx("div",{className:"card-content",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Total Credits"}),e.jsx("p",{className:"text-xl font-bold text-red-600",children:l(d.totalCredits)})]}),e.jsx(ae,{className:"h-8 w-8 text-red-500"})]})})}),e.jsx("div",{className:"card",children:e.jsx("div",{className:"card-content",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Closing Balance"}),e.jsx("p",{className:`text-xl font-bold ${d.closingBalance>=0?"text-green-600":"text-red-600"}`,children:l(Math.abs(d.closingBalance))})]}),e.jsx(q,{className:"h-8 w-8 text-blue-500"})]})})}),e.jsx("div",{className:"card",children:e.jsx("div",{className:"card-content",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Total Entries"}),e.jsx("p",{className:"text-xl font-bold text-gray-900",children:d.totalEntries})]}),e.jsx(L,{className:"h-8 w-8 text-purple-500"})]})})})]}),e.jsxs("div",{className:"card account-ledger-print",children:[e.jsx("div",{className:"card-header",children:e.jsxs("h3",{className:"text-lg font-semibold flex items-center",children:[e.jsx(re,{className:"h-5 w-5 mr-2"}),"Ledger Entries",p.length>0&&e.jsxs("span",{className:"ml-2 text-sm font-normal text-gray-500",children:["(",p.length," entries)"]})]})}),e.jsx("div",{className:"card-content p-0",children:z?e.jsx("div",{className:"flex justify-center items-center py-12",children:e.jsx($,{})}):p.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(L,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500",children:s?"No transactions found for this account":"Select an account to view ledger entries"})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200 account-ledger-table",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Date"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Description"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Reference"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Debit"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Credit"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Balance"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Source"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:p.map((t,n)=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:D(t.date)}),e.jsxs("td",{className:"px-6 py-4 text-sm text-gray-900",children:[e.jsx("div",{children:t.description}),t.customer&&e.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:["Customer: ",t.customer]}),t.supplier&&e.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:["Supplier: ",t.supplier]})]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-600",children:t.reference||"-"}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-right font-medium text-green-600",children:t.debitAmount>0?l(t.debitAmount):"-"}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-right font-medium text-red-600",children:t.creditAmount>0?l(t.creditAmount):"-"}),e.jsx("td",{className:`px-6 py-4 whitespace-nowrap text-sm text-right font-semibold ${t.balance>=0?"text-gray-900":"text-red-600"}`,children:l(Math.abs(t.balance))}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:"inline-flex px-2 py-1 text-xs font-medium rounded-full bg-blue-100 text-blue-800",children:t.source})})]},n))})]})})})]})]})]})]})};export{Ne as default};
