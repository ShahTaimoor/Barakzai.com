import{r as h,p as e,L as le,X as J,B as V,y as G,z as ne,Q as C,ai as ce,S as re,a1 as D,ad as oe,aD as de,aC as W}from"./index-WAoT78o_.js";import{u as me}from"./useFuzzySearch-3T44_vhU.js";import{c as xe,d as ue,e as he,f as pe,u as ge,g as je,h as ye,i as be,j as ve,k as Ne,l as fe}from"./suppliersApi-CVrNDSoD.js";import{D as ie}from"./download-CqTUNGzV.js";import{U as we}from"./upload-WwXfDfAY.js";import{F as Ce}from"./file-spreadsheet-yD2pgwZk.js";import{C as Se}from"./check-circle-Bs4hD_Mn.js";import{A as ke}from"./alert-circle-ipmQBT-s.js";import{F as Ae}from"./filter-BTES_dtq.js";import{C as Ee}from"./chevron-up-DF4Mn3Zl.js";import{C as Pe}from"./chevron-down-BWZz_AVk.js";import{P as Le}from"./phone-ehtvFRIM.js";import{N as Te}from"./NotesPanel-BRdWidwV.js";import{u as Fe}from"./chartOfAccountsApi-DIllcJS5.js";import{a as Ie}from"./citiesApi-C9Mck8vf.js";import{P as Be}from"./plus-CNtrfzq0.js";import{S as Oe}from"./star-DBjITf5d.js";import{M as ze}from"./message-square-B3B6AV4c.js";import{P as Ue}from"./pen-square-BWW9zxzE.js";import{T as Me}from"./trash-2-DLkCb2w3.js";import"./history-DkQEo-UP.js";import"./lock-v7yhMTQC.js";const $e=({onImportComplete:a,filters:A={}})=>{const[b,S]=h.useState(null),[s,r]=h.useState(null),[B,f]=h.useState(!1),[k,{isLoading:w}]=xe(),[i,{isLoading:x}]=ue(),{refetch:v}=he(void 0,{skip:!0}),[g]=pe(),$=async()=>{try{const u=await k(A).unwrap();if(u.downloadUrl){const j=u.filename||"suppliers.xlsx",p=await g(j).unwrap(),c=p instanceof Blob?p:new Blob([p]),N=document.createElement("a"),E=URL.createObjectURL(c);N.setAttribute("href",E),N.setAttribute("download",j),N.style.visibility="hidden",document.body.appendChild(N),N.click(),document.body.removeChild(N),URL.revokeObjectURL(E)}V(`Exported ${u.recordCount||0} suppliers to Excel`)}catch(u){G(u,"Excel Export")}},O=u=>{const j=u.target.files[0];if(j){if(!["application/vnd.ms-excel","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"].includes(j.mimetype)&&!j.name.match(/\.(xlsx|xls)$/)){ne("Invalid file type. Only Excel files are allowed."),u.target.value="";return}if(j.size>10*1024*1024){ne("File size exceeds 10MB limit"),u.target.value="";return}S(j)}},P=async()=>{var u,j,p;if(!b){C.error("Please select a file to import");return}try{const c=await i(b).unwrap();if(r((c==null?void 0:c.results)||c),((u=c==null?void 0:c.results)==null?void 0:u.success)>0||(c==null?void 0:c.success)>0){const E=((j=c==null?void 0:c.results)==null?void 0:j.success)||(c==null?void 0:c.success);V(`Successfully imported ${E} suppliers`),a&&a()}const N=((p=c==null?void 0:c.results)==null?void 0:p.errors)||(c==null?void 0:c.errors)||[];N.length>0&&ce(`${N.length} suppliers failed to import`)}catch(c){G(c,"Supplier Import")}},L=async()=>{try{const u=await v(),j=u.data instanceof Blob?u.data:new Blob([u.data],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),p=document.createElement("a"),c=URL.createObjectURL(j);p.setAttribute("href",c),p.setAttribute("download","supplier_template.xlsx"),p.style.visibility="hidden",document.body.appendChild(p),p.click(),document.body.removeChild(p),URL.revokeObjectURL(c),V("Template downloaded successfully")}catch(u){G(u,"Template Download")}},z=()=>{S(null),r(null),f(!1)};return e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Import / Export Suppliers"}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs("div",{className:"relative group",children:[e.jsxs("button",{onClick:L,className:"btn btn-outline btn-sm",children:[e.jsx(ie,{className:"h-4 w-4 mr-2"}),"Template"]}),e.jsxs("div",{className:"absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 px-3 py-2 bg-gray-900 text-white text-sm rounded-lg opacity-0 group-hover:opacity-100 transition-opacity duration-200 pointer-events-none whitespace-nowrap z-10",children:[e.jsxs("div",{className:"text-xs space-y-1",children:[e.jsx("div",{children:"• Download Excel template file"}),e.jsx("div",{children:"• Pre-formatted with correct columns"}),e.jsx("div",{children:"• Shows required and optional fields"}),e.jsx("div",{children:"• Use this to prepare import data"})]}),e.jsx("div",{className:"absolute top-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-l-4 border-r-4 border-t-4 border-transparent border-t-gray-900"})]})]}),e.jsxs("div",{className:"relative group",children:[e.jsxs(le,{onClick:$,isLoading:w,className:"btn btn-secondary btn-sm",children:[e.jsx(ie,{className:"h-4 w-4 mr-2"}),"Export Excel"]}),e.jsxs("div",{className:"absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 px-3 py-2 bg-gray-900 text-white text-sm rounded-lg opacity-0 group-hover:opacity-100 transition-opacity duration-200 pointer-events-none whitespace-nowrap z-10",children:[e.jsxs("div",{className:"text-xs space-y-1",children:[e.jsx("div",{children:"• Exports all suppliers to Excel file"}),e.jsx("div",{children:"• Includes all supplier data and fields"}),e.jsx("div",{children:"• File format: Excel (.xlsx)"}),e.jsx("div",{children:"• Filtered results based on current search"})]}),e.jsx("div",{className:"absolute top-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-l-4 border-r-4 border-t-4 border-transparent border-t-gray-900"})]})]}),e.jsxs("div",{className:"relative group",children:[e.jsxs("button",{onClick:()=>f(!0),className:"btn btn-primary btn-sm",children:[e.jsx(we,{className:"h-4 w-4 mr-2"}),"Import Suppliers"]}),e.jsxs("div",{className:"absolute bottom-full right-0 mb-2 px-3 py-2 bg-gray-900 text-white text-sm rounded-lg opacity-0 group-hover:opacity-100 transition-opacity duration-200 pointer-events-none whitespace-nowrap z-10",children:[e.jsxs("div",{className:"text-xs space-y-1",children:[e.jsx("div",{children:"• Download template for required format"}),e.jsx("div",{children:"• Required: Company Name, Contact Person"}),e.jsx("div",{children:"• Supported: Excel (.xlsx), Max 10MB"}),e.jsx("div",{children:"• Duplicates will be skipped"})]}),e.jsx("div",{className:"absolute top-full right-4 w-0 h-0 border-l-4 border-r-4 border-t-4 border-transparent border-t-gray-900"})]})]})]})]}),B&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-md w-full mx-4",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Import Suppliers"}),e.jsx("button",{onClick:z,className:"text-gray-400 hover:text-gray-600",children:e.jsx(J,{className:"h-5 w-5"})})]}),e.jsx("div",{className:"p-6",children:s?e.jsxs("div",{children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-3",children:"Import Results"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{className:"text-center p-3 bg-green-50 rounded-lg",children:[e.jsx(Se,{className:"h-6 w-6 text-green-600 mx-auto mb-1"}),e.jsx("div",{className:"text-lg font-semibold text-green-600",children:s.success}),e.jsx("div",{className:"text-sm text-green-700",children:"Success"})]}),e.jsxs("div",{className:"text-center p-3 bg-red-50 rounded-lg",children:[e.jsx(ke,{className:"h-6 w-6 text-red-600 mx-auto mb-1"}),e.jsx("div",{className:"text-lg font-semibold text-red-600",children:s.errors.length}),e.jsx("div",{className:"text-sm text-red-700",children:"Errors"})]})]}),s.errors.length>0&&e.jsxs("div",{className:"max-h-40 overflow-y-auto",children:[e.jsx("h5",{className:"font-medium text-gray-900 mb-2",children:"Errors:"}),e.jsxs("div",{className:"space-y-2",children:[s.errors.slice(0,10).map((u,j)=>e.jsxs("div",{className:"text-sm text-red-600 bg-red-50 p-2 rounded",children:["Row ",u.row,": ",u.error]},j)),s.errors.length>10&&e.jsxs("div",{className:"text-sm text-gray-500",children:["... and ",s.errors.length-10," more errors"]})]})]})]}),e.jsx("div",{className:"flex justify-end",children:e.jsx("button",{onClick:z,className:"btn btn-primary btn-sm",children:"Close"})})]}):e.jsxs("div",{children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Select Excel File"}),e.jsx("input",{type:"file",accept:".xlsx,.xls",onChange:O,className:"input w-full"})]}),b&&e.jsx("div",{className:"mb-4 p-3 bg-gray-50 rounded-lg",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(Ce,{className:"h-4 w-4 text-gray-600 mr-2"}),e.jsx("span",{className:"text-sm text-gray-700",children:b.name}),e.jsxs("span",{className:"text-xs text-gray-500 ml-auto",children:[(b.size/1024/1024).toFixed(2)," MB"]})]})}),e.jsxs("div",{className:"flex justify-end space-x-3",children:[e.jsx("button",{onClick:z,className:"btn btn-secondary btn-sm",children:"Cancel"}),e.jsx(le,{onClick:P,isLoading:x,disabled:!b,className:"btn btn-primary btn-sm",children:"Import Suppliers"})]})]})})]})})]})},Re=({filters:a,onFiltersChange:A,onClearFilters:b})=>{const[S,s]=h.useState(!1),r=(i,x)=>{A({...a,[i]:x})},B=i=>{const x={...a};delete x[i],A(x)},f=()=>{A({}),b&&b()},k=Object.keys(a).some(i=>a[i]!==""&&a[i]!==null&&a[i]!==void 0),w=()=>Object.keys(a).filter(i=>a[i]!==""&&a[i]!==null&&a[i]!==void 0).length;return e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 cursor-pointer hover:bg-gray-50",onClick:()=>s(!S),children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(Ae,{className:"h-5 w-5 text-gray-600"}),e.jsx("span",{className:"font-medium text-gray-900",children:"Filters"}),k&&e.jsxs("span",{className:"bg-blue-100 text-blue-800 text-xs font-medium px-2 py-1 rounded-full",children:[w()," active"]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[k&&e.jsx("button",{onClick:i=>{i.stopPropagation(),f()},className:"text-sm text-red-600 hover:text-red-800 font-medium",children:"Clear All"}),S?e.jsx(Ee,{className:"h-4 w-4 text-gray-400"}):e.jsx(Pe,{className:"h-4 w-4 text-gray-400"})]})]}),S&&e.jsxs("div",{className:"border-t border-gray-200 p-4 space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx(re,{className:"h-4 w-4 inline mr-1"}),"Search Suppliers"]}),e.jsx("input",{type:"text",placeholder:"Company name, contact...",value:a.search||"",onChange:i=>r("search",i.target.value),className:"input text-sm"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx(D,{className:"h-4 w-4 inline mr-1"}),"Status"]}),e.jsxs("select",{value:a.status||"",onChange:i=>r("status",i.target.value),className:"input text-sm",children:[e.jsx("option",{value:"",children:"All Statuses"}),e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"inactive",children:"Inactive"})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx(oe,{className:"h-4 w-4 inline mr-1"}),"Email Status"]}),e.jsxs("select",{value:a.emailStatus||"",onChange:i=>r("emailStatus",i.target.value),className:"input text-sm",children:[e.jsx("option",{value:"",children:"All Email Statuses"}),e.jsx("option",{value:"verified",children:"Verified"}),e.jsx("option",{value:"unverified",children:"Unverified"}),e.jsx("option",{value:"no-email",children:"No Email"})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx(Le,{className:"h-4 w-4 inline mr-1"}),"Phone Status"]}),e.jsxs("select",{value:a.phoneStatus||"",onChange:i=>r("phoneStatus",i.target.value),className:"input text-sm",children:[e.jsx("option",{value:"",children:"All Phone Statuses"}),e.jsx("option",{value:"verified",children:"Verified"}),e.jsx("option",{value:"unverified",children:"Unverified"}),e.jsx("option",{value:"no-phone",children:"No Phone"})]})]})]}),k&&e.jsxs("div",{className:"border-t border-gray-200 pt-4",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-700 mb-3",children:"Active Filters:"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:Object.entries(a).map(([i,x])=>{if(!x||x==="")return null;let v,g;switch(i){case"search":v="Search",g=`"${x}"`;break;case"status":v="Status",g=x.charAt(0).toUpperCase()+x.slice(1);break;case"emailStatus":v="Email",g=x==="verified"?"Verified":x==="unverified"?"Unverified":x==="no-email"?"No Email":x;break;case"phoneStatus":v="Phone",g=x==="verified"?"Verified":x==="unverified"?"Unverified":x==="no-phone"?"No Phone":x;break;default:v=i.charAt(0).toUpperCase()+i.slice(1),g=x}return e.jsxs("span",{className:"inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-800",children:[v,": ",g,e.jsx("button",{onClick:()=>B(i),className:"ml-1 inline-flex items-center justify-center w-4 h-4 rounded-full hover:bg-blue-200",children:e.jsx(J,{className:"h-3 w-3"})})]},i)})})]})]})]})},Z={companyName:"",contactPerson:{name:"",title:""},email:"",phone:"",website:"",businessType:"wholesaler",paymentTerms:"net30",creditLimit:0,openingBalance:0,rating:3,reliability:"average",minOrderAmount:0,minOrderQuantity:1,leadTime:7,status:"active",notes:"",ledgerAccount:"",addresses:[{type:"both",street:"",city:"",state:"",zipCode:"",country:"US",isDefault:!0}]},_e=({supplier:a,onSave:A,onCancel:b,isOpen:S})=>{var q;const[s,r]=h.useState(()=>({...Z})),[B,f]=h.useState(!1),[k,w]=h.useState(!1),[i,x]=h.useState(!1),[v,g]=h.useState(!1),[$,O]=h.useState(!1),[P,L]=h.useState(!1),[z]=ve(),[u]=Ne(),[j]=fe(),{data:p=[],isLoading:c}=Fe({accountType:"liability",accountCategory:"current_liabilities",includePartyAccounts:"true",isActive:"true"}),{data:N=[],isLoading:E}=Ie(),F=h.useMemo(()=>{if(!Array.isArray(p))return[];const l=p.filter(t=>{const m=(t.accountName||t.name||"").toLowerCase(),d=Array.isArray(t.tags)?t.tags:[];return m.includes("payable")||d.includes("supplier")||d.includes("accounts_payable")||t.accountCode&&t.accountCode.startsWith("21")}),o=p.filter(t=>t.allowDirectPosting!==!1);return[...l.length>0?l:o.length>0?o:p].sort((t,m)=>{const d=(t.accountCode||"").toString(),T=(m.accountCode||"").toString();return d.localeCompare(T,void 0,{numeric:!0})})},[p]);h.useEffect(()=>{var l,o,n,t;if(F.length>0){const m=F.find(d=>(d.accountName||d.name||"").toLowerCase()==="accounts payable"||d.accountCode==="2110")||F[0];if(a){const d=typeof a.openingBalance=="number"?a.openingBalance:a.pendingBalance&&a.pendingBalance>0?a.pendingBalance:a.advanceBalance?-a.advanceBalance:0;r({...Z,...a,contactPerson:{name:((l=a.contactPerson)==null?void 0:l.name)||"",title:((o=a.contactPerson)==null?void 0:o.title)||""},addresses:(n=a.addresses)!=null&&n.length?a.addresses:Z.addresses,openingBalance:d,ledgerAccount:((t=a.ledgerAccount)==null?void 0:t._id)||a.ledgerAccount||m._id||m.id||""})}else{const d=m._id||m.id;d&&r(T=>({...T,ledgerAccount:d}))}}},[a,F]),h.useEffect(()=>{if(!s.email||s.email.trim()===""){w(!1);return}if(!/^[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,}$/i.test(s.email)){w(!1);return}if(a&&a.email&&a.email.toLowerCase()===s.email.toLowerCase()){w(!1);return}const o=setTimeout(async()=>{var n;try{f(!0);const t=(a==null?void 0:a._id)||null,m=await z({email:s.email,excludeId:t}).unwrap(),d=((n=m==null?void 0:m.data)==null?void 0:n.exists)??(m==null?void 0:m.exists);w(!!d)}catch{w(!1)}finally{f(!1)}},500);return()=>clearTimeout(o)},[s.email,a]),h.useEffect(()=>{if(!s.companyName||s.companyName.trim()===""){g(!1);return}if(a&&a.companyName&&a.companyName.trim().toLowerCase()===s.companyName.trim().toLowerCase()){g(!1);return}const l=setTimeout(async()=>{var o;try{x(!0);const n=(a==null?void 0:a._id)||null,t=await u({companyName:s.companyName,excludeId:n}).unwrap(),m=((o=t==null?void 0:t.data)==null?void 0:o.exists)??(t==null?void 0:t.exists);g(!!m)}catch{g(!1)}finally{x(!1)}},500);return()=>clearTimeout(l)},[s.companyName,a]),h.useEffect(()=>{var o,n;if(!((o=s.contactPerson)!=null&&o.name)||s.contactPerson.name.trim()===""){L(!1);return}if(a&&((n=a.contactPerson)!=null&&n.name)&&a.contactPerson.name.trim().toLowerCase()===s.contactPerson.name.trim().toLowerCase()){L(!1);return}const l=setTimeout(async()=>{var t;try{O(!0);const m=(a==null?void 0:a._id)||null,d=await j({contactName:s.contactPerson.name,excludeId:m}).unwrap(),T=((t=d==null?void 0:d.data)==null?void 0:t.exists)??(d==null?void 0:d.exists);L(!!T)}catch{L(!1)}finally{O(!1)}},500);return()=>clearTimeout(l)},[(q=s.contactPerson)==null?void 0:q.name,a]),h.useEffect(()=>{w(!1),g(!1),L(!1)},[a]);const Q=l=>{var o,n,t;if(l.preventDefault(),!((o=s.companyName)!=null&&o.trim())){C.error("Company name is required");return}if(!((t=(n=s.contactPerson)==null?void 0:n.name)!=null&&t.trim())){C.error("Contact name is required");return}if(k){C.error("Please use a different email address");return}if(v){C.error("Please use a different company name");return}if(P){C.error("Please use a different contact name");return}A({...s,creditLimit:parseFloat(s.creditLimit)||0,openingBalance:parseFloat(s.openingBalance)||0})},U=(l,o,n)=>{const t=[...s.addresses];t[l]={...t[l],[o]:n},r({...s,addresses:t})};return S?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:e.jsx("div",{className:"bg-white rounded-lg max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:a?"Edit Supplier":"Add New Supplier"}),e.jsx("button",{onClick:b,className:"p-2 text-gray-400 hover:text-gray-600",children:e.jsx(J,{className:"h-5 w-5"})})]}),e.jsxs("form",{onSubmit:Q,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Company Information"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Company Name *"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",required:!0,value:s.companyName,onChange:l=>r({...s,companyName:l.target.value}),className:`input ${v?"border-red-500":""}`,placeholder:"Enter company name"}),i&&e.jsx("div",{className:"absolute right-3 top-1/2 transform -translate-y-1/2",children:e.jsx(W,{size:"sm"})})]}),v&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:"Company name already exists"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Business Type"}),e.jsxs("select",{value:s.businessType,onChange:l=>r({...s,businessType:l.target.value}),className:"input",children:[e.jsx("option",{value:"manufacturer",children:"Manufacturer"}),e.jsx("option",{value:"distributor",children:"Distributor"}),e.jsx("option",{value:"wholesaler",children:"Wholesaler"}),e.jsx("option",{value:"dropshipper",children:"Dropshipper"}),e.jsx("option",{value:"other",children:"Other"})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Ledger Account ",e.jsx("span",{className:"text-gray-400 text-xs",children:"(Auto-linked)"})]}),c?e.jsx("div",{className:"input bg-gray-50 text-gray-500",children:"Loading ledger account..."}):(()=>{const l=s.ledgerAccount,o=F.find(t=>(t._id||t.id)===l||(t.accountName||t.name||"").toLowerCase()==="accounts payable"||t.accountCode==="2110")||F[0],n=o?`${o.accountCode||"2110"} - ${o.accountName||o.name||"Accounts Payable"}`:"2110 - Accounts Payable";return e.jsxs(e.Fragment,{children:[e.jsx("input",{type:"text",value:n,className:"input bg-gray-50 text-gray-700 cursor-not-allowed",readOnly:!0,disabled:!0}),e.jsx("input",{type:"hidden",value:s.ledgerAccount}),e.jsxs("p",{className:"text-xs text-blue-600 mt-1",children:[e.jsx("span",{className:"font-medium",children:"ℹ️ Information:"}),' Suppliers are automatically linked to the "Accounts Payable" account (2110) for accounting purposes. This cannot be changed.']})]})})()]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Contact Person"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Name *"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",required:!0,value:s.contactPerson.name,onChange:l=>r({...s,contactPerson:{...s.contactPerson,name:l.target.value}}),className:`input ${P?"border-red-500":""}`,placeholder:"Enter full name"}),$&&e.jsx("div",{className:"absolute right-3 top-1/2 transform -translate-y-1/2",children:e.jsx(W,{size:"sm"})})]}),P&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:"Contact name already exists"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Title"}),e.jsx("input",{type:"text",value:s.contactPerson.title,onChange:l=>r({...s,contactPerson:{...s.contactPerson,title:l.target.value}}),className:"input",placeholder:"Job title"})]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Contact Information"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Email"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"email",value:s.email,onChange:l=>r({...s,email:l.target.value}),className:`input ${k?"border-red-500":""}`,placeholder:"email@company.com (optional)"}),B&&e.jsx("div",{className:"absolute right-3 top-1/2 transform -translate-y-1/2",children:e.jsx(W,{size:"sm"})})]}),k&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:"Email already exists"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Phone"}),e.jsx("input",{type:"tel",value:s.phone,onChange:l=>r({...s,phone:l.target.value}),className:"input",placeholder:"(555) 123-4567"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Website"}),e.jsx("input",{type:"url",value:s.website,onChange:l=>r({...s,website:l.target.value}),className:"input",placeholder:"https://company.com"})]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Business Terms"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Payment Terms"}),e.jsxs("select",{value:s.paymentTerms,onChange:l=>r({...s,paymentTerms:l.target.value}),className:"input",children:[e.jsx("option",{value:"cash",children:"Cash"}),e.jsx("option",{value:"net15",children:"Net 15"}),e.jsx("option",{value:"net30",children:"Net 30"}),e.jsx("option",{value:"net45",children:"Net 45"}),e.jsx("option",{value:"net60",children:"Net 60"}),e.jsx("option",{value:"net90",children:"Net 90"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Credit Limit ($)"}),e.jsx("input",{type:"number",min:"0",value:s.creditLimit,onChange:l=>r({...s,creditLimit:parseFloat(l.target.value)||0}),className:"input",placeholder:"0"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Opening Balance ($)"}),e.jsx("input",{type:"number",step:"0.01",value:s.openingBalance,onChange:l=>r({...s,openingBalance:parseFloat(l.target.value)||0}),className:"input",placeholder:"0.00"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Positive means you owe the supplier. Use a negative value if the supplier has an advance/credit."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Lead Time (days)"}),e.jsx("input",{type:"number",min:"0",value:s.leadTime,onChange:l=>r({...s,leadTime:parseInt(l.target.value)||0}),className:"input",placeholder:"7"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Min Order Amount ($)"}),e.jsx("input",{type:"number",min:"0",value:s.minOrderAmount,onChange:l=>r({...s,minOrderAmount:parseFloat(l.target.value)||0}),className:"input",placeholder:"0"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Rating (1-5)"}),e.jsxs("select",{value:s.rating,onChange:l=>r({...s,rating:parseInt(l.target.value)}),className:"input",children:[e.jsx("option",{value:1,children:"1 Star"}),e.jsx("option",{value:2,children:"2 Stars"}),e.jsx("option",{value:3,children:"3 Stars"}),e.jsx("option",{value:4,children:"4 Stars"}),e.jsx("option",{value:5,children:"5 Stars"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Reliability"}),e.jsxs("select",{value:s.reliability,onChange:l=>r({...s,reliability:l.target.value}),className:"input",children:[e.jsx("option",{value:"excellent",children:"Excellent"}),e.jsx("option",{value:"good",children:"Good"}),e.jsx("option",{value:"average",children:"Average"}),e.jsx("option",{value:"poor",children:"Poor"})]})]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Address"}),e.jsx("div",{className:"space-y-4",children:s.addresses.map((l,o)=>e.jsx("div",{className:"border border-gray-200 rounded-lg p-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Street Address"}),e.jsx("input",{type:"text",value:l.street,onChange:n=>U(o,"street",n.target.value),className:"input",placeholder:"123 Main St"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"City *"}),e.jsxs("select",{value:l.city||"",onChange:n=>U(o,"city",n.target.value),className:"input",required:!0,disabled:E,children:[e.jsx("option",{value:"",children:"Select a city"}),Array.isArray(N)&&N.map(n=>e.jsxs("option",{value:n.name,children:[n.name,n.state?`, ${n.state}`:""]},n._id||n.name))]}),E&&e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Loading cities..."}),!E&&N.length===0&&e.jsx("p",{className:"text-xs text-amber-600 mt-1",children:"No cities available. Please add cities first."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"State"}),e.jsx("input",{type:"text",value:l.state,onChange:n=>U(o,"state",n.target.value),className:"input",placeholder:"State"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"ZIP Code"}),e.jsx("input",{type:"text",value:l.zipCode,onChange:n=>U(o,"zipCode",n.target.value),className:"input",placeholder:"12345"})]})]})},o))})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Status & Notes"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Status"}),e.jsxs("select",{value:s.status,onChange:l=>r({...s,status:l.target.value}),className:"input",children:[e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"inactive",children:"Inactive"}),e.jsx("option",{value:"suspended",children:"Suspended"}),e.jsx("option",{value:"blacklisted",children:"Blacklisted"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Notes"}),e.jsx("textarea",{value:s.notes,onChange:l=>r({...s,notes:l.target.value}),className:"input",rows:"3",placeholder:"Additional notes about this supplier..."})]})]})]}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-6 border-t border-gray-200",children:[e.jsx("button",{type:"button",onClick:b,className:"btn btn-secondary",children:"Cancel"}),e.jsx("button",{type:"submit",className:"btn btn-primary",children:a?"Update Supplier":"Add Supplier"})]})]})]})})}):null},dt=()=>{var n;const[a,A]=h.useState(""),[b,S]=h.useState({}),[s,r]=h.useState(null),[B,f]=h.useState(!1),[k,w]=h.useState(!1),[i,x]=h.useState(null),v={search:a,limit:999999,...b},{data:g,isLoading:$,error:O,refetch:P}=ge(v,{refetchOnMountOrArgChange:!0}),[L,{isLoading:z}]=je(),[u,{isLoading:j}]=ye(),[p,{isLoading:c}]=be(),N=t=>{S(t)},E=()=>{S({}),A("")},F=((n=g==null?void 0:g.data)==null?void 0:n.suppliers)||(g==null?void 0:g.suppliers)||[],Q=me(F,a,["companyName","contactPerson.name","email","phone"],{threshold:.4,minScore:.3,limit:null}),U=t=>{var d,T,X,Y,H,K,ee,te,se,ae;const m={companyName:(d=t.companyName)==null?void 0:d.trim(),contactPerson:{name:(X=(T=t.contactPerson)==null?void 0:T.name)==null?void 0:X.trim(),title:(H=(Y=t.contactPerson)==null?void 0:Y.title)==null?void 0:H.trim()},email:((K=t.email)==null?void 0:K.trim())||void 0,phone:((ee=t.phone)==null?void 0:ee.trim())||void 0,website:((te=t.website)==null?void 0:te.trim())||void 0,businessType:t.businessType,paymentTerms:t.paymentTerms,creditLimit:Number(t.creditLimit)||0,rating:Number(t.rating)||3,reliability:t.reliability,minOrderAmount:Number(t.minOrderAmount)||0,minOrderQuantity:Number(t.minOrderQuantity)||1,leadTime:Number(t.leadTime)||7,status:t.status,notes:((se=t.notes)==null?void 0:se.trim())||void 0,addresses:((ae=t.addresses)==null?void 0:ae.map(y=>{var I,M,R,_;return{type:y.type,street:(I=y.street)==null?void 0:I.trim(),city:(M=y.city)==null?void 0:M.trim(),state:(R=y.state)==null?void 0:R.trim(),zipCode:(_=y.zipCode)==null?void 0:_.trim(),country:y.country||"US",isDefault:y.isDefault||!1}}))||[]};s?u({id:s._id,data:m}).unwrap().then(()=>{C.success("Supplier updated successfully!"),f(!1),r(null),P()}).catch(y=>{var I;C.error(((I=y==null?void 0:y.data)==null?void 0:I.message)||"Failed to update supplier")}):L(m).unwrap().then(()=>{C.success("Supplier created successfully!"),f(!1),r(null),P()}).catch(y=>{var R,_;const I=((R=y==null?void 0:y.data)==null?void 0:R.message)||"Failed to create supplier",M=(_=y==null?void 0:y.data)==null?void 0:_.errors;M&&Array.isArray(M)?C.error(`${I}: ${M.join(", ")}`):C.error(I)})},q=t=>{r(t),f(!0)},l=t=>{window.confirm(`Are you sure you want to delete ${t.companyName}?`)&&p(t._id).unwrap().then(()=>{C.success("Supplier deleted successfully!"),P()}).catch(m=>{var d;C.error(((d=m==null?void 0:m.data)==null?void 0:d.message)||"Failed to delete supplier")})},o=()=>{r(null),f(!0)};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Suppliers"}),e.jsx("p",{className:"text-gray-600",children:"Manage your supplier relationships and information"})]}),e.jsx("div",{className:"flex-shrink-0",children:e.jsxs("button",{onClick:o,className:"btn btn-primary btn-md w-full sm:w-auto",children:[e.jsx(Be,{className:"h-4 w-4 mr-2"}),"Add Supplier"]})})]}),e.jsx("div",{className:"flex items-center space-x-4",children:e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(re,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search suppliers...",value:a,onChange:t=>A(t.target.value),className:"input pl-10"})]})}),e.jsx($e,{onImportComplete:()=>queryClient.invalidateQueries("suppliers"),filters:v}),e.jsx(Re,{filters:b,onFiltersChange:N,onClearFilters:E}),$?e.jsx(de,{count:6}):O?e.jsx("div",{className:"card",children:e.jsxs("div",{className:"card-content text-center py-12",children:[e.jsx(D,{className:"mx-auto h-12 w-12 text-red-400"}),e.jsx("h3",{className:"mt-4 text-lg font-medium text-gray-900",children:"Error loading suppliers"}),e.jsx("p",{className:"mt-2 text-gray-600",children:O.message})]})}):Q.length>0?e.jsx("div",{className:"card w-full",children:e.jsxs("div",{className:"card-content p-0 w-full",children:[e.jsx("div",{className:"bg-gray-50 px-8 py-6 border-b border-gray-200",children:e.jsxs("div",{className:"grid grid-cols-12 gap-6 items-center",children:[e.jsxs("div",{className:"col-span-4",children:[e.jsx("h3",{className:"text-base font-medium text-gray-700",children:"Company Name"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Contact Person"})]}),e.jsx("div",{className:"col-span-2",children:e.jsx("h3",{className:"text-base font-medium text-gray-700",children:"Email"})}),e.jsx("div",{className:"col-span-1",children:e.jsx("h3",{className:"text-base font-medium text-gray-700",children:"Phone"})}),e.jsx("div",{className:"col-span-1",children:e.jsx("h3",{className:"text-base font-medium text-gray-700",children:"Status"})}),e.jsx("div",{className:"col-span-1",children:e.jsx("h3",{className:"text-base font-medium text-gray-700",children:"Type"})}),e.jsx("div",{className:"col-span-1",children:e.jsx("h3",{className:"text-base font-medium text-gray-700",children:"Rating"})}),e.jsx("div",{className:"col-span-1",children:e.jsx("h3",{className:"text-base font-medium text-gray-700",children:"Credit"})}),e.jsx("div",{className:"col-span-1",children:e.jsx("h3",{className:"text-base font-medium text-gray-700",children:"Actions"})})]})}),e.jsx("div",{className:"divide-y divide-gray-200",children:Q.map(t=>e.jsx("div",{className:"px-8 py-6 hover:bg-gray-50",children:e.jsxs("div",{className:"grid grid-cols-12 gap-6 items-center",children:[e.jsx("div",{className:"col-span-4",children:e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx(D,{className:"h-6 w-6 text-gray-400"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-base font-medium text-gray-900",children:t.companyName}),e.jsx("p",{className:"text-sm text-gray-500",children:t.contactPerson.name})]})]})}),e.jsx("div",{className:"col-span-2",children:e.jsx("p",{className:"text-sm text-gray-600",children:t.email||"-"})}),e.jsx("div",{className:"col-span-1",children:e.jsx("p",{className:"text-sm text-gray-600",children:t.phone||"-"})}),e.jsx("div",{className:"col-span-1",children:e.jsx("span",{className:`badge ${t.status==="active"?"badge-success":t.status==="inactive"?"badge-gray":t.status==="suspended"?"badge-danger":"badge-gray"}`,children:t.status})}),e.jsx("div",{className:"col-span-1",children:e.jsx("span",{className:`badge ${t.businessType==="wholesaler"?"badge-info":"badge-gray"}`,children:t.businessType})}),e.jsx("div",{className:"col-span-1",children:e.jsxs("div",{className:"flex items-center",children:[[...Array(5)].map((m,d)=>e.jsx(Oe,{className:`h-3 w-3 ${d<t.rating?"text-yellow-400 fill-current":"text-gray-300"}`},d)),e.jsxs("span",{className:"ml-1 text-xs text-gray-600",children:["(",t.rating,")"]})]})}),e.jsx("div",{className:"col-span-1",children:e.jsx("p",{className:"text-sm text-gray-600",children:Math.round(t.creditLimit||0)})}),e.jsx("div",{className:"col-span-1",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("button",{onClick:()=>{x({type:"Supplier",id:t._id,name:t.companyName}),w(!0)},className:"text-green-600 hover:text-green-800",title:"Notes",children:e.jsx(ze,{className:"h-5 w-5"})}),e.jsx("button",{onClick:()=>q(t),className:"text-primary-600 hover:text-primary-800",children:e.jsx(Ue,{className:"h-5 w-5"})}),e.jsx("button",{onClick:()=>l(t),className:"text-danger-600 hover:text-danger-800",children:e.jsx(Me,{className:"h-5 w-5"})})]})})]})},t._id))})]})}):e.jsx("div",{className:"card",children:e.jsxs("div",{className:"card-content text-center py-12",children:[e.jsx(D,{className:"mx-auto h-12 w-12 text-gray-400"}),e.jsx("h3",{className:"mt-4 text-lg font-medium text-gray-900",children:"No suppliers found"}),e.jsx("p",{className:"mt-2 text-gray-600",children:a?"Try adjusting your search terms.":"Get started by adding your first supplier"}),!a&&e.jsx("button",{onClick:o,className:"mt-4 btn btn-primary",children:"Add Your First Supplier"})]})}),e.jsx(_e,{supplier:s,onSave:U,onCancel:()=>{f(!1),r(null)},isOpen:B}),k&&i&&e.jsx(Te,{entityType:i.type,entityId:i.id,entityName:i.name,onClose:()=>{w(!1),x(null)}})]})};export{dt as Suppliers};
